<?php	/**	 * German language file for phpPgAdmin.  Use this as a basis	 *	 * @maintainer Laurenz Albe <laurenz.albe@wien.gv.at>	 *     * $Id: german.php,v 1.30 2008/02/18 23:06:51 ioguix Exp $	 */	// Language and character set	$lang['applang'] = 'Deutsch';	$lang['appcharset'] = 'UTF-8';	$lang['applocale'] = 'de_DE';	$lang['appdbencoding'] = 'LATIN1';	$lang['applangdir'] = 'ltr';	// Welcome	$lang['strintro'] = 'Willkommen bei phpPgAdmin.';	$lang['strppahome'] = 'phpPgAdmin Homepage';	$lang['strpgsqlhome'] = 'PostgreSQL Homepage';	$lang['strpgsqlhome_url'] = 'http://www.postgresql.org/';	$lang['strlocaldocs'] = 'PostgreSQL Dokumentation (lokal)';	$lang['strreportbug'] = 'Fehler melden';	$lang['strviewfaq'] = 'Online-FAQ ansehen';	$lang['strviewfaq_url'] = 'http://phppgadmin.sourceforge.net/?page=faq';		// Basic strings	$lang['strlogin'] = 'Anmelden';	$lang['strloginfailed'] = 'Anmeldung fehlgeschlagen';	$lang['strlogindisallowed'] = 'Anmeldung aus Sicherheitsgründen verweigert.';	$lang['strserver'] = 'Server';	$lang['strservers'] = 'Server';	$lang['strintroduction'] = 'Einführung';	$lang['strhost'] = 'Host';	$lang['strport'] = 'Port';	$lang['strlogout'] = 'Abmelden';	$lang['strowner'] = 'Besitzer';	$lang['straction'] = 'Aktion';	$lang['stractions'] = 'Aktionen';	$lang['strname'] = 'Name';	$lang['strdefinition'] = 'Definition';	$lang['strproperties'] = 'Eigenschaften';	$lang['strbrowse'] = 'Durchsuchen';	$lang['strenable'] = 'Einschalten';	$lang['strdisable'] = 'Ausschalten';	$lang['strdrop'] = 'Löschen';	$lang['strdropped'] = 'Gelöscht';	$lang['strnull'] = 'Null';	$lang['strnotnull'] = 'Nicht Null';	$lang['strprev'] = '< Zurück';	$lang['strnext'] = 'Weiter >';	$lang['strfirst'] = '<< Anfang';	$lang['strlast'] = 'Ende >>';	$lang['strfailed'] = 'Fehlgeschlagen';	$lang['strcreate'] = 'Erstellen';	$lang['strcreated'] = 'Erstellt';	$lang['strcomment'] = 'Kommentar';	$lang['strlength'] = 'Länge';	$lang['strdefault'] = 'Standardwert';	$lang['stralter'] = 'Ändern';	$lang['strok'] = 'OK';	$lang['strcancel'] = 'Abbrechen';	$lang['strac'] = 'Automatische Vervollständigung einschalten';	$lang['strsave'] = 'Speichern';	$lang['strreset'] = 'Zurücksetzen';	$lang['strinsert'] = 'Einfügen';	$lang['strselect'] = 'Abfrage';	$lang['strdelete'] = 'Löschen';	$lang['strupdate'] = 'Ändern';	$lang['strreferences'] = 'Verweise';	$lang['stryes'] = 'Ja';	$lang['strno'] = 'Nein';	$lang['strtrue'] = 'WAHR';	$lang['strfalse'] = 'FALSCH';	$lang['stredit'] = 'Bearbeiten';	$lang['strcolumn'] = 'Spalte';	$lang['strcolumns'] = 'Spalten';	$lang['strrows'] = 'Datensätze';	$lang['strrowsaff'] = 'Datensätze betroffen.';	$lang['strobjects'] = 'Objekt(e)';	$lang['strback'] = 'Zurück';	$lang['strqueryresults'] = 'Abfrageergebnis';	$lang['strshow'] = 'Anzeigen';	$lang['strempty'] = 'Leeren';	$lang['strlanguage'] = 'Sprache';	$lang['strencoding'] = 'Zeichenkodierung';	$lang['strvalue'] = 'Wert';	$lang['strunique'] = 'Eindeutig';	$lang['strprimary'] = 'Primär';	$lang['strexport'] = 'Exportieren';	$lang['strimport'] = 'Importieren';	$lang['strallowednulls'] = 'NULL-Zeichen erlaubt';	$lang['strbackslashn'] = '\N';	$lang['stremptystring'] = 'Leere Zeichenkette / Leere Spalte';	$lang['strsql'] = 'SQL';	$lang['stradmin'] = 'Admin';	$lang['strvacuum'] = 'Bereinigen';	$lang['stranalyze'] = 'Analysieren';	$lang['strclusterindex'] = 'Cluster';	$lang['strclustered'] = 'Geclustert?';	$lang['strreindex'] = 'Reindexieren';	$lang['strexecute'] = 'Ausführen';	$lang['stradd'] = 'Hinzufügen';	$lang['strevent'] = 'Ereignis';	$lang['strwhere'] = 'Bedingung';	$lang['strinstead'] = 'Tu stattdessen';	$lang['strwhen'] = 'Wann';	$lang['strformat'] = 'Format';	$lang['strdata'] = 'Daten';	$lang['strconfirm'] = 'Bestätigen';	$lang['strexpression'] = 'Ausdruck';	$lang['strellipsis'] = '...';	$lang['strseparator'] = ': ';	$lang['strexpand'] = 'Aufklappen';	$lang['strcollapse'] = 'Zuklappen';	$lang['strfind'] = 'Suchen';	$lang['stroptions'] = 'Optionen';	$lang['strrefresh'] = 'Aktualisieren';	$lang['strdownload'] = 'Herunterladen';	$lang['strdownloadgzipped'] = 'gzip-komprimiert herunterladen';	$lang['strinfo'] = 'Info';	$lang['stroids'] = 'OIDs';	$lang['stradvanced'] = 'Erweitert';	$lang['strvariables'] = 'Variable';	$lang['strprocess'] = 'Prozess';	$lang['strprocesses'] = 'Prozesse';	$lang['strsetting'] = 'Einstellung';	$lang['streditsql'] = 'SQL bearbeiten';	$lang['strruntime'] = 'Laufzeit gesamt: %s ms';	$lang['strpaginate'] = 'Ergebnisse seitenweise anzeigen';	$lang['struploadscript'] = 'oder laden Sie ein SQL-Script hoch:';	$lang['strstarttime'] = 'Beginnzeitpunkt';	$lang['strfile'] = 'Datei';	$lang['strfileimported'] = 'Datei importiert.';	$lang['strtrycred'] = 'Diese Anmeldedaten für alle Server verwenden';	$lang['strconfdropcred']  = 'Aus Sicherheitsgründen werden gemeinsamme Anmeldedaten beim Abmelden gelöscht. Sind Sie sicher, dass sie sich abmelden wollen?';	$lang['stractionsonmultiplelines'] = 'Mehrzeilige Aktionen';	$lang['strselectall'] = 'Alle auswählen';	$lang['strunselectall'] = 'Alle abwählen';	$lang['strlocale'] = 'Spracheinstellung';	// User-supplied SQL history	$lang['strhistory'] = 'Befehlsspeicher';	$lang['strnohistory'] = 'Kein Befehlsspeicher.';	$lang['strclearhistory'] = 'Befehlsspeicher löschen';	$lang['strdelhistory'] = 'Aus dem Befehlsspeicher löschen';	$lang['strconfdelhistory'] = 'Diese Abfrage wirklich aus dem Befehlsspeicher löschen?';	$lang['strconfclearhistory'] = 'Befehlsspeicher wirklich löschen?';	$lang['strnodatabaseselected'] = 'Bitte wählen Sie eine Datenbank aus.';	// Database sizes	$lang['strsize'] = 'Größe';	$lang['strbytes'] = 'Bytes';	$lang['strkb'] = 'kB';	$lang['strmb'] = 'MB';	$lang['strgb'] = 'GB';	$lang['strtb'] = 'TB';	// Error handling	$lang['strnoframes'] = 'Diese Anwendung funktioniert am besten mit einem Browser, der Frames beherrscht, kann aber mit dem untenstehenden Link auch ohne Frames verwendet werden.';	$lang['strnoframeslink'] = 'Ohne Frames arbeiten';	$lang['strbadconfig'] = 'Ihre config.inc.php ist nicht aktuell. Sie müssen sie aus der config.inc.php-dist neu erzeugen.';	$lang['strnotloaded'] = 'Ihre PHP-Installation unterstützt PostgreSQL nicht. Sie müssen PHP unter Verwendung der Konfigurationsoption --with-pgsql neu kompilieren.';	$lang['strpostgresqlversionnotsupported'] = 'Ihre PostgreSQL-Version wird nicht unterstützt. Bitte stellen Sie Ihre Datenbank auf Version %s oder eine neuere Version um.';	$lang['strbadschema'] = 'Ungültiges Schema angegeben.';	$lang['strbadencoding'] = 'Kann die Client-Zeichenkodierung nicht in der Datenbank setzen.';	$lang['strsqlerror'] = 'SQL-Fehler:';	$lang['strinstatement'] = 'In der Anweisung:';	$lang['strinvalidparam'] = 'Unzulässige Script-Parameter.';	$lang['strnodata'] = 'Keine Datensätze gefunden.';	$lang['strnoobjects'] = 'Keine Objekte gefunden.';	$lang['strrownotunique'] = 'Dieser Datensatz hat keine eindeutige Spalte.';	$lang['strnoreportsdb'] = 'Sie haben die Berichtsdatenbank nicht angelegt. In der Datei INSTALL finden Sie Anweisungen dafür.';	$lang['strnouploads'] = 'Das Hochladen von Dateien ist ausgeschaltet.';	$lang['strimporterror'] = 'Importfehler.';	$lang['strimporterror-fileformat'] = 'Importfehler: Dateiformat konnte nicht automatisch bestimmt werden.';	$lang['strimporterrorline'] = 'Importfehler in Zeile %s.';	$lang['strimporterrorline-badcolumnnum'] = 'Importfehler in Zeile %s: die Zeile hat nicht die richtige Anzahl von Spalten.';	$lang['strimporterror-uploadedfile'] = 'Importfehler: die Datei konnte nicht auf den Server geladen werden';	$lang['strcannotdumponwindows'] = 'Das Ablegen von komplizierten Tabellen- und Schemanamen wird auf Windows nicht unterstützt.';	$lang['strinvalidserverparam'] = 'Es wurde versucht, mit einem ungültigen Server-Parameter eine Verbindung herzustellen. Möglicherweise versucht jemand, in Ihr System einzubrechen.'; 	$lang['strnoserversupplied'] = 'Kein Server angegeben!';	// Tables	$lang['strtable'] = 'Tabelle';	$lang['strtables'] = 'Tabellen';	$lang['strshowalltables'] = 'Alle Tabellen anzeigen';	$lang['strnotables'] = 'Keine Tabellen gefunden.';	$lang['strnotable'] = 'Keine Tabelle gefunden.';	$lang['strcreatetable'] = 'Neue Tabelle erstellen';	$lang['strcreatetablelike'] = 'Neue Tabelle als Kopie einer bestehenden anlegen';	$lang['strcreatetablelikeparent'] = 'Ursprüngliche Tabelle';	$lang['strcreatelikewithdefaults'] = 'DEFAULT-Werte mitkopieren';	$lang['strcreatelikewithconstraints'] = 'Constraints mitkopieren';	$lang['strcreatelikewithindexes'] = 'Indizes mitkopieren';	$lang['strtablename'] = 'Tabellenname';	$lang['strtableneedsname'] = 'Sie müssen für die Tabelle einen Namen angeben.';	$lang['strtablelikeneedslike'] = 'Sie müssen eine Tabelle angeben, deren Spaltendefinitionen kopiert werden sollen.';	$lang['strtableneedsfield'] = 'Sie müssen mindestens eine Spalte angeben.';	$lang['strtableneedscols'] = 'Sie müssen eine zulässige Anzahl von Spalten angeben.';	$lang['strtablecreated'] = 'Tabelle erstellt.';	$lang['strtablecreatedbad'] = 'Erstellen der Tabelle fehlgeschlagen.';	$lang['strconfdroptable'] = 'Sind Sie sicher, dass Sie die Tabelle "%s" löschen möchten?';	$lang['strtabledropped'] = 'Tabelle gelöscht.';	$lang['strtabledroppedbad'] = 'Löschen der Tabelle fehlgeschlagen.';	$lang['strconfemptytable'] = 'Sind Sie sicher, dass Sie den Inhalt der Tabelle "%s" löschen möchten?';	$lang['strtableemptied'] = 'Tabelleninhalt gelöscht.';	$lang['strtableemptiedbad'] = 'Löschen des Tabelleninhaltes fehlgeschlagen.';	$lang['strinsertrow'] = 'Datensatz einfügen';	$lang['strrowinserted'] = 'Datensatz eingefügt.';	$lang['strrowinsertedbad'] = 'Einfügen des Datensatzes fehlgeschlagen.';	$lang['strrowduplicate'] = 'Einfügen des Datensatzes fehlgeschlagen: es wurde versucht, ein Duplikat einzufügen.';	$lang['streditrow'] = 'Datensatz bearbeiten';	$lang['strrowupdated'] = 'Datensatz geändert.';	$lang['strrowupdatedbad'] = 'Ändern des Datensatzes fehlgeschlagen.';	$lang['strdeleterow'] = 'Datensatz löschen';	$lang['strconfdeleterow'] = 'Sind Sie sicher, dass Sie diesen Datensatz löschen möchten?';	$lang['strrowdeleted'] = 'Datensatz gelöscht.';	$lang['strrowdeletedbad'] = 'Löschen des Datensatzes fehlgeschlagen.';	$lang['strinsertandrepeat'] = 'Einfügen und Wiederholen';	$lang['strnumcols'] = 'Anzahl der Spalten';	$lang['strcolneedsname'] = 'Sie müssen einen Namen für die Spalte angeben';	$lang['strselectallfields'] = 'Alle Felder auswählen';	$lang['strselectneedscol'] = 'Sie müssen mindestens eine Spalte anzeigen lassen.';	$lang['strselectunary'] = 'Unäre Operatoren können keine Werte haben.';	$lang['strcolumnaltered'] = 'Spalte geändert.';	$lang['strcolumnalteredbad'] = 'Ändern der Spalte fehlgeschlagen.';	$lang['strconfdropcolumn'] = 'Sind Sie sicher, dass Sie die Spalte "%s" aus der Tabelle "%s" löschen möchten?';	$lang['strcolumndropped'] = 'Spalte gelöscht.';	$lang['strcolumndroppedbad'] = 'Löschen der Spalte fehlgschlagen.';	$lang['straddcolumn'] = 'Spalte hinzufügen';	$lang['strcolumnadded'] = 'Spalte hinzugefügt.';	$lang['strcolumnaddedbad'] = 'Hinzufügen der Spalte fehlgeschlagen.';	$lang['strcascade'] = 'CASCADE';	$lang['strtablealtered'] = 'Tabelle geändert.';	$lang['strtablealteredbad'] = 'Ändern der Tabelle fehlgeschlagen.';	$lang['strdataonly'] = 'Nur die Daten';	$lang['strstructureonly'] = 'Nur die Struktur';	$lang['strstructureanddata'] = 'Struktur und Daten';	$lang['strtabbed'] = 'Mit Tabluatoren';	$lang['strauto'] = 'Automatisch';	$lang['strconfvacuumtable'] = 'Sind sie sicher, dass Sie VACUUM auf "%s" ausführen wollen?';	$lang['strconfanalyzetable'] = 'Sind sie sicher, dass Sie ANALYZE auf "%s" ausführen wollen?';	$lang['strestimatedrowcount'] = 'Geschätzte Anzahl von Datensätzen';	$lang['strspecifytabletoanalyze'] = 'Sie müssen mindestens eine Tabelle angeben, die analysiert werden soll.';	$lang['strspecifytabletoempty'] = 'Sie müssen mindestens eine Tabelle angeben, deren Inhalt gelöscht werden soll.';	$lang['strspecifytabletodrop'] = 'Sie müssen mindestens eine Tabelle angeben, die gelöscht werden soll.';	$lang['strspecifytabletovacuum'] = 'Sie müssen mindestens eine Tabelle angeben, die bereinigt werden soll.';	// Columns	$lang['strcolprop'] = 'Spalteneigenschaften';	$lang['strnotableprovided'] = 'Keine Tabelle angegeben!';			// Users	$lang['struser'] = 'Benutzer';	$lang['strusers'] = 'Benutzer';	$lang['strusername'] = 'Benutzername';	$lang['strpassword'] = 'Passwort';	$lang['strsuper'] = 'Superuser?';	$lang['strcreatedb'] = 'Datenbank erstellen?';	$lang['strexpires'] = 'Gültig bis';	$lang['strsessiondefaults'] = 'Standardwerte für Datenbanksitzungen';	$lang['strnousers'] = 'Keine Benutzer gefunden.';	$lang['struserupdated'] = 'Benutzer geändert.';	$lang['struserupdatedbad'] = 'Ändern des Benutzers fehlgeschlagen.';	$lang['strshowallusers'] = 'Alle Benutzer anzeigen';	$lang['strcreateuser'] = 'Benutzer anlegen';	$lang['struserneedsname'] = 'Sie müssen einen Namen für den Benutzer angeben.';	$lang['strusercreated'] = 'Benutzer angelegt.';	$lang['strusercreatedbad'] = 'Anlegen des Benutzers fehlgeschlagen.';	$lang['strconfdropuser'] = 'Sind Sie sicher, dass Sie den Benutzer "%s" löschen möchten?';	$lang['struserdropped'] = 'Benutzer gelöscht.';	$lang['struserdroppedbad'] = 'Löschen des Benutzers fehlgeschlagen.';	$lang['straccount'] = 'Benutzerkonto';	$lang['strchangepassword'] = 'Passwort ändern';	$lang['strpasswordchanged'] = 'Passwort geändert.';	$lang['strpasswordchangedbad'] = 'Ändern des Passwortes fehlgeschlagen.';	$lang['strpasswordshort'] = 'Passwort ist zu kurz.';	$lang['strpasswordconfirm'] = 'Passwort und Passwortbestätigung stimmen nicht überein.';		// Groups	$lang['strgroup'] = 'Gruppe';	$lang['strgroups'] = 'Gruppen';	$lang['strshowallgroups'] = 'Alle Gruppen anzeigen';	$lang['strnogroup'] = 'Gruppe nicht gefunden.';	$lang['strnogroups'] = 'Keine Gruppe gefunden.';	$lang['strcreategroup'] = 'Gruppe anlegen';	$lang['strgroupneedsname'] = 'Sie müssen für die Gruppe einen Namen angeben.';	$lang['strgroupcreated'] = 'Gruppe angelegt.';	$lang['strgroupcreatedbad'] = 'Anlegen der Gruppe fehlgeschlagen.';		$lang['strconfdropgroup'] = 'Sind Sie sicher, dass Sie die Gruppe "%s" löschen möchten?';	$lang['strgroupdropped'] = 'Gruppe gelöscht.';	$lang['strgroupdroppedbad'] = 'Löschen der Gruppe fehlgeschlagen.';	$lang['strmembers'] = 'Mitglieder';	$lang['strmemberof'] = 'Mitglied von';	$lang['stradminmembers'] = 'Administrative Mitglieder';	$lang['straddmember'] = 'Mitglied hinzufügen';	$lang['strmemberadded'] = 'Mitglied hinzugefügt.';	$lang['strmemberaddedbad'] = 'Hinzufügen des Mitglieds fehlgeschlagen.';	$lang['strdropmember'] = 'Mitglied löschen';	$lang['strconfdropmember'] = 'Sind Sie sicher, dass Sie das Mitglied "%s" aus der Gruppe "%s" löschen wollen?';	$lang['strmemberdropped'] = 'Mitglied gelöscht.';	$lang['strmemberdroppedbad'] = 'Löschen des Mitglieds fehlgeschlagen.';	// Roles	$lang['strrole'] = 'Rolle';	$lang['strroles'] = 'Rollen';	$lang['strshowallroles'] = 'Alle Rollen anzeigen';	$lang['strnoroles'] = 'Keine Rollen gefunden.';	$lang['strinheritsprivs'] = 'Rechte vererben?';	$lang['strcreaterole'] = 'Rolle anlegen';	$lang['strcancreaterole'] = 'Darf Rollen anlegen?';	$lang['strrolecreated'] = 'Rolle angelegt.';	$lang['strrolecreatedbad'] = 'Anlegen der Rolle fehlgeschlagen.';	$lang['strrolealtered'] = 'Rolle geändert.';	$lang['strrolealteredbad'] = 'Ändern der Rolle fehlgeschlagen.';	$lang['strcanlogin'] = 'Darf sich anmelden?';	$lang['strconnlimit'] = 'Maximalzahl an Datenbankverbindungen';	$lang['strdroprole'] = 'Rolle löschen';	$lang['strconfdroprole'] = 'Sind Sie sicher, dass Sie die Rolle "%s" löschen möchten?';	$lang['strroledropped'] = 'Rolle gelöscht.';	$lang['strroledroppedbad'] = 'Löschen der Rolle fehlgeschlagen.';	$lang['strnolimit'] = 'Unbeschränkt';	$lang['strnever'] = 'Nie';	$lang['strroleneedsname'] = 'Sie müssen für die Rolle einen Namen angeben.';	// Privileges	$lang['strprivilege'] = 'Recht';	$lang['strprivileges'] = 'Rechte';	$lang['strnoprivileges'] = 'Für dieses Objekt gelten die Standard-Eigentümerrechte.';	$lang['strgrant'] = 'Rechte erteilen';	$lang['strrevoke'] = 'Rechte entziehen';	$lang['strgranted'] = 'Rechte geändert.';	$lang['strgrantfailed'] = 'Ändern der Rechte fehlgeschlagen.';	$lang['strgrantbad'] = 'Sie müssen mindestens einen Benutzer oder eine Gruppe und mindestens ein Recht angeben.';	$lang['strgrantor'] = 'Recht vergeben von';	$lang['strasterisk'] = '*';	// Databases	$lang['strdatabase'] = 'Datenbank';	$lang['strdatabases'] = 'Datenbanken';	$lang['strshowalldatabases'] = 'Alle Datenbanken anzeigen';	$lang['strnodatabases'] = 'Keine Datenbanken gefunden.';	$lang['strcreatedatabase'] = 'Datenbank erstellen';	$lang['strdatabasename'] = 'Datenbankname';	$lang['strdatabaseneedsname'] = 'Sie müssen für die Datenbank einen Namen angeben.';	$lang['strdatabasecreated'] = 'Datenbank erstellt.';	$lang['strdatabasecreatedbad'] = 'Erstellen der Datenbank fehlgeschlagen.';	$lang['strconfdropdatabase'] = 'Sind Sie sicher, dass Sie die Datenbank "%s" löschen möchten?';	$lang['strdatabasedropped'] = 'Datenbank gelöscht.';	$lang['strdatabasedroppedbad'] = 'Löschen der Datenbank fehlgeschlagen.';	$lang['strentersql'] = 'Auszuführende SQL-Anweisungen hier eingeben:';	$lang['strsqlexecuted'] = 'SQL-Anweisungen ausgeführt.';	$lang['strvacuumgood'] = 'Tabellenbereinigung abgeschlossen.';	$lang['strvacuumbad'] = 'Tabellenbereinigung fehlgeschlagen.';	$lang['stranalyzegood'] = 'Analyse abgeschlossen.';	$lang['stranalyzebad'] = 'Analyse fehlgeschlagen.';	$lang['strreindexgood'] = 'Neuindexierung abgeschlossen.';	$lang['strreindexbad'] = 'Neuindexierung fehlgeschlagen.';	$lang['strfull'] = 'Mit Reorganisation';	$lang['strfreeze'] = 'Aggressives "Einfrieren"';	$lang['strforce'] = 'Erzwingen';	$lang['strsignalsent'] = 'Signal gesendet.';	$lang['strsignalsentbad'] = 'Senden des Signales fehlgeschlagen.';	$lang['strallobjects'] = 'Alle Objekte';	$lang['strdatabasealtered'] = 'Datenbank geändert.';	$lang['strdatabasealteredbad'] = 'Ändern der Datenbank fehlgeschlagen.';	$lang['strspecifydatabasetodrop'] = 'Sie müssen mindestens eine Datenbank angeben, die gelöscht werden soll.';	// Views	$lang['strview'] = 'Sicht';	$lang['strviews'] = 'Sichten';	$lang['strshowallviews'] = 'Alle Sichten anzeigen';	$lang['strnoview'] = 'Keine Sicht gefunden.';	$lang['strnoviews'] = 'Keine Sichten gefunden.';	$lang['strcreateview'] = 'Sicht erstellen';	$lang['strviewname'] = 'Name der Sicht';	$lang['strviewneedsname'] = 'Sie müssen für die Sicht einen Namen angeben.';	$lang['strviewneedsdef'] = 'Sie müssen für die Sicht eine Definition angeben.';	$lang['strviewneedsfields'] = 'Sie müssen die Spalten angeben, die sie in der Sicht haben wollen.';	$lang['strviewcreated'] = 'Sicht erstellt.';	$lang['strviewcreatedbad'] = 'Erstellen der Sicht fehlgeschlagen.';	$lang['strconfdropview'] = 'Sind Sie sicher, dass Sie die Sicht "%s" löschen möchten?';	$lang['strviewdropped'] = 'Sicht gelöscht.';	$lang['strviewdroppedbad'] = 'Löschen der Sicht fehlgeschlagen.';	$lang['strviewupdated'] = 'Sicht geändert.';	$lang['strviewupdatedbad'] = 'Ändern der Sicht fehlgeschlagen.';	$lang['strviewlink'] = 'Verbindende Schlüssel';	$lang['strviewconditions'] = 'Zusätzliche Bedingungen';	$lang['strcreateviewwiz'] = 'Sicht mit dem Assistenten erstellen';	$lang['strrenamedupfields'] = 'Doppelte Spalten umbenennen';	$lang['strdropdupfields'] = 'Doppelte Spalten entfernen';	$lang['strerrordupfields'] = 'Fehler bei den doppelten Spalten';	$lang['strviewaltered'] = 'Sicht geändert.';	$lang['strviewalteredbad'] = 'Ändern der Sicht fehlgeschlagen.';	$lang['strspecifyviewtodrop'] = 'Sie müssen mindestens eine Sicht angeben, die gelöscht werden soll.';	// Sequences	$lang['strsequence'] = 'Sequenz';	$lang['strsequences'] = 'Sequenzen';	$lang['strshowallsequences'] = 'Alle Sequenzen anzeigen';	$lang['strnosequence'] = 'Keine Sequenz gefunden.';	$lang['strnosequences'] = 'Keine Sequenzen gefunden.';	$lang['strcreatesequence'] = 'Sequenz erstellen';	$lang['strlastvalue'] = 'Letzter Wert';	$lang['strincrementby'] = 'Erhöhen um';		$lang['strstartvalue'] = 'Startwert';	$lang['strmaxvalue'] = 'Maximalwert';	$lang['strminvalue'] = 'Minimalwert';	$lang['strcachevalue'] = 'Anzahl Werte im Cache';	$lang['strlogcount'] = 'WAL-Zähler (log_cnt)';	$lang['strcancycle'] = 'Zyklisch?';	$lang['striscalled'] = 'Wird erhöht werden, wenn der nächste Wert angefordert wird (is_called)?';	$lang['strsequenceneedsname'] = 'Sie müssen für die Sequenz einen Namen angeben.';	$lang['strsequencecreated'] = 'Sequenz erstellt.';	$lang['strsequencecreatedbad'] = 'Erstellen der Sequenz fehlgeschlagen.';	$lang['strconfdropsequence'] = 'Sind Sie sicher, dass die die Sequenz "%s" löschen möchten?';	$lang['strsequencedropped'] = 'Sequenz gelöscht.';	$lang['strsequencedroppedbad'] = 'Löschen der Sequenz fehlgeschlagen.';	$lang['strsequencereset'] = 'Sequenz zurückgesetzt.';	$lang['strsequenceresetbad'] = 'Rücksetzen der Sequenz fehlgeschlagen.'; 	$lang['strsequencealtered'] = 'Sequenz geändert.'; 	$lang['strsequencealteredbad'] = 'Ändern der Sequenz fehlgeschlagen.'; 	$lang['strsetval'] = 'Wert setzen'; 	$lang['strsequencesetval'] = 'Sequenzwert gesetzt.'; 	$lang['strsequencesetvalbad'] = 'Setzen des Sequenzwertes fehlgeschlagen.'; 	$lang['strnextval'] = 'Wert erhöhen'; 	$lang['strsequencenextval'] = 'Sequenzwert erhöht.'; 	$lang['strsequencenextvalbad'] = 'Erhöhen des Sequenzwertes fehlgeschlagen.';	$lang['strspecifysequencetodrop'] = 'Sie müssen mindestens eine Sequenz angeben, die gelöscht werden soll.';		// Indexes	$lang['strindex'] = 'Index';	$lang['strindexes'] = 'Indizes';	$lang['strindexname'] = 'Indexname';	$lang['strshowallindexes'] = 'Alle Indizes anzeigen';	$lang['strnoindex'] = 'Kein Index gefunden.';	$lang['strnoindexes'] = 'Keine Indizes gefunden.';	$lang['strcreateindex'] = 'Index erstellen';	$lang['strtabname'] = 'Tabellenname';	$lang['strcolumnname'] = 'Spaltenname';	$lang['strindexneedsname'] = 'Sie müssen für den Index einen Namen angeben.';	$lang['strindexneedscols'] = 'Sie müssen eine zulässige Anzahl an Spalten angeben.';	$lang['strindexcreated'] = 'Index erstellt.';	$lang['strindexcreatedbad'] = 'Erstellen des Index fehlgeschlagen.';	$lang['strconfdropindex'] = 'Sind Sie sicher, dass sie den Index "%s" löschen möchten?';	$lang['strindexdropped'] = 'Index gelöscht.';	$lang['strindexdroppedbad'] = 'Löschen des Index fehlgeschlagen.';	$lang['strkeyname'] = 'Schlüsselname';	$lang['struniquekey'] = 'Eindeutiger Schlüssel';	$lang['strprimarykey'] = 'Primärerschlüssel'; 	$lang['strindextype'] = 'Typ des Index';	$lang['strtablecolumnlist'] = 'Spalten in der Tabelle';	$lang['strindexcolumnlist'] = 'Spalten im Index';	$lang['strconfcluster'] = 'Sind Sie sicher, dass Sie "%s" clustern wollen?';	$lang['strclusteredgood'] = 'Clustern abgeschlossen.';	$lang['strclusteredbad'] = 'Clustern fehlgeschlagen.';	// Rules	$lang['strrules'] = 'Regeln';	$lang['strrule'] = 'Regel';	$lang['strshowallrules'] = 'Alle Regeln anzeigen';	$lang['strnorule'] = 'Keine Regel gefunden.';	$lang['strnorules'] = 'Keine Regeln gefunden.';	$lang['strcreaterule'] = 'Regel erstellen';	$lang['strrulename'] = 'Regelname';	$lang['strruleneedsname'] = 'Sie müssen für die Regel einen Namen angeben.';	$lang['strrulecreated'] = 'Regel erstellt.';	$lang['strrulecreatedbad'] = 'Erstellen der Regel fehlgeschlagen.';	$lang['strconfdroprule'] = 'Sind Sie sicher, dass Sie die Regel "%s" in der Tabelle "%s" löschen möchten?';	$lang['strruledropped'] = 'Regel gelöscht.';	$lang['strruledroppedbad'] = 'Löschen der Regel fehlgeschlagen.';	// Constraints	$lang['strconstraint'] = 'Constraint';	$lang['strconstraints'] = 'Constraints';	$lang['strshowallconstraints'] = 'Alle Constraints anzeigen';	$lang['strnoconstraints'] = 'Keine Constraints gefunden.';	$lang['strcreateconstraint'] = 'Constraint erstellen';	$lang['strconstraintcreated'] = 'Constraint erstellt.';	$lang['strconstraintcreatedbad'] = 'Erstellen des Constraints fehlgeschlagen.';	$lang['strconfdropconstraint'] = 'Sind Sie sicher, dass Sie den Constraint "%s" in der Tabelle "%s" löschen möchten?';	$lang['strconstraintdropped'] = 'Constraint gelöscht.';	$lang['strconstraintdroppedbad'] = 'Löschen des Constraints fehlgeschlagen.';	$lang['straddcheck'] = 'Check-Constraint hinzufügen';	$lang['strcheckneedsdefinition'] = 'Ein Check-Constraint braucht eine Definition.';	$lang['strcheckadded'] = 'Check-Constraint hinzugefügt.';	$lang['strcheckaddedbad'] = 'Hinzufügen des Check-Constraints fehlgeschlagen.';	$lang['straddpk'] = 'Primärschlüssel hinzufügen';	$lang['strpkneedscols'] = 'Ein Primärschlüssel benötigt mindestens eine Spalte.';	$lang['strpkadded'] = 'Primärschlüssel hinzugefügt.';	$lang['strpkaddedbad'] = 'Hinzufügen des Primärschlüssels fehlgeschlagen.';	$lang['stradduniq'] = 'Eindeutigen Schlüssel hinzufügen';	$lang['struniqneedscols'] = 'Ein eindeutiger Schlüssel benötigt mindestens eine Spalte.';	$lang['struniqadded'] = 'Eindeutiger Schlüssel hinzugefügt.';	$lang['struniqaddedbad'] = 'Hinzufügen eines eindeutigen Schlüssels fehlgeschlagen.';	$lang['straddfk'] = 'Fremdschlüssel hinzufügen';	$lang['strfkneedscols'] = 'Ein Fremdschlüssel benötigt mindestens eine Spalte.';	$lang['strfkneedstarget'] = 'Ein Fremdschlüssel benötigt eine Zieltabelle.';	$lang['strfkadded'] = 'Fremdschlüssel hinzugefügt.';	$lang['strfkaddedbad'] = 'Hinzufügen eines Fremdschlüssels fehlgeschlagen.';	$lang['strfktarget'] = 'Zieltabelle';	$lang['strfkcolumnlist'] = 'Spalten im Schlüssel';	$lang['strondelete'] = 'ON DELETE';	$lang['stronupdate'] = 'ON UPDATE';	// Functions	$lang['strfunction'] = 'Funktion';	$lang['strfunctions'] = 'Funktionen';	$lang['strshowallfunctions'] = 'Alle Funktionen anzeigen';	$lang['strnofunction'] = 'Keine Funktion gefunden.';	$lang['strnofunctions'] = 'Keine Funktionen gefunden.';	$lang['strcreateplfunction'] = 'SQL/PL-Funktion erstellen';	$lang['strcreateinternalfunction'] = 'Interne Funktion erstellen';	$lang['strcreatecfunction'] = 'C-Funktion erstellen';	$lang['strfunctionname'] = 'Funktionsname';	$lang['strreturns'] = 'Rückgabetyp';	$lang['strproglanguage'] = 'Programmiersprache';	$lang['strfunctionneedsname'] = 'Sie müssen für die Funktion einen Namen angeben.';	$lang['strfunctionneedsdef'] = 'Sie müssen für die Funktion eine Definition angeben.';	$lang['strfunctioncreated'] = 'Funktion erstellt.';	$lang['strfunctioncreatedbad'] = 'Erstellen der Funktion fehlgeschlagen.';	$lang['strconfdropfunction'] = 'Sind Sie sicher, dass sie die Funktion "%s" löschen möchten?';	$lang['strfunctiondropped'] = 'Funktion gelöscht.';	$lang['strfunctiondroppedbad'] = 'Löschen der Funktion fehlgeschlagen.';	$lang['strfunctionupdated'] = 'Funktion geändert.';	$lang['strfunctionupdatedbad'] = 'Ändern der Funktion fehlgeschlagen.';	$lang['strobjectfile'] = 'Objektdatei';	$lang['strlinksymbol'] = 'Link-Symbol';	$lang['strarguments'] = 'Funktionsargumente';	$lang['strargmode'] = 'Richtung';	$lang['strargtype'] = 'Datentyp';	$lang['strargadd'] = 'Weiteres Argument hinzufügen';	$lang['strargremove'] = 'Dieses Argument entfernen';	$lang['strargnoargs'] = 'Diese Funktion kann nur ohne Argumente aufgerufen werden.';	$lang['strargenableargs'] = 'Diese Funktion kann mit Argumenten aufgerufen werden.';	$lang['strargnorowabove'] = 'Oberhalb dieser Spalte muss eine weitere Spalte sein.';	$lang['strargnorowbelow'] = 'Unterhalb dieser Spalte muss eine weitere Spalte sein.';	$lang['strargraise'] = 'Hinaufschieben.';	$lang['strarglower'] = 'Hinunterschieben.';	$lang['strargremoveconfirm'] = 'Sind Sie sicher, dass Sie dieses Argument entfernen wollen? Das kann nicht rückgängig gemacht werden.';	$lang['strfunctioncosting'] = 'Ausführungskosten';	$lang['strresultrows'] = 'Geschätzte Anzahl der Ergebniszeilen';	$lang['strexecutioncost'] = 'Geschätzte Ausführungskosten';	$lang['strspecifyfunctiontodrop'] = 'Sie müssen mindestens eine Funktion angeben, die gelöscht werden soll.';	// Triggers	$lang['strtrigger'] = 'Trigger';	$lang['strtriggers'] = 'Trigger';	$lang['strshowalltriggers'] = 'Alle Trigger anzeigen';	$lang['strnotrigger'] = 'Kein Trigger gefunden.';	$lang['strnotriggers'] = 'Keine Trigger gefunden.';	$lang['strcreatetrigger'] = 'Trigger erstellen';	$lang['strtriggerneedsname'] = 'Sie müssen für den Trigger einen Namen angeben.';	$lang['strtriggerneedsfunc'] = 'Sie müssen für den Trigger eine Funktion angeben.';	$lang['strtriggercreated'] = 'Trigger erstellt.';	$lang['strtriggercreatedbad'] = 'Erstellen des Triggers fehlgeschlagen.';	$lang['strconfdroptrigger'] = 'Sind Sie sicher, dass Sie den Trigger "%s" auf der Tabelle "%s" löschen möchten?';	$lang['strconfenabletrigger'] = 'Sind Sie sicher, dass Sie den Trigger "%s" auf der Tabelle "%s" aktivieren möchten?';	$lang['strconfdisabletrigger'] = 'Sind Sie sicher, dass Sie den Trigger "%s" auf der Tabelle "%s" deaktivieren möchten?';	$lang['strtriggerdropped'] = 'Trigger gelöscht.';	$lang['strtriggerdroppedbad'] = 'Löschen des Triggers fehlgeschlagen.';	$lang['strtriggerenabled'] = 'Trigger aktiviert.';	$lang['strtriggerenabledbad'] = 'Aktivieren des Triggers fehlgeschlagen.';	$lang['strtriggerdisabled'] = 'Trigger deaktiviert.';	$lang['strtriggerdisabledbad'] = 'Deaktivieren des Triggers fehlgeschlagen.';	$lang['strtriggeraltered'] = 'Trigger geändert.';	$lang['strtriggeralteredbad'] = 'Ändern des Triggers fehlgeschlagen.';	$lang['strforeach'] = 'Für alle';	// Types	$lang['strtype'] = 'Datentyp';	$lang['strtypes'] = 'Datentypen';	$lang['strshowalltypes'] = 'Alle Datentypen anzeigen';	$lang['strnotype'] = 'Kein Datentyp gefunden.';	$lang['strnotypes'] = 'Keine Datentypen gefunden.';	$lang['strcreatetype'] = 'Datentyp erstellen';	$lang['strcreatecomptype'] = 'Zusammengesetzten Typ erstellen';	$lang['strcreateenumtype'] = 'Aufzählungstyp erstellen';	$lang['strtypeneedsfield'] = 'Sie müssen mindestens ein Feld angeben.';	$lang['strtypeneedsvalue'] = 'Sie müssen mindestens einen Wert angeben.';	$lang['strtypeneedscols'] = 'Sie müssen eine gültige Anzahl von Spalten angeben.';	$lang['strtypeneedsvals'] = 'Sie müssen eine gültige Anzahl von Werten angeben.';	$lang['strinputfn'] = 'Eingabefunktion';	$lang['stroutputfn'] = 'Ausgabefunktion';	$lang['strpassbyval'] = 'Übergabe "by value"?';	$lang['stralignment'] = 'Alignment';	$lang['strelement'] = 'Element';	$lang['strdelimiter'] = 'Trennzeichen';	$lang['strstorage'] = 'Speicherung';	$lang['strfield'] = 'Spalte';	$lang['strnumfields'] = 'Anzahl Spalten';	$lang['strnumvalues'] = 'Anzahl Werte';	$lang['strtypeneedsname'] = 'Sie müssen einen Namen für den Datentyp angeben.';	$lang['strtypeneedslen'] = 'Sie müssen eine Länge für den Datentyp angeben.';	$lang['strtypecreated'] = 'Datentyp erstellt.';	$lang['strtypecreatedbad'] = 'Erstellen des Datentypen fehlgeschlagen.';	$lang['strconfdroptype'] = 'Sind Sie sicher, dass Sie den Datentyp "%s" löschen möchten?';	$lang['strtypedropped'] = 'Datentyp gelöscht.';	$lang['strtypedroppedbad'] = 'Löschen des Datentyps fehlgeschlagen.';	$lang['strflavor'] = 'Art';	$lang['strbasetype'] = 'Basis-Typ';	$lang['strcompositetype'] = 'Zusammengesetzt';	$lang['strpseudotype'] = 'Pseudo';	$lang['strenum'] = 'Aufzählend';	$lang['strenumvalues'] = 'Wert';	// Schemas	$lang['strschema'] = 'Schema';	$lang['strschemas'] = 'Schemata';	$lang['strshowallschemas'] = 'Alle Schemata anzeigen';	$lang['strnoschema'] = 'Kein Schema gefunden.';	$lang['strnoschemas'] = 'Keine Schemata gefunden.';	$lang['strcreateschema'] = 'Schema erstellen';	$lang['strschemaname'] = 'Name des Schema';	$lang['strschemaneedsname'] = 'Sie müssen für das Schema einen Namen angeben.';	$lang['strschemacreated'] = 'Schema erstellt.';	$lang['strschemacreatedbad'] = 'Erstellen des Schemas fehlgeschlagen.';	$lang['strconfdropschema'] = 'Sind Sie sicher, dass sie das Schema "%s" löschen möchten?';	$lang['strschemadropped'] = 'Schema gelöscht.';	$lang['strschemadroppedbad'] = 'Löschen des Schemas fehlgeschlagen';	$lang['strschemaaltered'] = 'Schema geändert.';	$lang['strschemaalteredbad'] = 'Ändern des Schemas fehlgeschlagen.';	$lang['strsearchpath'] = 'Schemasuchpfad';	$lang['strspecifyschematodrop'] = 'Sie müssen mindestens ein Schema angeben, das gelöscht werden soll.';	// Reports	$lang['strreport'] = 'Bericht';	$lang['strreports'] = 'Berichte';	$lang['strshowallreports'] = 'Alle Berichte anzeigen';	$lang['strnoreports'] = 'Keine Berichte gefunden.';	$lang['strcreatereport'] = 'Bericht erstellen.';	$lang['strreportdropped'] = 'Bericht gelöscht.';	$lang['strreportdroppedbad'] = 'Löschen des Berichtes fehlgeschlagen.';	$lang['strconfdropreport'] = 'Sind Sie sicher, dass Sie den Bericht "%s" löschen wollen?';	$lang['strreportneedsname'] = 'Sie müssen für den Bericht einen Namen angeben.';	$lang['strreportneedsdef'] = 'Sie müssen eine SQL-Abfrage für den Bericht eingeben.';	$lang['strreportcreated'] = 'Bericht gespeichert.';	$lang['strreportcreatedbad'] = 'Speichern des Berichtes fehlgeschlagen.';	// Domains	$lang['strdomain'] = 'Domäne';	$lang['strdomains'] = 'Domänen';	$lang['strshowalldomains'] = 'Alle Domänen anzeigen';	$lang['strnodomains'] = 'Keine Domänen gefunden.';	$lang['strcreatedomain'] = 'Domäne erstellen';	$lang['strdomaindropped'] = 'Domäne gelöscht.';	$lang['strdomaindroppedbad'] = 'Löschen der Domäne fehlgeschlagen.';	$lang['strconfdropdomain'] = 'Sind Sie sicher, dass Sie die Domäne "%s" löschen wollen?';	$lang['strdomainneedsname'] = 'Sie müssen einen Namen für die Domäne angeben.';	$lang['strdomaincreated'] = 'Domäne erstellt.';	$lang['strdomaincreatedbad'] = 'Erstellen der Domäne fehlgeschlagen.';	$lang['strdomainaltered'] = 'Domäne geändert.';	$lang['strdomainalteredbad'] = 'Ändern der Domäne fehlgeschlagen.';		// Operators	$lang['stroperator'] = 'Operator';	$lang['stroperators'] = 'Operatoren';	$lang['strshowalloperators'] = 'Alle Operatoren anzeigen';	$lang['strnooperator'] = 'Kein Operator gefunden.';	$lang['strnooperators'] = 'Keine Operatoren gefunden.';	$lang['strcreateoperator'] = 'Operator erstellen';	$lang['strleftarg'] = 'Typ des linken Arguments';	$lang['strrightarg'] = 'Typ des rechter Arguments';	$lang['strcommutator'] = 'Kommutator';	$lang['strnegator'] = 'Negator';	$lang['strrestrict'] = 'Funktion zur Schätzung der Restriktions-Selektivität';	$lang['strjoin'] = 'Funktion zur Schätzung der Join-Selektivität';	$lang['strhashes'] = 'Unterstützt Hash-Joins';	$lang['strmerges'] = 'Unterstützt Merge-Joins';	$lang['strleftsort'] = 'Kleiner-Operator zum Sortieren der linken Seite';	$lang['strrightsort'] = 'Kleiner-Operator zum Sortieren der rechten Seite';	$lang['strlessthan'] = 'Kleiner-Operator';	$lang['strgreaterthan'] = 'Größer-Operator';	$lang['stroperatorneedsname'] = 'Sie müssen einen Namen für den Operator angeben.';	$lang['stroperatorcreated'] = 'Operator erstellt.';	$lang['stroperatorcreatedbad'] = 'Erstellen des Operators fehlgeschlagen.';	$lang['strconfdropoperator'] = 'Sind Sie sicher, dass Sie den Operator "%s" löschen wollen?';	$lang['stroperatordropped'] = 'Operator gelöscht.';	$lang['stroperatordroppedbad'] = 'Löschen des Operators fehlgeschlagen.';	// Casts	$lang['strcasts'] = 'Typumwandlungen';	$lang['strnocasts'] = 'Keine Typumwandlungen gefunden.';	$lang['strsourcetype'] = 'Ursprungs-Datentyp';	$lang['strtargettype'] = 'Ziel-Datentyp';	$lang['strimplicit'] = 'Implizit';	$lang['strinassignment'] = 'Bei Zuweisungen';	$lang['strbinarycompat'] = '(Binärkompatibel)';		// Conversions	$lang['strconversions'] = 'Konvertierungen';	$lang['strnoconversions'] = 'Keine Konvertierungen gefunden.';	$lang['strsourceencoding'] = 'Ursprungs-Zeichenkodierung';	$lang['strtargetencoding'] = 'Ziel-Zeichenkodierung';		// Languages	$lang['strlanguages'] = 'Programmiersprachen';	$lang['strnolanguages'] = 'Keine Sprachen gefunden.';	$lang['strtrusted'] = 'Vertrauenswürdig';		// Info	$lang['strnoinfo'] = 'Keine Informationen vorhanden.';	$lang['strreferringtables'] = 'Tabellen, die mit Fremdschlüsseln auf diese Tabelle verweisen';	$lang['strparenttables'] = 'Elterntabellen';	$lang['strchildtables'] = 'Kindtabellen';	// Aggregates	$lang['straggregate'] = 'Aggregatsfunktion';	$lang['straggregates'] = 'Aggregatsfunktionen';	$lang['strnoaggregates'] = 'Keine Aggregatsfunktionen gefunden.';	$lang['stralltypes'] = '(Alle Typen)';	$lang['strcreateaggregate'] = 'Aggregatsfunktion erstellen';	$lang['straggrbasetype'] = 'Eingabedatentyp';	$lang['straggrsfunc'] = 'Zustandsübergangsfunktion';	$lang['straggrstype'] = 'Datentyp für den Zustandswert';	$lang['straggrffunc'] = 'Ergebnisfunktion';	$lang['straggrinitcond'] = 'Zustandswert zu Beginn';	$lang['straggrsortop'] = 'Operator für Sortierung';	$lang['strconfdropaggregate'] = 'Sind Sie sicher, dass Sie die Aggregatsfunktion "%s" löschen wollen?';	$lang['straggregatedropped'] = 'Aggregatsfunktion gelöscht.';	$lang['straggregatedroppedbad'] = 'Löschen der Aggregatsfunktion fehlgeschlagen.';	$lang['straggraltered'] = 'Aggregatsfunktion geändert.';	$lang['straggralteredbad'] = 'Ändern der Aggregatsfunktion fehlgeschlagen.';	$lang['straggrneedsname'] = 'Sie müssen einen Namen für die Aggregatsfunktion angeben.';	$lang['straggrneedsbasetype'] = 'Sie müssen den Eingabedatentyp für die Aggregatsfunktion angeben.';	$lang['straggrneedssfunc'] = 'Sie müssen den Namen der Zustandsübergangsfunktion für die Aggregatsfunktion angeben.';	$lang['straggrneedsstype'] = 'Sie müssen den Datentyp für den Zustandswert der Aggregatsfunktion angeben.';	$lang['straggrcreated'] = 'Aggregatsfunktion erstellt.';	$lang['straggrcreatedbad'] = 'Erstellen der Aggregatsfunktion fehlgeschlagen.';	$lang['straggrshowall'] = 'Alle Aggregatsfunktionen anzeigen';	// Operator Classes	$lang['stropclasses'] = 'Operatorklassen';	$lang['strnoopclasses'] = 'Keine Operatorklassen gefunden.';	$lang['straccessmethod'] = 'Zugriffsmethode';	// Stats and performance	$lang['strrowperf'] = 'Zeilen-Performance';	$lang['strioperf'] = 'E/A Performance';	$lang['stridxrowperf'] = 'Index-Zeilen-Performance';	$lang['stridxioperf'] = 'Index-E/A-Performance';	$lang['strpercent'] = '%';	$lang['strsequential'] = 'Sequentiell';	$lang['strscan'] = 'Durchsuchen';	$lang['strread'] = 'Lesen';	$lang['strfetch'] = 'Holen';	$lang['strheap'] = 'Heap';	$lang['strtoast'] = 'TOAST';	$lang['strtoastindex'] = 'TOAST-Index';	$lang['strcache'] = 'Zwischenspeicher';	$lang['strdisk'] = 'Festplatte';	$lang['strrows2'] = 'Zeilen';	// Tablespaces	$lang['strtablespace'] = 'Tablespace';	$lang['strtablespaces'] = 'Tablespaces';	$lang['strshowalltablespaces'] = 'Alle Tablespaces anzeigen';	$lang['strnotablespaces'] = 'Keine Tablespaces gefunden.';	$lang['strcreatetablespace'] = 'Tablespace erstellen';	$lang['strlocation'] = 'Pfad';	$lang['strtablespaceneedsname'] = 'Sie müssen einen Namen für den Tablespace angeben.';	$lang['strtablespaceneedsloc'] = 'Sie müssen ein Verzeichnis angeben, in dem Sie den Tablespace erstellen möchten.';	$lang['strtablespacecreated'] = 'Tablespace erstellt.';	$lang['strtablespacecreatedbad'] = 'Erstellen des Tablespace fehlgeschlagen.';	$lang['strconfdroptablespace'] = 'Sind Sie sicher, dass Sie den Tablespace "%s" löschen wollen?';	$lang['strtablespacedropped'] = 'Tablespace gelöscht.';	$lang['strtablespacedroppedbad'] = 'Löschen des Tablespace fehlgeschlagen.';	$lang['strtablespacealtered'] = 'Tablespace geändert.';	$lang['strtablespacealteredbad'] = 'Ändern des Tablespace fehlgeschlagen.';	// Slony clusters	$lang['strcluster'] = 'Cluster';	$lang['strnoclusters'] = 'Keine Cluster gefunden.';	$lang['strconfdropcluster'] = 'Sind Sie sicher, dass Sie den Cluster "%s" löschen möchten?';	$lang['strclusterdropped'] = 'Cluster gelöscht.';	$lang['strclusterdroppedbad'] = 'Löschen des Clusters fehlgeschlagen.';	$lang['strinitcluster'] = 'Cluster initialisieren';	$lang['strclustercreated'] = 'Cluster initialisiert.';	$lang['strclustercreatedbad'] = 'Initialisierung des Clusters fehlgeschlagen.';	$lang['strclusterneedsname'] = 'Sie müssen einen Namen für den Cluster angeben.';	$lang['strclusterneedsnodeid'] = 'Sie müssen eine ID für den lokalen Cluster-Knoten angeben.';	// Slony nodes	$lang['strnodes'] = 'Cluster-Knoten';	$lang['strnonodes'] = 'Keine Cluster-Knoten gefunden.';	$lang['strcreatenode'] = 'Cluster-Knoten erstellen';	$lang['strid'] = 'ID';	$lang['stractive'] = 'Aktiv';	$lang['strnodecreated'] = 'Cluster-Knoten erstellt.';	$lang['strnodecreatedbad'] = 'Erstellen des Cluster-Knotens fehlgeschlagen.';	$lang['strconfdropnode'] = 'Sind Sie sicher, dass Sie Cluster-Knoten "%s" löschen möchten?';	$lang['strnodedropped'] = 'Cluster-Knoten gelöscht.';	$lang['strnodedroppedbad'] = 'Löschen des Cluster-Knotens fehlgeschlagen.';	$lang['strfailover'] = 'Übernahme';	$lang['strnodefailedover'] = 'Cluster-Knoten übernommen.';	$lang['strnodefailedoverbad'] = 'Übernahme des Cluster-Knotens fehlgeschlagen.';	$lang['strstatus'] = 'Status';		$lang['strhealthy'] = 'Gesund';	$lang['stroutofsync'] = 'Nicht Synchronisiert';	$lang['strunknown'] = 'Unbekannt';		// Slony paths		$lang['strpaths'] = 'Kommunikationspfade';	$lang['strnopaths'] = 'Keine Kommunikationspfade gefunden.';	$lang['strcreatepath'] = 'Kommunikationspfad erstellen';	$lang['strnodename'] = 'Name des Cluster-Knotens';	$lang['strnodeid'] = 'ID des Cluster-Knotens';	$lang['strconninfo'] = 'Connection-String';	$lang['strconnretry'] = 'Wartezeit vor erneutem Verbindungsversuch in Sekunden';	$lang['strpathneedsconninfo'] = 'Sie müssen einen Connection-String für den Kommunikationspfad angeben.';	$lang['strpathneedsconnretry'] = 'Sie müssen die Wartezeit vor einem erneuten Verbindungsversuch angeben.';	$lang['strpathcreated'] = 'Kommunikationspfad erstellt.';	$lang['strpathcreatedbad'] = 'Erstellen des Kommunikationspfades fehlgeschlagen.';	$lang['strconfdroppath'] = 'Sind Sie sicher, dass Sie den Kommunikationspfad "%s" löschen möchten?';	$lang['strpathdropped'] = 'Kommunikationspfad gelöscht.';	$lang['strpathdroppedbad'] = 'Löschen des Kommunikationspfades fehlgeschlagen.';	// Slony listens	$lang['strlistens'] = 'Zuhörer';	$lang['strnolistens'] = 'Keine Zuhörer gefunden.';	$lang['strcreatelisten'] = 'Zuhörer erstellen';	$lang['strlistencreated'] = 'Zuhörer erstellt.';	$lang['strlistencreatedbad'] = 'Erstellen des Zuhörers fehlgeschlagen.';	$lang['strconfdroplisten'] = 'Sind Sie sicher, dass Sie Zuhörer "%s" löschen möchten?';	$lang['strlistendropped'] = 'Zuhörer gelöscht.';	$lang['strlistendroppedbad'] = 'Löschen des Zuhörers fehlgeschlagen.';	// Slony replication sets	$lang['strrepsets'] = 'Replikationsgruppe';	$lang['strnorepsets'] = 'Keine Replikationsgruppen gefunden.';	$lang['strcreaterepset'] = 'Replikationsgruppe erstellen';	$lang['strrepsetcreated'] = 'Replikationsgruppe erstellt.';	$lang['strrepsetcreatedbad'] = 'Erstellen der Replikationsgruppe fehlgeschlagen.';	$lang['strconfdroprepset'] = 'Sind Sie sicher, dass Sie Replikationsgruppe "%s" löschen möchten?';	$lang['strrepsetdropped'] = 'Replikationsgruppe gelöscht.';	$lang['strrepsetdroppedbad'] = 'Löschen der Replikationsgruppe fehlgeschlagen.';	$lang['strmerge'] = 'Vereinigen';	$lang['strmergeinto'] = 'Vereinigen mit';	$lang['strrepsetmerged'] = 'Replikationsgruppen vereinige.';	$lang['strrepsetmergedbad'] = 'Vereinigung der Replikationsgruppen fehlgeschlagen.';	$lang['strmove'] = 'Verschieben';	$lang['strneworigin'] = 'Neuer Usrprung';	$lang['strrepsetmoved'] = 'Replikationsgruppe verschoben.';	$lang['strrepsetmovedbad'] = 'Verschieben der Replikationsgruppe fehlgeschlagen.';	$lang['strnewrepset'] = 'Neue Replikationsgruppe';	$lang['strlock'] = 'Sperren';	$lang['strlocked'] = 'Gesperrt';	$lang['strunlock'] = 'Entsperren';	$lang['strconflockrepset'] = 'Sind Sie sicher, dass Sie Replikationsgruppe "%s" sperren möchten?';	$lang['strrepsetlocked'] = 'Replikationsgruppe gesperrt.';	$lang['strrepsetlockedbad'] = 'Sperren der Replikationsgruppe fehlgeschlagen.';	$lang['strconfunlockrepset'] = 'Sind Sie sicher, dass Sie Replikationsgruppe "%s" entsperren möchten?';	$lang['strrepsetunlocked'] = 'Replikationsgruppe entsperrt.';	$lang['strrepsetunlockedbad'] = 'Entsperren der Replikationsgruppe fehlgeschlagen.';	$lang['stronlyonnode'] = 'Nur auf dem Cluster-Knoten';	$lang['strddlscript'] = 'DDL-Script';	$lang['strscriptneedsbody'] = 'Sie müssen ein Script angeben, das auf allen Cluster-Knoten ausgeführt werden soll.';	$lang['strscriptexecuted'] = 'DDL-Script für die Replikationsgruppe ausgeführt.';	$lang['strscriptexecutedbad'] = 'Ausführung des DDL-Scripts für die Replikationsgruppe fehlgeschlagen.';	$lang['strtabletriggerstoretain'] = 'Die folgenden Trigger werden von Slony NICHT deaktiviert:';	// Slony tables in replication sets	$lang['straddtable'] = 'Tabelle hinzufügen';	$lang['strtableneedsuniquekey'] = 'Damit eine Tabelle hinzugefügt werden kann, muss sie einen Primärschlüssel oder einen eindeutigen Schlüssel besitzen.';	$lang['strtableaddedtorepset'] = 'Tabelle zu Replikationsgruppe hinzugefügt.';	$lang['strtableaddedtorepsetbad'] = 'Hinzufügen der Tabelle zur Replikationsgruppe fehlgeschlagen.';	$lang['strconfremovetablefromrepset'] = 'Sind Sie sicher, dass Sie die Tabelle "%s" aus der Replikationsgruppe "%s" entfernen möchten?';	$lang['strtableremovedfromrepset'] = 'Tabelle aus Replikationsgruppe entfernt.';	$lang['strtableremovedfromrepsetbad'] = 'Entfernen der Tabelle aus der Replikationsgruppe fehlgeschlagen.';	// Slony sequences in replication sets	$lang['straddsequence'] = 'Sequenz hinzufügen';	$lang['strsequenceaddedtorepset'] = 'Sequenz zu Replikationsgruppe hinzugefügt.';	$lang['strsequenceaddedtorepsetbad'] = 'Hinzufügen der Sequenz zur Replikationsgruppe fehlgeschlagen.';	$lang['strconfremovesequencefromrepset'] = 'Sind Sie sicher, dass Sie die Sequenz "%s" aus der Replikationsgruppe "%s" entfernen möchten?';	$lang['strsequenceremovedfromrepset'] = 'Sequenz aus Replikationsgruppe entfernt.';	$lang['strsequenceremovedfromrepsetbad'] = 'Entfernen der Sequenz aus der Replikationsgruppe fehlgeschlagen.';	// Slony subscriptions	$lang['strsubscriptions'] = 'Abonnements';	$lang['strnosubscriptions'] = 'Keine Abonnements gefunden.';	// Miscellaneous	$lang['strtopbar'] = '%s läuft auf %s:%s -- Sie sind als "%s" angemeldet, %s';	$lang['strtimefmt'] = 'D, j. n. Y, G:i';	$lang['strhelp'] = 'Hilfe';	$lang['strhelpicon'] = '?';	$lang['strhelppagebrowser'] = 'Browser für Hilfeseiten';	$lang['strselecthelppage'] = 'Hilfeseite auswählen';	$lang['strinvalidhelppage'] = 'Ungültige Hilfeseite.';	$lang['strlogintitle'] = 'Bei %s anmelden';	$lang['strlogoutmsg'] = 'Von %s abgemendet';	$lang['strloading'] = 'Lade...';	$lang['strerrorloading'] = 'Fehler beim Laden';	$lang['strclicktoreload'] = 'Klicken Sie zum Neuladen';	// Autovacuum	$lang['strautovacuum'] = 'Autovacuum';	$lang['strturnedon'] = 'Eingeschaltet';	$lang['strturnedoff'] = 'Ausgeschaltet';	$lang['strenabled'] = 'Aktiviert';	$lang['strvacuumbasethreshold'] = 'Autovacuum-Schwellwert';	$lang['strvacuumscalefactor'] = 'Autovacuum-Skalierungsfaktor';	$lang['stranalybasethreshold'] = 'Analyze-Schwellwert';	$lang['stranalyzescalefactor'] = 'Analyze-Skalierungsfaktor';	$lang['strvacuumcostdelay'] = 'Pause nach Erreichen des Autovacuum-Kostenlimits';	$lang['strvacuumcostlimit'] = 'Autovacuum-Kostenlimits';	// Table-level Locks	$lang['strlocks'] = 'Sperren';	$lang['strtransaction'] = 'Transaktions-ID';	$lang['strvirtualtransaction'] = 'Virtuelle Transaktions-ID';	$lang['strprocessid'] = 'Prozess-ID';	$lang['strmode'] = 'Art der Sperre';	$lang['strislockheld'] = 'Sperre gewährt?';	// Prepared transactions	$lang['strpreparedxacts'] = 'Vorbereitete verteilte Transaktionen';	$lang['strxactid'] = 'Transaktions-ID';	$lang['strgid'] = 'Globale ID';		// Fulltext search	$lang['strfulltext'] = 'Volltextsuche';	$lang['strftsconfig'] = 'Volltextsuch-Konfiguration';	$lang['strftsconfigs'] = 'Konfigurationen';	$lang['strftscreateconfig'] = 'Volltextsuch-Konfiguration erstellen';	$lang['strftscreatedict'] = 'Wörterbuch erstellen';	$lang['strftscreatedicttemplate'] = 'Wörterbuch-Blaupause erstellen';	$lang['strftscreateparser'] = 'Parser erstellen';	$lang['strftsnoconfigs'] = 'Keine Volltextsuch-Konfigurationen gefunden.';	$lang['strftsconfigdropped'] = 'Volltextsuch-Konfiguration gelöscht.';	$lang['strftsconfigdroppedbad'] = 'Löschen der Volltextsuch-Konfiguration fehlgeschlagen.';	$lang['strconfdropftsconfig'] = 'Sind Sie sicher, dass Sie die Volltextsuch-Konfiguration "%s" löschen möchten?';	$lang['strconfdropftsdict'] = 'Sind Sie sicher, dass Sie das Wörterbuch "%s" löschen möchten?';	$lang['strconfdropftsmapping'] = 'Sind Sie sicher, dass Sie die Zuordnung "%s" der Volltextsuch-Konfiguration "%s" löschen möchten?';	$lang['strftstemplate'] = 'Blaupause';	$lang['strftsparser'] = 'Parser';	$lang['strftsconfigneedsname'] = 'Sie müssen für die Volltextsuch-Konfiguration einen Namen angeben.';	$lang['strftsconfigcreated'] = 'Volltextsuch-Konfiguration erstellt.';	$lang['strftsconfigcreatedbad'] = 'Erstellen der Volltextsuch-Konfiguration fehlgeschlagen.';	$lang['strftsmapping'] = 'Zuordnung';	$lang['strftsdicts'] = 'Wörterbücher';	$lang['strftsdict'] = 'Wörterbuch';	$lang['strftsemptymap'] = 'Leere Zuordnung für Volltextsuch-Konfiguration.';	$lang['strftswithmap'] = 'Mit Zuordnung';	$lang['strftsmakedefault'] = 'Als Standardwert für die angegebene Spracheinstellung festlegen';	$lang['strftsconfigaltered'] = 'Volltextsuch-Konfiguration geändert.';	$lang['strftsconfigalteredbad'] = 'Ändern der Volltextsuch-Konfiguration fehlgeschlagen.';	$lang['strftsconfigmap'] = 'Zuordnung für Volltextsuch-Konfiguration';	$lang['strftsparsers'] = 'Parsers für Volltextsuch-Konfiguration';	$lang['strftsnoparsers'] = 'Keine Parsers für Volltextsuch-Konfiguration vorhanden';	$lang['strftsnodicts'] = 'Keine Wörterbücher für die Volltextsuche vorhanden.';	$lang['strftsdictcreated'] = 'Wörterbuch für die Volltextsuche erstellt.';	$lang['strftsdictcreatedbad'] = 'Erstellen des Wörterbuches für die Volltextsuche fehlgeschlagen.';	$lang['strftslexize'] = 'Funktion zum Zerlegen in Lexeme';	$lang['strftsinit'] = 'Initialisierungsfunktion';	$lang['strftsoptionsvalues'] = 'Optionen und Werte';	$lang['strftsdictneedsname'] = 'Sie müssen für das Volltextsuch-Wörterbuch einen Namen angeben.';	$lang['strftsdictdropped'] = 'Wörterbuches für die Volltextsuche gelöscht.';	$lang['strftsdictdroppedbad'] = 'Löschen des Wörterbuches für die Volltextsuche fehlgeschlagen.';	$lang['strftsdictaltered'] = 'Wörterbuches für die Volltextsuche geändert.';	$lang['strftsdictalteredbad'] = 'Ändern des Wörterbuches für die Volltextsuche fehlgeschlagen.';	$lang['strftsaddmapping'] = 'Neue Zuordnung hinzufügen';	$lang['strftsspecifymappingtodrop'] = 'Sie müssen mindestens eine Zuordnung angeben, die gelöscht werden soll.';	$lang['strftsspecifyconfigtoalter'] = 'Sie müssen eine Volltextsuch-Konfiguration angeben, die geändert werden soll';	$lang['strftsmappingdropped'] = 'Volltextsuch-Zuordnung gelöscht.';	$lang['strftsmappingdroppedbad'] = 'Löschen der Volltextsuch-Zuordnung fehlgeschlagen.';	$lang['strftsnodictionaries'] = 'Keine Wörterbücher gefunden.';	$lang['strftsmappingaltered'] = 'Volltextsuch-Zuordnung geändert.';	$lang['strftsmappingalteredbad'] = 'Ändern der Volltextsuch-Zuordnung fehlgeschlagen.';	$lang['strftsmappingadded'] = 'Volltextsuch-Zuordnung hinzugefügt.';	$lang['strftsmappingaddedbad'] = 'Hinzufügen der Volltextsuch-Zuordnung fehlgeschlagen.';	$lang['strftstabconfigs'] = 'Volltextsuch-Konfigurationen';	$lang['strftstabdicts'] = 'Wörterbücher';	$lang['strftstabparsers'] = 'Parser';?>
<?php	/**	 * Class to hold various commonly used functions	 *	 * $Id: Misc.php,v 1.171 2008/03/17 21:35:48 ioguix Exp $	 */	class Misc {		// Tracking string to include in HREFs		var $href;		// Tracking string to include in forms		var $form;		/* Constructor */		function Misc() {		}		/**		 * Checks if dumps are properly set up		 * @param $all (optional) True to check pg_dumpall, false to just check pg_dump		 * @return True, dumps are set up, false otherwise		 */		function isDumpEnabled($all = false) {			$info = $this->getServerInfo();			return !empty($info[$all ? 'pg_dumpall_path' : 'pg_dump_path']);		}		/**		 * Sets the href tracking variable		 */		function setHREF() {			$this->href = $this->getHREF();		}		/**		 * Get a href query string, excluding objects below the given object type (inclusive)		 */		function getHREF($exclude_from = null) {			$href = '';			if (isset($_REQUEST['server']) && $exclude_from != 'server') {				$href .= 'server=' . urlencode($_REQUEST['server']);				if (isset($_REQUEST['database']) && $exclude_from != 'database') {					$href .= '&amp;database=' . urlencode($_REQUEST['database']);					if (isset($_REQUEST['schema']) && $exclude_from != 'schema') {						$href .= '&amp;schema=' . urlencode($_REQUEST['schema']);					}				}			}			return $href;		}		/**		 * Sets the form tracking variable		 */		function setForm() {			$this->form = '';			if (isset($_REQUEST['server'])) {				$this->form .= "<input type=\"hidden\" name=\"server\" value=\"" . htmlspecialchars($_REQUEST['server']) . "\" />\n";				if (isset($_REQUEST['database'])) {					$this->form .= "<input type=\"hidden\" name=\"database\" value=\"" . htmlspecialchars($_REQUEST['database']) . "\" />\n";					if (isset($_REQUEST['schema'])) {						$this->form .= "<input type=\"hidden\" name=\"schema\" value=\"" . htmlspecialchars($_REQUEST['schema']) . "\" />\n";					}				}			}		}		/**		 * Render a value into HTML using formatting rules specified		 * by a type name and parameters.		 *		 * @param $str The string to change		 *		 * @param $type Field type (optional), this may be an internal PostgreSQL type, or:		 *			yesno    - same as bool, but renders as 'Yes' or 'No'.		 *			pre      - render in a <pre> block.		 *			nbsp     - replace all spaces with &nbsp;'s		 *			verbatim - render exactly as supplied, no escaping what-so-ever.		 *			callback - render using a callback function supplied in the 'function' param.		 *		 * @param $params Type parameters (optional), known parameters:		 *			null     - string to display if $str is null, or set to TRUE to use a default 'NULL' string,		 *			           otherwise nothing is rendered.		 *			clip     - if true, clip the value to a fixed length, and append an ellipsis...		 *			cliplen  - the maximum length when clip is enabled (defaults to $conf['max_chars'])		 *			ellipsis - the string to append to a clipped value (defaults to $lang['strellipsis'])		 *			tag      - an HTML element name to surround the value.		 *			class    - a class attribute to apply to any surrounding HTML element.		 *			align    - an align attribute ('left','right','center' etc.)		 *			true     - (type='bool') the representation of true.		 *			false    - (type='bool') the representation of false.		 *			function - (type='callback') a function name, accepts args ($str, $params) and returns a rendering.		 *			lineno   - prefix each line with a line number.		 *			map      - an associative array.		 *		 * @return The HTML rendered value		 */		function printVal($str, $type = null, $params = array()) {			global $lang, $conf, $data;			// Shortcircuit for a NULL value			if (is_null($str))				return isset($params['null'])						? ($params['null'] === true ? '<i>NULL</i>' : $params['null'])						: '';			if (isset($params['map']) && isset($params['map'][$str])) $str = $params['map'][$str];			// Clip the value if the 'clip' parameter is true.			if (isset($params['clip']) && $params['clip'] === true) {				$maxlen = isset($params['cliplen']) && is_integer($params['cliplen']) ? $params['cliplen'] : $conf['max_chars'];				$ellipsis = isset($params['ellipsis']) ? $params['ellipsis'] : $lang['strellipsis'];				if (strlen($str) > $maxlen) {					$str = substr($str, 0, $maxlen-1) . $ellipsis;				}			}			$out = '';			switch ($type) {				case 'int2':				case 'int4':				case 'int8':				case 'float4':				case 'float8':				case 'money':				case 'numeric':				case 'oid':				case 'xid':				case 'cid':				case 'tid':					$align = 'right';					$out = nl2br(htmlspecialchars($str));					break;				case 'yesno':					if (!isset($params['true'])) $params['true'] = $lang['stryes'];					if (!isset($params['false'])) $params['false'] = $lang['strno'];					// No break - fall through to boolean case.				case 'bool':				case 'boolean':					if (is_bool($str)) $str = $str ? 't' : 'f';					switch ($str) {						case 't':							$out = (isset($params['true']) ? $params['true'] : $lang['strtrue']);							$align = 'center';							break;						case 'f':							$out = (isset($params['false']) ? $params['false'] : $lang['strfalse']);							$align = 'center';							break;						default:							$out = htmlspecialchars($str);					}					break;				case 'bytea':					$tag = 'div';					$class = 'pre';					$out = $data->escapeBytea($str);					break;				case 'errormsg':					$tag = 'pre';					$class = 'error';					$out = htmlspecialchars($str);					break;				case 'pre':					$tag = 'pre';					$out = htmlspecialchars($str);					break;				case 'prenoescape':					$tag = 'pre';					$out = $str;					break;				case 'nbsp':					$out = nl2br(str_replace(' ', '&nbsp;', htmlspecialchars($str)));					break;				case 'verbatim':					$out = $str;					break;				case 'callback':					$out = $params['function']($str, $params);					break;				case 'prettysize':					if ($str == -1) 						$out = $lang['strnoaccess'];					else					{						$limit = 10 * 1024;						$mult = 1;						if ($str < $limit * $mult)							$out = $str.' '.$lang['strbytes'];						else						{							$mult *= 1024;							if ($str < $limit * $mult)								$out = floor(($str + $mult / 2) / $mult).' '.$lang['strkb'];							else							{								$mult *= 1024;								if ($str < $limit * $mult)									$out = floor(($str + $mult / 2) / $mult).' '.$lang['strmb'];								else								{									$mult *= 1024;									if ($str < $limit * $mult)										$out = floor(($str + $mult / 2) / $mult).' '.$lang['strgb'];									else									{										$mult *= 1024;										if ($str < $limit * $mult)											$out = floor(($str + $mult / 2) / $mult).' '.$lang['strtb'];									}								}							}						}					}					break;				case 'slonystatus':					switch ($str) {					case 'insync':						$out = $lang['strhealthy'];						break;					case 'outofsync':						$out = $lang['stroutofsync'];						break;					default:						$out = $lang['strunknown'];					}					break;				default:					// If the string contains at least one instance of >1 space in a row, a tab					// character, a space at the start of a line, or a space at the start of					// the whole string then render within a pre-formatted element (<pre>).					if (preg_match('/(^ |  |\t|\n )/m', $str)) {						$tag = 'pre';						$class = 'data';						$out = htmlspecialchars($str);					} else {						$out = nl2br(htmlspecialchars($str));					}			}			if (isset($params['class'])) $class = $params['class'];			if (isset($params['align'])) $align = $params['align'];			if (!isset($tag) && (isset($class) || isset($align))) $tag = 'div';			if (isset($tag)) {				$alignattr = isset($align) ? " style=\"text-align: {$align}\"" : '';				$classattr = isset($class) ? " class=\"{$class}\"" : '';				$out = "<{$tag}{$alignattr}{$classattr}>{$out}</{$tag}>";			}			// Add line numbers if 'lineno' param is true			if (isset($params['lineno']) && $params['lineno'] === true) {				$lines = explode("\n", $str);				$num = count($lines);				if ($num > 0) {					$temp = "<table>\n<tr><td class=\"{$class}\" style=\"vertical-align: top; padding-right: 10px;\"><pre class=\"{$class}\">";					for ($i = 1; $i <= $num; $i++) {						$temp .= $i . "\n";					}					$temp .= "</pre></td><td class=\"{$class}\" style=\"vertical-align: top;\">{$out}</td></tr></table>\n";					$out = $temp;				}				unset($lines);			}			return $out;		}		/**		 * A function to recursively strip slashes.  Used to		 * enforce magic_quotes_gpc being off.		 * @param &var The variable to strip		 */		function stripVar(&$var) {			if (is_array($var)) {				foreach($var as $k => $v) {					$this->stripVar($var[$k]);					/* magic_quotes_gpc escape keys as well ...*/					if (is_string($k)) {						$ek = stripslashes($k);						if ($ek !== $k) {							$var[$ek] = $var[$k];							unset($var[$k]);						}					}				}			}			else				$var = stripslashes($var);		}		/**		 * Print out the page heading and help link		 * @param $title Title, already escaped		 * @param $help (optional) The identifier for the help link		 */		function printTitle($title, $help = null) {			global $data, $lang;			echo "<h2>";			$this->printHelp($title, $help);			echo "</h2>\n";		}		/**		 * Print out a message		 * @param $msg The message to print		 */		function printMsg($msg) {			if ($msg != '') echo "<p class=\"message\">{$msg}</p>\n";		}		/**		 * Creates a database accessor		 */		function getDatabaseAccessor($database, $server_id = null) {			global $lang, $conf, $misc, $_connection;			$server_info = $this->getServerInfo($server_id);			// Perform extra security checks if this config option is set			if ($conf['extra_login_security']) {				// Disallowed logins if extra_login_security is enabled.				// These must be lowercase.				$bad_usernames = array('pgsql', 'postgres', 'root', 'administrator');				$username = strtolower($server_info['username']);				if ($server_info['password'] == '' || in_array($username, $bad_usernames)) {					unset($_SESSION['webdbLogin'][$_REQUEST['server']]);					$msg = $lang['strlogindisallowed'];					include('./login.php');					exit;				}			}			// Create the connection object and make the connection			$_connection = new Connection(				$server_info['host'],				$server_info['port'],				$server_info['sslmode'],				$server_info['username'],				$server_info['password'],				$database			);			// Get the name of the database driver we need to use.			// The description of the server is returned in $platform.			$_type = $_connection->getDriver($platform);			if ($_type === null) {				printf($lang['strpostgresqlversionnotsupported'], $postgresqlMinVer);				exit;			}			$this->setServerInfo('platform', $platform, $server_id);			$this->setServerInfo('pgVersion', $_connection->conn->pgVersion, $server_id);			// Create a database wrapper class for easy manipulation of the			// connection.			include_once('./classes/database/' . $_type . '.php');			$data = new $_type($_connection->conn);			$data->platform = $_connection->platform;			return $data;		}		/**		 * Prints the page header.  If global variable $_no_output is		 * set then no header is drawn.		 * @param $title The title of the page		 * @param $script script tag		 */		function printHeader($title = '', $script = null, $frameset = false) {			global $appName, $lang, $_no_output, $conf;			if (!isset($_no_output)) {				header("Content-Type: text/html; charset=" . $lang['appcharset']);				// Send XHTML headers, or regular XHTML strict headers				echo "<?xml version=\"1.0\" encoding=\"", htmlspecialchars($lang['appcharset']), "\"?>\n";				if ($frameset == true) {					echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Frameset//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd\">\n";				} else if (isset($conf['use_xhtml_strict']) && $conf['use_xhtml_strict']) {					echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-Strict.dtd\">\n";				} else {					echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n";				}				echo "<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"{$lang['applocale']}\" lang=\"{$lang['applocale']}\"";				if (strcasecmp($lang['applangdir'], 'ltr') != 0) echo " dir=\"", htmlspecialchars($lang['applangdir']), "\"";				echo ">\n";				echo "<head>\n";				echo "<meta http-equiv=\"Content-Type\" content=\"text/html; charset={$lang['appcharset']}\" />\n";				// Theme				echo "<link rel=\"stylesheet\" href=\"themes/{$conf['theme']}/global.css\" type=\"text/css\" />\n";				echo "<link rel=\"shortcut icon\" href=\"images/themes/{$conf['theme']}/Favicon.ico\" type=\"image/vnd.microsoft.icon\" />\n";				echo "<link rel=\"icon\" type=\"image/png\" href=\"images/themes/{$conf['theme']}/Introduction.png\" />\n";				echo "<title>", htmlspecialchars($appName);				if ($title != '') echo " - {$title}";				echo "</title>\n";				if ($script) echo "{$script}\n";				echo "</head>\n";			}		}		/**		 * Prints the page footer		 * @param $doBody True to output body tag, false otherwise		 */		function printFooter($doBody = true) {			global $_reload_browser, $_reload_drop_database;			global $lang, $_no_bottom_link;			if ($doBody) {				if (isset($_reload_browser)) $this->printReload(false);				elseif (isset($_reload_drop_database)) $this->printReload(true);				if (!isset($_no_bottom_link)) 					echo "<a href=\"#\" class=\"bottom_link\">".$lang['strgotoppage']."</a>";				echo "</body>\n";			}			echo "</html>\n";		}		/**		 * Prints the page body.		 * @param $doBody True to output body tag, false otherwise		 * @param $bodyClass - name of body class		 */		function printBody($bodyClass = '', $doBody = true ) {			global $_no_output;			if (!isset($_no_output)) {				if ($doBody) {					$bodyClass = htmlspecialchars($bodyClass);					echo "<body", ($bodyClass == '' ? '' : " class=\"{$bodyClass}\"");					echo ">\n";				}			}		}		/**		 * Outputs JavaScript code that will reload the browser		 * @param $database True if dropping a database, false otherwise		 */		function printReload($database) {			echo "<script type=\"text/javascript\">\n";			if ($database)				echo "\tparent.frames.browser.location.href=\"browser.php\";\n";			else				echo "\tparent.frames.browser.location.reload();\n";			echo "</script>\n";		}		/**		 * Display navigation tabs		 * @param $tabs An associative array of tabs definitions, see printNav() for an example.		 * @param $activetab The name of the tab to be highlighted.		 */		function printTabs($tabs, $activetab) {			global $misc, $conf, $data, $lang;			if (is_string($tabs)) {				$_SESSION['webdbLastTab'][$tabs] = $activetab;				$tabs = $this->getNavTabs($tabs);			}			echo "<table class=\"tabs\"><tr>\n";			#echo "<div class=\"tabs\">\n";			# FIXME: don't count hidden tabs			$width = (int)(100 / count($tabs)).'%';			foreach ($tabs as $tab_id => $tab) {				$active = ($tab_id == $activetab) ? ' active' : '';				if (!isset($tab['hide']) || $tab['hide'] !== true) {					$tablink = "<a" . $this->printActionUrl($tab, $_REQUEST, 'href') . ">";					if (isset($tab['icon']) && $icon = $this->icon($tab['icon']))						$tablink .= "<span class=\"icon\"><img src=\"{$icon}\" alt=\"{$tab['title']}\" /></span>";					$tablink .= "<span class=\"label\">{$tab['title']}</span></a>";					echo "<td style=\"width: {$width}\" class=\"tab{$active}\">";					#echo "<span class=\"tab{$active}\" style=\"white-space:nowrap;\">";					if (isset($tab['help']))						$this->printHelp($tablink, $tab['help']);					else						echo $tablink;					echo "</td>\n";					#echo "</span>\n";				}			}			echo "</tr></table>\n";			#echo "</div>\n";		}		/**		 * Retrieve the tab info for a specific tab bar.		 * @param $section The name of the tab bar.		 */		function getNavTabs($section) {			global $data, $lang, $conf, $slony;			$hide_advanced = ($conf['show_advanced'] === false);			switch ($section) {				case 'root':					return array (						'intro' => array (							'title' => $lang['strintroduction'],							'url'   => "intro.php",							'icon'  => 'Introduction',						),						'servers' => array (							'title' => $lang['strservers'],							'url'   => "servers.php",							'icon'  => 'Servers',						),					);				case 'server':				case 'report':					$server_info = $this->getServerInfo();					$hide_users = !$data->isSuperUser($server_info['username']);					$tmp = array (						'databases' => array (							'title' => $lang['strdatabases'],							'url'   => 'all_db.php',							'urlvars' => array('subject' => 'server'),							'help'  => 'pg.database',							'icon'  => 'Databases',						)					);					if ($data->hasRoles()) {						$tmp = array_merge($tmp, array(							'roles' => array (								'title' => $lang['strroles'],								'url'   => 'roles.php',								'urlvars' => array('subject' => 'server'),								'hide'  => $hide_users,								'help'  => 'pg.role',								'icon'  => 'Roles',							)						));					}					else {						$tmp = array_merge($tmp, array(							'users' => array (								'title' => $lang['strusers'],								'url'   => 'users.php',								'urlvars' => array('subject' => 'server'),								'hide'  => $hide_users,								'help'  => 'pg.user',								'icon'  => 'Users',							),							'groups' => array (								'title' => $lang['strgroups'],								'url'   => 'groups.php',								'urlvars' => array('subject' => 'server'),								'hide'  => $hide_users,								'help'  => 'pg.group',								'icon'  => 'UserGroups',							)						));					}					$tmp = array_merge($tmp, array(						'account' => array (							'title' => $lang['straccount'],							'url'   => $data->hasRoles() ? 'roles.php' : 'users.php',							'urlvars' => array('subject' => 'server', 'action' => 'account'),							'hide'  => !$hide_users,							'help'  => 'pg.role',							'icon'  => 'User',						),						'tablespaces' => array (							'title' => $lang['strtablespaces'],							'url'   => 'tablespaces.php',							'urlvars' => array('subject' => 'server'),							'hide'  => (!$data->hasTablespaces()),							'help'  => 'pg.tablespace',							'icon'  => 'Tablespaces',						),						'export' => array (							'title' => $lang['strexport'],							'url'   => 'all_db.php',							'urlvars' => array('subject' => 'server', 'action' => 'export'),							'hide'  => (!$this->isDumpEnabled()),							'icon'  => 'Export',						),						'reports' => array (							'title' => $lang['strreports'],							'url'   => 'reports.php',							'urlvars' => array('subject' => 'server'),							'hide' => !$conf['show_reports'],							'icon' => 'Reports',						),					));					return $tmp;					break;				case 'database':					$tabs = array (						'schemas' => array (							'title' => $lang['strschemas'],							'url'   => 'schemas.php',							'urlvars' => array('subject' => 'database'),							'help'  => 'pg.schema',							'icon'  => 'Schemas',						),						'sql' => array (							'title' => $lang['strsql'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'sql', 'new' => 1),							'help'  => 'pg.sql',							'tree'  => false,							'icon'  => 'SqlEditor'						),						'find' => array (							'title' => $lang['strfind'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'find'),							'tree'  => false,							'icon'  => 'Search'						),						'variables' => array (							'title' => $lang['strvariables'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'variables'),							'help'  => 'pg.variable',							'tree'  => false,							'icon'  => 'Variables',						),						'processes' => array (							'title' => $lang['strprocesses'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'processes'),							'help'  => 'pg.process',							'tree'  => false,							'icon'  => 'Processes',						),						'locks' => array (							'title' => $lang['strlocks'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'locks'),							'help'  => 'pg.locks',							'tree'  => false,							'icon'  => 'Key',						),						'admin' => array (							'title' => $lang['stradmin'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'admin'),							'tree'  => false,							'icon'  => 'Admin',						),						'privileges' => array (							'title' => $lang['strprivileges'],							'url'   => 'privileges.php',							'urlvars' => array('subject' => 'database'),							'hide'  => (!isset($data->privlist['database'])),							'help'  => 'pg.privilege',							'tree'  => false,							'icon'  => 'Privileges',						),						'languages' => array (							'title' => $lang['strlanguages'],							'url'   => 'languages.php',							'urlvars' => array('subject' => 'database'),							'hide'  => $hide_advanced,							'help'  => 'pg.language',							'icon'  => 'Languages',						),						'casts' => array (							'title' => $lang['strcasts'],							'url'   => 'casts.php',							'urlvars' => array('subject' => 'database'),							'hide'  => ($hide_advanced),							'help'  => 'pg.cast',							'icon'  => 'Casts',						),						'slony' => array (							'title' => 'Slony',							'url'   => 'plugin_slony.php',							'urlvars' => array('subject' => 'database', 'action' => 'clusters_properties'),							'hide'  => !isset($slony),							'help'  => '',							'icon'  => 'Replication',						),						'export' => array (							'title' => $lang['strexport'],							'url'   => 'database.php',							'urlvars' => array('subject' => 'database', 'action' => 'export'),							'hide'  => (!$this->isDumpEnabled()),							'tree'  => false,							'icon'  => 'Export',						),					);					return $tabs;				case 'schema':					$tabs = array (						'tables' => array (							'title' => $lang['strtables'],							'url'   => 'tables.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.table',							'icon'  => 'Tables',						),						'views' => array (							'title' => $lang['strviews'],							'url'   => 'views.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.view',							'icon'  => 'Views',						),						'sequences' => array (							'title' => $lang['strsequences'],							'url'   => 'sequences.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.sequence',							'icon'  => 'Sequences',						),						'functions' => array (							'title' => $lang['strfunctions'],							'url'   => 'functions.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.function',							'icon'  => 'Functions',						),						'fulltext' => array (							'title' => $lang['strfulltext'],							'url'   => 'fulltext.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.fts',							'tree'  => true,							'icon'  => 'Fts',						),						'domains' => array (							'title' => $lang['strdomains'],							'url'   => 'domains.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.domain',							'icon'  => 'Domains',						),						'aggregates' => array (							'title' => $lang['straggregates'],							'url'   => 'aggregates.php',							'urlvars' => array('subject' => 'schema'),							'hide'  => $hide_advanced,							'help'  => 'pg.aggregate',							'icon'  => 'Aggregates',						),						'types' => array (							'title' => $lang['strtypes'],							'url'   => 'types.php',							'urlvars' => array('subject' => 'schema'),							'hide'  => $hide_advanced,							'help'  => 'pg.type',							'icon'  => 'Types',						),						'operators' => array (							'title' => $lang['stroperators'],							'url'   => 'operators.php',							'urlvars' => array('subject' => 'schema'),							'hide'  => $hide_advanced,							'help'  => 'pg.operator',							'icon'  => 'Operators',						),						'opclasses' => array (							'title' => $lang['stropclasses'],							'url'   => 'opclasses.php',							'urlvars' => array('subject' => 'schema'),							'hide'  => $hide_advanced,							'help'  => 'pg.opclass',							'icon'  => 'OperatorClasses',						),						'conversions' => array (							'title' => $lang['strconversions'],							'url'   => 'conversions.php',							'urlvars' => array('subject' => 'schema'),							'hide'  => $hide_advanced,							'help'  => 'pg.conversion',							'icon'  => 'Conversions',						),						'privileges' => array (							'title' => $lang['strprivileges'],							'url'   => 'privileges.php',							'urlvars' => array('subject' => 'schema'),							'help'  => 'pg.privilege',							'tree'  => false,							'icon'  => 'Privileges',						),						'export' => array (							'title' => $lang['strexport'],							'url'   => 'schemas.php',							'urlvars' => array('subject' => 'schema', 'action' => 'export'),							'hide'  => (!$this->isDumpEnabled()),							'tree'  => false,							'icon'  => 'Export',						),					);					if (!$data->hasFTS()) unset($tabs['fulltext']);					return $tabs;				case 'table':					return array (						'columns' => array (							'title' => $lang['strcolumns'],							'url'   => 'tblproperties.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'icon'  => 'Columns',							'branch'=> true,						),						'indexes' => array (							'title' => $lang['strindexes'],							'url'   => 'indexes.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'help'  => 'pg.index',							'icon'  => 'Indexes',							'branch'=> true,						),						'constraints' => array (							'title' => $lang['strconstraints'],							'url'   => 'constraints.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'help'  => 'pg.constraint',							'icon'  => 'Constraints',							'branch'=> true,						),						'triggers' => array (							'title' => $lang['strtriggers'],							'url'   => 'triggers.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'help'  => 'pg.trigger',							'icon'  => 'Triggers',							'branch'=> true,						),						'rules' => array (							'title' => $lang['strrules'],							'url'   => 'rules.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'help'  => 'pg.rule',							'icon'  => 'Rules',							'branch'=> true,						),						'admin' => array (							'title' => $lang['stradmin'],							'url'   => 'tables.php',							'urlvars' => array('subject' => 'table', 'table' => field('table'), 'action' => 'admin'),							'icon'  => 'Admin',						),						'info' => array (							'title' => $lang['strinfo'],							'url'   => 'info.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'icon'  => 'Statistics',						),						'privileges' => array (							'title' => $lang['strprivileges'],							'url'   => 'privileges.php',							'urlvars' => array('subject' => 'table', 'table' => field('table')),							'help'  => 'pg.privilege',							'icon'  => 'Privileges',						),						'import' => array (							'title' => $lang['strimport'],							'url'   => 'tblproperties.php',							'urlvars' => array('subject' => 'table', 'table' => field('table'), 'action' => 'import'),							'icon'  => 'Import',							'hide'	=> false,						),						'export' => array (							'title' => $lang['strexport'],							'url'   => 'tblproperties.php',							'urlvars' => array('subject' => 'table', 'table' => field('table'), 'action' => 'export'),							'icon'  => 'Export',							'hide'	=> false,						),					);				case 'view':					return array (						'columns' => array (							'title' => $lang['strcolumns'],							'url'   => 'viewproperties.php',							'urlvars' => array('subject' => 'view', 'view' => field('view')),							'icon'  => 'Columns',							'branch'=> true,						),						'definition' => array (							'title' => $lang['strdefinition'],							'url'   => 'viewproperties.php',							'urlvars' => array('subject' => 'view', 'view' => field('view'), 'action' => 'definition'),							'icon'  => 'Definition'						),						'rules' => array (							'title' => $lang['strrules'],							'url'   => 'rules.php',							'urlvars' => array('subject' => 'view', 'view' => field('view')),							'help'  => 'pg.rule',							'icon'  => 'Rules',							'branch'=> true,						),						'privileges' => array (							'title' => $lang['strprivileges'],							'url'   => 'privileges.php',							'urlvars' => array('subject' => 'view', 'view' => field('view')),							'help'  => 'pg.privilege',							'icon'  => 'Privileges',						),						'export' => array (							'title' => $lang['strexport'],							'url'   => 'viewproperties.php',							'urlvars' => array('subject' => 'view', 'view' => field('view'), 'action' => 'export'),							'icon'  => 'Export',							'hide'	=> false,						),					);				case 'function':					return array (						'definition' => array (							'title' => $lang['strdefinition'],							'url'   => 'functions.php',							'urlvars' => array(									'subject' => 'function',									'function' => field('function'),									'function_oid' => field('function_oid'),									'action' => 'properties',								),							'icon'  => 'Definition',						),						'privileges' => array (							'title' => $lang['strprivileges'],							'url'   => 'privileges.php',							'urlvars' => array(									'subject' => 'function',									'function' => field('function'),									'function_oid' => field('function_oid'),								),							'icon'  => 'Privileges',						),					);				case 'aggregate':					return array (						'definition' => array (							'title' => $lang['strdefinition'],							'url'   => 'aggregates.php',							'urlvars' => array(									'subject' => 'aggregate',									'aggrname' => field('aggrname'),									'aggrtype' => field('aggrtype'),									'action' => 'properties',								),							'icon'  => 'Definition',						),					);				case 'role':					return array (						'definition' => array (							'title' => $lang['strdefinition'],							'url'   => 'roles.php',							'urlvars' => array(									'subject' => 'role',									'rolename' => field('rolename'),									'action' => 'properties',								),							'icon'  => 'Definition',						),					);				case 'popup':					return array (						'sql' => array (							'title' => $lang['strsql'],							'url'   => 'sqledit.php',							'urlvars' => array('subject' => 'schema', 'action' => 'sql'),							'help'  => 'pg.sql',							'icon'  => 'SqlEditor',						),						'find' => array (							'title' => $lang['strfind'],							'url'   => 'sqledit.php',							'urlvars' => array('subject' => 'schema', 'action' => 'find'),							'icon'  => 'Search',						),					);				case 'slony_cluster':					return array (						'properties' => array (							'title' => $lang['strproperties'],							'url'   => 'plugin_slony.php',							'urlvars' => array(									'subject' => 'slony_cluster',									'action' => 'cluster_properties',									'slony_cluster' => field('slony_cluster')								),							'help'  => '',							'tree'  => false,							'icon'  => 'Cluster',						),						'nodes' => array (							'title' => $lang['strnodes'],							'url'   => 'plugin_slony.php',							'urlvars' => array(									'subject' => 'slony_cluster',									'action' => 'nodes_properties',									'slony_cluster' => field('slony_cluster')								),							'branch' => 'nodes',							'help'  => '',							'icon'  => 'Nodes',						),						'sets' => array (							'title' => $lang['strrepsets'],							'url'   => 'plugin_slony.php',							'urlvars' => array(								'subject' => 'slony_cluster',								'action' => 'sets_properties',								'slony_cluster' => field('slony_cluster')							),							'branch' => 'sets',							'help'  => '',							'icon'  => 'ReplicationSets',						),					);				case 'column':					return array(						'properties' => array (							'title'		=> $lang['strcolprop'],							'url'		=> 'colproperties.php',							'urlvars'	=> array(								'subject' => 'column',								'table' => field('table'),								'column' => field('column')							),							'icon'		=> 'Column'						),						'privileges' => array (							'title' => $lang['strprivileges'],							'url'   => 'privileges.php',							'urlvars' => array(								'subject' => 'column',								'table' => field('table'),								'column' => field('column')							),							'help'  => 'pg.privilege',							'icon'  => 'Privileges',						)					);                case 'fulltext':                    return array (                        'ftsconfigs' => array (                            'title' => $lang['strftstabconfigs'],                            'url'   => 'fulltext.php',                            'urlvars' => array('subject' => 'schema'),                            'hide'  => !$data->hasFTS(),                            'help'  => 'pg.ftscfg',                            'tree'  => true,                            'icon'  => 'FtsCfg',                        ),                        'ftsdicts' => array (                            'title' => $lang['strftstabdicts'],                            'url'   => 'fulltext.php',                            'urlvars' => array('subject' => 'schema', 'action' => 'viewdicts'),                            'hide'  => !$data->hasFTS(),                            'help'  => 'pg.ftsdict',                            'tree'  => true,                            'icon'  => 'FtsDict',                        ),                        'ftsparsers' => array (                            'title' => $lang['strftstabparsers'],                            'url'   => 'fulltext.php',                            'urlvars' => array('subject' => 'schema', 'action' => 'viewparsers'),                            'hide'  => !$data->hasFTS(),                            'help'  => 'pg.ftsparser',                            'tree'  => true,                            'icon'  => 'FtsParser',                        ),                    );				default:					return array();			}		}		/**		 * Get the URL for the last active tab of a particular tab bar.		 */		function getLastTabURL($section) {			global $data;			$tabs = $this->getNavTabs($section);			if (isset($_SESSION['webdbLastTab'][$section]) && isset($tabs[$_SESSION['webdbLastTab'][$section]]))				$tab = $tabs[$_SESSION['webdbLastTab'][$section]];			else				$tab = reset($tabs);			return isset($tab['url']) ? $tab : null;		}		function printTopbar() {			global $lang, $conf, $appName, $appVersion, $appLangFiles;			$server_info = $this->getServerInfo();			echo "<div class=\"topbar\"><table style=\"width: 100%\"><tr><td>";			if ($server_info && isset($server_info['platform']) && isset($server_info['username'])) {				echo sprintf($lang['strtopbar'],					'<span class="platform">'.htmlspecialchars($server_info['platform']).'</span>',					'<span class="host">'.htmlspecialchars((empty($server_info['host'])) ? 'localhost':$server_info['host']).'</span>',					'<span class="port">'.htmlspecialchars($server_info['port']).'</span>',					'<span class="username">'.htmlspecialchars($server_info['username']).'</span>',					'<span class="date">'.date($lang['strtimefmt']).'</span>');			} else {				echo "<span class=\"appname\">$appName</span> <span class=\"version\">$appVersion</span>";			}			echo "</td>";			if (isset($_REQUEST['server'])) {				$sql_url = "sqledit.php?{$this->href}&amp;action=";				$sql_window_id = htmlspecialchars('sqledit:'.$_REQUEST['server']);				$history_url = "history.php?{$this->href}&amp;action=pophistory";				$history_window_id = htmlspecialchars('history:'.$_REQUEST['server']);				$logout_shared = isset($_SESSION['sharedUsername']) ?					' onclick="return confirm(\''. $lang['strconfdropcred']. '\')"':					'';				echo "<td style=\"text-align: right\">";				echo "<ul class=\"toplink\">\n\t<li><a class=\"toplink\" href=\"{$sql_url}sql\" target=\"sqledit\" onclick=\"window.open('{$sql_url}sql','{$sql_window_id}','toolbar=no,width=700,height=500,resizable=yes,scrollbars=yes').focus(); return false;\">{$lang['strsql']}</a></li>\n";				echo "\t<li><a class=\"toplink\" href=\"{$history_url}\" onclick=\"window.open('{$history_url}','{$history_window_id}','toolbar=no,width=800,height=600,resizable=yes,scrollbars=yes').focus(); return false;\">{$lang['strhistory']}</a></li>\n";				echo "\t<li><a class=\"toplink\" href=\"{$sql_url}find\" target=\"sqledit\" onclick=\"window.open('{$sql_url}find','{$sql_window_id}','toolbar=no,width=700,height=500,resizable=yes,scrollbars=yes').focus(); return false;\">{$lang['strfind']}</a></li>\n"; 				echo "\t<li><a class=\"toplink\" href=\"servers.php?action=logout&amp;logoutServer=".htmlspecialchars($server_info['host']).":".htmlspecialchars($server_info['port']).":".htmlspecialchars($server_info['sslmode'])."\"{$logout_shared}>{$lang['strlogout']}</a></li>\n"; 				echo "</ul>\n";				echo "</td>";			}/*			echo "<td style=\"text-align: right; width: 1%\">";			echo "<form method=\"get\"><select name=\"language\" onchange=\"this.form.submit()\">\n";			$language = isset($_SESSION['webdbLanguage']) ? $_SESSION['webdbLanguage'] : 'english';			foreach ($appLangFiles as $k => $v) {				echo "<option value=\"{$k}\"",					($k == $language) ? ' selected="selected"' : '',					">{$v}</option>\n";			}			echo "</select>\n";			echo "<noscript><input type=\"submit\" value=\"Set Language\"></noscript>\n";			foreach ($_GET as $key => $val) {				if ($key == 'language') continue;				echo "<input type=\"hidden\" name=\"$key\" value=\"", htmlspecialchars($val), "\" />\n";			}			echo "</form>\n";			echo "</td>";*/			echo "</tr></table></div>\n";		}		/**		 * Display a bread crumb trail.		 */		function printTrail($trail = array()) {			global $lang;			$this->printTopbar();			if (is_string($trail)) {				$trail = $this->getTrail($trail);			}			echo "<div class=\"trail\"><table><tr>";			foreach ($trail as $crumb) {				echo "<td class=\"crumb\">";				$crumblink = "<a";				if (isset($crumb['url']))					$crumblink .= ' href="' . $this->printVal($crumb['url'], 'nbsp') . '"';				if (isset($crumb['title']))					$crumblink .= " title=\"{$crumb['title']}\"";				$crumblink .= ">";				if (isset($crumb['title']))					$iconalt = $crumb['title'];				else					$iconalt = 'Database Root';				if (isset($crumb['icon']) && $icon = $this->icon($crumb['icon']))					$crumblink .= "<span class=\"icon\"><img src=\"{$icon}\" alt=\"{$iconalt}\" /></span>";				$crumblink .= "<span class=\"label\">" . htmlspecialchars($crumb['text']) . "</span></a>";				if (isset($crumb['help']))					$this->printHelp($crumblink, $crumb['help']);				else					echo $crumblink;				echo "{$lang['strseparator']}";				echo "</td>";			}			echo "</tr></table></div>\n";		}		/**		 * Create a bread crumb trail of the object hierarchy.		 * @param $object The type of object at the end of the trail.		 */		function getTrail($subject = null) {			global $lang, $conf, $data, $appName;			$trail = array();			$vars = '';			$done = false;			$trail['root'] = array(				'text'  => $appName,				'url'   => 'redirect.php?subject=root',				'icon'  => 'Introduction'			);			if ($subject == 'root') $done = true;			if (!$done) {				$vars = 'server='.urlencode($_REQUEST['server']).'&';				$server_info = $this->getServerInfo();				$trail['server'] = array(					'title' => $lang['strserver'],					'text'  => $server_info['desc'],					'url'   => "redirect.php?subject=server&{$vars}",					'help'  => 'pg.server',					'icon'  => 'Server'				);			}			if ($subject == 'server') $done = true;			if (isset($_REQUEST['report']) && !$done) {				$vars .= 'report='.urlencode($_REQUEST['report']).'&';				$trail['report'] = array(					'title' => $lang['strreport'],					'text'  => $_REQUEST['report'],					'url'   => "reports.php?subject=report&{$vars}",					'icon'  => 'Report'				);			}			if (isset($_REQUEST['database']) && !$done) {				$vars .= 'database='.urlencode($_REQUEST['database']).'&';				$trail['database'] = array(					'title' => $lang['strdatabase'],					'text'  => $_REQUEST['database'],					'url'   => "redirect.php?subject=database&{$vars}",					'help'  => 'pg.database',					'icon'  => 'Database'				);			} elseif (isset($_REQUEST['rolename']) && !$done) {				$vars .= "subject=role&action=properties&rolename=".urlencode($_REQUEST['rolename']);				$trail['role'] = array(					'title' => $lang['strrole'],					'text'  => $_REQUEST['rolename'],					'url'   => "redirect.php?{$vars}",					'help'  => 'pg.role',					'icon'  => 'Roles'				);			}			if ($subject == 'database' || $subject == 'role' || $subject == 'report') $done = true;			if (isset($_REQUEST['schema']) && !$done) {				$vars .= 'schema='.urlencode($_REQUEST['schema']).'&';				$trail['schema'] = array(					'title' => $lang['strschema'],					'text'  => $_REQUEST['schema'],					'url'   => "redirect.php?subject=schema&{$vars}",					'help'  => 'pg.schema',					'icon'  => 'Schema'				);			}			if ($subject == 'schema') $done = true;			if (isset($_REQUEST['slony_cluster']) && !$done) {				$vars .= 'slony_cluster='.urlencode($_REQUEST['slony_cluster']).'&';				$trail['slony_cluster'] = array(					'title' => 'Slony Cluster',					'text'  => $_REQUEST['slony_cluster'],					'url'   => "redirect.php?subject=slony_cluster&{$vars}",					'help'  => 'sl.cluster',					'icon'  => 'Cluster'				);			}			if ($subject == 'slony_cluster') $done = true;			if (isset($_REQUEST['table']) && !$done) {				$vars .= "table=".urlencode($_REQUEST['table']);				$trail['table'] = array(					'title' => $lang['strtable'],					'text'  => $_REQUEST['table'],					'url'   => "redirect.php?subject=table&{$vars}",					'help'  => 'pg.table',					'icon'  => 'Table'				);			} elseif (isset($_REQUEST['view']) && !$done) {				$vars .= "view=".urlencode($_REQUEST['view']);				$trail['view'] = array(					'title' => $lang['strview'],					'text'  => $_REQUEST['view'],					'url'   => "redirect.php?subject=view&{$vars}",					'help'  => 'pg.view',					'icon'  => 'View'				);			} elseif (isset($_REQUEST['ftscfg']) && !$done) {				$vars .= "action=viewconfig&ftscfg=".urlencode($_REQUEST['ftscfg']);				$trail['ftscfg'] = array(					'title' => $lang['strftsconfig'],					'text'  => $_REQUEST['ftscfg'],					'url'   => "fulltext.php?{$vars}",					'help'  => 'pg.ftscfg.example',					'icon'  => 'Fts'				);			}			if ($subject == 'table' || $subject == 'view' || $subject == 'ftscfg') $done = true;			if (!$done && !is_null($subject)) {				switch ($subject) {					case 'function':						$vars .= "{$subject}_oid=".urlencode($_REQUEST[$subject.'_oid']).'&';						$vars .= "subject={$subject}&{$subject}=".urlencode($_REQUEST[$subject]);						$trail[$subject] = array(							'title' => $lang['str'.$subject],							'text'  => $_REQUEST[$subject],							'url'   => "redirect.php?{$vars}",							'help'  => 'pg.function',							'icon'  => 'Function'						);						break;					case 'aggregate':						$vars .= "subject=aggregate&action=properties&aggrname=".urlencode($_REQUEST['aggrname']);						$vars .= "&aggrtype=".urlencode($_REQUEST['aggrtype']);						$trail[$subject] = array(							'title' => $lang['straggregate'],							'text'  => $_REQUEST['aggrname'],							'url'   => "redirect.php?{$vars}",							'help'  => 'pg.aggregate',							'icon'  => 'Aggregate'						);						break;					case 'slony_node':						$vars .= 'no_id='.urlencode($_REQUEST['no_id']).'&no_name='.urlencode($_REQUEST['no_name']);						$trail[$subject] = array(							'title' => 'Slony Node',							'text'  => $_REQUEST['no_name'],							'url'   => "redirect.php?{$vars}",							'help'  => 'sl.'.$subject,							'icon'  => 'Node'						);						break;					case 'slony_set':						$vars .= "{$subject}_id=".urlencode($_REQUEST[$subject]).'&';						$vars .= "subject={$subject}&{$subject}=".urlencode($_REQUEST[$subject]);						$trail[$subject] = array(							'title' => $lang['str'.$subject],							'text'  => $_REQUEST[$subject],							'url'   => "redirect.php?{$vars}",							'help'  => 'sl.'.$subject,							'icon'  => 'AvailableReplicationSet'						);						break;					case 'column':						$vars .= "&column=". urlencode($_REQUEST['column']) ."&subject=column";						$trail['column'] = array (							'title' => $lang['strcolumn'],							'text'  => $_REQUEST['column'],							'icon'	=> 'Column',							'url'   => "redirect.php?{$vars}"						);						break;					default:						if (isset($_REQUEST[$subject])) {							switch ($subject) {								case 'domain': $icon = 'Domain'; break;								case 'sequence': $icon = 'Sequence'; break;								case 'type': $icon = 'Type'; break;								case 'operator': $icon = 'Operator'; break;								default: $icon = null; break;							}							$trail[$subject] = array(								'title' => $lang['str'.$subject],								'text'  => $_REQUEST[$subject],								'help'  => 'pg.'.$subject,								'icon'  => $icon,							);						}				}			}			return $trail;		}		/**		 * Do multi-page navigation.  Displays the prev, next and page options.		 * @param $page the page currently viewed		 * @param $pages the maximum number of pages		 * @param $url the url to refer to with the page number inserted		 * @param $max_width the number of pages to make available at any one time (default = 20)		 */		function printPages($page, $pages, $url, $max_width = 20) {			global $lang;			$window = 10;			if ($page < 0 || $page > $pages) return;			if ($pages < 0) return;			if ($max_width <= 0) return;			if ($pages > 1) {				echo "<p style=\"text-align: center\">\n";				if ($page != 1) {					$temp = str_replace('%s', 1, $url);					echo "<a class=\"pagenav\" href=\"{$temp}\">{$lang['strfirst']}</a>\n";					$temp = str_replace('%s', $page - 1, $url);					echo "<a class=\"pagenav\" href=\"{$temp}\">{$lang['strprev']}</a>\n";				}				if ($page <= $window) {					$min_page = 1;					$max_page = min(2 * $window, $pages);				}				elseif ($page > $window && $pages >= $page + $window) {					$min_page = ($page - $window) + 1;					$max_page = $page + $window;				}				else {					$min_page = ($page - (2 * $window - ($pages - $page))) + 1;					$max_page = $pages;				}				// Make sure min_page is always at least 1				// and max_page is never greater than $pages				$min_page = max($min_page, 1);				$max_page = min($max_page, $pages);				for ($i = $min_page; $i <= $max_page; $i++) {					$temp = str_replace('%s', $i, $url);					if ($i != $page) echo "<a class=\"pagenav\" href=\"{$temp}\">$i</a>\n";					else echo "$i\n";				}				if ($page != $pages) {					$temp = str_replace('%s', $page + 1, $url);					echo "<a class=\"pagenav\" href=\"{$temp}\">{$lang['strnext']}</a>\n";					$temp = str_replace('%s', $pages, $url);					echo "<a class=\"pagenav\" href=\"{$temp}\">{$lang['strlast']}</a>\n";				}				echo "</p>\n";			}		}		/**		 * Displays link to the context help.		 * @param $str   - the string that the context help is related to (already escaped)		 * @param $help  - help section identifier		 */		function printHelp($str, $help) {			global $lang, $data;			echo $str;			if ($help) {				echo "<a class=\"help\" href=\"";				echo htmlspecialchars("help.php?help=".urlencode($help)."&server=".urlencode($_REQUEST['server']));				echo "\" title=\"{$lang['strhelp']}\" target=\"phppgadminhelp\">{$lang['strhelpicon']}</a>";			}		}		/**		 * Outputs JavaScript to set default focus		 * @param $object eg. forms[0].username		 */		function setFocus($object) {			echo "<script type=\"text/javascript\">\n";			echo "   document.{$object}.focus();\n";			echo "</script>\n";		}		/**		 * Outputs JavaScript to set the name of the browser window.		 * @param $name the window name		 * @param $addServer if true (default) then the server id is		 *        attached to the name.		 */		function setWindowName($name, $addServer = true) {			echo "<script type=\"text/javascript\">\n";			echo "//<![CDATA[\n";			echo "   window.name = '{$name}", ($addServer ? ':'.htmlspecialchars($_REQUEST['server']) : ''), "';\n";			echo "//]]>\n";			echo "</script>\n";		}		/**		 * Converts a PHP.INI size variable to bytes.  Taken from publically available		 * function by Chris DeRose, here: http://www.php.net/manual/en/configuration.directives.php#ini.file-uploads		 * @param $strIniSize The PHP.INI variable		 * @return size in bytes, false on failure		 */		function inisizeToBytes($strIniSize) {			// This function will take the string value of an ini 'size' parameter,			// and return a double (64-bit float) representing the number of bytes			// that the parameter represents. Or false if $strIniSize is unparseable.			$a_IniParts = array();			if (!is_string($strIniSize))				return false;			if (!preg_match ('/^(\d+)([bkm]*)$/i', $strIniSize,$a_IniParts))				return false;			$nSize = (double) $a_IniParts[1];			$strUnit = strtolower($a_IniParts[2]);			switch($strUnit) {				case 'm':					return ($nSize * (double) 1048576);				case 'k':					return ($nSize * (double) 1024);				case 'b':				default:					return $nSize;			}		}		/**		 * Display a URL given an action associative array.		 * @param $action An associative array of the follow properties:		 *			'url'  => The first part of the URL (before the ?)		 *			'urlvars' => Associative array of (URL variable => field name)		 *						these are appended to the URL		 *			'urlfn' => Function to apply to URL before display		 * @param $fields Field data from which 'urlfield' and 'vars' are obtained.		 * @param $attr If supplied then the URL will be quoted and prefixed with		 *				'$attr='.		 */		function printActionUrl(&$action, &$fields, $attr = null) {			$url = value($action['url'], $fields);			if ($url === false) return '';			if (!empty($action['urlvars'])) {				$urlvars = value($action['urlvars'], $fields);			} else {				$urlvars = array();			}			if (isset($urlvars['subject'])) {				$subject = value($urlvars['subject'], $fields);				if (isset($_REQUEST['server']) && $subject != 'root') {					$urlvars['server'] = $_REQUEST['server'];					if (isset($_REQUEST['database']) && $subject != 'server') {						$urlvars['database'] = $_REQUEST['database'];						if (isset($_REQUEST['schema']) && $subject != 'database') {							$urlvars['schema'] = $_REQUEST['schema'];						}					}				}			}			$sep = '?';			foreach ($urlvars as $var => $varfield) {				$url .= $sep . value_url($var, $fields) . '=' . value_url($varfield, $fields);				$sep = '&';			}			$url = htmlentities($url);			if ($attr !== null && $url != '')				return ' '.$attr.'="'.$url.'"';			else				return $url;		}		function getRequestVars($subject = '') {			$v = array();			if (!empty($subject))				$v['subject'] = $subject;			if (isset($_REQUEST['server']) && $subject != 'root') {				$v['server'] = $_REQUEST['server'];				if (isset($_REQUEST['database']) && $subject != 'server') {					$v['database'] = $_REQUEST['database'];					if (isset($_REQUEST['schema']) && $subject != 'database') {						$v['schema'] = $_REQUEST['schema'];					}				}			}			return $v;		}		function printUrlVars(&$vars, &$fields) {			foreach ($vars as $var => $varfield) {				echo "{$var}=", urlencode($fields[$varfield]), "&amp;";			}		}		/**		 * Display a table of data.		 * @param $tabledata A set of data to be formatted, as returned by $data->getDatabases() etc.		 * @param $columns   An associative array of columns to be displayed:		 *			$columns = array(		 *				column_id => array(		 *					'title' => Column heading,		 *					'field' => Field name for $tabledata->fields[...],		 *					'help'  => Help page for this column,		 *				), ...		 *			);		 * @param $actions   Actions that can be performed on each object:		 *			$actions = array(		 *				* multi action support		 *				* parameters are serialized for each entries and given in $_REQUEST['ma']		 *				'multiactions' => array(		 *					'keycols' => Associative array of (URL variable => field name), // fields included in the form		 *					'url' => URL submission,		 *					'default' => Default selected action in the form.		 *									if null, an empty action is added & selected		 *				),		 *				* actions *		 *				action_id => array(		 *					'title' => Action heading,		 *					'url'   => Static part of URL.  Often we rely		 *							   relative urls, usually the page itself (not '' !), or just a query string,		 *					'vars'  => Associative array of (URL variable => field name),		 *					'multiaction' => Name of the action to execute.		 *										Add this action to the multi action form		 *				), ...		 *			);		 * @param $nodata    (optional) Message to display if data set is empty.		 * @param $pre_fn    (optional) Name of a function to call for each row,		 *					 it will be passed two params: $rowdata and $actions,		 *					 it may be used to derive new fields or modify actions.		 *					 It can return an array of actions specific to the row,		 *					 or if nothing is returned then the standard actions are used.		 *					 (see tblproperties.php and constraints.php for examples)		 *					 The function must not must not store urls because		 *					 they are relative and won't work out of context.		 */		function printTable(&$tabledata, &$columns, &$actions, $nodata = null, $pre_fn = null) {			global $data, $conf, $misc, $lang;			if ($has_ma = isset($actions['multiactions']))				$ma = $actions['multiactions'];			unset($actions['multiactions']);			if ($tabledata->recordCount() > 0) {				// Remove the 'comment' column if they have been disabled				if (!$conf['show_comments']) {					unset($columns['comment']);				}				if (isset($columns['comment'])) {					// Uncomment this for clipped comments.					// TODO: This should be a user option.					//$columns['comment']['params']['clip'] = true;				}				if ($has_ma) {					echo "<script src=\"multiactionform.js\" type=\"text/javascript\"></script>\n";					echo "<form id=\"multi_form\" action=\"{$ma['url']}\" method=\"post\" enctype=\"multipart/form-data\">\n";					if (isset($ma['vars']))						foreach ($ma['vars'] as $k => $v)							echo "<input type=\"hidden\" name=\"$k\" value=\"$v\" />";				}				echo "<table>\n";				echo "<tr>\n";				// Display column headings				if ($has_ma) echo "<th></th>";				foreach ($columns as $column_id => $column) {					switch ($column_id) {						case 'actions':							if (sizeof($actions) > 0) echo "<th class=\"data\" colspan=\"", count($actions), "\">{$column['title']}</th>\n";							break;						default:							echo "<th class=\"data\">";							if (isset($column['help']))								$this->printHelp($column['title'], $column['help']);							else								echo $column['title'];							echo "</th>\n";							break;					}				}				echo "</tr>\n";				// Display table rows				$i = 0;				while (!$tabledata->EOF) {					$id = ($i % 2) + 1;					unset($alt_actions);					if (!is_null($pre_fn)) $alt_actions = $pre_fn($tabledata, $actions);					if (!isset($alt_actions)) $alt_actions =& $actions;					echo "<tr class=\"data{$id}\">\n";					if ($has_ma) {						foreach ($ma['keycols'] as $k => $v)							$a[$k] = $tabledata->fields[$v];						echo "<td>";						echo "<input type=\"checkbox\" name=\"ma[]\" value=\"". htmlentities(serialize($a)) ."\" />";						echo "</td>\n";					}					foreach ($columns as $column_id => $column) {						// Apply default values for missing parameters						if (isset($column['url']) && !isset($column['vars'])) $column['vars'] = array();						switch ($column_id) {							case 'actions':								foreach ($alt_actions as $action) {									if (isset($action['disable']) && $action['disable'] === true) {										echo "<td></td>\n";									} else {										echo "<td class=\"opbutton{$id}\">";										echo "<a href=\"{$action['url']}";										if ($action['url'] === '') echo '?';										$misc->printUrlVars($action['vars'], $tabledata->fields);										if (isset($action['target']))											echo "\" target=\"{$action['target']}";										echo "\">{$action['title']}</a></td>\n";									}								}								break;							default:								echo "<td>";								$val = value($column['field'], $tabledata->fields);								if (!is_null($val)) {									if (isset($column['url'])) {										echo "<a href=\"{$column['url']}";										$misc->printUrlVars($column['vars'], $tabledata->fields);										echo "\">";									}									$type = isset($column['type']) ? $column['type'] : null;									$params = isset($column['params']) ? $column['params'] : array();									echo $misc->printVal($val, $type, $params);									if (isset($column['url'])) echo "</a>";								}								echo "</td>\n";								break;						}					}					echo "</tr>\n";					$tabledata->moveNext();					$i++;				}				echo "</table>\n";				// Multi action table footer w/ options & [un]check'em all				if ($has_ma) {					// if default is not set or doesn't exist, set it to null					if (!isset($ma['default']) || !isset($actions[$ma['default']]))						$ma['default'] = null;					echo "<br />\n";					echo "<table>\n";					echo "<tr>\n";					echo "<th class=\"data\" style=\"text-align: left\" colspan=\"3\">{$lang['stractionsonmultiplelines']}</th>\n";					echo "</tr>\n";					echo "<tr class=\"row1\">\n";					echo "<td>";					echo "<a href=\"#\" onclick=\"javascript:checkAll(true);\">{$lang['strselectall']}</a> / ";					echo "<a href=\"#\" onclick=\"javascript:checkAll(false);\">{$lang['strunselectall']}</a></td>\n";					echo "<td>&nbsp;--->&nbsp;</td>\n";					echo "<td>\n";					echo "\t<select name=\"action\">\n";					if ($ma['default'] == null)						echo "\t\t<option value=\"\">--</option>\n";					foreach($actions as $k => $a)						if (isset($a['multiaction']))							echo "\t\t<option value=\"{$a['multiaction']}\"", ($ma['default']  == $k? ' selected="selected"': ''), ">{$a['title']}</option>\n";					echo "\t</select>\n";					echo "<input type=\"submit\" value=\"{$lang['strexecute']}\" />\n";					echo $misc->form;					echo "</td>\n";					echo "</tr>\n";					echo "</table>\n";					echo '</form>';				};				return true;			} else {				if (!is_null($nodata)) {					echo "<p>{$nodata}</p>\n";				}				return false;			}		}		/** Produce XML data for the browser tree		 * @param $treedata A set of records to populate the tree.		 * @param $attrs Attributes for tree items		 *        'text' - the text for the tree node		 *        'icon' - an icon for node		 *        'openIcon' - an alternative icon when the node is expanded		 *        'toolTip' - tool tip text for the node		 *        'action' - URL to visit when single clicking the node		 *        'iconAction' - URL to visit when single clicking the icon node		 *        'branch' - URL for child nodes (tree XML)		 *        'expand' - the action to return XML for the subtree		 *        'nodata' - message to display when node has no children		 *        'nohead' - suppress headers and opening <tree> tag		 *        'nofoot' - suppress closing </tree> tag		 */		function printTreeXML(&$treedata, &$attrs) {			global $conf, $lang;			if (!isset($attrs['nohead']) || $attrs['nohead'] === false) {				header("Content-Type: text/xml");				header("Cache-Control: no-cache");				echo "<?xml version=\"1.0\" encoding=\"", htmlspecialchars($lang['appcharset']), "\"?>\n";				echo "<tree>\n";			}			if ($treedata->recordCount() > 0) {				while (!$treedata->EOF) {					$rec =& $treedata->fields;					echo "<tree";					echo value_xml_attr('text', $attrs['text'], $rec);					echo value_xml_attr('action', $attrs['action'], $rec);					echo value_xml_attr('src', $attrs['branch'], $rec);					$icon = $this->icon(value($attrs['icon'], $rec));					echo value_xml_attr('icon', $icon, $rec);					echo value_xml_attr('iconaction', $attrs['iconAction'], $rec);					if (!empty($attrs['openicon'])) {						$icon = $this->icon(value($attrs['openIcon'], $rec));					}					echo value_xml_attr('openicon', $icon, $rec);					echo value_xml_attr('tooltip', $attrs['toolTip'], $rec);					echo " />\n";					$treedata->moveNext();				}			} else {				$msg = isset($attrs['nodata']) ? $attrs['nodata'] : $lang['strnoobjects'];				echo "<tree text=\"{$msg}\" onaction=\"tree.getSelected().getParent().reload()\" icon=\"", $this->icon('ObjectNotFound'), "\" />\n";			}			if (!isset($attrs['nofoot']) || $attrs['nofoot'] === false) {				echo "</tree>\n";			}		}		function adjustTabsForTree(&$tabs) {			include_once('./classes/ArrayRecordSet.php');			foreach ($tabs as $i => $tab) {				if ((isset($tab['hide']) && $tab['hide'] === true) || (isset($tab['tree']) && $tab['tree'] === false)) {					unset($tabs[$i]);				}			}			return new ArrayRecordSet($tabs);		}		function icon($icon) {			global $conf;			$path = "images/themes/{$conf['theme']}/{$icon}";			if (file_exists($path.'.png')) return $path.'.png';			if (file_exists($path.'.gif')) return $path.'.gif';			$path = "images/themes/default/{$icon}";			if (file_exists($path.'.png')) return $path.'.png';			if (file_exists($path.'.gif')) return $path.'.gif';			return '';		}		/**		 * Function to escape command line parameters		 * @param $str The string to escape		 * @return The escaped string		 */		function escapeShellArg($str) {			global $data, $lang;			if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {				// Due to annoying PHP bugs, shell arguments cannot be escaped				// (command simply fails), so we cannot allow complex objects				// to be dumped.				if (preg_match('/^[_.[:alnum:]]+$/', $str))					return $str;				else {					echo $lang['strcannotdumponwindows'];					exit;				}			}			else				return escapeshellarg($str);		}		/**		 * Function to escape command line programs		 * @param $str The string to escape		 * @return The escaped string		 */		function escapeShellCmd($str) {			global $data;			if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN') {				$data->fieldClean($str);				return '"' . $str . '"';			}			else				return escapeshellcmd($str);		}		/**		 * Get list of servers' groups if existing in the conf		 * @return a recordset of servers' groups		 */		function getServersGroups() {			global $conf, $lang;			$grps = array();						foreach ($conf['srv_groups'] as $i => $group) {				$grps[$i] = array(					'id' => $i,					'desc' => $group['desc'],				);							}						$grps['all'] = array(				'id' => 'all', 				'desc' => $lang['strallservers'],			);			include_once('./classes/ArrayRecordSet.php');			return new ArrayRecordSet($grps);		}				/**		 * Get list of servers		 * @param $recordset return as RecordSet suitable for printTable if true,		 *                   otherwise just return an array.		 * @param $group a group name to filter the returned servers using $conf[srv_groups]		 */		function getServers($recordset = false, $group = false) {			global $conf;			$logins = isset($_SESSION['webdbLogin']) && is_array($_SESSION['webdbLogin']) ? $_SESSION['webdbLogin'] : array();			$srvs = array();			if (($group !== false) and ($group !== 'all'))				$group = array_fill_keys(explode(',', $conf['srv_groups'][$group]['servers']), 1);						foreach($conf['servers'] as $idx => $info) {				$server_id = $info['host'].':'.$info['port'].':'.$info['sslmode'];				if (($group === false) 					or (isset($group[$idx]))					or ($group === 'all')				) {					$server_id = $info['host'].':'.$info['port'].':'.$info['sslmode'];										if (isset($logins[$server_id])) $srvs[$server_id] = $logins[$server_id];					else $srvs[$server_id] = $info;					$srvs[$server_id]['id'] = $server_id;				}			}			function _cmp_desc($a, $b) {				return strcmp($a['desc'], $b['desc']);			}			uasort($srvs, '_cmp_desc');			if ($recordset) {				include_once('./classes/ArrayRecordSet.php');				return new ArrayRecordSet($srvs);			}			return $srvs;		}		/**		 * Validate and retrieve information on a server.		 * If the parameter isn't supplied then the currently		 * connected server is returned.		 * @param $server_id A server identifier (host:port)		 * @return An associative array of server properties		 */		function getServerInfo($server_id = null) {			global $conf, $_reload_browser, $lang;			if ($server_id === null && isset($_REQUEST['server']))				$server_id = $_REQUEST['server'];			// Check for the server in the logged-in list			if (isset($_SESSION['webdbLogin'][$server_id]))				return $_SESSION['webdbLogin'][$server_id];			// Otherwise, look for it in the conf file			foreach($conf['servers'] as $idx => $info) {				if ($server_id == $info['host'].':'.$info['port'].':'.$info['sslmode']) {					// Automatically use shared credentials if available					if (!isset($info['username']) && isset($_SESSION['sharedUsername'])) {						$info['username'] = $_SESSION['sharedUsername'];						$info['password'] = $_SESSION['sharedPassword'];						$_reload_browser = true;						$this->setServerInfo(null, $info, $server_id);					}					return $info;				}			}			if ($server_id === null){				return null;			} else {				// Unable to find a matching server, are we being hacked?				echo $lang['strinvalidserverparam'];				exit;			}		}		/**		 * Set server information.		 * @param $key parameter name to set, or null to replace all		 *             params with the assoc-array in $value.		 * @param $value the new value, or null to unset the parameter		 * @param $server_id the server identifier, or null for current		 *                   server.		 */		function setServerInfo($key, $value, $server_id = null)		{			if ($server_id === null && isset($_REQUEST['server']))				$server_id = $_REQUEST['server'];			if ($key === null) {				if ($value === null)					unset($_SESSION['webdbLogin'][$server_id]);				else					$_SESSION['webdbLogin'][$server_id] = $value;			} else {				if ($value === null)					unset($_SESSION['webdbLogin'][$server_id][$key]);				else					$_SESSION['webdbLogin'][$server_id][$key] = $value;			}		}				/**		 * Set the current schema		 * @param $schema The schema name		 * @return 0 on success		 * @return $data->seSchema() on error		 */		function setCurrentSchema($schema) {			global $data;						$status = $data->setSchema($schema);			if($status != 0)				return $status;			$_REQUEST['schema'] = $schema;			$this->setHREF();			return 0;		}		/**		 * Save the given SQL script in the history 		 * of the database and server.		 * @param $script the SQL script to save.		 */		function saveScriptHistory($script) {			list($usec, $sec) = explode(' ', microtime());			$time = ((float)$usec + (float)$sec);			$_SESSION['history'][$_REQUEST['server']][$_REQUEST['database']]["$time"] = array(				'query' => $script,				'paginate' => (!isset($_REQUEST['paginate'])? 'f':'t'),				'queryid' => $time,			);		}			/*		 * Output dropdown list to select server and 		 * databases form the popups windows.		 * @param $onchange Javascript action to take when selections change.		 */			function printConnection($onchange) {			global $data, $lang, $misc;			echo "<table style=\"width: 100%\"><tr><td>\n";			echo "<label>";			$misc->printHelp($lang['strserver'], 'pg.server');			echo "</label>";			echo ": <select name=\"server\" {$onchange}>\n";						$servers = $misc->getServers();			foreach($servers as $info) {				if (empty($info['username'])) continue; // not logged on this server				echo "<option value=\"", htmlspecialchars($info['id']), "\"",					((isset($_REQUEST['server']) && $info['id'] == $_REQUEST['server'])) ? ' selected="selected"' : '', ">",					htmlspecialchars("{$info['desc']} ({$info['id']})"), "</option>\n";			}			echo "</select>\n</td><td style=\"text-align: right\">\n";						// Get the list of all databases			$databases = $data->getDatabases();			if ($databases->recordCount() > 0) {				echo "<label>";				$misc->printHelp($lang['strdatabase'], 'pg.database');				echo ": <select name=\"database\" {$onchange}>\n";								//if no database was selected, user should select one				if (!isset($_REQUEST['database']))					echo "<option value=\"\">--</option>\n";								while (!$databases->EOF) {					$dbname = $databases->fields['datname'];					echo "<option value=\"", htmlspecialchars($dbname), "\"",						((isset($_REQUEST['database']) && $dbname == $_REQUEST['database'])) ? ' selected="selected"' : '', ">",						htmlspecialchars($dbname), "</option>\n";					$databases->moveNext();				}				echo "</select></label>\n";			}			else {				$server_info = $misc->getServerInfo();				echo "<input type=\"hidden\" name=\"database\" value=\"", 					htmlspecialchars($server_info['defaultdb']), "\" />\n";			}						echo "</td></tr></table>\n";		}		/**		 * returns an array representing FKs definition for a table, sorted by fields		 * or by constraint.		 * @param $table The table to retrieve FK contraints from		 * @returns the array of FK definition:		 *   array(		 *     'byconstr' => array(		 *       constrain id => array(		 *         confrelid => foreign relation oid		 *         f_schema => foreign schema name		 *         f_table => foreign table name		 *         pattnums => array of parent's fields nums		 *         pattnames => array of parent's fields names		 *         fattnames => array of foreign attributes names		 *       )		 *     ),		 *     'byfield' => array(		 *       attribute num => array (constraint id, ...)		 *     ),		 *     'code' => HTML/js code to include in the page for auto-completion		 *   )		 **/		function getAutocompleteFKProperties($table) {			global $data;			$fksprops = array(				'byconstr' => array(),				'byfield' => array(),				'code' => ''			);			$constrs = $data->getConstraintsWithFields($table);			if (!$constrs->EOF) {				$conrelid = $constrs->fields['conrelid'];				while(!$constrs->EOF) {					if ($constrs->fields['contype'] == 'f') {						if (!isset($fksprops['byconstr'][$constrs->fields['conid']])) {							$fksprops['byconstr'][$constrs->fields['conid']] = array (								'confrelid' => $constrs->fields['confrelid'],								'f_table' => $constrs->fields['f_table'],								'f_schema' => $constrs->fields['f_schema'],								'pattnums' => array(),								'pattnames' => array(),								'fattnames' => array()							);						}						$fksprops['byconstr'][$constrs->fields['conid']]['pattnums'][] = $constrs->fields['p_attnum'];						$fksprops['byconstr'][$constrs->fields['conid']]['pattnames'][] = $constrs->fields['p_field'];						$fksprops['byconstr'][$constrs->fields['conid']]['fattnames'][] = $constrs->fields['f_field'];						if (!isset($fksprops['byfield'][$constrs->fields['p_attnum']]))							$fksprops['byfield'][$constrs->fields['p_attnum']] = array();						$fksprops['byfield'][$constrs->fields['p_attnum']][] = $constrs->fields['conid'];					}					$constrs->moveNext();				}				$fksprops['code'] = "<script type=\"text/javascript\">\n";				$fksprops['code'] .= "var constrs = {};\n";				foreach ($fksprops['byconstr'] as $conid => $props) {					$fksprops['code'] .= "constrs.constr_{$conid} = {\n";					$fksprops['code'] .= 'pattnums: ['. implode(',',$props['pattnums']) ."],\n";					$fksprops['code'] .= "f_table:'". addslashes(htmlentities($props['f_table'], ENT_QUOTES)) ."',\n";					$fksprops['code'] .= "f_schema:'". addslashes(htmlentities($props['f_schema'], ENT_QUOTES)) ."',\n";					$_ = '';					foreach ($props['pattnames'] as $n) {						$_ .= ",'". htmlentities($n, ENT_QUOTES) ."'";					}					$fksprops['code'] .= 'pattnames: ['. substr($_, 1) ."],\n";					$_ = '';					foreach ($props['fattnames'] as $n) {						$_ .= ",'". htmlentities($n, ENT_QUOTES) ."'";					}					$fksprops['code'] .= 'fattnames: ['. substr($_, 1) ."]\n";					$fksprops['code'] .= "};\n";				}				$fksprops['code'] .= "var attrs = {};\n";				foreach ($fksprops['byfield'] as $attnum => $cstrs ) {					$fksprops['code'] .= "attrs.attr_{$attnum} = [". implode(',', $fksprops['byfield'][$attnum]) ."];\n";				}				$fksprops['code'] .= "var table='". addslashes(htmlentities($table, ENT_QUOTES)) ."';";				$fksprops['code'] .= "var server='". htmlentities($_REQUEST['server']) ."';";				$fksprops['code'] .= "var database='". addslashes(htmlentities($_REQUEST['database'], ENT_QUOTES)) ."';";				$fksprops['code'] .= "</script>\n";				$fksprops['code'] .= '<div id="fkbg"></div>';				$fksprops['code'] .= '<div id="fklist"></div>';				$fksprops['code'] .= '<script src="libraries/js/jquery.js" type="text/javascript"></script>';				$fksprops['code'] .= '<script src="js/ac_insert_row.js" type="text/javascript"></script>';			}			else /* we have no foreign keys on this table */				return false;			return $fksprops;		}	}?>
<?php	/**	 * Manage functions in a database	 *	 * $Id: functions.php,v 1.78 2008/01/08 22:50:29 xzilla Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');	$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	if (!isset($msg)) $msg = '';	/**	 * Function to save after editing a function	 */	function doSaveEdit() {		global $data, $lang, $misc, $_reload_browser;		$fnlang = strtolower($_POST['original_lang']);		if ($fnlang == 'c') {			$def = array($_POST['formObjectFile'], $_POST['formLinkSymbol']);		} else if ($fnlang == 'internal'){			$def = $_POST['formLinkSymbol'];		} else {			$def = $_POST['formDefinition'];		}		if(!$data->hasFunctionAlterSchema()) $_POST['formFuncSchema'] = '';		$status = $data->setFunction($_POST['function_oid'], $_POST['original_function'], $_POST['formFunction'],			$_POST['original_arguments'], $_POST['original_returns'], $def,			$_POST['original_lang'], $_POST['formProperties'], isset($_POST['original_setof']),			$_POST['original_owner'],  $_POST['formFuncOwn'], $_POST['original_schema'],			$_POST['formFuncSchema'], isset($_POST['formCost']) ? $_POST['formCost'] : null,			isset($_POST['formRows']) ? $_POST['formRows'] : 0, $_POST['formComment']);		if ($status == 0) {			// If function has had schema altered, need to change to the new schema			// and reload the browser frame.			if (!empty($_POST['formFuncSchema']) && ($_POST['formFuncSchema'] != $_POST['original_schema'])) {				// Jump them to the new function schema				$_REQUEST['schema'] = $_POST['formFuncSchema'];				$misc->href = "server={$_REQUEST['server']}&amp;database={$_REQUEST['database']}&amp;schema={$_REQUEST['schema']}";				// Force a browser reload				$_reload_browser = true;			 }			doProperties($lang['strfunctionupdated']);		} else {			doEdit($lang['strfunctionupdatedbad']);		}	}	/**	 * Function to allow editing of a Function	 */	function doEdit($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('function');		$misc->printTitle($lang['stralter'],'pg.function.alter');		$misc->printMsg($msg);		$fndata = $data->getFunction($_REQUEST['function_oid']);		if ($fndata->recordCount() > 0) {			$fndata->fields['proretset'] = $data->phpBool($fndata->fields['proretset']);			// Initialise variables			if (!isset($_POST['formDefinition'])) $_POST['formDefinition'] = $fndata->fields['prosrc'];			if (!isset($_POST['formProperties'])) $_POST['formProperties'] = $data->getFunctionProperties($fndata->fields);			if (!isset($_POST['formFunction'])) $_POST['formFunction'] = $fndata->fields['proname'];			if (!isset($_POST['formComment'])) $_POST['formComment'] = $fndata->fields['procomment'];			if (!isset($_POST['formObjectFile'])) $_POST['formObjectFile'] = $fndata->fields['probin'];			if (!isset($_POST['formLinkSymbol'])) $_POST['formLinkSymbol'] = $fndata->fields['prosrc'];			if (!isset($_POST['formFuncOwn'])) $_POST['formFuncOwn'] = $fndata->fields['proowner'];			if (!isset($_POST['formFuncSchema'])) $_POST['formFuncSchema'] = $fndata->fields['proschema'];			if ($data->hasFunctionCosting()) {				if (!isset($_POST['formCost'])) $_POST['formCost'] = $fndata->fields['procost'];				if (!isset($_POST['formRows'])) $_POST['formRows'] = $fndata->fields['prorows'];			}			// Deal with named parameters			if ($data->hasNamedParams()) {				$args_arr = explode(', ', $fndata->fields['proarguments']);				$names_arr = $data->phpArray($fndata->fields['proargnames']);				$args = '';				$i = 0;				for ($i = 0; $i < sizeof($args_arr); $i++) {					if ($i != 0) $args .= ', ';					if (isset($names_arr[$i]) && $names_arr[$i] != '') {						$data->fieldClean($names_arr[$i]);						$args .= '"' . $names_arr[$i] . '" ';					}					$args .= $args_arr[$i];				}			}			else {				$args = $fndata->fields['proarguments'];			}			$func_full = $fndata->fields['proname'] . "(". $fndata->fields['proarguments'] .")";			echo "<form action=\"functions.php\" method=\"post\">\n";			echo "<table style=\"width: 90%\">\n";			echo "<tr>\n";			echo "<th class=\"data required\">{$lang['strschema']}</th>\n";			echo "<th class=\"data required\">{$lang['strfunction']}</th>\n";			echo "<th class=\"data\">{$lang['strarguments']}</th>\n";			echo "<th class=\"data required\">{$lang['strreturns']}</th>\n";			echo "<th class=\"data required\">{$lang['strproglanguage']}</th>\n";			echo "</tr>\n";			echo "<tr>\n";			echo "<td class=\"data1\">";			echo "<input type=\"hidden\" name=\"original_schema\" value=\"", htmlspecialchars($fndata->fields['proschema']),"\" />\n";			if ($data->hasFunctionAlterSchema()) {				$schemas = $data->getSchemas();				echo "<select name=\"formFuncSchema\">";				while (!$schemas->EOF) {					$schema = $schemas->fields['nspname'];					echo "<option value=\"", htmlspecialchars($schema), "\"",						($schema == $_POST['formFuncSchema']) ? ' selected="selected"' : '', ">", htmlspecialchars($schema), "</option>\n";					$schemas->moveNext();				}			    echo "</select>\n";			}			else echo $fndata->fields['proschema'];			echo "</td>\n";			echo "<td class=\"data1\">";			echo "<input type=\"hidden\" name=\"original_function\" value=\"", htmlspecialchars($fndata->fields['proname']),"\" />\n";			echo "<input name=\"formFunction\" style=\"width: 100%\" maxlength=\"{$data->_maxNameLen}\" value=\"", htmlspecialchars($_POST['formFunction']), "\" />";			echo "</td>\n";			echo "<td class=\"data1\">", $misc->printVal($args), "\n";			echo "<input type=\"hidden\" name=\"original_arguments\" value=\"",htmlspecialchars($args),"\" />\n";			echo "</td>\n";			echo "<td class=\"data1\">";			if ($fndata->fields['proretset']) echo "setof ";			echo $misc->printVal($fndata->fields['proresult']), "\n";			echo "<input type=\"hidden\" name=\"original_returns\" value=\"", htmlspecialchars($fndata->fields['proresult']), "\" />\n";			if ($fndata->fields['proretset'])				echo "<input type=\"hidden\" name=\"original_setof\" value=\"yes\" />\n";			echo "</td>\n";			echo "<td class=\"data1\">", $misc->printVal($fndata->fields['prolanguage']), "\n";			echo "<input type=\"hidden\" name=\"original_lang\" value=\"", htmlspecialchars($fndata->fields['prolanguage']), "\" />\n";			echo "</td>\n";			echo "</tr>\n";			$fnlang = strtolower($fndata->fields['prolanguage']);			if ($fnlang == 'c') {				echo "<tr><th class=\"data required\" colspan=\"2\">{$lang['strobjectfile']}</th>\n";				echo "<th class=\"data\" colspan=\"2\">{$lang['strlinksymbol']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"2\"><input type=\"text\" name=\"formObjectFile\" style=\"width:100%\" value=\"",					htmlspecialchars($_POST['formObjectFile']), "\" /></td>\n";				echo "<td class=\"data1\" colspan=\"2\"><input type=\"text\" name=\"formLinkSymbol\" style=\"width:100%\" value=\"",					htmlspecialchars($_POST['formLinkSymbol']), "\" /></td></tr>\n";			} else if ($fnlang == 'internal') {				echo "<tr><th class=\"data\" colspan=\"5\">{$lang['strlinksymbol']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"5\"><input type=\"text\" name=\"formLinkSymbol\" style=\"width:100%\" value=\"",					htmlspecialchars($_POST['formLinkSymbol']), "\" /></td></tr>\n";			} else {				echo "<tr><th class=\"data required\" colspan=\"5\">{$lang['strdefinition']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"5\"><textarea style=\"width:100%;\" rows=\"20\" cols=\"50\" name=\"formDefinition\">",					htmlspecialchars($_POST['formDefinition']), "</textarea></td></tr>\n";			}			// Display function comment			echo "<tr><th class=\"data\" colspan=\"5\">{$lang['strcomment']}</th></tr>\n";			echo "<tr><td class=\"data1\" colspan=\"5\"><textarea style=\"width:100%;\" name=\"formComment\" rows=\"3\" cols=\"50\">",				htmlspecialchars($_POST['formComment']), "</textarea></td></tr>\n";			// Display function cost options			if ($data->hasFunctionCosting()) {				echo "<tr><th class=\"data required\" colspan=\"5\">{$lang['strfunctioncosting']}</th></tr>\n";				echo "<td class=\"data1\" colspan=\"2\">{$lang['strexecutioncost']}: <input name=\"formCost\" size=\"16\" value=\"".					htmlspecialchars($_POST['formCost']) ."\" /></td>";				echo "<td class=\"data1\" colspan=\"2\">{$lang['strresultrows']}: <input name=\"formRows\" size=\"16\" value=\"",					htmlspecialchars($_POST['formRows']) ,"\"", (!$fndata->fields['proretset']) ? 'disabled' : '', "/></td>";			}			// Display function properties			if (is_array($data->funcprops) && sizeof($data->funcprops) > 0) {				echo "<tr><th class=\"data\" colspan=\"5\">{$lang['strproperties']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"5\">\n";				$i = 0;				foreach ($data->funcprops as $k => $v) {					echo "<select name=\"formProperties[{$i}]\">\n";					foreach ($v as $p) {						echo "<option value=\"", htmlspecialchars($p), "\"",							($p == $_POST['formProperties'][$i]) ? ' selected="selected"' : '',							">", $misc->printVal($p), "</option>\n";					}					echo "</select><br />\n";					$i++;				}				echo "</td></tr>\n";			}                        // function owner                        if ($data->hasFunctionAlterOwner()) {		            $users = $data->getUsers();                            echo "<tr><td class=\"data1\" colspan=\"5\">{$lang['strowner']}: <select name=\"formFuncOwn\">";				while (!$users->EOF) {					$uname = $users->fields['usename'];					echo "<option value=\"", htmlspecialchars($uname), "\"",						($uname == $_POST['formFuncOwn']) ? ' selected="selected"' : '', ">", htmlspecialchars($uname), "</option>\n";					$users->moveNext();				}				echo "</select>\n";			    echo "<input type=\"hidden\" name=\"original_owner\" value=\"", htmlspecialchars($fndata->fields['proowner']),"\" />\n";                            echo "</td></tr>\n";                        }			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"save_edit\" />\n";			echo "<input type=\"hidden\" name=\"function\" value=\"", htmlspecialchars($_REQUEST['function']), "\" />\n";			echo "<input type=\"hidden\" name=\"function_oid\" value=\"", htmlspecialchars($_REQUEST['function_oid']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}	/**	 * Show read only properties of a function	 */	function doProperties($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('function');		$misc->printTitle($lang['strproperties'],'pg.function');		$misc->printMsg($msg);		$funcdata = $data->getFunction($_REQUEST['function_oid']);		if ($funcdata->recordCount() > 0) {			// Deal with named parameters			if ($data->hasNamedParams()) {				$args_arr = explode(', ', $funcdata->fields['proarguments']);				$names_arr = $data->phpArray($funcdata->fields['proargnames']);				$args = '';				$i = 0;				for ($i = 0; $i < sizeof($args_arr); $i++) {					if ($i != 0) $args .= ', ';					if (isset($names_arr[$i]) && $names_arr[$i] != '') {						$data->fieldClean($names_arr[$i]);						$args .= '"' . $names_arr[$i] . '" ';					}					$args .= $args_arr[$i];				}			}			else {				$args = $funcdata->fields['proarguments'];			}			// Show comment if any			if ($funcdata->fields['procomment'] !== null)				echo "<p class=\"comment\">", $misc->printVal($funcdata->fields['procomment']), "</p>\n";			$funcdata->fields['proretset'] = $data->phpBool($funcdata->fields['proretset']);			$func_full = $funcdata->fields['proname'] . "(". $funcdata->fields['proarguments'] .")";			echo "<table style=\"width: 90%\">\n";			echo "<tr><th class=\"data\">{$lang['strfunction']}</th>\n";			echo "<th class=\"data\">{$lang['strarguments']}</th>\n";			echo "<th class=\"data\">{$lang['strreturns']}</th>\n";			echo "<th class=\"data\">{$lang['strproglanguage']}</th></tr>\n";			echo "<tr><td class=\"data1\">", $misc->printVal($funcdata->fields['proname']), "</td>\n";			echo "<td class=\"data1\">", $misc->printVal($args), "</td>\n";			echo "<td class=\"data1\">";			if ($funcdata->fields['proretset']) echo "setof ";			echo $misc->printVal($funcdata->fields['proresult']), "</td>\n";			echo "<td class=\"data1\">", $misc->printVal($funcdata->fields['prolanguage']), "</td></tr>\n";			$fnlang = strtolower($funcdata->fields['prolanguage']);			if ($fnlang == 'c') {				echo "<tr><th class=\"data\" colspan=\"2\">{$lang['strobjectfile']}</th>\n";				echo "<th class=\"data\" colspan=\"2\">{$lang['strlinksymbol']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"2\">", $misc->printVal($funcdata->fields['probin']), "</td>\n";				echo "<td class=\"data1\" colspan=\"2\">", $misc->printVal($funcdata->fields['prosrc']), "</td></tr>\n";			} else if ($fnlang == 'internal') {				echo "<tr><th class=\"data\" colspan=\"4\">{$lang['strlinksymbol']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"4\">", $misc->printVal($funcdata->fields['prosrc']), "</td></tr>\n";			} else {				include_once('./libraries/highlight.php');				echo "<tr><th class=\"data\" colspan=\"4\">{$lang['strdefinition']}</th></tr>\n";				// Check to see if we have syntax highlighting for this language				if (isset($data->langmap[$funcdata->fields['prolanguage']])) {					$temp = syntax_highlight(htmlspecialchars($funcdata->fields['prosrc']), $data->langmap[$funcdata->fields['prolanguage']]);					$tag = 'prenoescape';				}				else {					$temp = $funcdata->fields['prosrc'];					$tag = 'pre';				}				echo "<tr><td class=\"data1\" colspan=\"4\">", $misc->printVal($temp, $tag, array('lineno' => true, 'class' => 'data1')), "</td></tr>\n";			}			// Display function cost options			if ($data->hasFunctionCosting()) {				echo "<tr><th class=\"data required\" colspan=\"4\">{$lang['strfunctioncosting']}</th></tr>\n";				echo "<td class=\"data1\" colspan=\"2\">{$lang['strexecutioncost']}: ", $misc->printVal($funcdata->fields['procost']), " </td>";				echo "<td class=\"data1\" colspan=\"2\">{$lang['strresultrows']}: ", $misc->printVal($funcdata->fields['prorows']), " </td>";			}			// Show flags			if (is_array($data->funcprops) && sizeof($data->funcprops) > 0) {				// Fetch an array of the function properties				$funcprops = $data->getFunctionProperties($funcdata->fields);				echo "<tr><th class=\"data\" colspan=\"4\">{$lang['strproperties']}</th></tr>\n";				echo "<tr><td class=\"data1\" colspan=\"4\">\n";				foreach ($funcprops as $v) {					echo $misc->printVal($v), "<br />\n";				}				echo "</td></tr>\n";			}                        echo "<tr><td class=\"data1\" colspan=\"5\">{$lang['strowner']}: ", htmlspecialchars($funcdata->fields['proowner']),"\n";                        echo "</td></tr>\n";			echo "</table>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";		echo "<ul class=\"navlink\">\n\t<li><a href=\"functions.php?{$misc->href}\">{$lang['strshowallfunctions']}</a></li>\n";		echo "\t<li><a href=\"functions.php?action=edit&amp;{$misc->href}&amp;function=",			urlencode($_REQUEST['function']), "&amp;function_oid=", urlencode($_REQUEST['function_oid']), "\">{$lang['stralter']}</a></li>\n";		echo "\t<li><a href=\"functions.php?action=confirm_drop&amp;{$misc->href}&amp;function=",			urlencode($func_full), "&amp;function_oid=", $_REQUEST['function_oid'], "\">{$lang['strdrop']}</a></li>\n</ul>";	}	/**	 * Show confirmation of drop and perform actual drop	 */	function doDrop($confirm) {		global $data, $misc;		global $lang, $_reload_browser;		if (empty($_REQUEST['function']) && empty($_REQUEST['ma'])) {			doDefault($lang['strspecifyfunctiontodrop']);			exit();		}		if ($confirm) {			$misc->printTrail('schema');			$misc->printTitle($lang['strdrop'],'pg.function.drop');			echo "<form action=\"functions.php\" method=\"post\">\n";			//If multi drop			if (isset($_REQUEST['ma'])) {				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfdropfunction'], $misc->printVal($a['function'])), "</p>\n";					echo '<input type="hidden" name="function[]" value="', htmlspecialchars($a['function']), "\" />\n";					echo "<input type=\"hidden\" name=\"function_oid[]\" value=\"", htmlspecialchars($a['function_oid']), "\" />\n";				}			}			else {				echo "<p>", sprintf($lang['strconfdropfunction'], $misc->printVal($_REQUEST['function'])), "</p>\n";				echo "<input type=\"hidden\" name=\"function\" value=\"", htmlspecialchars($_REQUEST['function']), "\" />\n";				echo "<input type=\"hidden\" name=\"function_oid\" value=\"", htmlspecialchars($_REQUEST['function_oid']), "\" />\n";			}			echo "<input type=\"hidden\" name=\"action\" value=\"drop\" />\n";			echo $misc->form;			echo "<p><input type=\"checkbox\" id=\"cascade\" name=\"cascade\" /><label for=\"cascade\">{$lang['strcascade']}</label></p>\n";			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		}		else {			if (is_array($_POST['function_oid'])) {				$msg='';				$status = $data->beginTransaction();				if ($status == 0) {					foreach($_POST['function_oid'] as $k => $s) {						$status = $data->dropFunction($s, isset($_POST['cascade']));						if ($status == 0)							$msg.= sprintf('%s: %s<br />', htmlentities($_POST['function'][$k]), $lang['strfunctiondropped']);						else {							$data->endTransaction();							doDefault(sprintf('%s%s: %s<br />', $msg, htmlentities($_POST['function'][$k]), $lang['strfunctiondroppedbad']));							return;						}					}				}				if($data->endTransaction() == 0) {					// Everything went fine, back to the Default page....					$_reload_browser = true;					doDefault($msg);				}				else doDefault($lang['strfunctiondroppedbad']);			}			else{				$status = $data->dropFunction($_POST['function_oid'], isset($_POST['cascade']));				if ($status == 0) {					$_reload_browser = true;					doDefault($lang['strfunctiondropped']);				}				else {					doDefault($lang['strfunctiondroppedbad']);				}			}		}	}	/**	 * Displays a screen where they can enter a new function	 */	function doCreate($msg = '',$szJS="") {		global $data, $misc;		global $lang;		$misc->printTrail('schema');		if (!isset($_POST['formFunction'])) $_POST['formFunction'] = '';		if (!isset($_POST['formArguments'])) $_POST['formArguments'] = '';		if (!isset($_POST['formReturns'])) $_POST['formReturns'] = '';		if (!isset($_POST['formLanguage'])) $_POST['formLanguage'] = isset($_REQUEST['language']) ? $_REQUEST['language'] : 'sql';		if (!isset($_POST['formDefinition'])) $_POST['formDefinition'] = '';		if (!isset($_POST['formObjectFile'])) $_POST['formObjectFile'] = '';		if (!isset($_POST['formLinkSymbol'])) $_POST['formLinkSymbol'] = '';		if (!isset($_POST['formProperties'])) $_POST['formProperties'] = $data->defaultprops;		if (!isset($_POST['formSetOf'])) $_POST['formSetOf'] = '';		if (!isset($_POST['formArray'])) $_POST['formArray'] = '';		if (!isset($_POST['formCost'])) $_POST['formCost'] = '';		if (!isset($_POST['formRows'])) $_POST['formRows'] = '';		if (!isset($_POST['formComment'])) $_POST['formComment'] = '';		$types = $data->getTypes(true, true, true);		$langs = $data->getLanguages(true);		$fnlang = strtolower($_POST['formLanguage']);		switch ($fnlang) {			case 'c':				$misc->printTitle($lang['strcreatecfunction'],'pg.function.create.c');				break;			case 'internal':				$misc->printTitle($lang['strcreateinternalfunction'],'pg.function.create.internal');				break;			default:				$misc->printTitle($lang['strcreateplfunction'],'pg.function.create.pl');				break;		}		$misc->printMsg($msg);		// Create string for return type list		$szTypes = "";		while (!$types->EOF) {			$szSelected = "";			if($types->fields['typname'] == $_POST['formReturns']) {				$szSelected = " selected=\"selected\"";			}			/* this variable is include in the JS code bellow, so we need to ENT_QUOTES */			$szTypes .= "<option value=\"". htmlspecialchars($types->fields['typname'], ENT_QUOTES) ."\"{$szSelected}>";			$szTypes .= htmlspecialchars($types->fields['typname'], ENT_QUOTES) ."</option>";			$types->moveNext();		}		$szFunctionName = "<td class=\"data1\"><input name=\"formFunction\" size=\"16\" maxlength=\"{$data->_maxNameLen}\" value=\"".			htmlspecialchars($_POST['formFunction']) ."\" /></td>";		$szArguments = "<td class=\"data1\"><input name=\"formArguments\" style=\"width:100%;\" size=\"16\" value=\"".			htmlspecialchars($_POST['formArguments']) ."\" /></td>";		$szSetOfSelected = "";		$szNotSetOfSelected = "";		if($_POST['formSetOf'] == '') {			$szNotSetOfSelected = " selected=\"selected\"";		} else if($_POST['formSetOf'] == 'SETOF') {			$szSetOfSelected = " selected=\"selected\"";		}		$szReturns = "<td class=\"data1\" colspan=\"2\">";		$szReturns .= "<select name=\"formSetOf\">";		$szReturns .= "<option value=\"\"{$szNotSetOfSelected}></option>";		$szReturns .= "<option value=\"SETOF\"{$szSetOfSelected}>SETOF</option>";		$szReturns .= "</select>";		$szReturns .= "<select name=\"formReturns\">".$szTypes."</select>";		// Create string array type selector		$szArraySelected = "";		$szNotArraySelected = "";		if($_POST['formArray'] == '') {			$szNotArraySelected = " selected=\"selected\"";		} else if($_POST['formArray'] == '[]') {			$szArraySelected = " selected=\"selected\"";		}		$szReturns .= "<select name=\"formArray\">";		$szReturns .= "<option value=\"\"{$szNotArraySelected}></option>";		$szReturns .= "<option value=\"[]\"{$szArraySelected}>[ ]</option>";		$szReturns .= "</select>\n</td>";		// Create string for language		$szLanguage = "<td class=\"data1\">";		if ($fnlang == 'c' || $fnlang == 'internal') {			$szLanguage .=  $_POST['formLanguage'] . "\n";			$szLanguage .= "<input type=\"hidden\" name=\"formLanguage\" value=\"{$_POST['formLanguage']}\" />\n";		}		else {			$szLanguage .= "<select name=\"formLanguage\">\n";			while (!$langs->EOF) {				$szSelected = '';				if($langs->fields['lanname'] == $_POST['formLanguage']) {					$szSelected = ' selected="selected"';				}				if (strtolower($langs->fields['lanname']) != 'c' && strtolower($langs->fields['lanname']) != 'internal')					$szLanguage .= "<option value=\"". htmlspecialchars($langs->fields['lanname']). "\"{$szSelected}>\n".						$misc->printVal($langs->fields['lanname']) ."</option>";				$langs->moveNext();			}			$szLanguage .= "</select>\n";		}		$szLanguage .= "</td>";		$szJSArguments = "<tr><th class=\"data\" colspan=\"7\">{$lang['strarguments']}</th></tr>";		$arrayModes = array("IN","OUT","INOUT");		$szModes = "<select name=\"formArgModes[]\" style=\"width:100%;\">";		foreach($arrayModes as $pV) {			$szModes .= "<option value=\"{$pV}\">{$pV}</option>";		}		$szModes .= "</select>";		$szArgReturns = "<select name=\"formArgArray[]\">";		$szArgReturns .= "<option value=\"\"></option>";		$szArgReturns .= "<option value=\"[]\">[]</option>";		$szArgReturns .= "</select>";		if(!empty($conf['theme'])) {			$szImgPath = "images/themes/{$conf['theme']}";		} else {			$szImgPath = "images/themes/default";		}		if(empty($msg)) {			$szJSTRArg = "<script type=\"text/javascript\" >addArg();</script>\n";		} else {			$szJSTRArg = "";		}		$szJSAddTR = "<tr id=\"parent_add_tr\" onclick=\"addArg();\" onmouseover=\"this.style.cursor='pointer'\">\n<td style=\"text-align: right\" colspan=\"6\" class=\"data3\"><table><tr><td class=\"data3\"><img src=\"{$szImgPath}/AddArguments.png\" alt=\"Add Argument\" /></td><td class=\"data3\"><span style=\"font-size: 8pt\">{$lang['strargadd']}</span></td></tr></table></td>\n</tr>\n";		echo "<script src=\"functions.js\" type=\"text/javascript\"></script>		<script type=\"text/javascript\">			//<![CDATA[			var g_types_select = '<select name=\"formArgType[]\">{$szTypes}</select>{$szArgReturns}';			var g_modes_select = '{$szModes}';			var g_name = '';			var g_lang_strargremove = '", htmlspecialchars($lang["strargremove"], ENT_QUOTES) ,"';			var g_lang_strargnoargs = '", htmlspecialchars($lang["strargnoargs"], ENT_QUOTES) ,"';			var g_lang_strargenableargs = '", htmlspecialchars($lang["strargenableargs"], ENT_QUOTES) ,"';			var g_lang_strargnorowabove = '", htmlspecialchars($lang["strargnorowabove"], ENT_QUOTES) ,"';			var g_lang_strargnorowbelow = '", htmlspecialchars($lang["strargnorowbelow"], ENT_QUOTES) ,"';			var g_lang_strargremoveconfirm = '", htmlspecialchars($lang["strargremoveconfirm"], ENT_QUOTES) ,"';			var g_lang_strargraise = '", htmlspecialchars($lang["strargraise"], ENT_QUOTES) ,"';			var g_lang_strarglower = '", htmlspecialchars($lang["strarglower"], ENT_QUOTES) ,"';			//]]>		</script>		";		echo "<form action=\"functions.php\" method=\"post\">\n";		echo "<table><tbody id=\"args_table\">\n";		echo "<tr><th class=\"data required\">{$lang['strname']}</th>\n";		echo "<th class=\"data required\" colspan=\"2\">{$lang['strreturns']}</th>\n";		echo "<th class=\"data required\">{$lang['strproglanguage']}</th></tr>\n";		echo "<tr>\n";		echo "{$szFunctionName}\n";		echo "{$szReturns}\n";		echo "{$szLanguage}\n";		echo "</tr>\n";		echo "{$szJSArguments}\n";		echo "<tr>\n";		echo "<th class=\"data required\">{$lang['strargmode']}</th>\n";		echo "<th class=\"data required\">{$lang['strname']}</th>\n";		echo "<th class=\"data required\" colspan=\"2\">{$lang['strargtype']}</th>\n";		echo "</tr>\n";		echo "{$szJSAddTR}\n";		if ($fnlang == 'c') {			echo "<tr><th class=\"data required\" colspan=\"2\">{$lang['strobjectfile']}</th>\n";			echo "<th class=\"data\" colspan=\"2\">{$lang['strlinksymbol']}</th></tr>\n";			echo "<tr><td class=\"data1\" colspan=\"2\"><input type=\"text\" name=\"formObjectFile\" style=\"width:100%\" value=\"",				htmlspecialchars($_POST['formObjectFile']), "\" /></td>\n";			echo "<td class=\"data1\" colspan=\"2\"><input type=\"text\" name=\"formLinkSymbol\" style=\"width:100%\" value=\"",				htmlspecialchars($_POST['formLinkSymbol']), "\" /></td></tr>\n";		} else if ($fnlang == 'internal') {			echo "<tr><th class=\"data\" colspan=\"4\">{$lang['strlinksymbol']}</th></tr>\n";			echo "<tr><td class=\"data1\" colspan=\"4\"><input type=\"text\" name=\"formLinkSymbol\" style=\"width:100%\" value=\"",				htmlspecialchars($_POST['formLinkSymbol']), "\" /></td></tr>\n";		} else {			echo "<tr><th class=\"data required\" colspan=\"4\">{$lang['strdefinition']}</th></tr>\n";			echo "<tr><td class=\"data1\" colspan=\"4\"><textarea style=\"width:100%;\" rows=\"20\" cols=\"50\" name=\"formDefinition\">",				htmlspecialchars($_POST['formDefinition']), "</textarea></td></tr>\n";		}				// Display function comment		echo "<tr><th class=\"data\" colspan=\"4\">{$lang['strcomment']}</th></tr>\n";		echo "<tr><td class=\"data1\" colspan=\"4\"><textarea style=\"width:100%;\" name=\"formComment\" rows=\"3\" cols=\"50\">",			htmlspecialchars($_POST['formComment']), "</textarea></td></tr>\n";		// Display function cost options		if ($data->hasFunctionCosting()) {			echo "<tr><th class=\"data required\" colspan=\"4\">{$lang['strfunctioncosting']}</th></tr>\n";			echo "<td class=\"data1\" colspan=\"2\">{$lang['strexecutioncost']}: <input name=\"formCost\" size=\"16\" value=\"".				htmlspecialchars($_POST['formCost']) ."\" /></td>";			echo "<td class=\"data1\" colspan=\"2\">{$lang['strresultrows']}: <input name=\"formRows\" size=\"16\" value=\"".				htmlspecialchars($_POST['formRows']) ."\" /></td>";		}		// Display function properties		if (is_array($data->funcprops) && sizeof($data->funcprops) > 0) {			echo "<tr><th class=\"data required\" colspan=\"4\">{$lang['strproperties']}</th></tr>\n";			echo "<tr><td class=\"data1\" colspan=\"4\">\n";			$i = 0;			foreach ($data->funcprops as $k => $v) {				echo "<select name=\"formProperties[{$i}]\">\n";				foreach ($v as $p) {					echo "<option value=\"", htmlspecialchars($p), "\"",						($p == $_POST['formProperties'][$i]) ? ' selected="selected"' : '',						">", $misc->printVal($p), "</option>\n";				}				echo "</select><br />\n";				$i++;			}			echo "</td></tr>\n";		}		echo "</tbody></table>\n";		echo $szJSTRArg;		echo "<p><input type=\"hidden\" name=\"action\" value=\"save_create\" />\n";		echo $misc->form;		echo "<input type=\"submit\" value=\"{$lang['strcreate']}\" />\n";		echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";		echo "</form>\n";		echo $szJS;	}	/**	 * Actually creates the new function in the database	 */	function doSaveCreate() {		global $data, $lang;		$fnlang = strtolower($_POST['formLanguage']);		if ($fnlang == 'c') {			$def = array($_POST['formObjectFile'], $_POST['formLinkSymbol']);		} else if ($fnlang == 'internal'){			$def = $_POST['formLinkSymbol'];		} else {			$def = $_POST['formDefinition'];		}		$szJS = '';		echo "<script src=\"functions.js\" type=\"text/javascript\"></script>";		echo "<script type=\"text/javascript\">". buildJSData() .'</script>';		if(!empty($_POST['formArgName'])) {			$szJS = buildJSRows(buildFunctionArguments($_POST));		} else {			$szJS = "<script type=\"text/javascript\" src=\"functions.js\">noArgsRebuild(addArg());</script>";		}		$cost = (isset($_POST['formCost'])) ? $_POST['formCost'] : null;		if ($cost == '' || !is_numeric($cost) || $cost != (int)$cost || $cost < 0)  {			$cost = null;		}		$rows = (isset($_POST['formRows'])) ? $_POST['formRows'] : null;		if ($rows == '' || !is_numeric($rows) || $rows != (int)$rows )  {			$rows = null;		}		// Check that they've given a name and a definition		if ($_POST['formFunction'] == '') doCreate($lang['strfunctionneedsname'],$szJS);		elseif ($fnlang != 'internal' && !$def) doCreate($lang['strfunctionneedsdef'],$szJS);		else {			// Append array symbol to type if chosen			$status = $data->createFunction($_POST['formFunction'], empty($_POST['nojs'])? buildFunctionArguments($_POST) : $_POST['formArguments'],					$_POST['formReturns'] . $_POST['formArray'] , $def , $_POST['formLanguage'],					$_POST['formProperties'], $_POST['formSetOf'] == 'SETOF',					$cost, $rows, $_POST['formComment'], false);			if ($status == 0)				doDefault($lang['strfunctioncreated']);			else {				doCreate($lang['strfunctioncreatedbad'],$szJS);			}		}	}	/**	 * Build out the function arguments string	 */	function buildFunctionArguments($arrayVars) {		if(isset($_POST['formArgName'])) {			$arrayArgs = array();			foreach($arrayVars['formArgName'] as $pK => $pV) {				$arrayArgs[] = $arrayVars['formArgModes'][$pK] .' '. trim($pV) .' '. trim($arrayVars['formArgType'][$pK]) . $arrayVars['formArgArray'][$pK];			}			return implode(",", $arrayArgs);		}		return '';	}	/**	 * Build out JS to re-create table rows for arguments	 */	function buildJSRows($szArgs) {		$arrayModes = array('IN','OUT','INOUT');		$arrayArgs = explode(',',$szArgs);		$arrayProperArgs = array();		$nC = 0;		$szReturn = '';		foreach($arrayArgs as $pV) {			$arrayWords = explode(' ',$pV);			if(in_array($arrayWords[0],$arrayModes)===true) {				$szMode = $arrayWords[0];				array_shift($arrayWords);			}			$szArgName = array_shift($arrayWords);			if(strpos($arrayWords[count($arrayWords)-1],'[]')===false) {				$szArgType = implode(" ",$arrayWords);				$bArgIsArray = "false";			} else {				$szArgType = str_replace('[]','',implode(' ',$arrayWords));				$bArgIsArray = "true";			}			$arrayProperArgs[] = array($szMode,$szArgName,$szArgType,$bArgIsArray);			$szReturn .= "<script type=\"text/javascript\">RebuildArgTR('{$szMode}','{$szArgName}','{$szArgType}',new Boolean({$bArgIsArray}));</script>";			$nC++;		}		return $szReturn;	}	function buildJSData() {		global $data;		$arrayModes = array('IN','OUT','INOUT');		$arrayTypes = $data->getTypes(true, true, true);		$arrayPTypes = array();		$arrayPModes = array();		$szTypes = '';		while (!$arrayTypes->EOF) {			$arrayPTypes[] = "'". $arrayTypes->fields['typname'] ."'";			$arrayTypes->moveNext();		}		foreach($arrayModes as $pV) {			$arrayPModes[] = "'{$pV}'";		}		$szTypes = 'g_main_types = new Array('. implode(',', $arrayPTypes) .');';		$szModes = 'g_main_modes = new Array('. implode(',', $arrayPModes) .');';		return $szTypes . $szModes;	}	/**	 * Show default list of functions in the database	 */	function doDefault($msg = '') {		global $data, $conf, $misc, $func;		global $lang;		$misc->printTrail('schema');		$misc->printTabs('schema','functions');		$misc->printMsg($msg);		$funcs = $data->getFunctions();		$columns = array(			'function' => array(				'title' => $lang['strfunction'],				'field' => field('proproto'),				'type'  => 'verbatim',				'url'   => "redirect.php?subject=function&amp;action=properties&amp;{$misc->href}&amp;",				'vars'  => array('function' => 'proproto', 'function_oid' => 'prooid'),			),			'returns' => array(				'title' => $lang['strreturns'],				'field' => field('proreturns'),				'type'  => 'verbatim',			),			'owner' => array(				'title' => $lang['strowner'],				'field' => field('proowner'),			),			'proglanguage' => array(				'title' => $lang['strproglanguage'],				'field' => field('prolanguage'),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('procomment'),			),		);		$actions = array(			'multiactions' => array(				'keycols' => array('function' => 'proproto', 'function_oid' => 'prooid'),				'url' => 'functions.php',			),			'alter' => array(				'title' => $lang['stralter'],				'url'   => "functions.php?action=edit&amp;{$misc->href}&amp;",				'vars'  => array('function' => 'proproto', 'function_oid' => 'prooid'),			),			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "functions.php?action=confirm_drop&amp;{$misc->href}&amp;",				'vars'  => array('function' => 'proproto', 'function_oid' => 'prooid'),				'multiaction' => 'confirm_drop',			),			'privileges' => array(				'title' => $lang['strprivileges'],				'url'   => "privileges.php?{$misc->href}&amp;subject=function&amp;",				'vars'  => array('function' => 'proproto', 'function_oid' => 'prooid'),			),		);		$misc->printTable($funcs, $columns, $actions, $lang['strnofunctions']);		echo "<ul class=\"navlink\">\n\t<li><a href=\"functions.php?action=create&amp;{$misc->href}\">{$lang['strcreateplfunction']}</a></li>\n";		echo "\t<li><a href=\"functions.php?action=create&amp;language=internal&amp;{$misc->href}\">{$lang['strcreateinternalfunction']}</a></li>\n";		echo "\t<li><a href=\"functions.php?action=create&amp;language=C&amp;{$misc->href}\">{$lang['strcreatecfunction']}</a></li>\n</ul>\n";	}	/**	 * Generate XML for the browser tree.	 */	function doTree() {		global $misc, $data;		$funcs = $data->getFunctions();		$proto = concat(field('proname'),' (',field('proarguments'),')');		$reqvars = $misc->getRequestVars('function');		$attrs = array(			'text'    => $proto,			'icon'    => 'Function',			'toolTip' => field('procomment'),			'action'  => url('redirect.php',							$reqvars,							array(								'action' => 'properties',								'function' => $proto,								'function_oid' => field('prooid')							)						)		);		$misc->printTreeXML($funcs, $attrs);		exit;	}	if ($action == 'tree') doTree();	$misc->printHeader($lang['strfunctions']);	$misc->printBody();	switch ($action) {		case 'save_create':			if (isset($_POST['cancel'])) doDefault();			else doSaveCreate();			break;		case 'create':			doCreate();			break;		case 'drop':			if (isset($_POST['drop'])) doDrop(false);			else doDefault();			break;		case 'confirm_drop':			doDrop(true);			break;		case 'save_edit':			if (isset($_POST['cancel'])) doDefault();			else doSaveEdit();			break;		case 'edit':			doEdit();			break;		case 'properties':			doProperties();			break;		default:			doDefault();			break;	}	$misc->printFooter();?>
<?php	/**	 * Manage users in a database cluster	 *	 * $Id: users.php,v 1.40 2008/02/25 17:20:44 xzilla Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');	$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	if (!isset($msg)) $msg = '';			/**	 * If a user is not a superuser, then we have an 'account management' page	 * where they can change their password, etc.  We don't prevent them from	 * messing with the URL to gain access to other user admin stuff, because	 * the PostgreSQL permissions will prevent them changing anything anyway.	 */	function doAccount($msg = '') {		global $data, $misc;		global $lang;				$server_info = $misc->getServerInfo();				$userdata = $data->getUser($server_info['username']);		$_REQUEST['user'] = $server_info['username'];				$misc->printTrail('user');		$misc->printTabs('server','account');		$misc->printMsg($msg);		if ($userdata->recordCount() > 0) {			$userdata->fields['usesuper'] = $data->phpBool($userdata->fields['usesuper']);			$userdata->fields['usecreatedb'] = $data->phpBool($userdata->fields['usecreatedb']);			echo "<table>\n";			echo "<tr><th class=\"data\">{$lang['strusername']}</th><th class=\"data\">{$lang['strsuper']}</th><th class=\"data\">{$lang['strcreatedb']}</th><th class=\"data\">{$lang['strexpires']}</th>";			echo "<th class=\"data\">{$lang['strsessiondefaults']}</th>";			echo "</tr>\n";			echo "<tr>\n\t<td class=\"data1\">", $misc->printVal($userdata->fields['usename']), "</td>\n";			echo "\t<td class=\"data1\">", $misc->printVal($userdata->fields['usesuper'], 'yesno'), "</td>\n";			echo "\t<td class=\"data1\">", $misc->printVal($userdata->fields['usecreatedb'], 'yesno'), "</td>\n";			echo "\t<td class=\"data1\">", ($userdata->fields['useexpires'] == 'infinity' || is_null($userdata->fields['useexpires']) ? $lang['strnever'] : $misc->printVal($userdata->fields['useexpires'])), "</td>\n";			echo "\t<td class=\"data1\">", $misc->printVal($userdata->fields['useconfig']), "</td>\n";			echo "</tr>\n</table>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";				echo "<p><a class=\"navlink\" href=\"users.php?action=confchangepassword&amp;{$misc->href}\">{$lang['strchangepassword']}</a></p>\n";	}		/**	 * Show confirmation of change password and actually change password	 */	function doChangePassword($confirm, $msg = '') {		global $data, $misc;		global $lang, $conf;				$server_info = $misc->getServerInfo();				if ($confirm) {			$_REQUEST['user'] = $server_info['username'];			$misc->printTrail('user');			$misc->printTitle($lang['strchangepassword'],'pg.user.alter');			$misc->printMsg($msg);						if (!isset($_POST['password'])) $_POST['password'] = '';			if (!isset($_POST['confirm'])) $_POST['confirm'] = '';						echo "<form action=\"users.php\" method=\"post\">\n";			echo "<table>\n";			echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strpassword']}</th>\n";			echo "\t\t<td><input type=\"password\" name=\"password\" size=\"32\" value=\"", 				htmlspecialchars($_POST['password']), "\" /></td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strconfirm']}</th>\n";			echo "\t\t<td><input type=\"password\" name=\"confirm\" size=\"32\" value=\"\" /></td>\n\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"changepassword\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"ok\" value=\"{$lang['strok']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</p></form>\n";		}		else {			// Check that password is minimum length			if (strlen($_POST['password']) < $conf['min_password_length'])				doChangePassword(true, $lang['strpasswordshort']);			// Check that password matches confirmation password			elseif ($_POST['password'] != $_POST['confirm'])				doChangePassword(true, $lang['strpasswordconfirm']);			else {				$status = $data->changePassword($server_info['username'], 					$_POST['password']);				if ($status == 0)					doAccount($lang['strpasswordchanged']);				else					doAccount($lang['strpasswordchangedbad']);			}		}			}	/**	 * Function to allow editing of a user	 */	function doEdit($msg = '') {		global $data, $misc;		global $lang;			$misc->printTrail('user');		$misc->printTitle($lang['stralter'],'pg.user.alter');		$misc->printMsg($msg);				$userdata = $data->getUser($_REQUEST['username']);				if ($userdata->recordCount() > 0) {			$server_info = $misc->getServerInfo();			$canRename = $data->hasUserRename() && ($_REQUEST['username'] != $server_info['username']);			$userdata->fields['usesuper'] = $data->phpBool($userdata->fields['usesuper']);			$userdata->fields['usecreatedb'] = $data->phpBool($userdata->fields['usecreatedb']);			if (!isset($_POST['formExpires'])){				if ($canRename) $_POST['newname'] = $userdata->fields['usename'];				if ($userdata->fields['usesuper']) $_POST['formSuper'] = '';				if ($userdata->fields['usecreatedb']) $_POST['formCreateDB'] = '';				$_POST['formExpires'] = $userdata->fields['useexpires'] == 'infinity' ? '' : $userdata->fields['useexpires'];				$_POST['formPassword'] = '';			}					echo "<form action=\"users.php\" method=\"post\">\n";			echo "<table>\n";			echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strusername']}</th>\n";			echo "\t\t<td class=\"data1\">", ($canRename ? "<input name=\"newname\" size=\"15\" maxlength=\"{$data->_maxNameLen}\" value=\"" . htmlspecialchars($_POST['newname']) . "\" />" : $misc->printVal($userdata->fields['usename'])), "</td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left\"><label for=\"formSuper\">{$lang['strsuper']}</label></th>\n";			echo "\t\t<td class=\"data1\"><input type=\"checkbox\" id=\"formSuper\" name=\"formSuper\"", 				(isset($_POST['formSuper'])) ? ' checked="checked"' : '', " /></td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left\"><label for=\"formCreateDB\">{$lang['strcreatedb']}</label></th>\n";			echo "\t\t<td class=\"data1\"><input type=\"checkbox\" id=\"formCreateDB\" name=\"formCreateDB\"", 				(isset($_POST['formCreateDB'])) ? ' checked="checked"' : '', " /></td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strexpires']}</th>\n";			echo "\t\t<td class=\"data1\"><input size=\"16\" name=\"formExpires\" value=\"", htmlspecialchars($_POST['formExpires']), "\" /></td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strpassword']}</th>\n";			echo "\t\t<td class=\"data1\"><input type=\"password\" size=\"16\" name=\"formPassword\" value=\"", htmlspecialchars($_POST['formPassword']), "\" /></td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strconfirm']}</th>\n";			echo "\t\t<td class=\"data1\"><input type=\"password\" size=\"16\" name=\"formConfirm\" value=\"\" /></td>\n\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"save_edit\" />\n";			echo "<input type=\"hidden\" name=\"username\" value=\"", htmlspecialchars($_REQUEST['username']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}		/** 	 * Function to save after editing a user	 */	function doSaveEdit() {		global $data, $lang;				// Check name and password		if (isset($_POST['newname']) && $_POST['newname'] == '')			doEdit($lang['struserneedsname']);		else if ($_POST['formPassword'] != $_POST['formConfirm'])			doEdit($lang['strpasswordconfirm']);		else {			if (isset($_POST['newname'])) $status = $data->setRenameUser($_POST['username'], $_POST['formPassword'], isset($_POST['formCreateDB']), isset($_POST['formSuper']), $_POST['formExpires'], $_POST['newname']);			else $status = $data->setUser($_POST['username'], $_POST['formPassword'], isset($_POST['formCreateDB']), isset($_POST['formSuper']), $_POST['formExpires']);			if ($status == 0)				doDefault($lang['struserupdated']);			else				doEdit($lang['struserupdatedbad']);		}	}	/**	 * Show confirmation of drop and perform actual drop	 */	function doDrop($confirm) {		global $data, $misc;		global $lang;		if ($confirm) {			$misc->printTrail('user');			$misc->printTitle($lang['strdrop'],'pg.user.drop');						echo "<p>", sprintf($lang['strconfdropuser'], $misc->printVal($_REQUEST['username'])), "</p>\n";							echo "<form action=\"users.php\" method=\"post\">\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"drop\" />\n";			echo "<input type=\"hidden\" name=\"username\" value=\"", htmlspecialchars($_REQUEST['username']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else {			$status = $data->dropUser($_REQUEST['username']);			if ($status == 0)				doDefault($lang['struserdropped']);			else				doDefault($lang['struserdroppedbad']);		}			}		/**	 * Displays a screen where they can enter a new user	 */	function doCreate($msg = '') {		global $data, $misc, $username;		global $lang;				if (!isset($_POST['formUsername'])) $_POST['formUsername'] = '';		if (!isset($_POST['formPassword'])) $_POST['formPassword'] = '';		if (!isset($_POST['formConfirm'])) $_POST['formConfirm'] = '';		if (!isset($_POST['formExpires'])) $_POST['formExpires'] = '';				$misc->printTrail('server');		$misc->printTitle($lang['strcreateuser'],'pg.user.create');		$misc->printMsg($msg);		echo "<form action=\"users.php\" method=\"post\">\n";		echo "<table>\n";		echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strusername']}</th>\n";		echo "\t\t<td class=\"data1\"><input size=\"15\" maxlength=\"{$data->_maxNameLen}\" name=\"formUsername\" value=\"", htmlspecialchars($_POST['formUsername']), "\" /></td>\n\t</tr>\n";		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strpassword']}</th>\n";		echo "\t\t<td class=\"data1\"><input size=\"15\" type=\"password\" name=\"formPassword\" value=\"", htmlspecialchars($_POST['formPassword']), "\" /></td>\n\t</tr>\n";		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strconfirm']}</th>\n";		echo "\t\t<td class=\"data1\"><input size=\"15\" type=\"password\" name=\"formConfirm\" value=\"", htmlspecialchars($_POST['formConfirm']), "\" /></td>\n\t</tr>\n";		echo "\t<tr>\n\t\t<th class=\"data left\"><label for=\"formSuper\">{$lang['strsuper']}</label></th>\n";		echo "\t\t<td class=\"data1\"><input type=\"checkbox\" id=\"formSuper\" name=\"formSuper\"", 			(isset($_POST['formSuper'])) ? ' checked="checked"' : '', " /></td>\n\t</tr>\n";		echo "\t<tr>\n\t\t<th class=\"data left\"><label for=\"formCreateDB\">{$lang['strcreatedb']}</label></th>\n";		echo "\t\t<td class=\"data1\"><input type=\"checkbox\" id=\"formCreateDB\" name=\"formCreateDB\"", 			(isset($_POST['formCreateDB'])) ? ' checked="checked"' : '', " /></td>\n\t</tr>\n";		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strexpires']}</th>\n";		echo "\t\t<td class=\"data1\"><input size=\"30\" name=\"formExpires\" value=\"", htmlspecialchars($_POST['formExpires']), "\" /></td>\n\t</tr>\n";		echo "</table>\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"save_create\" />\n";		echo $misc->form;		echo "<input type=\"submit\" name=\"create\" value=\"{$lang['strcreate']}\" />\n";		echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";		echo "</form>\n";	}		/**	 * Actually creates the new user in the database	 */	function doSaveCreate() {		global $data;		global $lang;		// Check data		if ($_POST['formUsername'] == '')			doCreate($lang['struserneedsname']);		else if ($_POST['formPassword'] != $_POST['formConfirm'])			doCreate($lang['strpasswordconfirm']);		else {					$status = $data->createUser($_POST['formUsername'], $_POST['formPassword'], 				isset($_POST['formCreateDB']), isset($_POST['formSuper']), $_POST['formExpires'], array());			if ($status == 0)				doDefault($lang['strusercreated']);			else				doCreate($lang['strusercreatedbad']);		}	}		/**	 * Show default list of users in the database	 */	function doDefault($msg = '') {		global $data, $misc;		global $lang;				function renderUseExpires($val) {			global $lang;			return $val == 'infinity' ? $lang['strnever'] : htmlspecialchars($val); 		}				$misc->printTrail('server');		$misc->printTabs('server','users');		$misc->printMsg($msg);				$users = $data->getUsers();				$columns = array(			'user' => array(				'title' => $lang['strusername'],				'field' => field('usename'),			),			'superuser' => array(				'title' => $lang['strsuper'],				'field' => field('usesuper'),				'type'  => 'yesno',			),			'createdb' => array(				'title' => $lang['strcreatedb'],				'field' => field('usecreatedb'),				'type'  => 'yesno',			),			'expires' => array(				'title' => $lang['strexpires'],				'field' => field('useexpires'),				'type'  => 'callback',				'params'=> array('function' => 'renderUseExpires', 'null' => $lang['strnever']),			),			'defaults' => array(				'title' => $lang['strsessiondefaults'],				'field' => field('useconfig'),			),			'actions' => array(				'title' => $lang['stractions'],			),		);				$actions = array(			'alter' => array(				'title' => $lang['stralter'],				'url'   => "users.php?action=edit&amp;{$misc->href}&amp;",				'vars'  => array('username' => 'usename'),			),			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "users.php?action=confirm_drop&amp;{$misc->href}&amp;",				'vars'  => array('username' => 'usename'),			),		);				$misc->printTable($users, $columns, $actions, $lang['strnousers']);		echo "<p><a class=\"navlink\" href=\"users.php?action=create&amp;{$misc->href}\">{$lang['strcreateuser']}</a></p>\n";	}	$misc->printHeader($lang['strusers']);	$misc->printBody();	switch ($action) {		case 'changepassword':			if (isset($_REQUEST['ok'])) doChangePassword(false);			else doAccount();			break;		case 'confchangepassword':			doChangePassword(true);			break;					case 'account':			doAccount();			break;		case 'save_create':			if (isset($_REQUEST['cancel'])) doDefault();			else doSaveCreate();			break;		case 'create':						doCreate();			break;		case 'drop':			if (isset($_REQUEST['cancel'])) doDefault();			else doDrop(false);			break;		case 'confirm_drop':			doDrop(true);			break;		case 'save_edit':			if (isset($_REQUEST['cancel'])) doDefault();			else doSaveEdit();			break;		case 'edit':			doEdit();			break;		default:			doDefault();			break;	}		$misc->printFooter();?>
<?php	/**	 * Manage privileges in a database	 *	 * $Id: privileges.php,v 1.45 2007/09/13 13:41:01 ioguix Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');		$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	if (!isset($msg)) $msg = '';	/**	 * Grant permissions on an object to a user	 * @param $confirm To show entry screen	 * @param $mode 'grant' or 'revoke'	 * @param $msg (optional) A message to show	 */	function doAlter($confirm, $mode, $msg = '') {		global $data, $misc;		global $lang;		if (!isset($_REQUEST['username'])) $_REQUEST['username'] = array();		if (!isset($_REQUEST['groupname'])) $_REQUEST['groupname'] = array();		if (!isset($_REQUEST['privilege'])) $_REQUEST['privilege'] = array();			if ($confirm) {			// Get users from the database			$users = $data->getUsers();			// Get groups from the database			$groups = $data->getGroups();					$misc->printTrail($_REQUEST['subject']);						switch ($mode) {				case 'grant':					$misc->printTitle($lang['strgrant'],'pg.privilege.grant');					break;				case 'revoke':					$misc->printTitle($lang['strrevoke'],'pg.privilege.revoke');					break;			}			$misc->printMsg($msg);						echo "<form action=\"privileges.php\" method=\"post\">\n";			echo "<table>\n";			echo "<tr><th class=\"data left\">{$lang['strusers']}</th>\n";			echo "<td class=\"data1\"><select name=\"username[]\" multiple=\"multiple\" size=\"", min(6, $users->recordCount()), "\">\n";			while (!$users->EOF) {				$uname = htmlspecialchars($users->fields['usename']);				echo "<option value=\"{$uname}\"",					in_array($users->fields['usename'], $_REQUEST['username']) ? ' selected="selected"' : '', ">{$uname}</option>\n";				$users->moveNext();			}			echo "</select></td></tr>\n";			echo "<tr><th class=\"data left\">{$lang['strgroups']}</th>\n";			echo "<td class=\"data1\">\n";			echo "<input type=\"checkbox\" id=\"public\" name=\"public\"", (isset($_REQUEST['public']) ? ' checked="checked"' : ''), " /><label for=\"public\">PUBLIC</label>\n";			// Only show groups if there are groups!			if ($groups->recordCount() > 0) {				echo "<br /><select name=\"groupname[]\" multiple=\"multiple\" size=\"", min(6, $groups->recordCount()), "\">\n";				while (!$groups->EOF) {					$gname = htmlspecialchars($groups->fields['groname']);					echo "<option value=\"{$gname}\"",						in_array($groups->fields['groname'], $_REQUEST['groupname']) ? ' selected="selected"' : '', ">{$gname}</option>\n";					$groups->moveNext();				}				echo "</select>\n";			}			echo "</td></tr>\n";			echo "<tr><th class=\"data left required\">{$lang['strprivileges']}</th>\n";			echo "<td class=\"data1\">\n";			foreach ($data->privlist[$_REQUEST['subject']] as $v) {				$v = htmlspecialchars($v);				echo "<input type=\"checkbox\" id=\"privilege[$v]\" name=\"privilege[$v]\"", 							isset($_REQUEST['privilege'][$v]) ? ' checked="checked"' : '', " /><label for=\"privilege[$v]\">{$v}</label><br />\n";			}			echo "</td></tr>\n";			// Grant option			if ($data->hasGrantOption()) {				echo "<tr><th class=\"data left\">{$lang['stroptions']}</th>\n";				echo "<td class=\"data1\">\n";				if ($mode == 'grant') {					echo "<input type=\"checkbox\" id=\"grantoption\" name=\"grantoption\"", 								isset($_REQUEST['grantoption']) ? ' checked="checked"' : '', " /><label for=\"grantoption\">GRANT OPTION</label>\n";				}				elseif ($mode == 'revoke') {					echo "<input type=\"checkbox\" id=\"grantoption\" name=\"grantoption\"", 								isset($_REQUEST['grantoption']) ? ' checked="checked"' : '', " /><label for=\"grantoption\">GRANT OPTION FOR</label><br />\n";					echo "<input type=\"checkbox\" id=\"cascade\" name=\"cascade\"", 								isset($_REQUEST['cascade']) ? ' checked="checked"' : '', " /><label for=\"cascade\">CASCADE</label><br />\n";				}				echo "</td></tr>\n";			}			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"save\" />\n";			echo "<input type=\"hidden\" name=\"mode\" value=\"", htmlspecialchars($mode), "\" />\n";			echo "<input type=\"hidden\" name=\"subject\" value=\"", htmlspecialchars($_REQUEST['subject']), "\" />\n";			if (isset($_REQUEST[$_REQUEST['subject'].'_oid']))				echo "<input type=\"hidden\" name=\"", htmlspecialchars($_REQUEST['subject'].'_oid'),					"\" value=\"", htmlspecialchars($_REQUEST[$_REQUEST['subject'].'_oid']), "\" />\n";			echo "<input type=\"hidden\" name=\"", htmlspecialchars($_REQUEST['subject']),				"\" value=\"", htmlspecialchars($_REQUEST[$_REQUEST['subject']]), "\" />\n";			if ($_REQUEST['subject'] == 'column')				echo "<input type=\"hidden\" name=\"table\" value=\"",					htmlspecialchars($_REQUEST['table']), "\" />\n";			echo $misc->form;			if ($mode == 'grant')				echo "<input type=\"submit\" name=\"grant\" value=\"{$lang['strgrant']}\" />\n";			elseif ($mode == 'revoke')				echo "<input type=\"submit\" name=\"revoke\" value=\"{$lang['strrevoke']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>";			echo "</form>\n";		}		else {			// Determine whether object should be ref'd by name or oid.			if (isset($_REQUEST[$_REQUEST['subject'].'_oid']))				$object = $_REQUEST[$_REQUEST['subject'].'_oid'];			else				$object = $_REQUEST[$_REQUEST['subject']];			if (isset($_REQUEST['table'])) $table = $_REQUEST['table'];			else $table = null;			$status = $data->setPrivileges(($mode == 'grant') ? 'GRANT' : 'REVOKE', $_REQUEST['subject'], $object,				isset($_REQUEST['public']), $_REQUEST['username'], $_REQUEST['groupname'], array_keys($_REQUEST['privilege']),				isset($_REQUEST['grantoption']), isset($_REQUEST['cascade']), $table);			if ($status == 0)				doDefault($lang['strgranted']);			elseif ($status == -3 || $status == -4)				doAlter(true, $_REQUEST['mode'], $lang['strgrantbad']);			else				doAlter(true, $_REQUEST['mode'], $lang['strgrantfailed']);		}	}	/**	 * Show permissions on a database, namespace, relation, language or function	 */	function doDefault($msg = '') {		global $data, $misc, $database;		global $lang;		$misc->printTrail($_REQUEST['subject']);				# @@@FIXME: This switch is just a temporary solution,		# need a better way, maybe every type of object should		# have a tab bar???		switch ($_REQUEST['subject']) {			case 'server':			case 'database':			case 'schema':			case 'table':			case 'column':			case 'view':				$misc->printTabs($_REQUEST['subject'], 'privileges');				break;			default:				$misc->printTitle($lang['strprivileges'], 'pg.privilege');		}		$misc->printMsg($msg);		// Determine whether object should be ref'd by name or oid.		if (isset($_REQUEST[$_REQUEST['subject'].'_oid']))			$object = $_REQUEST[$_REQUEST['subject'].'_oid'];		else			$object = $_REQUEST[$_REQUEST['subject']];				// Get the privileges on the object, given its type		if ($_REQUEST['subject'] == 'column')			$privileges = $data->getPrivileges($object, 'column', $_REQUEST['table']);		else			$privileges = $data->getPrivileges($object, $_REQUEST['subject']);		if (sizeof($privileges) > 0) {			echo "<table>\n";			if ($data->hasRoles())				echo "<tr><th class=\"data\">{$lang['strrole']}</th>";			else				echo "<tr><th class=\"data\">{$lang['strtype']}</th><th class=\"data\">{$lang['struser']}/{$lang['strgroup']}</th>";			foreach ($data->privlist[$_REQUEST['subject']] as $v2) {				// Skip over ALL PRIVILEGES				if ($v2 == 'ALL PRIVILEGES') continue;				echo "<th class=\"data\">{$v2}</th>\n";			}			if ($data->hasGrantOption()) {				echo "<th class=\"data\">{$lang['strgrantor']}</th>";			}			echo "</tr>\n";			// Loop over privileges, outputting them			$i = 0;			foreach ($privileges as $v) {				$id = (($i % 2) == 0 ? '1' : '2');				echo "<tr class=\"data{$id}\">\n";				if (!$data->hasRoles())					echo "<td>", $misc->printVal($v[0]), "</td>\n";				echo "<td>", $misc->printVal($v[1]), "</td>\n";				foreach ($data->privlist[$_REQUEST['subject']] as $v2) {					// Skip over ALL PRIVILEGES					if ($v2 == 'ALL PRIVILEGES') continue;					echo "<td>";					if (in_array($v2, $v[2]))						echo $lang['stryes'];					else						echo $lang['strno'];					// If we have grant option for this, end mark					if ($data->hasGrantOption() && in_array($v2, $v[4])) echo $lang['strasterisk'];					echo "</td>\n";				}				if ($data->hasGrantOption()) {					echo "<td>", $misc->printVal($v[3]), "</td>\n";				}				echo "</tr>\n";				$i++;			}			echo "</table>";		}		else {			echo "<p>{$lang['strnoprivileges']}</p>\n";		}				// Links for granting to a user or group		switch ($_REQUEST['subject']) {			case 'table':			case 'view':			case 'sequence':			case 'function':			case 'tablespace':				$allurl = "{$_REQUEST['subject']}s.php";				$alltxt = $lang["strshowall{$_REQUEST['subject']}s"];				break;			case 'schema':				$allurl = "database.php";				$alltxt = $lang["strshowallschemas"];				break;			case 'database':				$allurl = 'all_db.php';				$alltxt = $lang['strshowalldatabases'];				break;		}				$subject = htmlspecialchars(urlencode($_REQUEST['subject']));		$object = htmlspecialchars(urlencode($_REQUEST[$_REQUEST['subject']]));				if ($_REQUEST['subject'] == 'function') {			$objectoid = $_REQUEST[$_REQUEST['subject'].'_oid'];			$alterurl = "privileges.php?action=alter&amp;{$misc->href}&amp;{$subject}={$object}&amp;{$subject}_oid={$objectoid}&amp;subject={$subject}&amp;mode=";		}		else if ($_REQUEST['subject'] == 'column') {			$alterurl = "privileges.php?action=alter&amp;{$misc->href}&amp;{$subject}={$object}"				."&amp;subject={$subject}&amp;table=". urlencode($_REQUEST['table']) ."&amp;mode=";		}		else {			$alterurl = "privileges.php?action=alter&amp;{$misc->href}&amp;{$subject}={$object}&amp;subject={$subject}&amp;mode=";		}			echo "<ul class=\"navlink\">\n\t<li><a href=\"{$alterurl}grant\">{$lang['strgrant']}</a></li>\n";		echo "\t<li><a href=\"{$alterurl}revoke\">{$lang['strrevoke']}</a></li>\n";		if (isset($allurl))			echo "\t<li><a href=\"{$allurl}?{$misc->href}\">{$alltxt}</a></li>\n";				echo "</ul>\n";	}	$misc->printHeader($lang['strprivileges']);	$misc->printBody();	switch ($action) {		case 'save':			if (isset($_REQUEST['cancel'])) doDefault();			else doAlter(false, $_REQUEST['mode']);			break;		case 'alter':			doAlter(true, $_REQUEST['mode']);			break;		default:			doDefault();			break;	}		$misc->printFooter();	?>
<?php	/**	 * Manage sequences in a database	 *	 * $Id: sequences.php,v 1.49 2007/12/15 22:21:54 ioguix Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');	$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	if (!isset($msg)) $msg = '';	/**	 * Display list of all sequences in the database/schema	 */	function doDefault($msg = '')	{		global $data, $conf, $misc;		global $lang;		$misc->printTrail('schema');		$misc->printTabs('schema', 'sequences');		$misc->printMsg($msg);		// Get all sequences		$sequences = $data->getSequences();		$columns = array(			'sequence' => array(				'title' => $lang['strsequence'],				'field' => field('seqname'),				'url'   => "sequences.php?action=properties&amp;{$misc->href}&amp;",				'vars'  => array('sequence' => 'seqname'),			),			'owner' => array(				'title' => $lang['strowner'],				'field' => field('seqowner'),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('seqcomment'),			),		);		$actions = array(			'multiactions' => array(				'keycols' => array('sequence' => 'seqname'),				'url' => 'sequences.php',			),			'alter' => array(				'title' => $lang['stralter'],				'url'   => "sequences.php?action=confirm_alter&amp;{$misc->href}&amp;subject=sequence&amp;",				'vars'  => array('sequence' => 'seqname'),			),			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "sequences.php?action=confirm_drop&amp;{$misc->href}&amp;",				'vars'  => array('sequence' => 'seqname'),				'multiaction' => 'confirm_drop',			),			'privileges' => array(				'title' => $lang['strprivileges'],				'url'   => "privileges.php?{$misc->href}&amp;subject=sequence&amp;",				'vars'  => array('sequence' => 'seqname'),			),		);		$misc->printTable($sequences, $columns, $actions, $lang['strnosequences']);		echo "<p><a class=\"navlink\" href=\"sequences.php?action=create&amp;{$misc->href}\">{$lang['strcreatesequence']}</a></p>\n";	}	/**	 * Generate XML for the browser tree.	 */	function doTree() {		global $misc, $data;		$sequences = $data->getSequences();		$reqvars = $misc->getRequestVars('sequence');		$attrs = array(			'text'   => field('seqname'),			'icon'   => 'Sequence',			'toolTip'=> field('seqcomment'),			'action' => url('sequences.php',							$reqvars,							array (								'action' => 'properties',								'sequence' => field('seqname')							)						)		);		$misc->printTreeXML($sequences, $attrs);		exit;	}	/**	 * Display the properties of a sequence	 */	function doProperties($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('sequence');		$misc->printTitle($lang['strproperties'],'pg.sequence');		$misc->printMsg($msg);		// Fetch the sequence information		$sequence = $data->getSequence($_REQUEST['sequence']);		if (is_object($sequence) && $sequence->recordCount() > 0) {			$sequence->fields['is_cycled'] = $data->phpBool($sequence->fields['is_cycled']);			$sequence->fields['is_called'] = $data->phpBool($sequence->fields['is_called']);			// Show comment if any			if ($sequence->fields['seqcomment'] !== null)				echo "<p class=\"comment\">", $misc->printVal($sequence->fields['seqcomment']), "</p>\n";			echo "<table border=\"0\">";			echo "<tr><th class=\"data\">{$lang['strname']}</th>";			if ($data->hasAlterSequenceStart()) {				echo "<th class=\"data\">{$lang['strstartvalue']}</th>";			}			echo "<th class=\"data\">{$lang['strlastvalue']}</th>";			echo "<th class=\"data\">{$lang['strincrementby']}</th>";			echo "<th class=\"data\">{$lang['strmaxvalue']}</th>";			echo "<th class=\"data\">{$lang['strminvalue']}</th>";			echo "<th class=\"data\">{$lang['strcachevalue']}</th>";			echo "<th class=\"data\">{$lang['strlogcount']}</th>";			echo "<th class=\"data\">{$lang['strcancycle']}</th>";			echo "<th class=\"data\">{$lang['striscalled']}</th></tr>";			echo "<tr>";			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['seqname']), "</td>";			if ($data->hasAlterSequenceStart()) {				echo "<td class=\"data1\">", $misc->printVal($sequence->fields['start_value']), "</td>";			}			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['last_value']), "</td>";			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['increment_by']), "</td>";			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['max_value']), "</td>";			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['min_value']), "</td>";			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['cache_value']), "</td>";			echo "<td class=\"data1\">", $misc->printVal($sequence->fields['log_cnt']), "</td>";			echo "<td class=\"data1\">", ($sequence->fields['is_cycled'] ? $lang['stryes'] : $lang['strno']), "</td>";			echo "<td class=\"data1\">", ($sequence->fields['is_called'] ? $lang['stryes'] : $lang['strno']), "</td>";			echo "</tr>";			echo "</table>";			echo "<ul class=\"navlink\">\n";			echo "\t<li><a href=\"sequences.php?action=confirm_alter&amp;{$misc->href}&amp;sequence=", urlencode($sequence->fields['seqname']), "\">{$lang['stralter']}</a></li>\n";			echo "\t<li><a href=\"sequences.php?action=confirm_setval&amp;{$misc->href}&amp;sequence=", urlencode($sequence->fields['seqname']), "\">{$lang['strsetval']}</a></li>\n";			echo "\t<li><a href=\"sequences.php?action=nextval&amp;{$misc->href}&amp;sequence=", urlencode($sequence->fields['seqname']), "\">{$lang['strnextval']}</a></li>\n";			if ($data->hasAlterSequenceStart()) {				echo "\t<li><a href=\"sequences.php?action=restart&amp;{$misc->href}&amp;sequence=", urlencode($sequence->fields['seqname']), "\">{$lang['strrestart']}</a></li>\n";			}			echo "\t<li><a href=\"sequences.php?action=reset&amp;{$misc->href}&amp;sequence=", urlencode($sequence->fields['seqname']), "\">{$lang['strreset']}</a></li>\n";			echo "\t<li><a href=\"sequences.php?{$misc->href}\">{$lang['strshowallsequences']}</a></li>\n</ul>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}	/**	 * Drop a sequence	 */	function doDrop($confirm, $msg = '') {		global $data, $misc;		global $lang;		if (empty($_REQUEST['sequence']) && empty($_REQUEST['ma'])) {			doDefault($lang['strspecifysequencetodrop']);			exit();		}				if ($confirm) {			$misc->printTrail('sequence');			$misc->printTitle($lang['strdrop'],'pg.sequence.drop');			$misc->printMsg($msg);						echo "<form action=\"sequences.php\" method=\"post\">\n";						//If multi drop			if (isset($_REQUEST['ma'])) {				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfdropsequence'], $misc->printVal($a['sequence'])), "</p>\n";					printf('<input type="hidden" name="sequence[]" value="%s" />', htmlspecialchars($a['sequence']));				}			} else {				echo "<p>", sprintf($lang['strconfdropsequence'], $misc->printVal($_REQUEST['sequence'])), "</p>\n";				echo "<input type=\"hidden\" name=\"sequence\" value=\"", htmlspecialchars($_REQUEST['sequence']), "\" />\n";			}			echo "<p><input type=\"checkbox\" id=\"cascade\" name=\"cascade\" /> <label for=\"cascade\">{$lang['strcascade']}</label></p>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"drop\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else {			if (is_array($_POST['sequence'])) {				$msg='';				$status = $data->beginTransaction();				if ($status == 0) {					foreach($_POST['sequence'] as $s) {						$status = $data->dropSequence($s, isset($_POST['cascade']));						if ($status == 0)							$msg.= sprintf('%s: %s<br />', htmlentities($s), $lang['strsequencedropped']);						else {							$data->endTransaction();							doDefault(sprintf('%s%s: %s<br />', $msg, htmlentities($s), $lang['strsequencedroppedbad']));							return;						}					}				}				if($data->endTransaction() == 0) {					// Everything went fine, back to the Default page....					$_reload_browser = true;					doDefault($msg);				}				else doDefault($lang['strsequencedroppedbad']);			}			else{				$status = $data->dropSequence($_POST['sequence'], isset($_POST['cascade']));				if ($status == 0) {					$_reload_browser = true;					doDefault($lang['strsequencedropped']);				}				else					doDrop(true, $lang['strsequencedroppedbad']);			}		}	}	/**	 * Displays a screen where they can enter a new sequence	 */	function doCreateSequence($msg = '') {		global $data, $misc;		global $lang;		if (!isset($_POST['formSequenceName'])) $_POST['formSequenceName'] = '';		if (!isset($_POST['formIncrement'])) $_POST['formIncrement'] = '';		if (!isset($_POST['formMinValue'])) $_POST['formMinValue'] = '';		if (!isset($_POST['formMaxValue'])) $_POST['formMaxValue'] = '';		if (!isset($_POST['formStartValue'])) $_POST['formStartValue'] = '';		if (!isset($_POST['formCacheValue'])) $_POST['formCacheValue'] = '';		$misc->printTrail('schema');		$misc->printTitle($lang['strcreatesequence'],'pg.sequence.create');		$misc->printMsg($msg);		echo "<form action=\"sequences.php\" method=\"post\">\n";		echo "<table>\n";		echo "<tr><th class=\"data left required\">{$lang['strname']}</th>\n";		echo "<td class=\"data1\"><input name=\"formSequenceName\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",			htmlspecialchars($_POST['formSequenceName']), "\" /></td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strincrementby']}</th>\n";		echo "<td class=\"data1\"><input name=\"formIncrement\" size=\"5\" value=\"",			htmlspecialchars($_POST['formIncrement']), "\" /> </td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strminvalue']}</th>\n";		echo "<td class=\"data1\"><input name=\"formMinValue\" size=\"5\" value=\"",			htmlspecialchars($_POST['formMinValue']), "\" /></td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strmaxvalue']}</th>\n";		echo "<td class=\"data1\"><input name=\"formMaxValue\" size=\"5\" value=\"",			htmlspecialchars($_POST['formMaxValue']), "\" /></td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strstartvalue']}</th>\n";		echo "<td class=\"data1\"><input name=\"formStartValue\" size=\"5\" value=\"",			htmlspecialchars($_POST['formStartValue']), "\" /></td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strcachevalue']}</th>\n";		echo "<td class=\"data1\"><input name=\"formCacheValue\" size=\"5\" value=\"",			htmlspecialchars($_POST['formCacheValue']), "\" /></td></tr>\n";		echo "<tr><th class=\"data left\"><label for=\"formCycledValue\">{$lang['strcancycle']}</label></th>\n";		echo "<td class=\"data1\"><input type=\"checkbox\" id=\"formCycledValue\" name=\"formCycledValue\" ",			(isset($_POST['formCycledValue']) ? ' checked="checked"' : ''), " /></td></tr>\n";		echo "</table>\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"save_create_sequence\" />\n";		echo $misc->form;		echo "<input type=\"submit\" name=\"create\" value=\"{$lang['strcreate']}\" />\n";		echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";		echo "</form>\n";	}	/**	 * Actually creates the new sequence in the database	 */	function doSaveCreateSequence() {		global $data;		global $lang;		// Check that they've given a name and at least one column		if ($_POST['formSequenceName'] == '') doCreateSequence($lang['strsequenceneedsname']);		else {			$status = $data->createSequence($_POST['formSequenceName'],				$_POST['formIncrement'], $_POST['formMinValue'],				$_POST['formMaxValue'], $_POST['formStartValue'],				$_POST['formCacheValue'], isset($_POST['formCycledValue']));			if ($status == 0) {				doDefault($lang['strsequencecreated']);			} else {				doCreateSequence($lang['strsequencecreatedbad']);			}		}	}	/**	 * Restarts a sequence	 */	function doRestart() {		global $data;		global $lang;		$status = $data->restartSequence($_REQUEST['sequence']);		if ($status == 0)			doProperties($lang['strsequencerestart']);		else			doProperties($lang['strsequencerestartbad']);	}	/**	 * Resets a sequence	 */	function doReset() {		global $data;		global $lang;		$status = $data->resetSequence($_REQUEST['sequence']);		if ($status == 0)			doProperties($lang['strsequencereset']);		else			doProperties($lang['strsequenceresetbad']);	}	/**	 * Set Nextval of a sequence	 */	function doNextval() {		global $data;		global $lang;		$status = $data->nextvalSequence($_REQUEST['sequence']);		if ($status == 0)			doProperties($lang['strsequencenextval']);		else			doProperties($lang['strsequencenextvalbad']);	}	/**	 * Function to save after 'setval'ing a sequence	 */	function doSaveSetval() {		global $data, $lang, $_reload_browser;		$status = $data->setvalSequence($_POST['sequence'], $_POST['nextvalue']);		if ($status == 0)			doProperties($lang['strsequencesetval']);		else			doProperties($lang['strsequencesetvalbad']);	}	/**	 * Function to allow 'setval'ing of a sequence	 */	function doSetval($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('sequence');		$misc->printTitle($lang['strsetval'], 'pg.sequence');		$misc->printMsg($msg);		// Fetch the sequence information		$sequence = $data->getSequence($_REQUEST['sequence']);		if (is_object($sequence) && $sequence->recordCount() > 0) {			echo "<form action=\"sequences.php\" method=\"post\">\n";			echo "<table border=\"0\">";			echo "<tr><th class=\"data left required\">{$lang['strlastvalue']}</th>\n";			echo "<td class=\"data1\">";			echo "<input name=\"nextvalue\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",				$misc->printVal($sequence->fields['last_value']), "\" /></td></tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"setval\" />\n";			echo "<input type=\"hidden\" name=\"sequence\" value=\"", htmlspecialchars($_REQUEST['sequence']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"setval\" value=\"{$lang['strsetval']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}	/**	 * Function to save after altering a sequence	 */	function doSaveAlter() {		global $data, $lang, $_reload_browser, $misc;		if (!isset($_POST['owner'])) $_POST['owner'] = null;		if (!isset($_POST['newschema'])) $_POST['newschema'] = null;		if (!isset($_POST['formIncrement'])) $_POST['formIncrement'] = null;		if (!isset($_POST['formMinValue'])) $_POST['formMinValue'] = null;		if (!isset($_POST['formMaxValue'])) $_POST['formMaxValue'] = null;		if (!isset($_POST['formStartValue'])) $_POST['formStartValue'] = null;		if (!isset($_POST['formRestartValue'])) $_POST['formRestartValue'] = null;		if (!isset($_POST['formCacheValue'])) $_POST['formCacheValue'] = null;		if (!isset($_POST['formCycledValue'])) $_POST['formCycledValue'] = null;		$status = $data->alterSequence($_POST['sequence'], $_POST['name'], $_POST['comment'], $_POST['owner'],			$_POST['newschema'], $_POST['formIncrement'], $_POST['formMinValue'], $_POST['formMaxValue'],			$_POST['formRestartValue'], $_POST['formCacheValue'], isset($_POST['formCycledValue']), $_POST['formStartValue']);		if ($status == 0) {			if ($_POST['sequence'] != $_POST['name']) {				// Jump them to the new view name				$_REQUEST['sequence'] = $_POST['name'];				// Force a browser reload				$_reload_browser = true;			}			if (!empty($_POST['newschema']) && ($_POST['newschema'] != $data->_schema)) {				// Jump them to the new sequence schema				$misc->setCurrentSchema($_POST['newschema']);				$_reload_browser = true;			 }			doProperties($lang['strsequencealtered']);		}		else			doProperties($lang['strsequencealteredbad']);	}	/**	 * Function to allow altering of a sequence	 */	function doAlter($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('sequence');		$misc->printTitle($lang['stralter'], 'pg.sequence.alter');		$misc->printMsg($msg);		// Fetch the sequence information		$sequence = $data->getSequence($_REQUEST['sequence']);		if (is_object($sequence) && $sequence->recordCount() > 0) {			if (!isset($_POST['name'])) $_POST['name'] = $_REQUEST['sequence'];			if (!isset($_POST['comment'])) $_POST['comment'] = $sequence->fields['seqcomment'];			if (!isset($_POST['owner'])) $_POST['owner'] = $sequence->fields['seqowner'];			if (!isset($_POST['newschema'])) $_POST['newschema'] = $sequence->fields['nspname'];			// Handle Checkbox Value			$sequence->fields['is_cycled'] = $data->phpBool($sequence->fields['is_cycled']);			if ($sequence->fields['is_cycled']) $_POST['formCycledValue'] = 'on';			echo "<form action=\"sequences.php\" method=\"post\">\n";			echo "<table>\n";			echo "<tr><th class=\"data left required\">{$lang['strname']}</th>\n";			echo "<td class=\"data1\">";			echo "<input name=\"name\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",				htmlspecialchars($_POST['name']), "\" /></td></tr>\n";			$server_info = $misc->getServerInfo();			if ($data->isSuperUser($server_info['username'])) {				// Fetch all users				$users = $data->getUsers();				echo "<tr><th class=\"data left required\">{$lang['strowner']}</th>\n";				echo "<td class=\"data1\"><select name=\"owner\">";				while (!$users->EOF) {					$uname = $users->fields['usename'];					echo "<option value=\"", htmlspecialchars($uname), "\"",					($uname == $_POST['owner']) ? ' selected="selected"' : '', ">", htmlspecialchars($uname), "</option>\n";					$users->moveNext();				}				echo "</select></td></tr>\n";			}						if ($data->hasAlterSequenceSchema()) {				$schemas = $data->getSchemas();				echo "<tr><th class=\"data left required\">{$lang['strschema']}</th>\n";				echo "<td class=\"data1\"><select name=\"newschema\">";				while (!$schemas->EOF) {					$schema = $schemas->fields['nspname'];					echo "<option value=\"", htmlspecialchars($schema), "\"",						($schema == $_POST['newschema']) ? ' selected="selected"' : '', ">", htmlspecialchars($schema), "</option>\n";					$schemas->moveNext();				}			    echo "</select></td></tr>\n";			}			echo "<tr><th class=\"data left\">{$lang['strcomment']}</th>\n";			echo "<td class=\"data1\">";			echo "<textarea rows=\"3\" cols=\"32\" name=\"comment\">",				htmlspecialchars($_POST['comment']), "</textarea></td></tr>\n";			if ($data->hasAlterSequenceStart()) {				echo "<tr><th class=\"data left\">{$lang['strstartvalue']}</th>\n";				echo "<td class=\"data1\"><input name=\"formStartValue\" size=\"5\" value=\"",					htmlspecialchars($sequence->fields['start_value']), "\" /></td></tr>\n";			}			echo "<tr><th class=\"data left\">{$lang['strrestartvalue']}</th>\n";			echo "<td class=\"data1\"><input name=\"formRestartValue\" size=\"5\" value=\"",				htmlspecialchars($sequence->fields['last_value']), "\" /></td></tr>\n";			echo "<tr><th class=\"data left\">{$lang['strincrementby']}</th>\n";			echo "<td class=\"data1\"><input name=\"formIncrement\" size=\"5\" value=\"",				htmlspecialchars($sequence->fields['increment_by']), "\" /> </td></tr>\n";			echo "<tr><th class=\"data left\">{$lang['strmaxvalue']}</th>\n";			echo "<td class=\"data1\"><input name=\"formMaxValue\" size=\"5\" value=\"",				htmlspecialchars($sequence->fields['max_value']), "\" /></td></tr>\n";			echo "<tr><th class=\"data left\">{$lang['strminvalue']}</th>\n";			echo "<td class=\"data1\"><input name=\"formMinValue\" size=\"5\" value=\"",				htmlspecialchars($sequence->fields['min_value']), "\" /></td></tr>\n";			echo "<tr><th class=\"data left\">{$lang['strcachevalue']}</th>\n";			echo "<td class=\"data1\"><input name=\"formCacheValue\" size=\"5\" value=\"",				htmlspecialchars($sequence->fields['cache_value']), "\" /></td></tr>\n";			echo "<tr><th class=\"data left\"><label for=\"formCycledValue\">{$lang['strcancycle']}</label></th>\n";			echo "<td class=\"data1\"><input type=\"checkbox\" id=\"formCycledValue\" name=\"formCycledValue\" ",				( isset($_POST['formCycledValue']) ? ' checked="checked"' : ''), " /></td></tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"alter\" />\n";			echo $misc->form;			echo "<input type=\"hidden\" name=\"sequence\" value=\"", htmlspecialchars($_REQUEST['sequence']), "\" />\n";			echo "<input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}	if ($action == 'tree') doTree();	// Print header	$misc->printHeader($lang['strsequences']);	$misc->printBody();	switch($action) {		case 'create':			doCreateSequence();			break;		case 'save_create_sequence':			if (isset($_POST['create'])) doSaveCreateSequence();			else doDefault();			break;		case 'properties':			doProperties();			break;		case 'drop':			if (isset($_POST['drop'])) doDrop(false);			else doDefault();			break;		case 'confirm_drop':			doDrop(true);			break;		case 'restart':			doRestart();			break;		case 'reset':			doReset();			break;		case 'nextval':			doNextval();			break;		case 'setval':			if (isset($_POST['setval'])) doSaveSetval();			else doDefault();			break;		case 'confirm_setval':			doSetval();			break;		case 'alter':			if (isset($_POST['alter'])) doSaveAlter();			else doDefault();			break;		case 'confirm_alter':			doAlter();			break;		default:			doDefault();			break;	}	// Print footer	$misc->printFooter();?>
<?php/** * PostgreSQL 8.0 support * * $Id: Postgres80.php,v 1.28 2007/12/12 04:11:10 xzilla Exp $ */include_once('./classes/database/Postgres81.php');class Postgres80 extends Postgres81 {	var $major_version = 8.0;	// Map of database encoding names to HTTP encoding names.  If a	// database encoding does not appear in this list, then its HTTP	// encoding name is the same as its database encoding name.	var $codemap = array(		'ALT' => 'CP866',		'EUC_CN' => 'GB2312',		'EUC_JP' => 'EUC-JP',		'EUC_KR' => 'EUC-KR',		'EUC_TW' => 'EUC-TW',		'ISO_8859_5' => 'ISO-8859-5',		'ISO_8859_6' => 'ISO-8859-6',		'ISO_8859_7' => 'ISO-8859-7',		'ISO_8859_8' => 'ISO-8859-8',		'JOHAB' => 'CP1361',		'KOI8' => 'KOI8-R',		'LATIN1' => 'ISO-8859-1',		'LATIN2' => 'ISO-8859-2',		'LATIN3' => 'ISO-8859-3',		'LATIN4' => 'ISO-8859-4',		// The following encoding map is a known error in PostgreSQL < 7.2		// See the constructor for Postgres72.		'LATIN5' => 'ISO-8859-5',		'LATIN6' => 'ISO-8859-10',		'LATIN7' => 'ISO-8859-13',		'LATIN8' => 'ISO-8859-14',		'LATIN9' => 'ISO-8859-15',		'LATIN10' => 'ISO-8859-16',		'SQL_ASCII' => 'US-ASCII',		'TCVN' => 'CP1258',		'UNICODE' => 'UTF-8',		'WIN' => 'CP1251',		'WIN874' => 'CP874',		'WIN1256' => 'CP1256'	);	/**	 * Constructor	 * @param $conn The database connection	 */	function Postgres80($conn) {		$this->Postgres81($conn);	}	// Help functions	function getHelpPages() {		include_once('./help/PostgresDoc80.php');		return $this->help_page;	}	// Database functions	/**	 * Return all database available on the server	 * @return A list of databases, sorted alphabetically	 */	function getDatabases($currentdatabase = NULL) {		global $conf, $misc;		$server_info = $misc->getServerInfo();		if (isset($conf['owned_only']) && $conf['owned_only'] && !$this->isSuperUser($server_info['username'])) {			$username = $server_info['username'];			$this->clean($username);			$clause = " AND pu.usename='{$username}'";		}		else $clause = '';		if ($currentdatabase != NULL) {			$this->clean($currentdatabase);			$orderby = "ORDER BY pdb.datname = '{$currentdatabase}' DESC, pdb.datname";		}		else			$orderby = "ORDER BY pdb.datname";		if (!$conf['show_system'])			$where = ' AND NOT pdb.datistemplate';		else			$where = ' AND pdb.datallowconn';		$sql = "SELECT pdb.datname AS datname, pu.usename AS datowner, pg_encoding_to_char(encoding) AS datencoding,                               (SELECT description FROM pg_description pd WHERE pdb.oid=pd.objoid) AS datcomment,                               (SELECT spcname FROM pg_catalog.pg_tablespace pt WHERE pt.oid=pdb.dattablespace) AS tablespace                        FROM pg_database pdb, pg_user pu			WHERE pdb.datdba = pu.usesysid			{$where}			{$clause}			{$orderby}";		return $this->selectSet($sql);	}	// Schema functions	/**	 * Return all schemas in the current database.	 * @return All schemas, sorted alphabetically	 */	function getSchemas() {		global $conf, $slony;		if (!$conf['show_system']) {			$where = "WHERE nspname NOT LIKE 'pg@_%' ESCAPE '@' AND nspname != 'information_schema'";			if (isset($slony) && $slony->isEnabled()) {				$temp = $slony->slony_schema;				$this->clean($temp);				$where .= " AND nspname != '{$temp}'";			}		}		else $where = "WHERE nspname !~ '^pg_t(emp_[0-9]+|oast)$'";		$sql = "			SELECT pn.nspname, pu.usename AS nspowner,				pg_catalog.obj_description(pn.oid, 'pg_namespace') AS nspcomment			FROM pg_catalog.pg_namespace pn				LEFT JOIN pg_catalog.pg_user pu ON (pn.nspowner = pu.usesysid)			{$where}			ORDER BY nspname";		return $this->selectSet($sql);	}	/**	 * Return all information relating to a schema	 * @param $schema The name of the schema	 * @return Schema information	 */	function getSchemaByName($schema) {		$this->clean($schema);		$sql = "			SELECT nspname, nspowner, u.usename AS ownername, nspacl,				pg_catalog.obj_description(pn.oid, 'pg_namespace') as nspcomment            FROM pg_catalog.pg_namespace pn            	LEFT JOIN pg_shadow as u ON pn.nspowner = u.usesysid			WHERE nspname='{$schema}'";		return $this->selectSet($sql);	}	// Table functions	/**	 * Protected method which alter a table	 * SHOULDN'T BE CALLED OUTSIDE OF A TRANSACTION	 * @param $tblrs The table recordSet returned by getTable()	 * @param $name The new name for the table	 * @param $owner The new owner for the table	 * @param $schema The new schema for the table	 * @param $comment The comment on the table	 * @param $tablespace The new tablespace for the table ('' means leave as is)	 * @return 0 success	 * @return -3 rename error	 * @return -4 comment error	 * @return -5 owner error	 * @return -6 tablespace error	 */	protected	function _alterTable($tblrs, $name, $owner, $schema, $comment, $tablespace) {		/* $schema not supported in pg80- */		// Comment		$status = $this->setComment('TABLE', '', $tblrs->fields['relname'], $comment);		if ($status != 0) return -4;		// Owner		$this->fieldClean($owner);		$status = $this->alterTableOwner($tblrs, $owner);		if ($status != 0) return -5;		// Tablespace		$this->fieldClean($tablespace);		$status = $this->alterTableTablespace($tblrs, $tablespace);			if ($status != 0) return -6;		// Rename		$this->fieldClean($name);		$status = $this->alterTableName($tblrs, $name);		if ($status != 0) return -3;		return 0;	}	// Constraint functions	/**	 * Returns a list of all constraints on a table,	 * including constraint name, definition, related col and referenced namespace,	 * table and col if needed	 * @param $table the table where we are looking for fk	 * @return a recordset	 */	function getConstraintsWithFields($table) {		$c_schema = $this->_schema;		$this->clean($c_schema);		$this->clean($table);		// get the max number of col used in a constraint for the table		$sql = "SELECT DISTINCT			max(SUBSTRING(array_dims(c.conkey) FROM '^\\\[.*:(.*)\\\]$')) as nb		FROM pg_catalog.pg_constraint AS c			JOIN pg_catalog.pg_class AS r ON (c.conrelid=r.oid)		    JOIN pg_catalog.pg_namespace AS ns ON (r.relnamespace=ns.oid)		WHERE			r.relname = '{$table}' AND ns.nspname='{$c_schema}'";		$rs = $this->selectSet($sql);		if ($rs->EOF) $max_col = 0;		else $max_col = $rs->fields['nb'];		$sql = '			SELECT				c.oid AS conid, c.contype, c.conname, pg_catalog.pg_get_constraintdef(c.oid, true) AS consrc,				ns1.nspname as p_schema, r1.relname as p_table, ns2.nspname as f_schema,				r2.relname as f_table, f1.attname as p_field, f1.attnum AS p_attnum, f2.attname as f_field,				f2.attnum AS f_attnum, pg_catalog.obj_description(c.oid, \'pg_constraint\') AS constcomment,				c.conrelid, c.confrelid			FROM				pg_catalog.pg_constraint AS c				JOIN pg_catalog.pg_class AS r1 ON (c.conrelid=r1.oid)				JOIN pg_catalog.pg_attribute AS f1 ON (f1.attrelid=r1.oid AND (f1.attnum=c.conkey[1]';		for ($i = 2; $i <= $rs->fields['nb']; $i++) {			$sql.= " OR f1.attnum=c.conkey[$i]";		}		$sql.= '))				JOIN pg_catalog.pg_namespace AS ns1 ON r1.relnamespace=ns1.oid				LEFT JOIN (					pg_catalog.pg_class AS r2 JOIN pg_catalog.pg_namespace AS ns2 ON (r2.relnamespace=ns2.oid)				) ON (c.confrelid=r2.oid)				LEFT JOIN pg_catalog.pg_attribute AS f2 ON					(f2.attrelid=r2.oid AND ((c.confkey[1]=f2.attnum AND c.conkey[1]=f1.attnum)';		for ($i = 2; $i <= $rs->fields['nb']; $i++)			$sql.= "OR (c.confkey[$i]=f2.attnum AND c.conkey[$i]=f1.attnum)";		$sql .= sprintf("))			WHERE				r1.relname = '%s' AND ns1.nspname='%s'			ORDER BY 1", $table, $c_schema);		return $this->selectSet($sql);	}	// View functions	/**	 * Protected method which alter a view	 * SHOULDN'T BE CALLED OUTSIDE OF A TRANSACTION	 * @param $vwrs The view recordSet returned by getView()	 * @param $name The new name for the view	 * @param $owner The new owner for the view	 * @param $comment The comment on the view	 * @return 0 success	 * @return -3 rename error	 * @return -4 comment error	 * @return -5 owner error	 */	protected    function _alterView($vwrs, $name, $owner, $schema, $comment) {    	/* $schema not supported in pg80- */    	$this->fieldArrayClean($vwrs->fields);		// Comment		if ($this->setComment('VIEW', $vwrs->fields['relname'], '', $comment) != 0)			return -4;		// Owner		$this->fieldClean($owner);		$status = $this->alterViewOwner($vwrs, $owner);		if ($status != 0) return -5;		// Rename		$this->fieldClean($name);		$status = $this->alterViewName($vwrs, $name);		if ($status != 0) return -3;		return 0;	}	// Sequence functions	/**	 * Protected method which alter a sequence	 * SHOULDN'T BE CALLED OUTSIDE OF A TRANSACTION	 * @param $seqrs The sequence recordSet returned by getSequence()	 * @param $name The new name for the sequence	 * @param $comment The comment on the sequence	 * @param $owner The new owner for the sequence	 * @param $schema The new schema for the sequence	 * @param $increment The increment	 * @param $minvalue The min value	 * @param $maxvalue The max value	 * @param $restartvalue The starting value	 * @param $cachevalue The cache value	 * @param $cycledvalue True if cycled, false otherwise	 * @param $startvalue The sequence start value when issueing a restart	 * @return 0 success	 * @return -3 rename error	 * @return -4 comment error	 * @return -5 owner error	 * @return -6 get sequence props error	 * @return -7 schema error	 */	protected	function _alterSequence($seqrs, $name, $comment, $owner, $schema, $increment,	$minvalue, $maxvalue, $restartvalue, $cachevalue, $cycledvalue, $startvalue) {		/* $schema not supported in pg80- */		$this->fieldArrayClean($seqrs->fields);		// Comment		$status = $this->setComment('SEQUENCE', $seqrs->fields['seqname'], '', $comment);		if ($status != 0)			return -4;		// Owner		$this->fieldClean($owner);		$status = $this->alterSequenceOwner($seqrs, $owner);		if ($status != 0)			return -5;		// Props		$this->clean($increment);		$this->clean($minvalue);		$this->clean($maxvalue);		$this->clean($restartvalue);		$this->clean($cachevalue);		$this->clean($cycledvalue);		$this->clean($startvalue);		$status = $this->alterSequenceProps($seqrs, $increment,	$minvalue,			$maxvalue, $restartvalue, $cachevalue, $cycledvalue, null);		if ($status != 0)			return -6;		// Rename		$this->fieldClean($name);		$status = $this->alterSequenceName($seqrs, $name);		if ($status != 0)			return -3;		return 0;	}	// Role, User/group functions	/**	 * Changes a user's password	 * @param $username The username	 * @param $password The new password	 * @return 0 success	 */	function changePassword($username, $password) {		$enc = $this->_encryptPassword($username, $password);		$this->fieldClean($username);		$this->clean($enc);		$sql = "ALTER USER \"{$username}\" WITH ENCRYPTED PASSWORD '{$enc}'";		return $this->execute($sql);	}	// Aggregate functions	/**	 * Gets all information for an aggregate	 * @param $name The name of the aggregate	 * @param $basetype The input data type of the aggregate	 * @return A recordset	 */	function getAggregate($name, $basetype) {		$c_schema = $this->_schema;		$this->clean($c_schema);		$this->clean($name);		$this->clean($basetype);		$sql = "			SELECT p.proname,				CASE p.proargtypes[0]					WHEN 'pg_catalog.\"any\"'::pg_catalog.regtype THEN NULL					ELSE pg_catalog.format_type(p.proargtypes[0], NULL)				END AS proargtypes, a.aggtransfn, format_type(a.aggtranstype, NULL) AS aggstype,				a.aggfinalfn, a.agginitval, u.usename, pg_catalog.obj_description(p.oid, 'pg_proc') AS aggrcomment			FROM pg_catalog.pg_proc p, pg_catalog.pg_namespace n, pg_catalog.pg_user u, pg_catalog.pg_aggregate a			WHERE n.oid = p.pronamespace AND p.proowner=u.usesysid AND p.oid=a.aggfnoid				AND p.proisagg AND n.nspname='{$c_schema}'				AND p.proname='{$name}'				AND CASE p.proargtypes[0]					WHEN 'pg_catalog.\"any\"'::pg_catalog.regtype THEN ''					ELSE pg_catalog.format_type(p.proargtypes[0], NULL)				END ='{$basetype}'";		return $this->selectSet($sql);	}	// Capabilities	function hasAggregateSortOp() { return false; }	function hasAlterTableSchema() { return false; }	function hasAutovacuum() { return false; }	function hasDisableTriggers() { return false; }	function hasFunctionAlterSchema() { return false; }	function hasPreparedXacts() { return false; }	function hasRoles() { return false; }	function hasAlterSequenceSchema() { return false; }	function hasServerAdminFuncs() { return false; }}?>
<?php/** * PostgreSQL 8.1 support * * $Id: Postgres81.php,v 1.21 2008/01/19 13:46:15 ioguix Exp $ */include_once('./classes/database/Postgres82.php');class Postgres81 extends Postgres82 {	var $major_version = 8.1;	// List of all legal privileges that can be applied to different types	// of objects.	var $privlist = array(		'table' => array('SELECT', 'INSERT', 'UPDATE', 'DELETE', 'RULE', 'REFERENCES', 'TRIGGER', 'ALL PRIVILEGES'),		'view' => array('SELECT', 'INSERT', 'UPDATE', 'DELETE', 'RULE', 'REFERENCES', 'TRIGGER', 'ALL PRIVILEGES'),		'sequence' => array('SELECT', 'UPDATE', 'ALL PRIVILEGES'),		'database' => array('CREATE', 'TEMPORARY', 'ALL PRIVILEGES'),		'function' => array('EXECUTE', 'ALL PRIVILEGES'),		'language' => array('USAGE', 'ALL PRIVILEGES'),		'schema' => array('CREATE', 'USAGE', 'ALL PRIVILEGES'),		'tablespace' => array('CREATE', 'ALL PRIVILEGES')	);	// List of characters in acl lists and the privileges they	// refer to.	var $privmap = array(		'r' => 'SELECT',		'w' => 'UPDATE',		'a' => 'INSERT',		'd' => 'DELETE',		'R' => 'RULE',		'x' => 'REFERENCES',		't' => 'TRIGGER',		'X' => 'EXECUTE',		'U' => 'USAGE',		'C' => 'CREATE',		'T' => 'TEMPORARY'	);	// Array of allowed index types	var $typIndexes = array('BTREE', 'RTREE', 'GIST', 'HASH');	/**	 * Constructor	 * @param $conn The database connection	 */	function Postgres81($conn) {		$this->Postgres82($conn);	}	// Help functions		function getHelpPages() {		include_once('./help/PostgresDoc81.php');		return $this->help_page;	}	// Database functions	/**	 * Returns all databases available on the server	 * @return A list of databases, sorted alphabetically	 */	function getDatabases($currentdatabase = NULL) {		global $conf, $misc;				$server_info = $misc->getServerInfo();				if (isset($conf['owned_only']) && $conf['owned_only'] && !$this->isSuperUser($server_info['username'])) {			$username = $server_info['username'];			$this->clean($username);			$clause = " AND pr.rolname='{$username}'";		}		else $clause = '';		if ($currentdatabase != NULL) {			$this->clean($currentdatabase);			$orderby = "ORDER BY pdb.datname = '{$currentdatabase}' DESC, pdb.datname";		}		else			$orderby = "ORDER BY pdb.datname";		if (!$conf['show_system'])			$where = ' AND NOT pdb.datistemplate';		else			$where = ' AND pdb.datallowconn';		$sql = "SELECT pdb.datname AS datname, pr.rolname AS datowner, pg_encoding_to_char(encoding) AS datencoding,                               (SELECT description FROM pg_catalog.pg_description pd WHERE pdb.oid=pd.objoid) AS datcomment,                               (SELECT spcname FROM pg_catalog.pg_tablespace pt WHERE pt.oid=pdb.dattablespace) AS tablespace,							   pg_catalog.pg_database_size(pdb.oid) as dbsize                         FROM pg_catalog.pg_database pdb LEFT JOIN pg_catalog.pg_roles pr ON (pdb.datdba = pr.oid)  						WHERE true 			{$where}			{$clause}			{$orderby}";		return $this->selectSet($sql);	}	/**	 * Alters a database	 * the multiple return vals are for postgres 8+ which support more functionality in alter database	 * @param $dbName The name of the database	 * @param $newName new name for the database	 * @param $newOwner The new owner for the database	 * @return 0 success	 * @return -1 transaction error	 * @return -2 owner error	 * @return -3 rename error	 */	function alterDatabase($dbName, $newName, $newOwner = '', $comment = '') {		$this->clean($dbName);		$this->clean($newName);		$this->clean($newOwner);		//ignore $comment, not supported pre 8.2					$status = $this->beginTransaction();		if ($status != 0) {			$this->rollbackTransaction();			return -1;		}		if ($dbName != $newName) {			$status = $this->alterDatabaseRename($dbName, $newName);			if ($status != 0) {				$this->rollbackTransaction();				return -3;			}		}		$status = $this->alterDatabaseOwner($newName, $newOwner);		if ($status != 0) {			$this->rollbackTransaction();			return -2;		}		return $this->endTransaction();	}	// Tablespace functions		/**	 * Retrieves a tablespace's information	 * @return A recordset	 */	function getTablespace($spcname) {		$this->clean($spcname);		$sql = "SELECT spcname, pg_catalog.pg_get_userbyid(spcowner) AS spcowner, spclocation					FROM pg_catalog.pg_tablespace WHERE spcname='{$spcname}'";		return $this->selectSet($sql);	}		/**	 * Retrieves information for all tablespaces	 * @param $all Include all tablespaces (necessary when moving objects back to the default space)	 * @return A recordset	 */	function getTablespaces($all = false) {		global $conf;				$sql = "SELECT spcname, pg_catalog.pg_get_userbyid(spcowner) AS spcowner, spclocation					FROM pg_catalog.pg_tablespace";		if (!$conf['show_system'] && !$all) {			$sql .= " WHERE spcname NOT LIKE 'pg\\\\_%'";	}			$sql .= " ORDER BY spcname";		return $this->selectSet($sql);	}	// Capabilities	function hasCreateTableLikeWithConstraints() {return false;}	function hasSharedComments() {return false;}	function hasConcurrentIndexBuild() {return false;}}?>
<?php	/**	 * Manage types in a database	 *	 * $Id: types.php,v 1.42 2007/11/30 15:25:23 soranzo Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');		$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	if (!isset($msg)) $msg = '';	/**	 * Show read only properties for a type	 */	function doProperties($msg = '') {		global $data, $misc;		global $lang;		// Get type (using base name)		$typedata = $data->getType($_REQUEST['type']);		$misc->printTrail('type');		$misc->printTitle($lang['strproperties'], 'pg.type');		$misc->printMsg($msg);				function attPre(&$rowdata) {			global $data;			$rowdata->fields['+type'] = $data->formatType($rowdata->fields['type'], $rowdata->fields['atttypmod']);		}				if ($typedata->recordCount() > 0) {			$vals = false;			switch ($typedata->fields['typtype']) {			case 'c':				$attrs = $data->getTableAttributes($_REQUEST['type']);								$columns = array(					'field' => array(						'title' => $lang['strfield'],						'field' => field('attname'),					),					'type' => array(						'title' => $lang['strtype'],						'field' => field('+type'),					),					'comment' => array(						'title' => $lang['strcomment'],						'field' => field('comment'),					)				);								$actions = array();								$misc->printTable($attrs, $columns, $actions, null, 'attPre');								break;			case 'e':				$vals = $data->getEnumValues($typedata->fields['typname']);			default:				$byval = $data->phpBool($typedata->fields['typbyval']);				echo "<table>\n";				echo "<tr><th class=\"data left\">{$lang['strname']}</th>\n";				echo "<td class=\"data1\">", $misc->printVal($typedata->fields['typname']), "</td></tr>\n";				echo "<tr><th class=\"data left\">{$lang['strinputfn']}</th>\n";				echo "<td class=\"data1\">", $misc->printVal($typedata->fields['typin']), "</td></tr>\n";				echo "<tr><th class=\"data left\">{$lang['stroutputfn']}</th>\n";				echo "<td class=\"data1\">", $misc->printVal($typedata->fields['typout']), "</td></tr>\n";				echo "<tr><th class=\"data left\">{$lang['strlength']}</th>\n";				echo "<td class=\"data1\">", $misc->printVal($typedata->fields['typlen']), "</td></tr>\n";				echo "<tr><th class=\"data left\">{$lang['strpassbyval']}</th>\n";				echo "<td class=\"data1\">", ($byval) ? $lang['stryes'] : $lang['strno'], "</td></tr>\n";				echo "<tr><th class=\"data left\">{$lang['stralignment']}</th>\n";				echo "<td class=\"data1\">", $misc->printVal($typedata->fields['typalign']), "</td></tr>\n";				if ($data->hasEnumTypes() && $vals) {					$vals = $vals->getArray();					$nbVals = count($vals);					echo "<tr>\n\t<th class=\"data left\" rowspan=\"$nbVals\">{$lang['strenumvalues']}</th>\n";					echo "<td class=\"data2\">{$vals[0]['enumval']}</td></tr>\n";					for ($i=1; $i < $nbVals; $i++)						echo "<td class=\"data", 2-($i%2), "\">{$vals[$i]['enumval']}</td></tr>\n";				}				echo "</table>\n";			}			echo "<p><a class=\"navlink\" href=\"types.php?{$misc->href}\">{$lang['strshowalltypes']}</a></p>\n";		} else			doDefault($lang['strinvalidparam']);	}		/**	 * Show confirmation of drop and perform actual drop	 */	function doDrop($confirm) {		global $data, $misc;		global $lang;		if ($confirm) {			$misc->printTrail('type');			$misc->printTitle($lang['strdrop'], 'pg.type.drop');			echo "<p>", sprintf($lang['strconfdroptype'], $misc->printVal($_REQUEST['type'])), "</p>\n";			echo "<form action=\"types.php\" method=\"post\">\n";			echo "<p><input type=\"checkbox\" id=\"cascade\" name=\"cascade\" /> <label for=\"cascade\">{$lang['strcascade']}</label></p>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"drop\" />\n";			echo "<input type=\"hidden\" name=\"type\" value=\"", htmlspecialchars($_REQUEST['type']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else {			$status = $data->dropType($_POST['type'], isset($_POST['cascade']));			if ($status == 0)				doDefault($lang['strtypedropped']);			else				doDefault($lang['strtypedroppedbad']);		}			}	/**	 * Displays a screen where they can enter a new composite type	 */	function doCreateComposite($msg = '') {		global $data, $misc;		global $lang;		if (!isset($_REQUEST['stage'])) $_REQUEST['stage'] = 1;		if (!isset($_REQUEST['name'])) $_REQUEST['name'] = '';		if (!isset($_REQUEST['fields'])) $_REQUEST['fields'] = '';		if (!isset($_REQUEST['typcomment'])) $_REQUEST['typcomment'] = '';		switch ($_REQUEST['stage']) {			case 1:				$misc->printTrail('type');				$misc->printTitle($lang['strcreatecomptype'], 'pg.type.create');				$misc->printMsg($msg);								echo "<form action=\"types.php\" method=\"post\">\n";				echo "<table>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strname']}</th>\n";				echo "\t\t<td class=\"data\"><input name=\"name\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"", 					htmlspecialchars($_REQUEST['name']), "\" /></td>\n\t</tr>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strnumfields']}</th>\n";				echo "\t\t<td class=\"data\"><input name=\"fields\" size=\"5\" maxlength=\"{$data->_maxNameLen}\" value=\"", 					htmlspecialchars($_REQUEST['fields']), "\" /></td>\n\t</tr>\n";				echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strcomment']}</th>\n";				echo "\t\t<td><textarea name=\"typcomment\" rows=\"3\" cols=\"32\">", 					htmlspecialchars($_REQUEST['typcomment']), "</textarea></td>\n\t</tr>\n";				echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"create_comp\" />\n";				echo "<input type=\"hidden\" name=\"stage\" value=\"2\" />\n";				echo $misc->form;				echo "<input type=\"submit\" value=\"{$lang['strnext']}\" />\n";				echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";				break;			case 2:				global $lang;				// Check inputs				$fields = trim($_REQUEST['fields']);				if (trim($_REQUEST['name']) == '') {					$_REQUEST['stage'] = 1;					doCreateComposite($lang['strtypeneedsname']);					return;				}				elseif ($fields == '' || !is_numeric($fields) || $fields != (int)$fields || $fields < 1)  {					$_REQUEST['stage'] = 1;					doCreateComposite($lang['strtypeneedscols']);					return;				}				$types = $data->getTypes(true, false, true);				$misc->printTrail('schema');				$misc->printTitle($lang['strcreatecomptype'], 'pg.type.create');				$misc->printMsg($msg);				echo "<form action=\"types.php\" method=\"post\">\n";				// Output table header				echo "<table>\n";				echo "\t<tr><th colspan=\"2\" class=\"data required\">{$lang['strfield']}</th><th colspan=\"2\" class=\"data required\">{$lang['strtype']}</th>";				echo"<th class=\"data\">{$lang['strlength']}</th><th class=\"data\">{$lang['strcomment']}</th></tr>\n";								for ($i = 0; $i < $_REQUEST['fields']; $i++) {					if (!isset($_REQUEST['field'][$i])) $_REQUEST['field'][$i] = '';					if (!isset($_REQUEST['length'][$i])) $_REQUEST['length'][$i] = '';					if (!isset($_REQUEST['colcomment'][$i])) $_REQUEST['colcomment'][$i] = '';					echo "\t<tr>\n\t\t<td>", $i + 1, ".&nbsp;</td>\n";					echo "\t\t<td><input name=\"field[{$i}]\" size=\"16\" maxlength=\"{$data->_maxNameLen}\" value=\"",						htmlspecialchars($_REQUEST['field'][$i]), "\" /></td>\n";					echo "\t\t<td>\n\t\t\t<select name=\"type[{$i}]\">\n";					$types->moveFirst();					while (!$types->EOF) {						$typname = $types->fields['typname'];						echo "\t\t\t\t<option value=\"", htmlspecialchars($typname), "\"",						(isset($_REQUEST['type'][$i]) && $typname == $_REQUEST['type'][$i]) ? ' selected="selected"' : '', ">",							$misc->printVal($typname), "</option>\n";						$types->moveNext();					}					echo "\t\t\t</select>\n\t\t</td>\n";										// Output array type selector					echo "\t\t<td>\n\t\t\t<select name=\"array[{$i}]\">\n";					echo "\t\t\t\t<option value=\"\"", (isset($_REQUEST['array'][$i]) && $_REQUEST['array'][$i] == '') ? ' selected="selected"' : '', "></option>\n";					echo "\t\t\t\t<option value=\"[]\"", (isset($_REQUEST['array'][$i]) && $_REQUEST['array'][$i] == '[]') ? ' selected="selected"' : '', ">[ ]</option>\n";					echo "\t\t\t</select>\n\t\t</td>\n";										echo "\t\t<td><input name=\"length[{$i}]\" size=\"10\" value=\"", 						htmlspecialchars($_REQUEST['length'][$i]), "\" /></td>\n";					echo "\t\t<td><input name=\"colcomment[{$i}]\" size=\"40\" value=\"", 						htmlspecialchars($_REQUEST['colcomment'][$i]), "\" /></td>\n\t</tr>\n";				}					echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"create_comp\" />\n";				echo "<input type=\"hidden\" name=\"stage\" value=\"3\" />\n";				echo $misc->form;				echo "<input type=\"hidden\" name=\"name\" value=\"", htmlspecialchars($_REQUEST['name']), "\" />\n";				echo "<input type=\"hidden\" name=\"fields\" value=\"", htmlspecialchars($_REQUEST['fields']), "\" />\n";				echo "<input type=\"hidden\" name=\"typcomment\" value=\"", htmlspecialchars($_REQUEST['typcomment']), "\" />\n";				echo "<input type=\"submit\" value=\"{$lang['strcreate']}\" />\n";				echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";												break;			case 3:				global $data, $lang;				// Check inputs				$fields = trim($_REQUEST['fields']);				if (trim($_REQUEST['name']) == '') {					$_REQUEST['stage'] = 1;					doCreateComposite($lang['strtypeneedsname']);					return;				}				elseif ($fields == '' || !is_numeric($fields) || $fields != (int)$fields || $fields <= 0)  {					$_REQUEST['stage'] = 1;					doCreateComposite($lang['strtypeneedscols']);						return;				}								$status = $data->createCompositeType($_REQUEST['name'], $_REQUEST['fields'], $_REQUEST['field'],								$_REQUEST['type'], $_REQUEST['array'], $_REQUEST['length'], $_REQUEST['colcomment'], 								$_REQUEST['typcomment']);				if ($status == 0)					doDefault($lang['strtypecreated']);				elseif ($status == -1) {					$_REQUEST['stage'] = 2;					doCreateComposite($lang['strtypeneedsfield']);					return;				}				else {					$_REQUEST['stage'] = 2;					doCreateComposite($lang['strtypecreatedbad']);					return;				}				break;			default:				echo "<p>{$lang['strinvalidparam']}</p>\n";		}	}	/**	 * Displays a screen where they can enter a new enum type	 */	function doCreateEnum($msg = '') {		global $data, $misc;		global $lang;		if (!isset($_REQUEST['stage'])) $_REQUEST['stage'] = 1;		if (!isset($_REQUEST['name'])) $_REQUEST['name'] = '';		if (!isset($_REQUEST['values'])) $_REQUEST['values'] = '';		if (!isset($_REQUEST['typcomment'])) $_REQUEST['typcomment'] = '';		switch ($_REQUEST['stage']) {			case 1:				$misc->printTrail('type');				$misc->printTitle($lang['strcreateenumtype'], 'pg.type.create');				$misc->printMsg($msg);								echo "<form action=\"types.php\" method=\"post\">\n";				echo "<table>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strname']}</th>\n";				echo "\t\t<td class=\"data\"><input name=\"name\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"", 					htmlspecialchars($_REQUEST['name']), "\" /></td>\n\t</tr>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strnumvalues']}</th>\n";				echo "\t\t<td class=\"data\"><input name=\"values\" size=\"5\" maxlength=\"{$data->_maxNameLen}\" value=\"", 					htmlspecialchars($_REQUEST['values']), "\" /></td>\n\t</tr>\n";				echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strcomment']}</th>\n";				echo "\t\t<td><textarea name=\"typcomment\" rows=\"3\" cols=\"32\">", 					htmlspecialchars($_REQUEST['typcomment']), "</textarea></td>\n\t</tr>\n";				echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"create_enum\" />\n";				echo "<input type=\"hidden\" name=\"stage\" value=\"2\" />\n";				echo $misc->form;				echo "<input type=\"submit\" value=\"{$lang['strnext']}\" />\n";				echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";				break;			case 2:				global $lang;				// Check inputs				$values = trim($_REQUEST['values']);				if (trim($_REQUEST['name']) == '') {					$_REQUEST['stage'] = 1;					doCreateEnum($lang['strtypeneedsname']);					return;				}				elseif ($values == '' || !is_numeric($values) || $values != (int)$values || $values < 1)  {					$_REQUEST['stage'] = 1;					doCreateEnum($lang['strtypeneedsvals']);					return;				}				$misc->printTrail('schema');				$misc->printTitle($lang['strcreateenumtype'], 'pg.type.create');				$misc->printMsg($msg);				echo "<form action=\"types.php\" method=\"post\">\n";				// Output table header				echo "<table>\n";				echo "\t<tr><th colspan=\"2\" class=\"data required\">{$lang['strvalue']}</th></tr>\n";								for ($i = 0; $i < $_REQUEST['values']; $i++) {					if (!isset($_REQUEST['value'][$i])) $_REQUEST['value'][$i] = '';					echo "\t<tr>\n\t\t<td>", $i + 1, ".&nbsp;</td>\n";					echo "\t\t<td><input name=\"value[{$i}]\" size=\"16\" maxlength=\"{$data->_maxNameLen}\" value=\"",						htmlspecialchars($_REQUEST['value'][$i]), "\" /></td>\n\t</tr>\n";				}					echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"create_enum\" />\n";				echo "<input type=\"hidden\" name=\"stage\" value=\"3\" />\n";				echo $misc->form;				echo "<input type=\"hidden\" name=\"name\" value=\"", htmlspecialchars($_REQUEST['name']), "\" />\n";				echo "<input type=\"hidden\" name=\"values\" value=\"", htmlspecialchars($_REQUEST['values']), "\" />\n";				echo "<input type=\"hidden\" name=\"typcomment\" value=\"", htmlspecialchars($_REQUEST['typcomment']), "\" />\n";				echo "<input type=\"submit\" value=\"{$lang['strcreate']}\" />\n";				echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";				break;			case 3:				global $data, $lang;				// Check inputs				$values = trim($_REQUEST['values']);				if (trim($_REQUEST['name']) == '') {					$_REQUEST['stage'] = 1;					doCreateEnum($lang['strtypeneedsname']);					return;				}				elseif ($values == '' || !is_numeric($values) || $values != (int)$values || $values <= 0)  {					$_REQUEST['stage'] = 1;					doCreateEnum($lang['strtypeneedsvals']);						return;				}				$status = $data->createEnumType($_REQUEST['name'], $_REQUEST['value'], $_REQUEST['typcomment']);				if ($status == 0)					doDefault($lang['strtypecreated']);				elseif ($status == -1) {					$_REQUEST['stage'] = 2;					doCreateEnum($lang['strtypeneedsvalue']);					return;				}				else {					$_REQUEST['stage'] = 2;					doCreateEnum($lang['strtypecreatedbad']);					return;				}				break;			default:				echo "<p>{$lang['strinvalidparam']}</p>\n";		}	}	/**	 * Displays a screen where they can enter a new type	 */	function doCreate($msg = '') {		global $data, $misc;		global $lang;		if (!isset($_POST['typname'])) $_POST['typname'] = '';		if (!isset($_POST['typin'])) $_POST['typin'] = '';		if (!isset($_POST['typout'])) $_POST['typout'] = '';		if (!isset($_POST['typlen'])) $_POST['typlen'] = '';		if (!isset($_POST['typdef'])) $_POST['typdef'] = '';		if (!isset($_POST['typelem'])) $_POST['typelem'] = '';		if (!isset($_POST['typdelim'])) $_POST['typdelim'] = '';		if (!isset($_POST['typalign'])) $_POST['typalign'] = $data->typAlignDef;		if (!isset($_POST['typstorage'])) $_POST['typstorage'] = $data->typStorageDef;		// Retrieve all functions and types in the database		$funcs = $data->getFunctions(true);		$types = $data->getTypes(true);		$misc->printTrail('schema');		$misc->printTitle($lang['strcreatetype'], 'pg.type.create');		$misc->printMsg($msg);		echo "<form action=\"types.php\" method=\"post\">\n";		echo "<table>\n";		echo "<tr><th class=\"data left required\">{$lang['strname']}</th>\n";		echo "<td class=\"data1\"><input name=\"typname\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",			htmlspecialchars($_POST['typname']), "\" /></td></tr>\n";		echo "<tr><th class=\"data left required\">{$lang['strinputfn']}</th>\n";		echo "<td class=\"data1\"><select name=\"typin\">";		while (!$funcs->EOF) {			$proname = htmlspecialchars($funcs->fields['proname']);			echo "<option value=\"{$proname}\"",				($proname == $_POST['typin']) ? ' selected="selected"' : '', ">{$proname}</option>\n";			$funcs->moveNext();		}		echo "</select></td></tr>\n";		echo "<tr><th class=\"data left required\">{$lang['stroutputfn']}</th>\n";		echo "<td class=\"data1\"><select name=\"typout\">";		$funcs->moveFirst();		while (!$funcs->EOF) {			$proname = htmlspecialchars($funcs->fields['proname']);			echo "<option value=\"{$proname}\"",				($proname == $_POST['typout']) ? ' selected="selected"' : '', ">{$proname}</option>\n";			$funcs->moveNext();		}		echo "</select></td></tr>\n";		echo "<tr><th class=\"data left" . (version_compare($data->major_version, '7.4', '<') ? ' required' : '') . "\">{$lang['strlength']}</th>\n";		echo "<td class=\"data1\"><input name=\"typlen\" size=\"8\" value=\"",			htmlspecialchars($_POST['typlen']), "\" /></td></tr>";		echo "<tr><th class=\"data left\">{$lang['strdefault']}</th>\n";		echo "<td class=\"data1\"><input name=\"typdef\" size=\"8\" value=\"",			htmlspecialchars($_POST['typdef']), "\" /></td></tr>";		echo "<tr><th class=\"data left\">{$lang['strelement']}</th>\n";		echo "<td class=\"data1\"><select name=\"typelem\">";		echo "<option value=\"\"></option>\n";		while (!$types->EOF) {			$currname = htmlspecialchars($types->fields['typname']);			echo "<option value=\"{$currname}\"",				($currname == $_POST['typelem']) ? ' selected="selected"' : '', ">{$currname}</option>\n";			$types->moveNext();		}		echo "</select></td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strdelimiter']}</th>\n";		echo "<td class=\"data1\"><input name=\"typdelim\" size=\"1\" maxlength=\"1\" value=\"",			htmlspecialchars($_POST['typdelim']), "\" /></td></tr>";		echo "<tr><th class=\"data left\"><label for=\"typbyval\">{$lang['strpassbyval']}</label></th>\n";		echo "<td class=\"data1\"><input type=\"checkbox\" id=\"typbyval\" name=\"typbyval\"", 			isset($_POST['typbyval']) ? ' checked="checked"' : '', " /></td></tr>";		echo "<tr><th class=\"data left\">{$lang['stralignment']}</th>\n";		echo "<td class=\"data1\"><select name=\"typalign\">";		foreach ($data->typAligns as $v) {			echo "<option value=\"{$v}\"",				($v == $_POST['typalign']) ? ' selected="selected"' : '', ">{$v}</option>\n";		}		echo "</select></td></tr>\n";		echo "<tr><th class=\"data left\">{$lang['strstorage']}</th>\n";		echo "<td class=\"data1\"><select name=\"typstorage\">";		foreach ($data->typStorages as $v) {			echo "<option value=\"{$v}\"",				($v == $_POST['typstorage']) ? ' selected="selected"' : '', ">{$v}</option>\n";		}		echo "</select></td></tr>\n";		echo "</table>\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"save_create\" />\n";		echo $misc->form;		echo "<input type=\"submit\" value=\"{$lang['strcreate']}\" />\n";		echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";		echo "</form>\n";	}		/**	 * Actually creates the new type in the database	 */	function doSaveCreate() {		global $data;		global $lang;		// Check that they've given a name and a length.		// Note: We're assuming they've given in and out functions here		// which might be unwise...		if ($_POST['typname'] == '') doCreate($lang['strtypeneedsname']);		elseif ($_POST['typlen'] == '') doCreate($lang['strtypeneedslen']);		else {		 			$status = $data->createType(				$_POST['typname'],				$_POST['typin'],				$_POST['typout'],				$_POST['typlen'],				$_POST['typdef'],				$_POST['typelem'],				$_POST['typdelim'],				isset($_POST['typbyval']),				$_POST['typalign'],				$_POST['typstorage']			);			if ($status == 0)				doDefault($lang['strtypecreated']);			else				doCreate($lang['strtypecreatedbad']);		}	}		/**	 * Show default list of types in the database	 */	function doDefault($msg = '') {		global $data, $conf, $misc;		global $lang;		$misc->printTrail('schema');		$misc->printTabs('schema','types');		$misc->printMsg($msg);				$types = $data->getTypes();		$columns = array(			'type' => array(				'title' => $lang['strtype'],				'field' => field('typname'),				'url'   => "types.php?action=properties&amp;{$misc->href}&amp;",				'vars'  => array('type' => 'basename'),			),			'owner' => array(				'title' => $lang['strowner'],				'field' => field('typowner'),			),			'flavour' => array(				'title' => $lang['strflavor'],				'field' => field('typtype'),				'type'  => 'verbatim',				'params'=> array(					'map' => array(						'b' => $lang['strbasetype'],						'c' => $lang['strcompositetype'],						'd' => $lang['strdomain'],						'p' => $lang['strpseudotype'],						'e' => $lang['strenum'],					),					'align' => 'center',				),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('typcomment'),			),		);				if (!isset($types->fields['typtype'])) unset($columns['flavour']);		$actions = array(			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "types.php?action=confirm_drop&amp;{$misc->href}&amp;",				'vars'  => array('type' => 'basename'),			),		);				$misc->printTable($types, $columns, $actions, $lang['strnotypes']);		echo "<ul class=\"navlink\">\n\t<li><a href=\"types.php?action=create&amp;{$misc->href}\">{$lang['strcreatetype']}</a></li>\n";		echo "\t<li><a href=\"types.php?action=create_comp&amp;{$misc->href}\">{$lang['strcreatecomptype']}</a></li>\n";		if ($data->hasEnumTypes())			echo "\t<li><a href=\"types.php?action=create_enum&amp;{$misc->href}\">{$lang['strcreateenumtype']}</a></li>\n";		echo "</ul>\n";	}		/**	 * Generate XML for the browser tree.	 */	function doTree() {		global $misc, $data;				$types = $data->getTypes();				$reqvars = $misc->getRequestVars('type');				$attrs = array(			'text'   => field('typname'),			'icon'   => 'Type',			'toolTip'=> field('typcomment'),			'action' => url('types.php',							$reqvars,							array(								'action' => 'properties',								'type'   => field('basename')							)						)		);				$misc->printTreeXML($types, $attrs);		exit;	}		if ($action == 'tree') doTree();		$misc->printHeader($lang['strtypes']);	$misc->printBody();	switch ($action) {		case 'create_comp':			if (isset($_POST['cancel'])) doDefault();			else doCreateComposite();			break;		case 'create_enum':			if (isset($_POST['cancel'])) doDefault();			else doCreateEnum();			break;		case 'save_create':			if (isset($_POST['cancel'])) doDefault();			else doSaveCreate();			break;		case 'create':			doCreate();			break;		case 'drop':			if (isset($_POST['cancel'])) doDefault();			else doDrop(false);			break;		case 'confirm_drop':			doDrop(true);			break;					case 'properties':			doProperties();			break;		default:			doDefault();			break;	}		$misc->printFooter();?>
<?php	/**	 * List tables in a database	 *	 * $Id: tblproperties.php,v 1.92 2008/01/19 13:46:15 ioguix Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');	$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	/**	 * Function to save after altering a table	 */	function doSaveAlter() {		global $data, $lang, $_reload_browser, $misc;		// For databases that don't allow owner change		if (!isset($_POST['owner'])) $_POST['owner'] = '';		// Default tablespace to null if it isn't set		if (!isset($_POST['tablespace'])) $_POST['tablespace'] = null;		if (!isset($_POST['newschema'])) $_POST['newschema'] = null;		$status = $data->alterTable($_POST['table'], $_POST['name'], $_POST['owner'], $_POST['newschema'], $_POST['comment'], $_POST['tablespace']);		if ($status == 0) {			// If table has been renamed, need to change to the new name and			// reload the browser frame.			if ($_POST['table'] != $_POST['name']) {				// Jump them to the new table name				$_REQUEST['table'] = $_POST['name'];				// Force a browser reload				$_reload_browser = true;			}			// If schema has changed, need to change to the new schema and reload the browser			if (!empty($_POST['newschema']) && ($_POST['newschema'] != $data->_schema)) {				// Jump them to the new sequence schema				$misc->setCurrentSchema($_POST['newschema']);				$_reload_browser = true;			 }			doDefault($lang['strtablealtered']);		}		else			doAlter($lang['strtablealteredbad']);	}	/**	 * Function to allow altering of a table	 */	function doAlter($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('table');		$misc->printTitle($lang['stralter'], 'pg.table.alter');		$misc->printMsg($msg);		// Fetch table info		$table = $data->getTable($_REQUEST['table']);		// Fetch all users		$users = $data->getUsers();		// Fetch all tablespaces from the database		if ($data->hasTablespaces()) $tablespaces = $data->getTablespaces(true);		if ($table->recordCount() > 0) {			if (!isset($_POST['name'])) $_POST['name'] = $table->fields['relname'];			if (!isset($_POST['owner'])) $_POST['owner'] = $table->fields['relowner'];			if (!isset($_POST['newschema'])) $_POST['newschema'] = $table->fields['nspname'];			if (!isset($_POST['comment'])) $_POST['comment'] = $table->fields['relcomment'];			if ($data->hasTablespaces() && !isset($_POST['tablespace'])) $_POST['tablespace'] = $table->fields['tablespace'];			echo "<form action=\"tblproperties.php\" method=\"post\">\n";			echo "<table>\n";			echo "<tr><th class=\"data left required\">{$lang['strname']}</th>\n";			echo "<td class=\"data1\">";			echo "<input name=\"name\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",				htmlspecialchars($_POST['name'], ENT_QUOTES), "\" /></td></tr>\n";			$server_info = $misc->getServerInfo();			if ($data->isSuperUser($server_info['username'])) {				echo "<tr><th class=\"data left required\">{$lang['strowner']}</th>\n";				echo "<td class=\"data1\"><select name=\"owner\">";				while (!$users->EOF) {					$uname = $users->fields['usename'];					echo "<option value=\"", htmlspecialchars($uname), "\"",						($uname == $_POST['owner']) ? ' selected="selected"' : '', ">", htmlspecialchars($uname), "</option>\n";					$users->moveNext();				}				echo "</select></td></tr>\n";			}			if ($data->hasAlterTableSchema()) {				$schemas = $data->getSchemas();				echo "<tr><th class=\"data left required\">{$lang['strschema']}</th>\n";				echo "<td class=\"data1\"><select name=\"newschema\">";				while (!$schemas->EOF) {					$schema = $schemas->fields['nspname'];					echo "<option value=\"", htmlspecialchars($schema), "\"",						($schema == $_POST['newschema']) ? ' selected="selected"' : '', ">", htmlspecialchars($schema), "</option>\n";					$schemas->moveNext();				}			    echo "</select></td></tr>\n";			}			// Tablespace (if there are any)			if ($data->hasTablespaces() && $tablespaces->recordCount() > 0) {				echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strtablespace']}</th>\n";				echo "\t\t<td class=\"data1\">\n\t\t\t<select name=\"tablespace\">\n";				// Always offer the default (empty) option				echo "\t\t\t\t<option value=\"\"",					($_POST['tablespace'] == '') ? ' selected="selected"' : '', "></option>\n";				// Display all other tablespaces				while (!$tablespaces->EOF) {					$spcname = htmlspecialchars($tablespaces->fields['spcname']);					echo "\t\t\t\t<option value=\"{$spcname}\"",						($spcname == $_POST['tablespace']) ? ' selected="selected"' : '', ">{$spcname}</option>\n";					$tablespaces->moveNext();				}				echo "\t\t\t</select>\n\t\t</td>\n\t</tr>\n";			}			echo "<tr><th class=\"data left\">{$lang['strcomment']}</th>\n";			echo "<td class=\"data1\">";			echo "<textarea rows=\"3\" cols=\"32\" name=\"comment\">",				htmlspecialchars($_POST['comment']), "</textarea></td></tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"alter\" />\n";			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}	function doExport($msg = '') {		global $data, $misc;		global $lang;		// Determine whether or not the table has an object ID		$hasID = $data->hasObjectID($_REQUEST['table']);		$misc->printTrail('table');		$misc->printTabs('table','export');		$misc->printMsg($msg);		echo "<form action=\"dataexport.php\" method=\"post\">\n";		echo "<table>\n";		echo "<tr><th class=\"data\">{$lang['strformat']}</th><th class=\"data\" colspan=\"2\">{$lang['stroptions']}</th></tr>\n";		// Data only		echo "<tr><th class=\"data left\" rowspan=\"", ($hasID) ? 2 : 1, "\">";		echo "<input type=\"radio\" id=\"what1\" name=\"what\" value=\"dataonly\" checked=\"checked\" /><label for=\"what1\">{$lang['strdataonly']}</label></th>\n";		echo "<td>{$lang['strformat']}</td>\n";		echo "<td><select name=\"d_format\">\n";		echo "<option value=\"copy\">COPY</option>\n";		echo "<option value=\"sql\">SQL</option>\n";		echo "<option value=\"csv\">CSV</option>\n";		echo "<option value=\"tab\">{$lang['strtabbed']}</option>\n";		echo "<option value=\"html\">XHTML</option>\n";		echo "<option value=\"xml\">XML</option>\n";		echo "</select>\n</td>\n</tr>\n";		if ($hasID) {			echo "<tr><td><label for=\"d_oids\">{$lang['stroids']}</td><td><input type=\"checkbox\" id=\"d_oids\" name=\"d_oids\" /></td>\n</tr>\n";		}		// Structure only		echo "<tr><th class=\"data left\"><input type=\"radio\" id=\"what2\" name=\"what\" value=\"structureonly\" /><label for=\"what2\">{$lang['strstructureonly']}</label></th>\n";		echo "<td><label for=\"s_clean\">{$lang['strdrop']}</label></td><td><input type=\"checkbox\" id=\"s_clean\" name=\"s_clean\" /></td>\n</tr>\n";		// Structure and data		echo "<tr><th class=\"data left\" rowspan=\"", ($hasID) ? 3 : 2, "\">";		echo "<input type=\"radio\" id=\"what3\" name=\"what\" value=\"structureanddata\" /><label for=\"what3\">{$lang['strstructureanddata']}</label></th>\n";		echo "<td>{$lang['strformat']}</td>\n";		echo "<td><select name=\"sd_format\">\n";		echo "<option value=\"copy\">COPY</option>\n";		echo "<option value=\"sql\">SQL</option>\n";		echo "</select>\n</td>\n</tr>\n";		echo "<tr><td><label for=\"sd_clean\">{$lang['strdrop']}</label></td><td><input type=\"checkbox\" id=\"sd_clean\" name=\"sd_clean\" /></td>\n</tr>\n";		if ($hasID) {			echo "<tr><td><label for=\"sd_oids\">{$lang['stroids']}</label></td><td><input type=\"checkbox\" id=\"sd_oids\" name=\"sd_oids\" /></td>\n</tr>\n";		}		echo "</table>\n";		echo "<h3>{$lang['stroptions']}</h3>\n";		echo "<p><input type=\"radio\" id=\"output1\" name=\"output\" value=\"show\" checked=\"checked\" /><label for=\"output1\">{$lang['strshow']}</label>\n";		echo "<br/><input type=\"radio\" id=\"output2\" name=\"output\" value=\"download\" /><label for=\"output2\">{$lang['strdownload']}</label></p>\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"export\" />\n";		echo $misc->form;		echo "<input type=\"hidden\" name=\"subject\" value=\"table\" />\n";		echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";		echo "<input type=\"submit\" value=\"{$lang['strexport']}\" /></p>\n";		echo "</form>\n";	}	function doImport($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('table');		$misc->printTabs('table','import');		$misc->printMsg($msg);		// Check that file uploads are enabled		if (ini_get('file_uploads')) {			// Don't show upload option if max size of uploads is zero			$max_size = $misc->inisizeToBytes(ini_get('upload_max_filesize'));			if (is_double($max_size) && $max_size > 0) {				echo "<form action=\"dataimport.php\" method=\"post\" enctype=\"multipart/form-data\">\n";				echo "<table>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strformat']}</th>\n";				echo "\t\t<td><select name=\"format\">\n";				echo "\t\t\t<option value=\"auto\">{$lang['strauto']}</option>\n";				echo "\t\t\t<option value=\"csv\">CSV</option>\n";				echo "\t\t\t<option value=\"tab\">{$lang['strtabbed']}</option>\n";				if (function_exists('xml_parser_create')) {					echo "\t\t\t<option value=\"xml\">XML</option>\n";				}				echo "\t\t</select></td>\n\t</tr>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strallowednulls']}</th>\n";				echo "\t\t<td><label><input type=\"checkbox\" name=\"allowednulls[0]\" value=\"\\N\" checked=\"checked\" />{$lang['strbackslashn']}</label><br />\n";				echo "\t\t<label><input type=\"checkbox\" name=\"allowednulls[1]\" value=\"NULL\" />NULL</label><br />\n";				echo "\t\t<label><input type=\"checkbox\" name=\"allowednulls[2]\" value=\"\" />{$lang['stremptystring'] }</label></td>\n\t</tr>\n";				echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strfile']}</th>\n";				echo "\t\t<td><input type=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"{$max_size}\" />";				echo "<input type=\"file\" name=\"source\" /></td>\n\t</tr>\n";				echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"import\" />\n";				echo $misc->form;				echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";				echo "<input type=\"submit\" value=\"{$lang['strimport']}\" /></p>\n";				echo "</form>\n";			}		}		else echo "<p>{$lang['strnouploads']}</p>\n";	}	/**	 * Displays a screen where they can add a column	 */	function doAddColumn($msg = '') {		global $data, $misc, $_reload_browser;		global $lang;		if (!isset($_REQUEST['stage'])) $_REQUEST['stage'] = 1;		switch ($_REQUEST['stage']) {			case 1:				// Set variable defaults				if (!isset($_POST['field'])) $_POST['field'] = '';				if (!isset($_POST['type'])) $_POST['type'] = '';				if (!isset($_POST['array'])) $_POST['array'] = '';				if (!isset($_POST['length'])) $_POST['length'] = '';				if (!isset($_POST['default'])) $_POST['default'] = '';				if (!isset($_POST['comment'])) $_POST['comment'] = '';				// Fetch all available types				$types = $data->getTypes(true, false, true);				$types_for_js = array();				$misc->printTrail('table');				$misc->printTitle($lang['straddcolumn'], 'pg.column.add');				$misc->printMsg($msg);				echo "<script src=\"tables.js\" type=\"text/javascript\"></script>";				echo "<form action=\"tblproperties.php\" method=\"post\">\n";				// Output table header				echo "<table>\n";				echo "<tr><th class=\"data required\">{$lang['strname']}</th>\n<th colspan=\"2\" class=\"data required\">{$lang['strtype']}</th>\n";				echo "<th class=\"data\">{$lang['strlength']}</th>\n";				if ($data->hasCreateFieldWithConstraints())					echo "<th class=\"data\">{$lang['strnotnull']}</th>\n<th class=\"data\">{$lang['strdefault']}</th>\n";				echo "<th class=\"data\">{$lang['strcomment']}</th></tr>\n";				echo "<tr><td><input name=\"field\" size=\"16\" maxlength=\"{$data->_maxNameLen}\" value=\"",					htmlspecialchars($_POST['field']), "\" /></td>\n";				echo "<td><select name=\"type\" id=\"type\" onchange=\"checkLengths(document.getElementById('type').value,'');\">\n";				// Output any "magic" types.  This came in with the alter column type so we'll check that				if ($data->hasMagicTypes()) {					foreach ($data->extraTypes as $v) {						$types_for_js[] = strtolower($v);						echo "\t<option value=\"", htmlspecialchars($v), "\"",						($v == $_POST['type']) ? ' selected="selected"' : '', ">",							$misc->printVal($v), "</option>\n";					}				}				while (!$types->EOF) {					$typname = $types->fields['typname'];					$types_for_js[] = $typname;					echo "\t<option value=\"", htmlspecialchars($typname), "\"", ($typname == $_POST['type']) ? ' selected="selected"' : '', ">",						$misc->printVal($typname), "</option>\n";					$types->moveNext();				}				echo "</select></td>\n";				// Output array type selector				echo "<td><select name=\"array\">\n";				echo "\t<option value=\"\"", ($_POST['array'] == '') ? ' selected="selected"' : '', "></option>\n";				echo "\t<option value=\"[]\"", ($_POST['array'] == '[]') ? ' selected="selected"' : '', ">[ ]</option>\n";				echo "</select></td>\n";				$predefined_size_types = array_intersect($data->predefined_size_types, $types_for_js);				$escaped_predef_types = array(); // the JS escaped array elements				foreach($predefined_size_types as $value) {					$escaped_predef_types[] = "'{$value}'";				}				echo "<td><input name=\"length\" id=\"lengths\" size=\"8\" value=\"",					htmlspecialchars($_POST['length']), "\" /></td>\n";				// Support for adding column with not null and default				if ($data->hasCreateFieldWithConstraints()) {					echo "<td><input type=\"checkbox\" name=\"notnull\"",						(isset($_REQUEST['notnull'])) ? ' checked="checked"' : '', " /></td>\n";					echo "<td><input name=\"default\" size=\"20\" value=\"",						htmlspecialchars($_POST['default']), "\" /></td>\n";				}				echo "<td><input name=\"comment\" size=\"40\" value=\"",					htmlspecialchars($_POST['comment']), "\" /></td></tr>\n";				echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"add_column\" />\n";				echo "<input type=\"hidden\" name=\"stage\" value=\"2\" />\n";				echo $misc->form;				echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";				if (!$data->hasCreateFieldWithConstraints()) {					echo "<input type=\"hidden\" name=\"default\" value=\"\" />\n";				}				echo "<input type=\"submit\" value=\"{$lang['stradd']}\" />\n";				echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";				echo "<script type=\"text/javascript\">predefined_lengths = new Array(". implode(",",$escaped_predef_types) .");checkLengths(document.getElementById('type').value,'');</script>\n";				break;			case 2:				// Check inputs				if (trim($_POST['field']) == '') {					$_REQUEST['stage'] = 1;					doAddColumn($lang['strcolneedsname']);					return;				}				if (!isset($_POST['length'])) $_POST['length'] = '';				$status = $data->addColumn($_POST['table'], $_POST['field'],							   $_POST['type'], $_POST['array'] != '', $_POST['length'], isset($_POST['notnull']),							   $_POST['default'], $_POST['comment']);				if ($status == 0) {					$_reload_browser = true;					doDefault($lang['strcolumnadded']);				}				else {					$_REQUEST['stage'] = 1;					doAddColumn($lang['strcolumnaddedbad']);					return;				}				break;			default:				echo "<p>{$lang['strinvalidparam']}</p>\n";		}	}	/**	 * Show confirmation of drop column and perform actual drop	 */	function doDrop($confirm) {		global $data, $database, $misc, $_reload_browser;		global $lang;		if ($confirm) {			$misc->printTrail('column');			$misc->printTitle($lang['strdrop'], 'pg.column.drop');            echo "<p>", sprintf($lang['strconfdropcolumn'], $misc->printVal($_REQUEST['column']),                    $misc->printVal($_REQUEST['table'])), "</p>\n";			echo "<form action=\"tblproperties.php\" method=\"post\">\n";			echo "<input type=\"hidden\" name=\"action\" value=\"drop\" />\n";			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";			echo "<input type=\"hidden\" name=\"column\" value=\"", htmlspecialchars($_REQUEST['column']), "\" />\n";			echo $misc->form;			echo "<p><input type=\"checkbox\" id=\"cascade\" name=\"cascade\"> <label for=\"cascade\">{$lang['strcascade']}</label></p>\n";			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		}		else {			$status = $data->dropColumn($_POST['table'], $_POST['column'], isset($_POST['cascade']));			if ($status == 0) {				$_reload_browser = true;				doDefault($lang['strcolumndropped']);			}			else				doDefault($lang['strcolumndroppedbad']);		}	}	function doTree() {		global $misc, $data;		$columns = $data->getTableAttributes($_REQUEST['table']);		$reqvars = $misc->getRequestVars('column');		$attrs = array (			'text'   => field('attname'),			'action' => url('colproperties.php',							$reqvars,							array(								'table'		=> $_REQUEST['table'],								'column'	=> field('attname')							)						),			'icon'   => 'Column',			'iconAction' => url('display.php',								$reqvars,								array(									'table'		=> $_REQUEST['table'],									'column'	=> field('attname'),									'query'		=> replace(														'SELECT "%column%", count(*) AS "count" FROM "%table%" GROUP BY "%column%" ORDER BY "%column%"',														array (															'%column%' => field('attname'),															'%table%' => $_REQUEST['table']														)													)								)							),			'toolTip'=> field('comment')		);		$misc->printTreeXML($columns, $attrs);		exit;	}	if ($action == 'tree') doTree();	/**	 * Show default list of columns in the table	 */	function doDefault($msg = '') {		global $data, $conf, $misc;		global $lang;		function attPre(&$rowdata, $actions) {			global $data;			$rowdata->fields['+type'] = $data->formatType($rowdata->fields['type'], $rowdata->fields['atttypmod']);			$attname = $rowdata->fields['attname'];			$table = $_REQUEST['table'];			$data->fieldClean($attname);			$data->fieldClean($table);			$actions['browse']['url'] .= 'query=' . urlencode("SELECT \"{$attname}\", count(*) AS \"count\"				FROM \"{$table}\" GROUP BY \"{$attname}\" ORDER BY \"{$attname}\"") . '&amp;';			return $actions;		}		$misc->printTrail('table');		$misc->printTabs('table','columns');		$misc->printMsg($msg);		// Get table		$tdata = $data->getTable($_REQUEST['table']);		// Get columns		$attrs = $data->getTableAttributes($_REQUEST['table']);		// Get constraints keys		$ck = $data->getConstraintsWithFields($_REQUEST['table']);		// Show comment if any		if ($tdata->fields['relcomment'] !== null)			echo '<p class="comment">', $misc->printVal($tdata->fields['relcomment']), "</p>\n";		$columns = array(			'column' => array(				'title' => $lang['strcolumn'],				'field' => field('attname'),				'url'   => "colproperties.php?subject=column&amp;{$misc->href}&amp;table=".urlencode($_REQUEST['table'])."&amp;",				'vars'  => array('column' => 'attname'),			),			'type' => array(				'title' => $lang['strtype'],				'field' => field('+type'),			),			'notnull' => array(				'title' => $lang['strnotnull'],				'field' => field('attnotnull'),				'type'  => 'bool',				'params'=> array('true' => 'NOT NULL', 'false' => ''),			),			'default' => array(				'title' => $lang['strdefault'],				'field' => field('adsrc'),			),			'keyprop' => array(				'title' => $lang['strconstraints'],				'field' => field('attname'),				'type'  => 'callback',				'params'=> array(					'function' => 'cstrRender',					'keys' => $ck->getArray()				)			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('comment'),			),		);		function cstrRender($s, $p) {			global $misc, $data;			$str ='';			foreach ($p['keys'] as $k => $c) {				if (is_null($p['keys'][$k]['consrc'])) {					$atts = $data->getAttributeNames($_REQUEST['table'], explode(' ', $p['keys'][$k]['indkey']));					$c['consrc'] = ($c['contype'] == 'u' ? "UNIQUE (" : "PRIMARY KEY (") . join(',', $atts) . ')';				}				if ($c['p_field'] == $s)					switch ($c['contype']) {						case 'p':							$str .= '<a href="constraints.php?'. $misc->href ."&amp;table=". urlencode($c['p_table']) ."&amp;schema=". urlencode($c['p_schema']) ."\"><img src=\"".								$misc->icon('PrimaryKey') .'" alt="[pk]" title="'. htmlentities($c['consrc']) .'" /></a>';						break;						case 'f':							$str .= '<a href="tblproperties.php?'. $misc->href ."&amp;table=". urlencode($c['f_table']) ."&amp;schema=". urlencode($c['f_schema']) ."\"><img src=\"".								$misc->icon('ForeignKey') .'" alt="[fk]" title="'. htmlentities($c['consrc']) .'" /></a>';						break;						case 'u':							$str .= '<a href="constraints.php?'. $misc->href ."&amp;table=". urlencode($c['p_table']) ."&amp;schema=". urlencode($c['p_schema']) ."\"><img src=\"".								$misc->icon('UniqueConstraint') .'" alt="[uniq]" title="'. htmlentities($c['consrc']) .'" /></a>';						break;						case 'c':							$str .= '<a href="constraints.php?'. $misc->href ."&amp;table=". urlencode($c['p_table']) ."&amp;schema=". urlencode($c['p_schema']) ."\"><img src=\"".								$misc->icon('CheckConstraint') .'" alt="[check]" title="'. htmlentities($c['consrc']) .'" /></a>';					}			}			return $str;		}		$return_url = urlencode("tblproperties.php?{$misc->href}&amp;table=". urlencode($_REQUEST['table']));		$actions = array(			'browse' => array(				'title' => $lang['strbrowse'],				'url' => "display.php?{$misc->href}&amp;subject=column&amp;return_url={$return_url}&amp;table=".urlencode($_REQUEST['table'])."&amp;return_desc=" . urlencode($lang['strback']) . '&amp;',				'vars' => array('column' => 'attname'),			),			'alter' => array(				'title' => $lang['stralter'],				'url'   => "colproperties.php?action=properties&amp;{$misc->href}&amp;table=".urlencode($_REQUEST['table'])."&amp;",				'vars'  => array('column' => 'attname'),			),			'privileges' => array(				'title' => $lang['strprivileges'],				'url'   => "privileges.php?subject=column&amp;{$misc->href}&amp;table=".urlencode($_REQUEST['table'])."&amp;",				'vars'  => array('column' => 'attname'),			),			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "tblproperties.php?action=confirm_drop&amp;{$misc->href}&amp;table=".urlencode($_REQUEST['table'])."&amp;",				'vars'  => array('column' => 'attname'),			),		);		$misc->printTable($attrs, $columns, $actions, null, 'attPre');		echo "<ul class=\"navlink\">\n";		echo "\t<li><a href=\"display.php?{$misc->href}&amp;table=", urlencode($_REQUEST['table']), "&amp;subject=table&amp;return_url={$return_url}&amp;return_desc=",			urlencode($lang['strback']), "\">{$lang['strbrowse']}</a></li>\n";		echo "\t<li><a href=\"tables.php?action=confselectrows&amp;{$misc->href}&amp;table=", urlencode($_REQUEST['table']),"\">{$lang['strselect']}</a></li>\n";		echo "\t<li><a href=\"tables.php?action=confinsertrow&amp;{$misc->href}&amp;table=", urlencode($_REQUEST['table']),"\">{$lang['strinsert']}</a></li>\n";		echo "\t<li><a href=\"tables.php?action=confirm_empty&amp;{$misc->href}&amp;table=", urlencode($_REQUEST['table']),"\">{$lang['strempty']}</a></li>\n";		echo "\t<li><a href=\"tables.php?action=confirm_drop&amp;{$misc->href}&amp;table=", urlencode($_REQUEST['table']),"\">{$lang['strdrop']}</a></li>\n";		echo "\t<li><a href=\"tblproperties.php?action=add_column&amp;{$misc->href}&amp;table=", urlencode($_REQUEST['table']),"\">{$lang['straddcolumn']}</a></li>\n";		echo "\t<li><a href=\"tblproperties.php?action=confirm_alter&amp;{$misc->href}&amp;table=", urlencode($_REQUEST['table']),"\">{$lang['stralter']}</a></li>\n";		echo "</ul>\n";	}	$misc->printHeader($lang['strtables'] . ' - ' . $_REQUEST['table']);	$misc->printBody();	switch ($action) {		case 'alter':			if (isset($_POST['alter'])) doSaveAlter();			else doDefault();			break;		case 'confirm_alter':			doAlter();			break;		case 'import':			doImport();			break;		case 'export':			doExport();			break;		case 'add_column':			if (isset($_POST['cancel'])) doDefault();			else doAddColumn();			break;		case 'properties':			if (isset($_POST['cancel'])) doDefault();			else doProperties();			break;		case 'drop':			if (isset($_POST['drop'])) doDrop(false);			else doDefault();			break;		case 'confirm_drop':			doDrop(true);			break;		default:			doDefault();			break;	}	$misc->printFooter();?>
<?php	/**	 * Manage fulltext configurations, dictionaries and mappings	 *	 * $Id: fulltext.php,v 1.6 2008/03/17 21:35:48 ioguix Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');	$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	if (!isset($msg)) $msg = '';	function doDefault($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('schema');		$misc->printTabs('schema','fulltext');		$misc->printTabs('fulltext','ftsconfigs');		$misc->printMsg($msg);		$cfgs = $data->getFtsConfigurations(false);		$columns = array(			'configuration' => array(				'title' => $lang['strftsconfig'],				'field' => field('name'),				'url'   => "fulltext.php?action=viewconfig&amp;{$misc->href}&amp;",				'vars'	=> array('ftscfg' => 'name'),			),			'schema' => array(				'title' => $lang['strschema'],				'field' => field('schema'),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('comment'),			),		);		$actions = array(			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "fulltext.php?action=dropconfig&amp;{$misc->href}&amp;",				'vars'  => array('ftscfg' => 'name'),			),			'alter' => array(				'title' => $lang['stralter'],				'url'   => "fulltext.php?action=alterconfig&amp;{$misc->href}&amp;",				'vars'  => array('ftscfg' => 'name'),			),		);		$misc->printTable($cfgs, $columns, $actions, $lang['strftsnoconfigs']);		echo "<ul class=\"navlink\">\n";		echo "\t<li><a href=\"fulltext.php?action=createconfig&amp;{$misc->href}\">{$lang['strftscreateconfig']}</a></li>\n";		echo "</ul>\n";	}	function doDropConfig($confirm) {		global $data, $data, $misc;		global $lang, $_reload_browser;		if ($confirm) {			$misc->printTrail('ftscfg');			$misc->printTitle($lang['strdrop'], 'pg.ftscfg.drop');			echo "<p>", sprintf($lang['strconfdropftsconfig'], $misc->printVal($_REQUEST['ftscfg'])), "</p>\n";			echo "<form action=\"fulltext.php\" method=\"post\">\n";			echo "<p><input type=\"checkbox\" id=\"cascade\" name=\"cascade\" /> <label for=\"cascade\">{$lang['strcascade']}</label></p>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"dropconfig\" />\n";			echo "<input type=\"hidden\" name=\"database\" value=\"", htmlspecialchars($_REQUEST['database']), "\" />\n";			echo "<input type=\"hidden\" name=\"ftscfg\" value=\"", htmlspecialchars($_REQUEST['ftscfg']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else {			$status = $data->dropFtsConfiguration($_POST['ftscfg'], isset($_POST['cascade']));			if ($status == 0) {				$_reload_browser = true;				doDefault($lang['strftsconfigdropped']);			}			else				doDefault($lang['strftsconfigdroppedbad']);		}	}	function doDropDict($confirm) {		global $data, $data, $misc;		global $lang, $_reload_browser;		if ($confirm) {			$misc->printTrail('ftscfg'); // TODO: change to smth related to dictionary			$misc->printTitle($lang['strdrop'], 'pg.ftsdict.drop');			echo "<p>", sprintf($lang['strconfdropftsdict'], $misc->printVal($_REQUEST['ftsdict'])), "</p>\n";			echo "<form action=\"fulltext.php\" method=\"post\">\n";			echo "<p><input type=\"checkbox\" id=\"cascade\" name=\"cascade\" /> <label for=\"cascade\">{$lang['strcascade']}</label></p>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"dropdict\" />\n";			echo "<input type=\"hidden\" name=\"database\" value=\"", htmlspecialchars($_REQUEST['database']), "\" />\n";			echo "<input type=\"hidden\" name=\"ftsdict\" value=\"", htmlspecialchars($_REQUEST['ftsdict']), "\" />\n";			//echo "<input type=\"hidden\" name=\"ftscfg\" value=\"", htmlspecialchars($_REQUEST['ftscfg']), "\" />\n";			echo "<input type=\"hidden\" name=\"prev_action\" value=\"viewdicts\" /></p>\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else {			$status = $data->dropFtsDictionary($_POST['ftsdict'], isset($_POST['cascade']));			if ($status == 0) {				$_reload_browser = true;				doViewDicts($lang['strftsdictdropped']);			}			else				doViewDicts($lang['strftsdictdroppedbad']);		}	}	/**	 * Displays a screen where one can enter a new FTS configuration	 */	function doCreateConfig($msg = '') {		global $data, $misc;		global $lang;		include_once('./classes/Gui.php');		$server_info = $misc->getServerInfo();		if (!isset($_POST['formName'])) $_POST['formName'] = '';		if (!isset($_POST['formParser'])) $_POST['formParser'] = '';		if (!isset($_POST['formTemplate'])) $_POST['formTemplate'] = '';		if (!isset($_POST['formWithMap'])) $_POST['formWithMap'] = '';		if (!isset($_POST['formComment'])) $_POST['formComment'] = '';		// Fetch all FTS configurations from the database		$ftscfgs = $data->getFtsConfigurations();		// Fetch all FTS parsers from the database		$ftsparsers = $data->getFtsParsers();		$misc->printTrail('schema');		$misc->printTitle($lang['strftscreateconfig'], 'pg.ftscfg.create');		$misc->printMsg($msg);		echo "<form action=\"fulltext.php\" method=\"post\">\n";		echo "<table>\n";		/* conf name */		echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strname']}</th>\n";		echo "\t\t<td class=\"data1\"><input name=\"formName\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",			htmlspecialchars($_POST['formName']), "\" /></td>\n\t</tr>\n";		// Template		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strftstemplate']}</th>\n";		echo "\t\t<td class=\"data1\">";		$tpls = array();		$tplsel = '';		while (!$ftscfgs->EOF) {			$data->fieldClean($ftscfgs->fields['schema']);			$data->fieldClean($ftscfgs->fields['name']);			$tplname = $ftscfgs->fields['schema'] .'.'. $ftscfgs->fields['name'];			$tpls[$tplname] = serialize(array(				'name' => $ftscfgs->fields['name'],				'schema' => $ftscfgs->fields['schema']			));			if ($_POST['formTemplate'] == $tpls[$tplname]) {				$tplsel = htmlspecialchars($tpls[$tplname]);			}			$ftscfgs->moveNext();		}		echo GUI::printCombo($tpls, 'formTemplate', true, $tplsel, false);		echo "\n\t\t</td>\n\t</tr>\n";		// Parser		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strftsparser']}</th>\n";		echo "\t\t<td class=\"data1\">\n";		$ftsparsers_ = array();		$ftsparsel = '';		while (!$ftsparsers->EOF) {			$data->fieldClean($ftsparsers->fields['schema']);			$data->fieldClean($ftsparsers->fields['name']);			$parsername = $ftsparsers->fields['schema'] .'.'. $ftsparsers->fields['name'];						$ftsparsers_[$parsername] = serialize(array(				'parser' => $ftsparsers->fields['name'],				'schema' => $ftsparsers->fields['schema']			));			if ($_POST['formParser'] == $ftsparsers_[$parsername]) {				$ftsparsel = htmlspecialchars($ftsparsers_[$parsername]);			}			$ftsparsers->moveNext();		}		echo GUI::printCombo($ftsparsers_, 'formParser', true, $ftsparsel, false);		echo "\n\t\t</td>\n\t</tr>\n";		// Comment		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strcomment']}</th>\n";		echo "\t\t<td class=\"data1\"><textarea name=\"formComment\" rows=\"3\" cols=\"32\">",			htmlspecialchars($_POST['formComment']), "</textarea></td>\n\t</tr>\n";		echo "</table>\n";		echo "<p>\n";		echo "<input type=\"hidden\" name=\"action\" value=\"createconfig\" />\n";		echo "<input type=\"hidden\" name=\"database\" value=\"", htmlspecialchars($_REQUEST['database']), "\" />\n";		echo $misc->form;		echo "<input type=\"submit\" name=\"create\" value=\"{$lang['strcreate']}\" />\n";		echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";		echo "</p>\n";		echo "</form>\n";	}	/**	 * Actually creates the new FTS configuration in the database	 */	function doSaveCreateConfig() {		global $data, $lang, $_reload_browser;		$err = '';		// Check that they've given a name		if ($_POST['formName'] == '') $err .= "{$lang['strftsconfigneedsname']}<br />";				if (($_POST['formParser'] != '') && ($_POST['formTemplate'] != ''))  $err .= "{$lang['strftscantparsercopy']}<br />";		if ($err != '') return doCreateConfig($err);		if ($_POST['formParser'] != '') $formParser = unserialize($_POST['formParser']);		else $formParser = '';		if ($_POST['formTemplate'] != '') $formTemplate = unserialize($_POST['formTemplate']);		else $formTemplate = '';		$status = $data->createFtsConfiguration($_POST['formName'], $formParser, $formTemplate, $_POST['formComment']);		if ($status == 0) {			$_reload_browser = true;			doDefault($lang['strftsconfigcreated']);		}		else			doCreateConfig($lang['strftsconfigcreatedbad']);	}	/**	 * Display a form to permit editing FTS configuration properies.	 */	function doAlterConfig($msg = '') {		global $data, $misc, $lang;		$misc->printTrail('ftscfg');		$misc->printTitle($lang['stralter'], 'pg.ftscfg.alter');		$misc->printMsg($msg);		$ftscfg = $data->getFtsConfigurationByName($_REQUEST['ftscfg']);		if ($ftscfg->recordCount() > 0) {			if (!isset($_POST['formComment'])) $_POST['formComment'] = $ftscfg->fields['comment'];			if (!isset($_POST['ftscfg'])) $_POST['ftscfg'] = $_REQUEST['ftscfg'];			if (!isset($_POST['formName'])) $_POST['formName'] = $_REQUEST['ftscfg'];			if (!isset($_POST['formParser'])) $_POST['formParser'] = '';			// Fetch all FTS parsers from the database			$ftsparsers = $data->getFtsParsers();			echo "<form action=\"fulltext.php\" method=\"post\">\n";			echo "<table>\n";			echo "\t<tr>\n";			echo "\t\t<th class=\"data left required\">{$lang['strname']}</th>\n";			echo "\t\t<td class=\"data1\">";			echo "\t\t\t<input name=\"formName\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",				htmlspecialchars($_POST['formName']), "\" />\n";			echo "\t\t</td>\n";			echo "\t</tr>\n";			// Comment			echo "\t<tr>\n";			echo "\t\t<th class=\"data\">{$lang['strcomment']}</th>\n";			echo "\t\t<td class=\"data1\"><textarea cols=\"32\" rows=\"3\"name=\"formComment\">", htmlspecialchars($_POST['formComment']), "</textarea></td>\n";			echo "\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"alterconfig\" />\n";			echo "<input type=\"hidden\" name=\"ftscfg\" value=\"", htmlspecialchars($_POST['ftscfg']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		} else {			echo "<p>{$lang['strnodata']}</p>\n";		}	}	/**	 * Save the form submission containing changes to a FTS configuration	 */	function doSaveAlterConfig() {		global $data, $misc, $lang;		$status = $data->updateFtsConfiguration($_POST['ftscfg'], $_POST['formComment'], $_POST['formName']);		if ($status == 0)			doDefault($lang['strftsconfigaltered']);		else			doAlterConfig($lang['strftsconfigalteredbad']);	}	/**	 * View list of FTS parsers	 */	function doViewParsers($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('schema');		$misc->printTabs('schema','fulltext');		$misc->printTabs('fulltext','ftsparsers');		$misc->printMsg($msg);		$parsers = $data->getFtsParsers(false);		$columns = array(			'schema' => array(				'title' => $lang['strschema'],				'field' => field('schema'),			),			'name' => array(				'title' => $lang['strname'],				'field' => field('name'),			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('comment'),			),		);		$actions = array();		$misc->printTable($parsers, $columns, $actions, $lang['strftsnoparsers']);		//TODO: create parser		//echo "<ul class=\"navlink\">\n";		//echo "\t<li><a href=\"#\">{$lang['strftscreateparser']}</a></li>\n";		//echo "</ul>\n";	}	/**	 * View list of FTS dictionaries	 */	function doViewDicts($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('schema');		$misc->printTabs('schema','fulltext');		$misc->printTabs('fulltext','ftsdicts');		$misc->printMsg($msg);		$dicts = $data->getFtsDictionaries(false);		$columns = array(			'schema' => array(				'title' => $lang['strschema'],				'field' => field('schema'),			),			'name' => array(				'title' => $lang['strname'],				'field' => field('name'),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('comment'),			),		);		$actions = array(			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "fulltext.php?action=dropdict&amp;{$misc->href}&amp;",				'vars'  => array('ftsdict' => 'name'),			),			'alter' => array(				'title' => $lang['stralter'],				'url'   => "fulltext.php?action=alterdict&amp;{$misc->href}&amp;",				'vars'  => array('ftsdict' => 'name'),			),		);		$misc->printTable($dicts, $columns, $actions, $lang['strftsnodicts']);		echo "<ul class=\"navlink\">\n";		echo "\t<li><a href=\"fulltext.php?action=createdict&amp;{$misc->href}&amp;\">{$lang['strftscreatedict']}</a></li>\n";		echo "</ul>\n";	}	/**	 * View details of FTS configuration given	 */	function doViewConfig($ftscfg, $msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('ftscfg');		$misc->printTabs('schema','fulltext');		$misc->printTabs('fulltext','ftsconfigs');		$misc->printMsg($msg);		echo "<h3>{$lang['strftsconfigmap']}</h3>\n";		$map = $data->getFtsConfigurationMap($ftscfg);		$columns = array(			'name' => array(				'title' => $lang['strftsmapping'],				'field' => field('name'),			),			'dictionaries' => array(				'title' => $lang['strftsdicts'],				'field' => field('dictionaries'),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('description'),			),		);		$actions = array(			'drop' => array(				'title' => $lang['strdrop'],				'url'   => "fulltext.php?action=dropmapping&amp;{$misc->href}&amp;",				'vars'  => array('mapping' => 'name', 'ftscfg' => 'cfgname'),				'multiaction' => 'dropmapping',			),			'alter' => array(				'title' => $lang['stralter'],				'url'   => "fulltext.php?action=altermapping&amp;{$misc->href}&amp;",				'vars'  => array('mapping' => 'name', 'ftscfg' => 'cfgname'),			),			'multiactions' => array(				'keycols' => array('mapping' => 'name'),				'url' => 'fulltext.php',				'default' => null,				'vars'  => array('ftscfg' => $ftscfg),			),		);		$misc->printTable($map, $columns, $actions, $lang['strftsemptymap']);		echo "<ul class=\"navlink\">\n";		echo "\t<li><a href=\"fulltext.php?action=addmapping&amp;{$misc->href}&ftscfg={$ftscfg}\">{$lang['strftsaddmapping']}</a></li>\n";		echo "</ul>\n";	}	/**	 * Displays a screen where one can enter a details of a new FTS dictionary	 */	function doCreateDict($msg = '') {		global $data, $misc;		global $lang;		include_once('./classes/Gui.php');		$server_info = $misc->getServerInfo();		if (!isset($_POST['formName'])) $_POST['formName'] = '';		if(!isset($_POST['formIsTemplate'])) $_POST['formIsTemplate'] = false;		if (!isset($_POST['formTemplate'])) $_POST['formTemplate'] = '';		if (!isset($_POST['formLexize'])) $_POST['formLexize'] = '';		if (!isset($_POST['formInit'])) $_POST['formInit'] = '';		if (!isset($_POST['formOption'])) $_POST['formOption'] = '';		if (!isset($_POST['formComment'])) $_POST['formComment'] = '';		// Fetch all FTS dictionaries from the database		$ftstpls = $data->getFtsDictionaryTemplates();		$misc->printTrail('schema');		// TODO: create doc links		$misc->printTitle($lang['strftscreatedict'], 'pg.ftsdict.create');		$misc->printMsg($msg);		echo "<form action=\"fulltext.php\" method=\"post\">\n";		echo "<table>\n";		echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strname']}</th>\n";		echo "\t\t<td class=\"data1\"><input name=\"formName\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",			htmlspecialchars($_POST['formName']), "\" />&nbsp;",			"<input type=\"checkbox\" name=\"formIsTemplate\" id=\"formIsTemplate\"", $_POST['formIsTemplate'] ? ' checked="checked" ' : '', " />\n",			"<label for=\"formIsTemplate\">{$lang['strftscreatedicttemplate']}</label></td>\n\t</tr>\n";		// Template		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strftstemplate']}</th>\n";		echo "\t\t<td class=\"data1\">";		$tpls = array();		$tplsel = '';		while (!$ftstpls->EOF) {			$data->fieldClean($ftstpls->fields['schema']);			$data->fieldClean($ftstpls->fields['name']);			$tplname = $ftstpls->fields['schema'] .'.'. $ftstpls->fields['name'];			$tpls[$tplname] = serialize(array(				'name' => $ftstpls->fields['name'],				'schema' => $ftstpls->fields['schema']			));			if ($_POST['formTemplate'] == $tpls[$tplname]) {				$tplsel = htmlspecialchars($tpls[$tplname]);			}			$ftstpls->moveNext();		}		echo GUI::printCombo($tpls, 'formTemplate', true, $tplsel, false);		echo "\n\t\t</td>\n\t</tr>\n";		// TODO: what about maxlengths?		// Lexize		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strftslexize']}</th>\n";		echo "\t\t<td class=\"data1\"><input name=\"formLexize\" size=\"32\" maxlength=\"1000\" value=\"",			htmlspecialchars($_POST['formLexize']), "\" ", isset($_POST['formIsTemplate']) ? '' : ' disabled="disabled" ',			"/></td>\n\t</tr>\n";		// Init		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strftsinit']}</th>\n";		echo "\t\t<td class=\"data1\"><input name=\"formInit\" size=\"32\" maxlength=\"1000\" value=\"",			htmlspecialchars($_POST['formInit']), "\"", @$_POST['formIsTemplate'] ? '' : ' disabled="disabled" ',			"/></td>\n\t</tr>\n";		// Option		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strftsoptionsvalues']}</th>\n";		echo "\t\t<td class=\"data1\"><input name=\"formOption\" size=\"32\" maxlength=\"1000\" value=\"",			htmlspecialchars($_POST['formOption']), "\" /></td>\n\t</tr>\n";		// Comment		echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strcomment']}</th>\n";		echo "\t\t<td class=\"data1\"><textarea name=\"formComment\" rows=\"3\" cols=\"32\">",			htmlspecialchars($_POST['formComment']), "</textarea></td>\n\t</tr>\n";		echo "</table>\n";		echo "<p>\n";		echo "<input type=\"hidden\" name=\"action\" value=\"createdict\" />\n";		echo "<input type=\"hidden\" name=\"database\" value=\"", htmlspecialchars($_REQUEST['database']), "\" />\n";		echo $misc->form;		echo "<input type=\"submit\" name=\"create\" value=\"{$lang['strcreate']}\" />\n";		echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";		echo "</p>\n";		echo "</form>\n",			"<script type=\"text/javascript\">								function templateOpts() {					isTpl = document.getElementsByName('formIsTemplate')[0].checked;					document.getElementsByName('formTemplate')[0].disabled = isTpl;					document.getElementsByName('formOption')[0].disabled = isTpl;					document.getElementsByName('formLexize')[0].disabled = !isTpl;					document.getElementsByName('formInit')[0].disabled = !isTpl;				}								document.getElementsByName('formIsTemplate')[0].onchange = templateOpts;				templateOpts();			</script>\n";	}	/**	 * Actually creates the new FTS dictionary in the database	 */	function doSaveCreateDict() {		global $data, $lang, $_reload_browser;		// Check that they've given a name		if ($_POST['formName'] == '') doCreateDict($lang['strftsdictneedsname']);		else {			if(!isset($_POST['formIsTemplate'])) $_POST['formIsTemplate'] = false;			if(isset($_POST['formTemplate']))				$formTemplate = unserialize($_POST['formTemplate']);			else				$formTemplate = '';			if(!isset($_POST['formLexize'])) $_POST['formLexize'] = '';			if(!isset($_POST['formInit'])) $_POST['formInit'] = '';			if(!isset($_POST['formOption'])) $_POST['formOption'] = '';						$status = $data->createFtsDictionary($_POST['formName'], $_POST['formIsTemplate'],				$formTemplate, $_POST['formLexize'],				$_POST['formInit'], $_POST['formOption'], $_POST['formComment']			);						if ($status == 0) {				$_reload_browser = true;				doViewDicts($lang['strftsdictcreated']);			}			else				doCreateDict($lang['strftsdictcreatedbad']);		}	}	/**	 * Display a form to permit editing FTS dictionary properies.	 */	function doAlterDict($msg = '') {		global $data, $misc, $lang;		$misc->printTrail('ftscfg'); // TODO: change to smth related to dictionary		$misc->printTitle($lang['stralter'], 'pg.ftsdict.alter');		$misc->printMsg($msg);		$ftsdict = $data->getFtsDictionaryByName($_REQUEST['ftsdict']);		if ($ftsdict->recordCount() > 0) {			if (!isset($_POST['formComment'])) $_POST['formComment'] = $ftsdict->fields['comment'];			if (!isset($_POST['ftsdict'])) $_POST['ftsdict'] = $_REQUEST['ftsdict'];			if (!isset($_POST['formName'])) $_POST['formName'] = $_REQUEST['ftsdict'];			echo "<form action=\"fulltext.php\" method=\"post\">\n";			echo "<table>\n";			echo "\t<tr>\n";			echo "\t\t<th class=\"data left required\">{$lang['strname']}</th>\n";			echo "\t\t<td class=\"data1\">";			echo "\t\t\t<input name=\"formName\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",				htmlspecialchars($_POST['formName']), "\" />\n";			echo "\t\t</td>\n";			echo "\t</tr>\n";			// Comment			echo "\t<tr>\n";			echo "\t\t<th class=\"data\">{$lang['strcomment']}</th>\n";			echo "\t\t<td class=\"data1\"><textarea cols=\"32\" rows=\"3\"name=\"formComment\">", htmlspecialchars($_POST['formComment']), "</textarea></td>\n";			echo "\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"alterdict\" />\n";			echo "<input type=\"hidden\" name=\"ftsdict\" value=\"", htmlspecialchars($_POST['ftsdict']), "\" />\n";			echo "<input type=\"hidden\" name=\"prev_action\" value=\"viewdicts\" /></p>\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		} else {			echo "<p>{$lang['strnodata']}</p>\n";		}	}	/**	 * Save the form submission containing changes to a FTS dictionary	 */	function doSaveAlterDict() {		global $data, $misc, $lang;		$status = $data->updateFtsDictionary($_POST['ftsdict'], $_POST['formComment'], $_POST['formName']);		if ($status == 0)			doViewDicts($lang['strftsdictaltered']);		else			doAlterDict($lang['strftsdictalteredbad']);	}	/**	 * Show confirmation of drop and perform actual drop of FTS mapping	 */	function doDropMapping($confirm) {		global $data, $misc;		global $lang, $_reload_drop_database;		if (empty($_REQUEST['mapping']) && empty($_REQUEST['ma'])) {			doDefault($lang['strftsspecifymappingtodrop']);			return;		}		if (empty($_REQUEST['ftscfg'])) {			doDefault($lang['strftsspecifyconfigtoalter']);			return;		}		if ($confirm) {			$misc->printTrail('ftscfg'); // TODO: proper breadcrumbs			$misc->printTitle($lang['strdrop'], 'pg.ftscfg.alter');			echo "<form action=\"fulltext.php\" method=\"post\">\n";			// Case of multiaction drop			if (isset($_REQUEST['ma'])) {				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfdropftsmapping'], $misc->printVal($a['mapping']), $misc->printVal($_REQUEST['ftscfg'])), "</p>\n";					printf('<input type="hidden" name="mapping[]" value="%s" />', htmlspecialchars($a['mapping']));				}			} else {				echo "<p>", sprintf($lang['strconfdropftsmapping'], $misc->printVal($_REQUEST['mapping']), $misc->printVal($_REQUEST['ftscfg'])), "</p>\n";				echo "<input type=\"hidden\" name=\"mapping\" value=\"", htmlspecialchars($_REQUEST['mapping']), "\" />\n";			}			echo "<input type=\"hidden\" name=\"ftscfg\" value=\"{$_REQUEST['ftscfg']}\" />\n";			echo "<input type=\"hidden\" name=\"action\" value=\"dropmapping\" />\n";            echo "<input type=\"hidden\" name=\"prev_action\" value=\"viewconfig\" /></p>\n";            			echo $misc->form;			echo "<input type=\"submit\" name=\"drop\" value=\"{$lang['strdrop']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		} else {			// Case of multiaction drop			if (is_array($_REQUEST['mapping'])) {				$status = $data->changeFtsMapping($_REQUEST['ftscfg'], $_REQUEST['mapping'], 'drop');				if ($status != 0) {					doViewConfig($_REQUEST['ftscfg'], $lang['strftsmappingdroppedbad']);					return;				}				doViewConfig($_REQUEST['ftscfg'], $lang['strftsmappingdropped']);			} else {				$status = $data->changeFtsMapping($_REQUEST['ftscfg'], array($_REQUEST['mapping']), 'drop');				if ($status == 0) {					doViewConfig($_REQUEST['ftscfg'], $lang['strftsmappingdropped']);				} else {					doViewConfig($_REQUEST['ftscfg'], $lang['strftsmappingdroppedbad']);				}			}		}	}	function doAlterMapping($msg = '') {		global $data, $misc, $lang;		$misc->printTrail('ftscfg');		$misc->printTitle($lang['stralter'], 'pg.ftscfg.alter');		$misc->printMsg($msg);		$ftsdicts = $data->getFtsDictionaries();		if ($ftsdicts->recordCount() > 0) {			if (!isset($_POST['formMapping'])) $_POST['formMapping'] = @$_REQUEST['mapping'];			if (!isset($_POST['formDictionary'])) $_POST['formDictionary'] = '';			if (!isset($_POST['ftscfg'])) $_POST['ftscfg'] = $_REQUEST['ftscfg'];			echo "<form action=\"fulltext.php\" method=\"post\">\n";			echo "<table>\n";			echo "\t<tr>\n";			echo "\t\t<th class=\"data left required\">{$lang['strftsmapping']}</th>\n";			echo "\t\t<td class=\"data1\">";			// Case of multiaction drop			if (isset($_REQUEST['ma'])) {				$ma_mappings = array();				$ma_mappings_names = array();				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					printf('<input type="hidden" name="formMapping[]" value="%s" />', htmlspecialchars($a['mapping']));					$ma_mappings[] = $data->getFtsMappingByName($_POST['ftscfg'], $a['mapping']);					$ma_mappings_names[] = $a['mapping'];				}				echo implode(", ", $ma_mappings_names);			} else {				$mapping = $data->getFtsMappingByName($_POST['ftscfg'], $_POST['formMapping']);				echo $mapping->fields['name'];				echo "<input type=\"hidden\" name=\"formMapping\" value=\"", htmlspecialchars($_POST['formMapping']), "\" />\n";			}			echo "\t\t</td>\n";			echo "\t</tr>\n";			// Dictionary			echo "\t<tr>\n";			echo "\t\t<th class=\"data left required\">{$lang['strftsdict']}</th>\n";			echo "\t\t<td class=\"data1\">";			echo "\t\t\t<select name=\"formDictionary\">\n";			while (!$ftsdicts->EOF) {				$ftsdict = htmlspecialchars($ftsdicts->fields['name']);				echo "\t\t\t\t<option value=\"{$ftsdict}\"",					($ftsdict == $_POST['formDictionary'] || $ftsdict == @$mapping->fields['dictionaries'] || $ftsdict == @$ma_mappings[0]->fields['dictionaries']) ? ' selected="selected"' : '', ">{$ftsdict}</option>\n";				$ftsdicts->moveNext();			}			echo "\t\t</td>\n";			echo "\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"altermapping\" />\n";			echo "<input type=\"hidden\" name=\"ftscfg\" value=\"", htmlspecialchars($_POST['ftscfg']), "\" />\n";            echo "<input type=\"hidden\" name=\"prev_action\" value=\"viewconfig\" /></p>\n";            			echo $misc->form;			echo "<input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		} else {			echo "<p>{$lang['strftsnodictionaries']}</p>\n";		}	}	/**	 * Save the form submission containing changes to a FTS mapping	 */	function doSaveAlterMapping() {		global $data, $misc, $lang;		$mappingArray = (is_array($_POST['formMapping']) ? $_POST['formMapping'] : array($_POST['formMapping']));		$status = $data->changeFtsMapping($_POST['ftscfg'], $mappingArray, 'alter', $_POST['formDictionary']);		if ($status == 0)			doViewConfig($_POST['ftscfg'], $lang['strftsmappingaltered']);		else			doAlterMapping($lang['strftsmappingalteredbad']);	}	/**	 * Show the form to enter parameters of a new FTS mapping	 */	function doAddMapping($msg = '') {		global $data, $misc, $lang;		$misc->printTrail('ftscfg');		$misc->printTitle($lang['stralter'], 'pg.ftscfg.alter');		$misc->printMsg($msg);		$ftsdicts = $data->getFtsDictionaries();		if ($ftsdicts->recordCount() > 0) {			if (!isset($_POST['formMapping'])) $_POST['formMapping'] = '';			if (!isset($_POST['formDictionary'])) $_POST['formDictionary'] = '';			if (!isset($_POST['ftscfg'])) $_POST['ftscfg'] = $_REQUEST['ftscfg'];			$mappings = $data->getFtsMappings($_POST['ftscfg']);			echo "<form action=\"fulltext.php\" method=\"post\">\n";			echo "<table>\n";			echo "\t<tr>\n";			echo "\t\t<th class=\"data left required\">{$lang['strftsmapping']}</th>\n";			echo "\t\t<td class=\"data1\">";			echo "\t\t\t<select name=\"formMapping\">\n";			while (!$mappings->EOF) {				$mapping = htmlspecialchars($mappings->fields['name']);				$mapping_desc = htmlspecialchars($mappings->fields['description']);				echo "\t\t\t\t<option value=\"{$mapping}\"",					$mapping == $_POST['formMapping'] ? ' selected="selected"' : '', ">{$mapping}", $mapping_desc ? " - {$mapping_desc}" : "", "</option>\n";				$mappings->moveNext();			}			echo "\t\t</td>\n";			echo "\t</tr>\n";			// Dictionary			echo "\t<tr>\n";			echo "\t\t<th class=\"data left required\">{$lang['strftsdict']}</th>\n";			echo "\t\t<td class=\"data1\">";			echo "\t\t\t<select name=\"formDictionary\">\n";			while (!$ftsdicts->EOF) {				$ftsdict = htmlspecialchars($ftsdicts->fields['name']);				echo "\t\t\t\t<option value=\"{$ftsdict}\"",					$ftsdict == $_POST['formDictionary'] ? ' selected="selected"' : '', ">{$ftsdict}</option>\n";				$ftsdicts->moveNext();			}			echo "\t\t</td>\n";			echo "\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"addmapping\" />\n";			echo "<input type=\"hidden\" name=\"ftscfg\" value=\"", htmlspecialchars($_POST['ftscfg']), "\" />\n";			echo "<input type=\"hidden\" name=\"prev_action\" value=\"viewconfig\" /></p>\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"add\" value=\"{$lang['stradd']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		} else {			echo "<p>{$lang['strftsnodictionaries']}</p>\n";		}	}	/**	 * Save the form submission containing parameters of a new FTS mapping	 */	function doSaveAddMapping() {		global $data, $misc, $lang;		$mappingArray = (is_array($_POST['formMapping']) ? $_POST['formMapping'] : array($_POST['formMapping']));		$status = $data->changeFtsMapping($_POST['ftscfg'], $mappingArray, 'add', $_POST['formDictionary']);		if ($status == 0)			doViewConfig($_POST['ftscfg'], $lang['strftsmappingadded']);		else			doAddMapping($lang['strftsmappingaddedbad']);	}	/**	 * Generate XML for the browser tree.	 */	function doTree() {		global $misc, $data, $lang, $slony;		$tabs = $misc->getNavTabs('fulltext');		$items = $misc->adjustTabsForTree($tabs);		$reqvars = $misc->getRequestVars('ftscfg');		$attrs = array(			'text'   => noEscape(field('title')),			'icon'   => field('icon'),			'action' => url('fulltext.php',				$reqvars,				field('urlvars')			),			'branch' => url('fulltext.php',				$reqvars,				array(					'action'  => 'subtree',					'what'  => field('icon') // IZ: yeah, it's ugly, but I do not want to change navigation tabs arrays				)			),		);		$misc->printTreeXML($items, $attrs);		exit;	}	function doSubTree($what) {		global $misc, $data, $lang;		switch($what) {			case 'FtsCfg':				$items = $data->getFtsConfigurations(false);				$urlvars = array('action' => 'viewconfig', 'ftscfg' => field('name'));				break;			case 'FtsDict':				$items = $data->getFtsDictionaries(false);				$urlvars = array('action' => 'viewdicts');				break;			case 'FtsParser':				$items = $data->getFtsParsers(false);				$urlvars = array('action' => 'viewparsers');				break;			default:				exit;		}		$reqvars = $misc->getRequestVars('ftscfg');		$attrs = array(			'text'   => noEscape(field('name')),			'icon'   => $what,			'toolTip'=> field('comment'),			'action' => url('fulltext.php',				$reqvars,				$urlvars			),			'branch' => ifempty(field('branch'),				'',				url('fulltext.php',					$reqvars,					array(						'action'  => 'subtree',						'ftscfg'  => field('name')					)				)			),		);		$misc->printTreeXML($items, $attrs);		exit;	}	if ($action == 'tree') doTree();	if ($action == 'subtree') doSubTree($_REQUEST['what']);	$misc->printHeader($lang['strschemas']);	$misc->printBody();	if (isset($_POST['cancel'])) {		if (isset($_POST['prev_action'])) {			$action = $_POST['prev_action'];		} else {			$action = '';		}	}	switch ($action) {		case 'createconfig':			if (isset($_POST['create'])) doSaveCreateConfig();			else doCreateConfig();			break;		case 'alterconfig':			if (isset($_POST['alter'])) doSaveAlterConfig();			else doAlterConfig();			break;		case 'dropconfig':			if (isset($_POST['drop'])) doDropConfig(false);			else doDropConfig(true);			break;		case 'viewconfig':			doViewConfig($_REQUEST['ftscfg']);			break;		case 'viewparsers':			doViewParsers();			break;		case 'viewdicts':			doViewDicts();			break;		case 'createdict':			if (isset($_POST['create'])) doSaveCreateDict();			else doCreateDict();			break;		case 'alterdict':			if (isset($_POST['alter'])) doSaveAlterDict();			else doAlterDict();			break;		case 'dropdict':			if (isset($_POST['drop'])) doDropDict(false);			else doDropDict(true);			break;		case 'dropmapping':			if (isset($_POST['drop'])) doDropMapping(false);			else doDropMapping(true);			break;		case 'altermapping':			if (isset($_POST['alter'])) doSaveAlterMapping();			else doAlterMapping();			break;		case 'addmapping':			if (isset($_POST['add'])) doSaveAddMapping();			else doAddMapping();			break;		default:			doDefault();			break;	}	$misc->printFooter();?>
<?php	$script = ''; // init global value script		/**	 * Show confirmation of cluster and perform cluster	 */	function doCluster($type, $confirm=false) {		global $script, $data, $misc, $lang;		if (($type == 'table') && empty($_REQUEST['table']) && empty($_REQUEST['ma'])) {			doDefault($lang['strspecifytabletocluster']);			return;		}		if ($confirm) {			if (isset($_REQUEST['ma'])) {				$misc->printTrail('schema');				$misc->printTitle($lang['strclusterindex'], 'pg.index.cluster');				echo "<form action=\"{$script}\" method=\"post\">\n";				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfclustertable'], $misc->printVal($a['table'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table[]\" value=\"", htmlspecialchars($a['table']), "\" />\n";				}			} // END if multi cluster			else {				$misc->printTrail($type);				$misc->printTitle($lang['strclusterindex'], 'pg.index.cluster');								echo "<form action=\"{$script}\" method=\"post\">\n";								if ($type == 'table') {					echo "<p>", sprintf($lang['strconfclustertable'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";				}				else {					echo "<p>", sprintf($lang['strconfclusterdatabase'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"\" />\n";				}			}			echo "<input type=\"hidden\" name=\"action\" value=\"cluster\" />\n";						echo $misc->form;			echo "<input type=\"submit\" name=\"cluster\" value=\"{$lang['strcluster']}\" />\n"; //TODO			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		} // END single cluster		else {			//If multi table cluster			if ($type == 'table') { // cluster one or more table				if (is_array($_REQUEST['table'])) {					$msg='';					foreach($_REQUEST['table'] as $o) {						$status = $data->clusterIndex($o);						if ($status == 0)							$msg.= sprintf('%s: %s<br />', htmlentities($o), $lang['strclusteredgood']);						else {							doDefault($type, sprintf('%s%s: %s<br />', $msg, htmlentities($o), $lang['strclusteredbad']));							return;						}					}					 // Everything went fine, back to the Default page....					 doDefault($msg);				}				else {					$status = $data->clusterIndex($_REQUEST['object']);					if ($status == 0) {						doAdmin($type, $lang['strclusteredgood']);					}					else						doAdmin($type, $lang['strclusteredbad']);				}			}			else { // Cluster all tables in database				$status = $data->clusterIndex();				if ($status == 0) {					doAdmin($type, $lang['strclusteredgood']);				}				else					doAdmin($type, $lang['strclusteredbad']);			}		}	}		/**	 * Show confirmation of reindex and perform reindex	 */	function doReindex($type, $confirm=false) {		global $script, $data, $misc, $lang, $_reload_browser;		if (($type == 'table') && empty($_REQUEST['table']) && empty($_REQUEST['ma'])) {			doDefault($lang['strspecifytabletoreindex']);			return;		}		if ($confirm) {			if (isset($_REQUEST['ma'])) {				$misc->printTrail('schema');				$misc->printTitle($lang['strreindex'], 'pg.reindex');				echo "<form action=\"{$script}\" method=\"post\">\n";				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfreindextable'], $misc->printVal($a['table'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table[]\" value=\"", htmlspecialchars($a['table']), "\" />\n";				}			} // END if multi reindex			else {				$misc->printTrail($type);				$misc->printTitle($lang['strreindex'], 'pg.reindex');								echo "<form action=\"{$script}\" method=\"post\">\n";								if ($type == 'table') {					echo "<p>", sprintf($lang['strconfreindextable'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";				}				else {					echo "<p>", sprintf($lang['strconfreindexdatabase'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"\" />\n";				}			}			echo "<input type=\"hidden\" name=\"action\" value=\"reindex\" />\n";						if ($data->hasForceReindex())				echo "<p><input type=\"checkbox\" id=\"reindex_force\" name=\"reindex_force\" /><label for=\"reindex_force\">{$lang['strforce']}</label></p>\n";						echo $misc->form;			echo "<input type=\"submit\" name=\"reindex\" value=\"{$lang['strreindex']}\" />\n"; //TODO			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		} // END single reindex		else {			//If multi table reindex			if (($type == 'table') && is_array($_REQUEST['table'])) {				$msg='';				foreach($_REQUEST['table'] as $o) {					$status = $data->reindex(strtoupper($type), $o, isset($_REQUEST['reindex_force']));					if ($status == 0)						$msg.= sprintf('%s: %s<br />', htmlentities($o), $lang['strreindexgood']);					else {						doDefault($type, sprintf('%s%s: %s<br />', $msg, htmlentities($o), $lang['strreindexbad']));						return;					}				}				 // Everything went fine, back to the Default page....				 $_reload_browser = true;				 doDefault($msg);			}			else {				$status = $data->reindex(strtoupper($type), $_REQUEST['object'], isset($_REQUEST['reindex_force']));				if ($status == 0) {					$_reload_browser = true;					doAdmin($type, $lang['strreindexgood']);				}				else					doAdmin($type, $lang['strreindexbad']);			}		}	}		/**	 * Show confirmation of analyze and perform analyze	 */	function doAnalyze($type, $confirm=false) {		global $script, $data, $misc, $lang, $_reload_browser;		if (($type == 'table') && empty($_REQUEST['table']) && empty($_REQUEST['ma'])) {			doDefault($lang['strspecifytabletoanalyze']);			return;		}		if ($confirm) {			if (isset($_REQUEST['ma'])) {				$misc->printTrail('schema');				$misc->printTitle($lang['stranalyze'], 'pg.analyze');				echo "<form action=\"{$script}\" method=\"post\">\n";				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfanalyzetable'], $misc->printVal($a['table'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table[]\" value=\"", htmlspecialchars($a['table']), "\" />\n";				}			} // END if multi analyze			else {				$misc->printTrail($type);				$misc->printTitle($lang['stranalyze'], 'pg.analyze');								echo "<form action=\"{$script}\" method=\"post\">\n";								if ($type == 'table') {					echo "<p>", sprintf($lang['strconfanalyzetable'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";				}				else {					echo "<p>", sprintf($lang['strconfanalyzedatabase'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"\" />\n";				}			}			echo "<input type=\"hidden\" name=\"action\" value=\"analyze\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"analyze\" value=\"{$lang['stranalyze']}\" />\n"; //TODO			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		} // END single analyze		else {			//If multi table analyze			if (($type == 'table') && is_array($_REQUEST['table'])) {				$msg='';				foreach($_REQUEST['table'] as $o) {					$status = $data->analyzeDB($o);					if ($status == 0)						$msg.= sprintf('%s: %s<br />', htmlentities($o), $lang['stranalyzegood']);					else {						doDefault($type, sprintf('%s%s: %s<br />', $msg, htmlentities($o), $lang['stranalyzebad']));						return;					}				}				 // Everything went fine, back to the Default page....				 $_reload_browser = true;				 doDefault($msg);			}			else {				//we must pass table here. When empty, analyze the whole db				$status = $data->analyzeDB($_REQUEST['table']);				if ($status == 0) {					$_reload_browser = true;					doAdmin($type, $lang['stranalyzegood']);				}				else					doAdmin($type, $lang['stranalyzebad']);			}		}	}	/**	 * Show confirmation of vacuum and perform actual vacuum	 */	function doVacuum($type, $confirm = false) {		global $script, $data, $misc, $lang, $_reload_browser;		if (($type == 'table') && empty($_REQUEST['table']) && empty($_REQUEST['ma'])) {			doDefault($lang['strspecifytabletovacuum']);			return;		}		if ($confirm) {			if (isset($_REQUEST['ma'])) {				$misc->printTrail('schema');				$misc->printTitle($lang['strvacuum'], 'pg.vacuum');				echo "<form action=\"{$script}\" method=\"post\">\n";				foreach($_REQUEST['ma'] as $v) {					$a = unserialize(htmlspecialchars_decode($v, ENT_QUOTES));					echo "<p>", sprintf($lang['strconfvacuumtable'], $misc->printVal($a['table'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table[]\" value=\"", htmlspecialchars($a['table']), "\" />\n";				}			} // END if multi vacuum			else {				$misc->printTrail($type);				$misc->printTitle($lang['strvacuum'], 'pg.vacuum');				echo "<form action=\"{$script}\" method=\"post\">\n";								if ($type == 'table') {					echo "<p>", sprintf($lang['strconfvacuumtable'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";				}				else {					echo "<p>", sprintf($lang['strconfvacuumdatabase'], $misc->printVal($_REQUEST['object'])), "</p>\n";					echo "<input type=\"hidden\" name=\"table\" value=\"\" />\n";				}			}			echo "<input type=\"hidden\" name=\"action\" value=\"vacuum\" />\n";			echo $misc->form;			echo "<p><input type=\"checkbox\" id=\"vacuum_full\" name=\"vacuum_full\" /> <label for=\"vacuum_full\">{$lang['strfull']}</label></p>\n";			echo "<p><input type=\"checkbox\" id=\"vacuum_analyze\" name=\"vacuum_analyze\" /> <label for=\"vacuum_analyze\">{$lang['stranalyze']}</label></p>\n";			echo "<p><input type=\"checkbox\" id=\"vacuum_freeze\" name=\"vacuum_freeze\" /><label for=\"vacuum_freeze\">{$lang['strfreeze']}</label></p>\n";			echo "<input type=\"submit\" name=\"vacuum\" value=\"{$lang['strvacuum']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" />\n";			echo "</form>\n";		} // END single vacuum		else {			//If multi drop			if (is_array($_REQUEST['table'])) {				$msg='';				foreach($_REQUEST['table'] as $t) {					$status = $data->vacuumDB($t, isset($_REQUEST['vacuum_analyze']), isset($_REQUEST['vacuum_full']), isset($_REQUEST['vacuum_freeze']));					if ($status == 0)						$msg.= sprintf('%s: %s<br />', htmlentities($t), $lang['strvacuumgood']);					else {						doDefault($type, sprintf('%s%s: %s<br />', $msg, htmlentities($t), $lang['strvacuumbad']));						return;					}				}				 // Everything went fine, back to the Default page....				 $_reload_browser = true;				 doDefault($msg);			}			else {				//we must pass table here. When empty, vacuum the whole db				$status = $data->vacuumDB($_REQUEST['table'], isset($_REQUEST['vacuum_analyze']), isset($_REQUEST['vacuum_full']), isset($_REQUEST['vacuum_freeze']));				if ($status == 0) {					$_reload_browser = true;					doAdmin($type, $lang['strvacuumgood']);				}				else					doAdmin($type, $lang['strvacuumbad']);			}		}	}	/**	 * Add or Edit autovacuum params and save them	 */	function doEditAutovacuum($type, $confirm, $msg='') {		global $script, $data, $misc, $lang;				if (empty($_REQUEST['table'])) {			doAdmin($type, '', $lang['strspecifyeditvacuumtable']);			return;		}				$script = ($type == 'database')? 'database.php' : 'tables.php';				if ($confirm) {			$misc->printTrail($type);			$misc->printTitle(sprintf($lang['streditvacuumtable'], $misc->printVal($_REQUEST['table'])));			$misc->printMsg(sprintf($msg, $misc->printVal($_REQUEST['table'])));			if (empty($_REQUEST['table'])) {				doAdmin($type, '', $lang['strspecifyeditvacuumtable']);				return;			}						$old_val = $data->getTableAutovacuum($_REQUEST['table']);			$defaults = $data->getAutovacuum();			$old_val = $old_val->fields;			if (isset($old_val['autovacuum_enabled']) and ($old_val['autovacuum_enabled'] == 'off')) {				$enabled = '';				$disabled = 'checked="checked"';			}			else {				$enabled = 'checked="checked"';				$disabled = '';			}			if (!isset($old_val['autovacuum_vacuum_threshold'])) $old_val['autovacuum_vacuum_threshold'] = '';			if (!isset($old_val['autovacuum_vacuum_scale_factor'])) $old_val['autovacuum_vacuum_scale_factor'] = '';			if (!isset($old_val['autovacuum_analyze_threshold'])) $old_val['autovacuum_analyze_threshold'] = '';			if (!isset($old_val['autovacuum_analyze_scale_factor'])) $old_val['autovacuum_analyze_scale_factor'] = '';			if (!isset($old_val['autovacuum_vacuum_cost_delay'])) $old_val['autovacuum_vacuum_cost_delay'] = '';			if (!isset($old_val['autovacuum_vacuum_cost_limit'])) $old_val['autovacuum_vacuum_cost_limit'] = '';			echo "<form action=\"{$script}\" method=\"post\">\n";			echo $misc->form;			echo "<input type=\"hidden\" name=\"action\" value=\"editautovac\" />\n";			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";			echo "<br />\n<br />\n<table>\n";			echo "\t<tr><td>&nbsp;</td>\n";			echo "<th class=\"data\">{$lang['strnewvalues']}</th><th class=\"data\">{$lang['strdefaultvalues']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['strenable']}</th>\n";			echo "<td class=\"data1\">\n";			echo "<label for=\"on\">on</label><input type=\"radio\" name=\"autovacuum_enabled\" id=\"on\" value=\"on\" {$enabled} />\n";			echo "<label for=\"off\">off</label><input type=\"radio\" name=\"autovacuum_enabled\" id=\"off\" value=\"off\" {$disabled} /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['strvacuumbasethreshold']}</th>\n";			echo "<td class=\"data1\"><input type=\"text\" name=\"autovacuum_vacuum_threshold\" value=\"{$old_val['autovacuum_vacuum_threshold']}\" /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum_vacuum_threshold']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['strvacuumscalefactor']}</th>\n";			echo "<td class=\"data1\"><input type=\"text\" name=\"autovacuum_vacuum_scale_factor\" value=\"{$old_val['autovacuum_vacuum_scale_factor']}\" /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum_vacuum_scale_factor']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['stranalybasethreshold']}</th>\n";			echo "<td class=\"data1\"><input type=\"text\" name=\"autovacuum_analyze_threshold\" value=\"{$old_val['autovacuum_analyze_threshold']}\" /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum_analyze_threshold']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['stranalyzescalefactor']}</th>\n";			echo "<td class=\"data1\"><input type=\"text\" name=\"autovacuum_analyze_scale_factor\" value=\"{$old_val['autovacuum_analyze_scale_factor']}\" /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum_analyze_scale_factor']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['strvacuumcostdelay']}</th>\n";			echo "<td class=\"data1\"><input type=\"text\" name=\"autovacuum_vacuum_cost_delay\" value=\"{$old_val['autovacuum_vacuum_cost_delay']}\" /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum_vacuum_cost_delay']}</th></tr>\n";			echo "\t<tr><th class=\"data left\">{$lang['strvacuumcostlimit']}</th>\n";			echo "<td class=\"datat1\"><input type=\"text\" name=\"autovacuum_vacuum_cost_limit\" value=\"{$old_val['autovacuum_vacuum_cost_limit']}\" /></td>\n";			echo "<th class=\"data left\">{$defaults['autovacuum_vacuum_cost_limit']}</th></tr>\n";			echo "</table>\n";			echo "<br />";			echo "<br />";			echo "<input type=\"submit\" name=\"save\" value=\"{$lang['strsave']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else {			$status = $data->saveAutovacuum($_REQUEST['table'], $_POST['autovacuum_enabled'], $_POST['autovacuum_vacuum_threshold'], 				$_POST['autovacuum_vacuum_scale_factor'], $_POST['autovacuum_analyze_threshold'], $_POST['autovacuum_analyze_scale_factor'],				$_POST['autovacuum_vacuum_cost_delay'], $_POST['autovacuum_vacuum_cost_limit']);						if ($status == 0)				doAdmin($type, '', sprintf($lang['strsetvacuumtablesaved'], $_REQUEST['table']));			else				doEditAutovacuum($type, true, $lang['strsetvacuumtablefail']);		}	}		/**	 * confirm drop autovacuum params for a table and drop it	 */	function doDropAutovacuum($type, $confirm) {		global $script, $data, $misc, $lang;		if (empty($_REQUEST['table'])) {			doAdmin($type, '', $lang['strspecifydelvacuumtable']);			return;		}				if ($confirm) {			$misc->printTrail($type);			$misc->printTabs($type,'admin');						$script = ($type == 'database')? 'database.php' : 'tables.php';			printf("<p>{$lang['strdelvacuumtable']}</p>\n", 				$misc->printVal("\"{$_GET['schema']}"."{$_GET['table']}\""));			echo "<form style=\"float: left\" action=\"{$script}\" method=\"post\">\n";			echo "<input type=\"hidden\" name=\"action\" value=\"delautovac\" />\n";			echo $misc->form;			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";			echo "<input type=\"hidden\" name=\"rel\" value=\"", htmlspecialchars(serialize(array($_REQUEST['schema'], $_REQUEST['table']))), "\" />\n";			echo "<input type=\"submit\" name=\"yes\" value=\"{$lang['stryes']}\" />\n";			echo "</form>\n";						echo "<form action=\"{$script}\" method=\"post\">\n";			echo "<input type=\"hidden\" name=\"action\" value=\"admin\" />\n";			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['table']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" name=\"no\" value=\"{$lang['strno']}\" />\n";			echo "</form>\n";		}		else {						$status = $data->dropAutovacuum($_POST['table']);						if ($status == 0) {				doAdmin($type, '', sprintf($lang['strvacuumtablereset'], $misc->printVal($_POST['table'])));			}			else				doAdmin($type, '', sprintf($lang['strdelvacuumtablefail'], $misc->printVal($_POST['table'])));		}	}	/**	 * database/table administration and tuning tasks	 *	 * $Id: admin.php	 */		function doAdmin($type, $msg = '') {		global $script, $data, $misc, $lang;			$misc->printTrail($type);		$misc->printTabs($type,'admin');		$misc->printMsg($msg);				if ($type == 'database')			printf("<p>{$lang['stradminondatabase']}</p>\n", $misc->printVal($_REQUEST['object']));		else			printf("<p>{$lang['stradminontable']}</p>\n", $misc->printVal($_REQUEST['object']));				echo "<table style=\"width: 50%\">\n";		echo "<tr>\n";		echo "<th class=\"data\">";		$misc->printHelp($lang['strvacuum'],'pg.admin.vacuum')."</th>\n";		echo "</th>";		echo "<th class=\"data\">";		$misc->printHelp($lang['stranalyze'],'pg.admin.analyze');		echo "</th>";		if ($data->hasRecluster()){			echo "<th class=\"data\">";			$misc->printHelp($lang['strclusterindex'],'pg.index.cluster');			echo "</th>";		}		echo "<th class=\"data\">";		$misc->printHelp($lang['strreindex'],'pg.index.reindex');		echo "</th>";		echo "</tr>";			// Vacuum		echo "<tr class=\"row1\">\n";		echo "<td style=\"text-align: center; vertical-align: bottom\">\n";		echo "<form action=\"{$script}\" method=\"post\">\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"confirm_vacuum\" />\n";		echo $misc->form;		if ($type == 'table') {			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";			echo "<input type=\"hidden\" name=\"subject\" value=\"table\" />\n";		}		echo "<input type=\"submit\" value=\"{$lang['strvacuum']}\" /></p>\n";		echo "</form>\n";										echo "</td>\n";		// Analyze		echo "<td style=\"text-align: center; vertical-align: bottom\">\n";		echo "<form action=\"{$script}\" method=\"post\">\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"confirm_analyze\" />\n";		echo $misc->form;		if ($type == 'table') {			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";			echo "<input type=\"hidden\" name=\"subject\" value=\"table\" />\n";		}		echo "<input type=\"submit\" value=\"{$lang['stranalyze']}\" /></p>\n";		echo "</form>\n";		echo "</td>\n";				// Cluster		if ($data->hasRecluster()){			$disabled = '';			echo "<td style=\"text-align: center; vertical-align: bottom\">\n";			echo "<form action=\"{$script}\" method=\"post\">\n";			echo $misc->form;			if ($type == 'table') {				echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";				echo "<input type=\"hidden\" name=\"subject\" value=\"table\" />\n";				if (!$data->alreadyClustered($_REQUEST['object'])) {					$disabled = 'disabled="disabled" ';					echo "{$lang['strnoclusteravailable']}<br />";				}			}			echo "<p><input type=\"hidden\" name=\"action\" value=\"confirm_cluster\" />\n";			echo "<input type=\"submit\" value=\"{$lang['strclusterindex']}\" $disabled/></p>\n";			echo "</form>\n";			echo "</td>\n";		}				// Reindex		echo "<td style=\"text-align: center; vertical-align: bottom\">\n";		echo "<form action=\"{$script}\" method=\"post\">\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"confirm_reindex\" />\n";		echo $misc->form;		if ($type == 'table') {			echo "<input type=\"hidden\" name=\"table\" value=\"", htmlspecialchars($_REQUEST['object']), "\" />\n";			echo "<input type=\"hidden\" name=\"subject\" value=\"table\" />\n";		}		echo "<input type=\"submit\" value=\"{$lang['strreindex']}\" /></p>\n";		echo "</form>\n";		echo "</td>\n";		echo "</tr>\n";		echo "</table>\n";		// Autovacuum		if($data->hasAutovacuum()) {			// get defaults values for autovacuum			$defaults = $data->getAutovacuum();			// Fetch the autovacuum properties from the database or table if != ''			if ($type == 'table') $autovac = $data->getTableAutovacuum($_REQUEST['table']);			else $autovac = $data->getTableAutovacuum();			echo "<br /><br /><h2>{$lang['strvacuumpertable']}</h2>";			echo '<p>' . (($defaults['autovacuum'] == 'on') ? $lang['strturnedon'] : $lang['strturnedoff'] ) . '</p>';			echo "<p class=\"message\">{$lang['strnotdefaultinred']}</p>";						function enlight($f, $p) {				if ( isset($f[$p[0]]) and ($f[$p[0]] != $p[1]))					return "<span style=\"color:#F33;font-weight:bold\">". htmlspecialchars($f[$p[0]]) ."</span>";				return htmlspecialchars($p[1]);			}						$columns = array(				'namespace' => array(					'title' => $lang['strschema'],					'field' => field('nspname'),					'url'   => "redirect.php?subject=schema&amp;{$misc->href}&amp;",					'vars'  => array('schema' => 'nspname'),				),					'relname' => array(					'title' => $lang['strtable'],					'field' => field('relname'),					'url'	=> "redirect.php?subject=table&amp;{$misc->href}&amp;",					'vars'  => array('table' => 'relname', 'schema' => 'nspname'),				),				'autovacuum_enabled' => array(					'title' => $lang['strenabled'],					'field' => callback('enlight', array('autovacuum_enabled', $defaults['autovacuum'])),					'type' => 'verbatim'				),				'autovacuum_vacuum_threshold' => array(					'title' => $lang['strvacuumbasethreshold'],					'field' => callback('enlight', array('autovacuum_vacuum_threshold', $defaults['autovacuum_vacuum_threshold'])),					'type' => 'verbatim'				),				'autovacuum_vacuum_scale_factor' => array(					'title' => $lang['strvacuumscalefactor'],					'field' => callback('enlight', array('autovacuum_vacuum_scale_factor', $defaults['autovacuum_vacuum_scale_factor'])),					'type' => 'verbatim'				),				'autovacuum_analyze_threshold' => array(					'title' => $lang['stranalybasethreshold'],					'field' => callback('enlight', array('autovacuum_analyze_threshold', $defaults['autovacuum_analyze_threshold'])),					'type' => 'verbatim'				),				'autovacuum_analyze_scale_factor' => array(					'title' => $lang['stranalyzescalefactor'],					'field' => callback('enlight', array('autovacuum_analyze_scale_factor', $defaults['autovacuum_analyze_scale_factor'])),					'type' => 'verbatim'				),				'autovacuum_vacuum_cost_delay' => array(					'title' => $lang['strvacuumcostdelay'],					'field' => concat(callback('enlight', array('autovacuum_vacuum_cost_delay', $defaults['autovacuum_vacuum_cost_delay'])), 'ms'),					'type' => 'verbatim'				),				'autovacuum_vacuum_cost_limit' => array(					'title' => $lang['strvacuumcostlimit'],					'field' => callback('enlight', array('autovacuum_vacuum_cost_limit', $defaults['autovacuum_vacuum_cost_limit'])),					'type' => 'verbatim'				),			);						// Maybe we need to check permissions here?			$columns['actions'] = array('title' => $lang['stractions']);			$actions = array(				'edit' => array(					'title' => $lang['stredit'],					'url'   => "{$script}?action=confeditautovac&amp;{$misc->href}&amp;subject={$type}&amp;",					'vars'  => array(						'schema' => 'nspname',						'table' => 'relname'					)				),				'delete' => array(					'title' => $lang['strdelete'],					'url'   => "{$script}?action=confdelautovac&amp;{$misc->href}&amp;subject={$type}&amp;",					'vars'  => array(						'schema' => 'nspname',						'table' => 'relname'					)				)			);						if ($type == 'table') {				unset($actions['edit']['vars']['schema'], 					$actions['delete']['vars']['schema'],					$columns['namespace'],					$columns['relname']				);			}			$misc->printTable($autovac, $columns, $actions, $lang['strnovacuumconf']);						if (($type == 'table') and ($autovac->recordCount() == 0)) {				echo "<br />";				echo "<a href=\"tables.php?action=confeditautovac&amp;{$misc->href}&amp;table=", htmlspecialchars($_REQUEST['table'])					,"\">{$lang['straddvacuumtable']}</a>";			}		}	}		function adminActions($action, $type) {		global $script;				if ($type == 'database') {			$_REQUEST['object'] = $_REQUEST['database'];			$script = 'database.php';		}		else {			// $_REQUEST['table'] is no set if we are in the schema page			$_REQUEST['object'] = (isset($_REQUEST['table']) ? $_REQUEST['table']:'');			$script = 'tables.php';		}		switch ($action) {			case 'confirm_cluster':				doCluster($type, true);				break;			case 'confirm_reindex':				doReindex($type, true);				break;			case 'confirm_analyze':				doAnalyze($type, true);				break;			case 'confirm_vacuum':				doVacuum($type, true);				break;			case 'cluster':				if (isset($_POST['cluster'])) doCluster($type);				// if multi-action from table canceled: back to the schema default page				else if (($type == 'table') && is_array($_REQUEST['object']) ) doDefault();				else doAdmin($type);				break;			case 'reindex':				if (isset($_POST['reindex'])) doReindex($type);				// if multi-action from table canceled: back to the schema default page				else if (($type == 'table') && is_array($_REQUEST['object']) ) doDefault();				else doAdmin($type);				break;			case 'analyze':				if (isset($_POST['analyze'])) doAnalyze($type);				// if multi-action from table canceled: back to the schema default page				else if (($type == 'table') && is_array($_REQUEST['object']) ) doDefault();				else doAdmin($type);				break;			case 'vacuum':				if (isset($_POST['vacuum'])) doVacuum($type);				// if multi-action from table canceled: back to the schema default page				else if (($type == 'table') && is_array($_REQUEST['object']) ) doDefault();				else doAdmin($type);				break;			case 'admin':				doAdmin($type);				break;			case 'confeditautovac':				doEditAutovacuum($type, true);				break;			case 'confdelautovac':				doDropAutovacuum($type, true);				break;			case 'confaddautovac':				doAddAutovacuum(true);				break;			case 'editautovac':				if (isset($_POST['save'])) doEditAutovacuum($type, false);				else doAdmin($type);				break;			case 'delautovac':				doDropAutovacuum($type, false);				break;			default:				return false;		}		return true;	}?>
<?php	/**	 * List views in a database	 *	 * $Id: viewproperties.php,v 1.34 2007/12/11 14:17:17 ioguix Exp $	 */	// Include application functions	include_once('./libraries/lib.inc.php');	$action = (isset($_REQUEST['action'])) ? $_REQUEST['action'] : '';	/** 	 * Function to save after editing a view	 */	function doSaveEdit() {		global $data, $lang;				$status = $data->setView($_POST['view'], $_POST['formDefinition'], $_POST['formComment']);		if ($status == 0)			doDefinition($lang['strviewupdated']);		else			doEdit($lang['strviewupdatedbad']);	}		/**	 * Function to allow editing of a view	 */	function doEdit($msg = '') {		global $data, $misc;		global $lang;				$misc->printTrail('view');		$misc->printTitle($lang['stredit'],'pg.view.alter');		$misc->printMsg($msg);				$viewdata = $data->getView($_REQUEST['view']);				if ($viewdata->recordCount() > 0) {						if (!isset($_POST['formDefinition'])) {				$_POST['formDefinition'] = $viewdata->fields['vwdefinition'];				$_POST['formComment'] = $viewdata->fields['relcomment'];			}						echo "<form action=\"viewproperties.php\" method=\"post\">\n";			echo "<table style=\"width: 100%\">\n";			echo "\t<tr>\n\t\t<th class=\"data left required\">{$lang['strdefinition']}</th>\n";			echo "\t\t<td class=\"data1\"><textarea style=\"width: 100%;\" rows=\"20\" cols=\"50\" name=\"formDefinition\">", 				htmlspecialchars($_POST['formDefinition']), "</textarea></td>\n\t</tr>\n";			echo "\t<tr>\n\t\t<th class=\"data left\">{$lang['strcomment']}</th>\n";			echo "\t\t<td class=\"data1\"><textarea rows=\"3\" cols=\"32\" name=\"formComment\">", 				htmlspecialchars($_POST['formComment']), "</textarea></td>\n\t</tr>\n";			echo "</table>\n";			echo "<p><input type=\"hidden\" name=\"action\" value=\"save_edit\" />\n";			echo "<input type=\"hidden\" name=\"view\" value=\"", htmlspecialchars($_REQUEST['view']), "\" />\n";			echo $misc->form;			echo "<input type=\"submit\" value=\"{$lang['stralter']}\" />\n";			echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";			echo "</form>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";	}	/** 	 * Allow the dumping of the data "in" a view	 * NOTE:: PostgreSQL doesn't currently support dumping the data in a view 	 *        so I have disabled the data related parts for now. In the future 	 *        we should allow it conditionally if it becomes supported.  This is 	 *        a SMOP since it is based on pg_dump version not backend version. 	 */	function doExport($msg = '') {		global $data, $misc;		global $lang;		$misc->printTrail('view');		$misc->printTabs('view','export');		$misc->printMsg($msg);		echo "<form action=\"dataexport.php\" method=\"post\">\n";		echo "<table>\n";		echo "<tr><th class=\"data\">{$lang['strformat']}</th><th class=\"data\" colspan=\"2\">{$lang['stroptions']}</th></tr>\n";		// Data only		echo "<!--\n";		echo "<tr><th class=\"data left\">";		echo "<input type=\"radio\" id=\"what1\" name=\"what\" value=\"dataonly\" /><label for=\"what1\">{$lang['strdataonly']}</label></th>\n";		echo "<td>{$lang['strformat']}</td>\n";		echo "<td><select name=\"d_format\" >\n";		echo "<option value=\"copy\">COPY</option>\n";		echo "<option value=\"sql\">SQL</option>\n";		echo "<option value=\"csv\">CSV</option>\n";		echo "<option value=\"tab\">{$lang['strtabbed']}</option>\n";		echo "<option value=\"html\">XHTML</option>\n";		echo "<option value=\"xml\">XML</option>\n";		echo "</select>\n</td>\n</tr>\n";		echo "-->\n";		// Structure only		echo "<tr><th class=\"data left\"><input type=\"radio\" id=\"what2\" name=\"what\" value=\"structureonly\" checked=\"checked\" /><label for=\"what2\">{$lang['strstructureonly']}</label></th>\n";		echo "<td><label for=\"s_clean\">{$lang['strdrop']}</label></td><td><input type=\"checkbox\" id=\"s_clean\" name=\"s_clean\" /></td>\n</tr>\n";		// Structure and data		echo "<!--\n";		echo "<tr><th class=\"data left\" rowspan=\"2\">";		echo "<input type=\"radio\" id=\"what3\" name=\"what\" value=\"structureanddata\" /><label for=\"what3\">{$lang['strstructureanddata']}</label></th>\n";		echo "<td>{$lang['strformat']}</td>\n";		echo "<td><select name=\"sd_format\">\n";		echo "<option value=\"copy\">COPY</option>\n";		echo "<option value=\"sql\">SQL</option>\n";		echo "</select>\n</td>\n</tr>\n";		echo "<td><label for=\"sd_clean\">{$lang['strdrop']}</label></td><td><input type=\"checkbox\" id=\"sd_clean\" name=\"sd_clean\" /></td>\n</tr>\n";		echo "-->\n";		echo "</table>\n";				echo "<h3>{$lang['stroptions']}</h3>\n";		echo "<p><input type=\"radio\" id=\"output1\" name=\"output\" value=\"show\" checked=\"checked\" /><label for=\"output1\">{$lang['strshow']}</label>\n";		echo "<br/><input type=\"radio\" id=\"output2\" name=\"output\" value=\"download\" /><label for=\"output2\">{$lang['strdownload']}</label></p>\n";		echo "<p><input type=\"hidden\" name=\"action\" value=\"export\" />\n";		echo $misc->form;		echo "<input type=\"hidden\" name=\"subject\" value=\"view\" />\n";		echo "<input type=\"hidden\" name=\"view\" value=\"", htmlspecialchars($_REQUEST['view']), "\" />\n";		echo "<input type=\"submit\" value=\"{$lang['strexport']}\" /></p>\n";		echo "</form>\n";	}	/**	 * Show definition for a view	 */	function doDefinition($msg = '') {		global $data, $misc;		global $lang;			// Get view		$vdata = $data->getView($_REQUEST['view']);		$misc->printTrail('view');		$misc->printTabs('view','definition');		$misc->printMsg($msg);				if ($vdata->recordCount() > 0) {			// Show comment if any			if ($vdata->fields['relcomment'] !== null)				echo "<p class=\"comment\">", $misc->printVal($vdata->fields['relcomment']), "</p>\n";			echo "<table style=\"width: 100%\">\n";			echo "<tr><th class=\"data\">{$lang['strdefinition']}</th></tr>\n";			echo "<tr><td class=\"data1\">", $misc->printVal($vdata->fields['vwdefinition']), "</td></tr>\n";			echo "</table>\n";		}		else echo "<p>{$lang['strnodata']}</p>\n";				echo "<p><a class=\"navlink\" href=\"viewproperties.php?action=edit&amp;{$misc->href}&amp;view=", 			urlencode($_REQUEST['view']), "\">{$lang['stralter']}</a></p>\n";	}	/**	 * Displays a screen where they can alter a column in a view	 */	function doProperties($msg = '') {		global $data, $misc;		global $lang;		if (!isset($_REQUEST['stage'])) $_REQUEST['stage'] = 1;		switch ($_REQUEST['stage']) {			case 1:				global $lang;				$misc->printTrail('column');				$misc->printTitle($lang['stralter'],'pg.column.alter'); 				$misc->printMsg($msg);				echo "<form action=\"viewproperties.php\" method=\"post\">\n";				// Output view header				echo "<table>\n";				echo "<tr><th class=\"data required\">{$lang['strname']}</th><th class=\"data required\">{$lang['strtype']}</th>";				echo "<th class=\"data\">{$lang['strdefault']}</th><th class=\"data\">{$lang['strcomment']}</th></tr>";				$column = $data->getTableAttributes($_REQUEST['view'], $_REQUEST['column']);				if (!isset($_REQUEST['default'])) {					$_REQUEST['field'] = $column->fields['attname'];					$_REQUEST['default'] = $_REQUEST['olddefault'] = $column->fields['adsrc'];					$_REQUEST['comment'] = $column->fields['comment'];				}				echo "<tr><td><input name=\"field\" size=\"32\" value=\"",					htmlspecialchars($_REQUEST['field']), "\" /></td>";								echo "<td>", $misc->printVal($data->formatType($column->fields['type'], $column->fields['atttypmod'])), "</td>";				echo "<td><input name=\"default\" size=\"20\" value=\"", 					htmlspecialchars($_REQUEST['default']), "\" /></td>";				echo "<td><input name=\"comment\" size=\"32\" value=\"", 					htmlspecialchars($_REQUEST['comment']), "\" /></td>";								echo "</table>\n";				echo "<p><input type=\"hidden\" name=\"action\" value=\"properties\" />\n";				echo "<input type=\"hidden\" name=\"stage\" value=\"2\" />\n";				echo $misc->form;				echo "<input type=\"hidden\" name=\"view\" value=\"", htmlspecialchars($_REQUEST['view']), "\" />\n";				echo "<input type=\"hidden\" name=\"column\" value=\"", htmlspecialchars($_REQUEST['column']), "\" />\n";				echo "<input type=\"hidden\" name=\"olddefault\" value=\"", htmlspecialchars($_REQUEST['olddefault']), "\" />\n";				echo "<input type=\"submit\" value=\"{$lang['stralter']}\" />\n";				echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";												break;			case 2:				global $data, $lang;				// Check inputs				if (trim($_REQUEST['field']) == '') {					$_REQUEST['stage'] = 1;					doProperties($lang['strcolneedsname']);					return;				}								// Alter the view column				$status = $data->alterColumn($_REQUEST['view'], $_REQUEST['column'], $_REQUEST['field'], 							     false, false, $_REQUEST['default'], $_REQUEST['olddefault'],							     '', '', '', '', $_REQUEST['comment']);				if ($status == 0)					doDefault($lang['strcolumnaltered']);				else {					$_REQUEST['stage'] = 1;					doProperties($lang['strcolumnalteredbad']);					return;				}				break;			default:				echo "<p>{$lang['strinvalidparam']}</p>\n";		}	}	function doAlter($confirm = false, $msg = '') {		if ($confirm) {			global $data, $misc, $lang;			$misc->printTrail('view');			$misc->printTitle($lang['stralter'], 'pg.view.alter');			$misc->printMsg($msg);			// Fetch view info			$view = $data->getView($_REQUEST['view']);			if ($view->recordCount() > 0) {				if (!isset($_POST['name'])) $_POST['name'] = $view->fields['relname'];	            if (!isset($_POST['owner'])) $_POST['owner'] = $view->fields['relowner'];	            if (!isset($_POST['newschema'])) $_POST['newschema'] = $view->fields['nspname'];				if (!isset($_POST['comment'])) $_POST['comment'] = $view->fields['relcomment'];				echo "<form action=\"viewproperties.php\" method=\"post\">\n";				echo "<table>\n";	            echo "<tr><th class=\"data left required\">{$lang['strname']}</th>\n";				echo "<td class=\"data1\">";				echo "<input name=\"name\" size=\"32\" maxlength=\"{$data->_maxNameLen}\" value=\"",					htmlspecialchars($_POST['name']), "\" /></td></tr>\n";				$server_info = $misc->getServerInfo();				if ($data->isSuperUser($server_info['username'])) {					// Fetch all users					$users = $data->getUsers();					echo "<tr><th class=\"data left required\">{$lang['strowner']}</th>\n";					echo "<td class=\"data1\"><select name=\"owner\">";					while (!$users->EOF) {						$uname = $users->fields['usename'];						echo "<option value=\"", htmlspecialchars($uname), "\"",						($uname == $_POST['owner']) ? ' selected="selected"' : '', ">", htmlspecialchars($uname), "</option>\n";						$users->moveNext();					}					echo "</select></td></tr>\n";				}				if ($data->hasAlterTableSchema()) {					$schemas = $data->getSchemas();					echo "<tr><th class=\"data left required\">{$lang['strschema']}</th>\n";					echo "<td class=\"data1\"><select name=\"newschema\">";					while (!$schemas->EOF) {						$schema = $schemas->fields['nspname'];						echo "<option value=\"", htmlspecialchars($schema), "\"",							($schema == $_POST['newschema']) ? ' selected="selected"' : '', ">", htmlspecialchars($schema), "</option>\n";						$schemas->moveNext();					}					echo "</select></td></tr>\n";				}								echo "<tr><th class=\"data left\">{$lang['strcomment']}</th>\n";				echo "<td class=\"data1\">";				echo "<textarea rows=\"3\" cols=\"32\" name=\"comment\">",	                htmlspecialchars($_POST['comment']), "</textarea></td></tr>\n";				echo "</table>\n";				echo "<input type=\"hidden\" name=\"action\" value=\"alter\" />\n";				echo "<input type=\"hidden\" name=\"view\" value=\"", htmlspecialchars($_REQUEST['view']), "\" />\n";				echo $misc->form;				echo "<p><input type=\"submit\" name=\"alter\" value=\"{$lang['stralter']}\" />\n";	            echo "<input type=\"submit\" name=\"cancel\" value=\"{$lang['strcancel']}\" /></p>\n";				echo "</form>\n";			}			else echo "<p>{$lang['strnodata']}</p>\n";		}		else{			global $data, $lang, $_reload_browser, $misc;			// For databases that don't allow owner change	        if (!isset($_POST['owner'])) $_POST['owner'] = '';	        if (!isset($_POST['newschema'])) $_POST['newschema'] = null;			$status = $data->alterView($_POST['view'], $_POST['name'], $_POST['owner'], $_POST['newschema'], $_POST['comment']);			if ($status == 0) {				// If view has been renamed, need to change to the new name and				// reload the browser frame.				if ($_POST['view'] != $_POST['name']) {					// Jump them to the new view name					$_REQUEST['view'] = $_POST['name'];	                // Force a browser reload					$_reload_browser = true;				}				// If schema has changed, need to change to the new schema and reload the browser				if (!empty($_POST['newschema']) && ($_POST['newschema'] != $data->_schema)) {					// Jump them to the new sequence schema					$misc->setCurrentSchema($_POST['newschema']);					$_reload_browser = true;				}				doDefault($lang['strviewaltered']);			}			else doAlter(true, $lang['strviewalteredbad']);		}	}	function doTree () {		global $misc, $data;		$reqvars = $misc->getRequestVars('column');		$columns = $data->getTableAttributes($_REQUEST['view']);				$attrs = array (			'text'   => field('attname'),			'action' => url('colproperties.php',							$reqvars,							array(								'view'     => $_REQUEST['view'],								'column'    => field('attname')							)						),			'icon'   => 'Column',			'iconAction' => url('display.php',							$reqvars,							array(								'view'     => $_REQUEST['view'],								'column'    => field('attname'),								'query'     => replace(									'SELECT "%column%", count(*) AS "count" FROM %view% GROUP BY "%column%" ORDER BY "%column%"',									array (										'%column%' => field('attname'),										'%view%' => $_REQUEST['view']									)								)							)			),			'toolTip'=> field('comment')		);		$misc->printTreeXML($columns, $attrs);		exit;	}	if ($action == 'tree') doTree();	/**	 * Show view definition and virtual columns	 */	function doDefault($msg = '') {		global $data, $misc;		global $lang;				function attPre(&$rowdata) {			global $data;			$rowdata->fields['+type'] = $data->formatType($rowdata->fields['type'], $rowdata->fields['atttypmod']);		}				$misc->printTrail('view');		$misc->printTabs('view','columns');		$misc->printMsg($msg);		// Get view		$vdata = $data->getView($_REQUEST['view']);		// Get columns (using same method for getting a view)		$attrs = $data->getTableAttributes($_REQUEST['view']);				// Show comment if any		if ($vdata->fields['relcomment'] !== null)			echo "<p class=\"comment\">", $misc->printVal($vdata->fields['relcomment']), "</p>\n";		$columns = array(			'column' => array(				'title' => $lang['strcolumn'],				'field' => field('attname'),			),			'type' => array(				'title' => $lang['strtype'],				'field' => field('+type'),			),			'default' => array(				'title' => $lang['strdefault'],				'field' => field('adsrc'),			),			'actions' => array(				'title' => $lang['stractions'],			),			'comment' => array(				'title' => $lang['strcomment'],				'field' => field('comment'),			),		);				$actions = array(			'alter' => array(				'title' => $lang['stralter'],				'url'   => "viewproperties.php?action=properties&amp;{$misc->href}&amp;view=".urlencode($_REQUEST['view'])."&amp;",				'vars'  => array('column' => 'attname'),			),		);				$misc->printTable($attrs, $columns, $actions, null, 'attPre');			echo "<br />\n";		echo "<ul class=\"navlink\">\n";		$return_url = urlencode("viewproperties.php?{$misc->href}&amp;view=" . urlencode($_REQUEST['view']));		echo "\t<li><a href=\"display.php?{$misc->href}&amp;view=", urlencode($_REQUEST['view']), "&amp;subject=view&amp;return_url={$return_url}&amp;return_desc=",			urlencode($lang['strback']), "\">{$lang['strbrowse']}</a></li>\n";		echo "\t<li><a href=\"views.php?action=confselectrows&amp;{$misc->href}&amp;view=", urlencode($_REQUEST['view']),"\">{$lang['strselect']}</a></li>\n";		echo "\t<li><a href=\"views.php?action=confirm_drop&amp;{$misc->href}&amp;view=", urlencode($_REQUEST['view']),"\">{$lang['strdrop']}</a></li>\n";		echo "\t<li><a href=\"viewproperties.php?action=confirm_alter&amp;{$misc->href}&amp;view=", urlencode($_REQUEST['view']),"\">{$lang['stralter']}</a></li>\n";		echo "</ul>\n";	}	$misc->printHeader($lang['strviews'] . ' - ' . $_REQUEST['view']);	$misc->printBody();	switch ($action) {		case 'save_edit':			if (isset($_POST['cancel'])) doDefinition();			else doSaveEdit();			break;		case 'edit':			doEdit();			break;		case 'export':			doExport();			break;		case 'definition':			doDefinition();			break;		case 'properties':			if (isset($_POST['cancel'])) doDefault();			else doProperties();			break;		case 'alter':			if (isset($_POST['alter'])) doAlter(false);			else doDefault();			break;		case 'confirm_alter':			doAlter(true);			break;		case 'drop':			if (isset($_POST['drop'])) doDrop(false);			else doDefault();			break;		case 'confirm_drop':			doDrop(true);			break;		default:			doDefault();			break;	}		$misc->printFooter();?>

<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * * @package PhpMyAdmin *//** * */require_once './libraries/common.inc.php';/** * Does the common work */$GLOBALS['js_include'][] = 'server_privileges.js';$GLOBALS['js_include'][] = 'replication.js';require './libraries/server_common.inc.php';require './libraries/replication.inc.php';require './libraries/replication_gui.lib.php';require_once './libraries/server_synchronize.lib.php';/** * Checks if the user is allowed to do what he tries to... */if (! $is_superuser) {    include './libraries/server_links.inc.php';    echo '<h2>' . "\n"        . PMA_getIcon('s_replication.png')        . __('Replication') . "\n"        . '</h2>' . "\n";    PMA_Message::error(__('No Privileges'))->display();    include './libraries/footer.inc.php';}/** * Handling control requests */if (isset($GLOBALS['sr_take_action'])) {    $refresh = false;    if (isset($GLOBALS['slave_changemaster'])) {        $_SESSION['replication']['m_username'] = $sr['username'] = PMA_sqlAddSlashes($GLOBALS['username']);        $_SESSION['replication']['m_password'] = $sr['pma_pw']   = PMA_sqlAddSlashes($GLOBALS['pma_pw']);        $_SESSION['replication']['m_hostname'] = $sr['hostname'] = PMA_sqlAddSlashes($GLOBALS['hostname']);        $_SESSION['replication']['m_port']     = $sr['port']     = PMA_sqlAddSlashes($GLOBALS['port']);        $_SESSION['replication']['m_correct']  = '';        $_SESSION['replication']['sr_action_status'] = 'error';        $_SESSION['replication']['sr_action_info'] = __('Unknown error');        // Attempt to connect to the new master server        $link_to_master = PMA_replication_connect_to_master($sr['username'], $sr['pma_pw'], $sr['hostname'], $sr['port']);        if (! $link_to_master) {            $_SESSION['replication']['sr_action_status'] = 'error';            $_SESSION['replication']['sr_action_info'] = sprintf(__('Unable to connect to master %s.'), htmlspecialchars($sr['hostname']));        } else {            // Read the current master position            $position = PMA_replication_slave_bin_log_master($link_to_master);            if (empty($position)) {                $_SESSION['replication']['sr_action_status'] = 'error';                $_SESSION['replication']['sr_action_info'] = __('Unable to read master log position. Possible privilege problem on master.');            } else {                $_SESSION['replication']['m_correct']  = true;                if (! PMA_replication_slave_change_master($sr['username'], $sr['pma_pw'], $sr['hostname'], $sr['port'], $position, true, false)) {                    $_SESSION['replication']['sr_action_status'] = 'error';                    $_SESSION['replication']['sr_action_info'] = __('Unable to change master');                } else {                    $_SESSION['replication']['sr_action_status'] = 'success';                    $_SESSION['replication']['sr_action_info'] = sprintf(__('Master server changed successfully to %s'), htmlspecialchars($sr['hostname']));                }            }        }    } elseif (isset($GLOBALS['sr_slave_server_control'])) {        if ($GLOBALS['sr_slave_action'] == 'reset') {            PMA_replication_slave_control("STOP");            PMA_DBI_try_query("RESET SLAVE;");            PMA_replication_slave_control("START");        } else {            PMA_replication_slave_control($GLOBALS['sr_slave_action'], $GLOBALS['sr_slave_control_parm']);        }        $refresh = true;    } elseif (isset($GLOBALS['sr_slave_skip_error'])) {        $count = 1;        if (isset($GLOBALS['sr_skip_errors_count'])) {            $count = $GLOBALS['sr_skip_errors_count'] * 1;        }        PMA_replication_slave_control("STOP");        PMA_DBI_try_query("SET GLOBAL SQL_SLAVE_SKIP_COUNTER = ".$count.";");        PMA_replication_slave_control("START");    } elseif (isset($GLOBALS['sl_sync'])) {        // TODO username, host and port could be read from 'show slave status',        // when asked for a password this might work in more situations then just after changing master (where the master password is stored in session)        $src_link = PMA_replication_connect_to_master($_SESSION['replication']['m_username'], $_SESSION['replication']['m_password'], $_SESSION['replication']['m_hostname'], $_SESSION['replication']['m_port']);        $trg_link = null; // using null to indicate the current PMA server        $data = PMA_DBI_fetch_result('SHOW MASTER STATUS', null, null, $src_link); // let's find out, which databases are replicated        $do_db     = array();        $ignore_db = array();        $dblist    = array();        if (! empty($data[0]['Binlog_Do_DB'])) {            $do_db     = explode(',', $data[0]['Binlog_Do_DB']);        }        if (! empty($data[0]['Binlog_Ignore_DB'])) {            $ignore_db = explode(',', $data[0]['Binlog_Ignore_DB']);        }        $tmp_alldbs = PMA_DBI_query('SHOW DATABASES;', $src_link);        while ($tmp_row = PMA_DBI_fetch_row($tmp_alldbs)) {            if (PMA_is_system_schema($tmp_row[0])) {                continue;            }            if (count($do_db) == 0) {                if (array_search($tmp_row[0], $ignore_db) !== false) {                    continue;                }                $dblist[] = $tmp_row[0];                PMA_DBI_query('CREATE DATABASE IF NOT EXISTS '.PMA_backquote($tmp_row[0]), $trg_link);            } else {                if (array_search($tmp_row[0], $do_db) !== false) {                    $dblist[] = $tmp_row[0];                    PMA_DBI_query('CREATE DATABASE IF NOT EXISTS '.PMA_backquote($tmp_row[0]), $trg_link);                }            }        } // end while        unset($do_db, $ignore_db, $data);        if (isset($GLOBALS['repl_data'])) {            $include_data = true;        } else {            $include_data = false;        }        foreach ($dblist as $db) {            PMA_replication_synchronize_db($db, $src_link, $trg_link, $include_data);        }        // TODO some form of user feedback error/success would be nice        //  What happens if $dblist is empty?        //  or sync failed?    }    if ($refresh) {        Header("Location: ". PMA_generate_common_url($GLOBALS['url_params']));    }    unset($refresh);}/** * Displays the links */require './libraries/server_links.inc.php';echo '<div id="replication">';echo ' <h2>';echo '   ' . PMA_getImage('s_replication.png');echo     __('Replication');echo ' </h2>';// Display error messagesif (isset($_SESSION['replication']['sr_action_status']) && isset($_SESSION['replication']['sr_action_info'])) {    if ($_SESSION['replication']['sr_action_status'] == 'error') {        PMA_Message::error($_SESSION['replication']['sr_action_info'])->display();        $_SESSION['replication']['sr_action_status'] = 'unknown';    } elseif ($_SESSION['replication']['sr_action_status'] == 'success') {        PMA_Message::success($_SESSION['replication']['sr_action_info'])->display();        $_SESSION['replication']['sr_action_status'] = 'unknown';    }}if ($server_master_status) {    if (! isset($GLOBALS['repl_clear_scr'])) {        echo '<fieldset>';        echo '<legend>' . __('Master replication') . '</legend>';        echo __('This server is configured as master in a replication process.');        echo '<ul>';        echo '  <li><a href="#" id="master_status_href">' . __('Show master status') . '</a></li>';        PMA_replication_print_status_table('master', true, false);        echo '  <li><a href="#" id="master_slaves_href">' . __('Show connected slaves') . '</a></li>';        PMA_replication_print_slaves_table(true);        $_url_params = $GLOBALS['url_params'];        $_url_params['mr_adduser'] = true;        $_url_params['repl_clear_scr'] = true;        echo '  <li><a href="' . PMA_generate_common_url($_url_params) . '" id="master_addslaveuser_href">' . __('Add slave replication user') . '</a></li>';    }    // Display 'Add replication slave user' form    if (isset($GLOBALS['mr_adduser'])) {        PMA_replication_gui_master_addslaveuser();    } elseif (! isset($GLOBALS['repl_clear_scr'])) {        echo "</ul>";        echo "</fieldset>";    }} elseif (! isset($GLOBALS['mr_configure']) && ! isset($GLOBALS['repl_clear_scr'])) {    $_url_params = $GLOBALS['url_params'];    $_url_params['mr_configure'] = true;    echo '<fieldset>';    echo '<legend>' . __('Master replication') . '</legend>';    echo sprintf(__('This server is not configured as master in a replication process. Would you like to <a href="%s">configure</a> it?'), PMA_generate_common_url($_url_params));    echo '</fieldset>';}if (isset($GLOBALS['mr_configure'])) {    // Render the 'Master configuration' section    echo '<fieldset>';    echo '<legend>' . __('Master configuration') . '</legend>';    echo __('This server is not configured as master server in a replication process. You can choose from either replicating all databases and ignoring certain (useful if you want to replicate majority of databases) or you can choose to ignore all databases by default and allow only certain databases to be replicated. Please select the mode:') . '<br /><br />';    echo '<select name="db_type" id="db_type">';    echo '<option value="all">' . __('Replicate all databases; Ignore:') . '</option>';    echo '<option value="ign">' . __('Ignore all databases; Replicate:') . '</option>';    echo '</select>';    echo '<br /><br />';    echo __('Please select databases:') . '<br />';    echo PMA_replication_db_multibox();    echo '<br /><br />';    echo __('Now, add the following lines at the end of [mysqld] section in your my.cnf and please restart the MySQL server afterwards.') . '<br />';    echo '<pre id="rep"></pre>';    echo __('Once you restarted MySQL server, please click on Go button. Afterwards, you should see a message informing you, that this server <b>is</b> configured as master');    echo '</fieldset>';    echo '<fieldset class="tblFooters">';    echo ' <form method="post" action="server_replication.php" >';    echo PMA_generate_common_hidden_inputs('', '');    echo '  <input type="submit" value="' . __('Go') . '" id="goButton" />';    echo ' </form>';    echo '</fieldset>';    include './libraries/footer.inc.php';    exit;}echo '</div>';if (! isset($GLOBALS['repl_clear_scr'])) {    // Render the 'Slave configuration' section    echo '<fieldset>';    echo '<legend>' . __('Slave replication') . '</legend>';    if ($server_slave_status) {        echo '<div id="slave_configuration_gui">';        $_url_params = $GLOBALS['url_params'];        $_url_params['sr_take_action'] = true;        $_url_params['sr_slave_server_control'] = true;        if ($server_slave_replication[0]['Slave_IO_Running'] == 'No') {            $_url_params['sr_slave_action'] = 'start';        } else {            $_url_params['sr_slave_action'] = 'stop';        }        $_url_params['sr_slave_control_parm'] = 'IO_THREAD';        $slave_control_io_link = PMA_generate_common_url($_url_params);        if ($server_slave_replication[0]['Slave_SQL_Running'] == 'No') {            $_url_params['sr_slave_action'] = 'start';        } else {            $_url_params['sr_slave_action'] = 'stop';        }        $_url_params['sr_slave_control_parm'] = 'SQL_THREAD';        $slave_control_sql_link = PMA_generate_common_url($_url_params);        if ($server_slave_replication[0]['Slave_IO_Running'] == 'No'            || $server_slave_replication[0]['Slave_SQL_Running'] == 'No'        ) {            $_url_params['sr_slave_action'] = 'start';        } else {            $_url_params['sr_slave_action'] = 'stop';        }        $_url_params['sr_slave_control_parm'] = null;        $slave_control_full_link = PMA_generate_common_url($_url_params);        $_url_params['sr_slave_action'] = 'reset';        $slave_control_reset_link = PMA_generate_common_url($_url_params);        $_url_params = $GLOBALS['url_params'];        $_url_params['sr_slave_skip_error'] = true;        $slave_skip_error_link = PMA_generate_common_url($_url_params);        if ($server_slave_replication[0]['Slave_SQL_Running'] == 'No') {            PMA_Message::error(__('Slave SQL Thread not running!'))->display();        }        if ($server_slave_replication[0]['Slave_IO_Running'] == 'No') {            PMA_Message::error(__('Slave IO Thread not running!'))->display();        }        $_url_params = $GLOBALS['url_params'];        $_url_params['sl_configure'] = true;        $_url_params['repl_clear_scr'] = true;        $reconfiguremaster_link = PMA_generate_common_url($_url_params);        echo __('Server is configured as slave in a replication process. Would you like to:');        echo '<br />';        echo '<ul>';        echo ' <li><a href="#" id="slave_status_href">' . __('See slave status table') . '</a></li>';        echo PMA_replication_print_status_table('slave', true, false);        if (isset($_SESSION['replication']['m_correct']) && $_SESSION['replication']['m_correct'] == true) {            echo ' <li><a href="#" id="slave_synchronization_href">' . __('Synchronize databases with master') . '</a></li>';            echo ' <div id="slave_synchronization_gui" style="display: none">';            echo '  <form method="post" action="server_replication.php">';            echo PMA_generate_common_hidden_inputs('', '');            echo '   <input type="checkbox" name="repl_struc" value="1" checked="checked" disabled="disabled" /> ' . __('Structure') . '<br />'; // this is just for vizualization, it has no other purpose            echo '   <input type="checkbox" name="repl_data"  value="1" checked="checked" /> ' . __('Data') .' <br />';            echo '   <input type="hidden" name="sr_take_action" value="1" />';            echo '   <input type="submit" name="sl_sync" value="' . __('Go') . '" />';            echo '  </form>';            echo ' </div>';        }        echo ' <li><a href="#" id="slave_control_href">' . __('Control slave:') . '</a>';        echo ' <div id="slave_control_gui" style="display: none">';        echo '  <ul>';        echo '   <li><a href="'. $slave_control_full_link . '">' . (($server_slave_replication[0]['Slave_IO_Running'] == 'No' || $server_slave_replication[0]['Slave_SQL_Running'] == 'No') ? __('Full start') : __('Full stop')) . ' </a></li>';        echo '   <li><a href="'. $slave_control_reset_link . '">' . __('Reset slave') . '</a></li>';        if ($server_slave_replication[0]['Slave_SQL_Running'] == 'No') {            echo '   <li><a href="' . $slave_control_sql_link . '">' . __('Start SQL Thread only') . '</a></li>';        } else {            echo '   <li><a href="' . $slave_control_sql_link . '">' . __('Stop SQL Thread only') . '</a></li>';        }        if ($server_slave_replication[0]['Slave_IO_Running'] == 'No') {            echo '   <li><a href="' . $slave_control_io_link . '">' . __('Start IO Thread only') . '</a></li>';        } else {            echo '   <li><a href="' . $slave_control_io_link . '">' . __('Stop IO Thread only') . '</a></li>';        }        echo '  </ul>';        echo ' </div>';        echo ' </li>';        echo ' <li><a href="#" id="slave_errormanagement_href">' . __('Error management:') . '</a>';        echo ' <div id="slave_errormanagement_gui" style="display: none">';        PMA_Message::error(__('Skipping errors might lead into unsynchronized master and slave!'))->display();        echo '  <ul>';        echo '   <li><a href="' . $slave_skip_error_link . '">' . __('Skip current error') . '</a></li>';        echo '   <li>' . __('Skip next');        echo '    <form method="post" action="server_replication.php">';        echo PMA_generate_common_hidden_inputs('', '');        echo '      <input type="text" name="sr_skip_errors_count" value="1" style="width: 30px" />' . __('errors.');        echo '              <input type="submit" name="sr_slave_skip_error" value="' . __('Go') . '" />';        echo '      <input type="hidden" name="sr_take_action" value="1" />';        echo '    </form></li>';        echo '  </ul>';        echo ' </div>';        echo ' </li>';        echo ' <li><a href="' . $reconfiguremaster_link . '">' . __('Change or reconfigure master server') . '</a></li>';        echo '</ul>';    } elseif (! isset($GLOBALS['sl_configure'])) {        $_url_params = $GLOBALS['url_params'];        $_url_params['sl_configure'] = true;        $_url_params['repl_clear_scr'] = true;        echo sprintf(__('This server is not configured as slave in a replication process. Would you like to <a href="%s">configure</a> it?'), PMA_generate_common_url($_url_params));    }    echo '</div>';    echo '</fieldset>';}if (isset($GLOBALS['sl_configure'])) {    PMA_replication_gui_changemaster("slave_changemaster");}require './libraries/footer.inc.php';?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package PhpMyAdmin-Engines *//** * Load BDB class. */require_once './libraries/engines/bdb.lib.php';/** * This is same as BDB. * @package PhpMyAdmin-Engines */class PMA_StorageEngine_berkeleydb extends PMA_StorageEngine_bdb{}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Set of functions used to build CSV dumps of tables for excel * * @package PhpMyAdmin-Export * @subpackage CSV-Excel */if (! defined('PHPMYADMIN')) {    exit;}/** * */if (isset($plugin_list)) {    $plugin_list['excel'] = array(        'text' => __('CSV for MS Excel'),        'extension' => 'csv',        'mime_type' => 'text/comma-separated-values',        'options' => array(            array('type' => 'begin_group', 'name' => 'general_opts'),            array('type' => 'text', 'name' => 'null', 'text' => __('Replace NULL with:')),            array('type' => 'bool', 'name' => 'removeCRLF', 'text' => __('Remove carriage return/line feed characters within columns')),            array('type' => 'bool', 'name' => 'columns', 'text' => __('Put columns names in the first row')),            array(                'type' => 'select',                'name' => 'edition',                'values' => array(                    'win' => 'Windows',                    'mac_excel2003' => 'Excel 2003 / Macintosh',                    'mac_excel2008' => 'Excel 2008 / Macintosh'),                'text' => __('Excel edition:')),            array('type' => 'hidden', 'name' => 'structure_or_data'),            array('type' => 'end_group'),            ),        'options_text' => __('Options'),        );} else {    /* Everything rest is coded in csv plugin */    include './libraries/export/csv.php';}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Server synchronisation functions. * * @package PhpMyAdmin *//** * Places matching tables in source and target databases in $matching_tables * array whereas $uncommon_source_tables array gets the tables present in * source database but are absent from target database.  Criterion for * matching tables is just comparing their names. * * @param array $trg_tables              array of target database table names, * @param array $src_tables              array of source database table names, * @param array &$matching_tables        empty array passed by reference to save *                                       names of matching tables, * @param array &$uncommon_source_tables empty array passed by reference to save *                                       names of tables present in source database *                                       but absent from target database */function PMA_getMatchingTables($trg_tables, $src_tables, &$matching_tables, &$uncommon_source_tables){    for ($k=0; $k< sizeof($src_tables); $k++) {        $present_in_target = false;        for ($l=0; $l < sizeof($trg_tables); $l++) {            if ($src_tables[$k] === $trg_tables[$l]) {                $present_in_target = true;                $matching_tables[] = $src_tables[$k];            }        }        if ($present_in_target === false) {            $uncommon_source_tables[] = $src_tables[$k];        }    }}/** * Places tables present in target database but are absent from source database * * @param array $trg_tables              array of target database table names, * @param array $matching_tables         matching tables array containing names *                                       of matching tables, * @param array &$uncommon_target_tables empty array passed by reference to save *                                       names of tables presnet in target database *                                       but absent from source database */function PMA_getNonMatchingTargetTables($trg_tables, $matching_tables, &$uncommon_target_tables){    for ($c=0; $c<sizeof($trg_tables); $c++) {        $match = false;        for ($d=0; $d < sizeof($matching_tables); $d++) {            if ($trg_tables[$c] === $matching_tables[$d]) {                $match=true;            }        }        if ($match === false) {            $uncommon_target_tables[] = $trg_tables[$c];        }    }}/** * Finds the difference in source and target matching tables by * first comparing source table's primary key entries with target table enteries. * It gets the field names for the matching table also for comparisons. * If the entry is found in target table also then it is checked for the remaining * field values also, in order to check whether update is required or not. * If update is required, it is placed in $update_array * Otherwise that entry is placed in the $insert_array. * * @param string  $src_db                  name of source database * @param string  $trg_db                  name of target database * @param db_link $src_link                connection established with source server * @param db_link $trg_link                connection established with target server * @param array   &$matching_table         array containing matching table names * @param array   &$matching_tables_fields A two dimensional array passed by reference to contain names of fields for each matching table * @param array   &$update_array           A three dimensional array passed by reference to *                                         contain updates required for each matching table * @param array   &$insert_array           A three dimensional array passed by reference to *                                         contain inserts required for each matching table * @param array   &$delete_array           Unused * @param array   &$fields_num             A two dimensional array passed by reference to *                                         contain number of fields for each matching table * @param int     $matching_table_index    Index of a table from $matching_table array * @param array   &$matching_tables_keys   A two dimensional array passed by reference to contain names of keys for each matching table */function PMA_dataDiffInTables($src_db, $trg_db, $src_link, $trg_link, &$matching_table, &$matching_tables_fields,    &$update_array, &$insert_array, &$delete_array, &$fields_num, $matching_table_index, &$matching_tables_keys){    if (isset($matching_table[$matching_table_index])) {        $fld = array();        $fld_results = PMA_DBI_get_columns($src_db, $matching_table[$matching_table_index], null, true, $src_link);        $is_key = array();        if (isset($fld_results)) {            foreach ($fld_results as $each_field) {                $field_name = $each_field['Field'];                if ($each_field['Key'] == 'PRI') {                    $is_key[] = $field_name;                }                $fld[] = $field_name;            }        }        $matching_tables_fields[$matching_table_index] = $fld;        $fields_num[$matching_table_index] = sizeof($fld);        $matching_tables_keys[$matching_table_index] = $is_key;        $source_result_set = PMA_get_column_values($src_db, $matching_table[$matching_table_index], $is_key, $src_link);        $source_size = sizeof($source_result_set);        $trg_fld_results = PMA_DBI_get_columns($trg_db, $matching_table[$matching_table_index], null, true, $trg_link);        $all_keys_match = true;        $trg_keys = array();        if (isset($trg_fld_results)) {            foreach ($trg_fld_results as $each_field) {                if ($each_field['Key'] == 'PRI') {                    $trg_keys[] = $each_field['Field'];                    if (! (in_array($each_field['Field'], $is_key))) {                        $all_keys_match = false;                    }                }            }        }        $update_row = 0;        $insert_row = 0;        for ($j = 0; $j < $source_size; $j++) {            $starting_index = 0;            $update_field = 0;            if (isset($source_result_set[$j]) && ($all_keys_match)) {                // Query the target server to see which rows already exist                $trg_select_query = "SELECT * FROM " . PMA_backquote($trg_db) . "."                    . PMA_backquote($matching_table[$matching_table_index]) . " WHERE ";                if (sizeof($is_key) == 1) {                    $trg_select_query .= PMA_backquote($is_key[0]). "='" . $source_result_set[$j] . "'";                } elseif (sizeof($is_key) > 1) {                    for ($k=0; $k < sizeof($is_key); $k++) {                        $trg_select_query .= PMA_backquote($is_key[$k]) . "='" . $source_result_set[$j][$is_key[$k]] . "'";                        if ($k < (sizeof($is_key)-1)) {                            $trg_select_query .= " AND ";                        }                    }                }                $target_result_set = PMA_DBI_fetch_result($trg_select_query, null, null, $trg_link);                if ($target_result_set) {                    // Fetch the row from the source server to do a comparison                    $src_select_query = "SELECT * FROM " . PMA_backquote($src_db) . "."                        . PMA_backquote($matching_table[$matching_table_index]) . " WHERE ";                    if (sizeof($is_key) == 1) {                        $src_select_query .= PMA_backquote($is_key[0]) . "='" . $source_result_set[$j] . "'";                    } elseif (sizeof($is_key) > 1) {                        for ($k=0; $k< sizeof($is_key); $k++) {                            $src_select_query .= PMA_backquote($is_key[$k]) . "='" . $source_result_set[$j][$is_key[$k]] . "'";                            if ($k < (sizeof($is_key) - 1)) {                                $src_select_query .= " AND ";                            }                        }                    }                    $src_result_set = PMA_DBI_fetch_result($src_select_query, null, null, $src_link);                    /**                    * Comparing each corresponding field of the source and target matching rows.                    * Placing the primary key, value of primary key, field to be updated, and the                    * new value of field to be updated in each row of the update array.                    */                    for ($m = 0; ($m < $fields_num[$matching_table_index]) && ($starting_index == 0) ; $m++) {                        if (isset($src_result_set[0][$fld[$m]])) {                            if (isset($target_result_set[0][$fld[$m]])) {                                if (($src_result_set[0][$fld[$m]] != $target_result_set[0][$fld[$m]]) && (! (in_array($fld[$m], $is_key)))) {                                    if (sizeof($is_key) == 1) {                                        if ($source_result_set[$j]) {                                            $update_array[$matching_table_index][$update_row][$is_key[0]] = $source_result_set[$j];                                        }                                    } elseif (sizeof($is_key) > 1) {                                        for ($n=0; $n < sizeof($is_key); $n++) {                                            if (isset($src_result_set[0][$is_key[$n]])) {                                                $update_array[$matching_table_index][$update_row][$is_key[$n]] = $src_result_set[0][$is_key[$n]];                                            }                                        }                                    }                                    $update_array[$matching_table_index][$update_row][$update_field] = $fld[$m];                                    $update_field++;                                    if (isset($src_result_set[0][$fld[$m]])) {                                        $update_array[$matching_table_index][$update_row][$update_field] = $src_result_set[0][$fld[$m]];                                        $update_field++;                                    }                                    $starting_index = $m;                                    $update_row++;                                }                            } else {                                if (sizeof($is_key) == 1) {                                    if ($source_result_set[$j]) {                                        $update_array[$matching_table_index][$update_row][$is_key[0]] = $source_result_set[$j];                                    }                                } elseif (sizeof($is_key) > 1) {                                    for ($n = 0; $n < sizeof($is_key); $n++) {                                        if (isset($src_result_set[0][$is_key[$n]])) {                                            $update_array[$matching_table_index][$update_row][$is_key[$n]] = $src_result_set[0][$is_key[$n]];                                        }                                    }                                }                                $update_array[$matching_table_index][$update_row][$update_field] = $fld[$m];                                $update_field++;                                if (isset($src_result_set[0][$fld[$m]])) {                                    $update_array[$matching_table_index][$update_row][$update_field] = $src_result_set[0][$fld[$m]];                                    $update_field++;                                }                                $starting_index = $m;                                $update_row++;                            }                        }                    }                    for ($m = $starting_index + 1; $m < $fields_num[$matching_table_index] ; $m++) {                        if (isset($src_result_set[0][$fld[$m]])) {                            if (isset($target_result_set[0][$fld[$m]])) {                                if (($src_result_set[0][$fld[$m]] != $target_result_set[0][$fld[$m]]) && (!(in_array($fld[$m], $is_key)))) {                                    $update_row--;                                    $update_array[$matching_table_index][$update_row][$update_field] = $fld[$m];                                    $update_field++;                                    if ($src_result_set[0][$fld[$m]]) {                                        $update_array[$matching_table_index][$update_row][$update_field] = $src_result_set[0][$fld[$m]];                                        $update_field++;                                    }                                    $update_row++;                                }                            } else {                                $update_row--;                                $update_array[$matching_table_index][$update_row][$update_field] = $fld[$m];                                $update_field++;                                if ($src_result_set[0][$fld[$m]]) {                                    $update_array[$matching_table_index][$update_row][$update_field] = $src_result_set[0][$fld[$m]];                                    $update_field++;                                }                                $update_row++;                            }                        }                    }                } else {                    /**                     * Placing the primary key, and the value of primary key of the row that is to be inserted in the target table                     */                    if (sizeof($is_key) == 1) {                        if (isset($source_result_set[$j])) {                            $insert_array[$matching_table_index][$insert_row][$is_key[0]] = $source_result_set[$j];                        }                    } elseif (sizeof($is_key) > 1) {                        for ($l = 0; $l < sizeof($is_key); $l++) {                            if (isset($source_result_set[$j][$matching_tables_fields[$matching_table_index][$l]])) {                                $insert_array[$matching_table_index][$insert_row][$is_key[$l]] = $source_result_set[$j][$matching_tables_fields[$matching_table_index][$l]];                            }                        }                    }                    $insert_row++;                }            } else {                /**                 * Placing the primary key, and the value of primary key of the row that is to be inserted in the target table                 * This condition is met when there is an additional column in the source table                 */                if (sizeof($is_key) == 1) {                    if (isset($source_result_set[$j])) {                        $insert_array[$matching_table_index][$insert_row][$is_key[0]] = $source_result_set[$j];                    }                } elseif (sizeof($is_key) > 1) {                    for ($l = 0; $l < sizeof($is_key); $l++) {                        if (isset($source_result_set[$j][$matching_tables_fields[$matching_table_index][$l]])) {                            $insert_array[$matching_table_index][$insert_row][$is_key[$l]] = $source_result_set[$j][$matching_tables_fields[$matching_table_index][$l]];                        }                    }                }                $insert_row++;            }        } // for loop ends    }}/** * Finds the rows which are to be deleted from target table. * * @param array   &$delete_array        array containing rows that are to be deleted * @param array   $matching_table       array containing matching table names * @param int     $matching_table_index index of a table from $matching_table array * @param array   $trg_keys             array of target table keys * @param array   $src_keys             array of source table keys * @param string  $trg_db               name of target database * @param db_link $trg_link             connection established with target server * @param string  $src_db               name of source database * @param db_link $src_link             connection established with source server */function PMA_findDeleteRowsFromTargetTables(&$delete_array, $matching_table, $matching_table_index, $trg_keys, $src_keys, $trg_db, $trg_link, $src_db, $src_link){    if (isset($trg_keys[$matching_table_index])) {        $target_key_values = PMA_get_column_values($trg_db, $matching_table[$matching_table_index], $trg_keys[$matching_table_index], $trg_link);    }    if (isset($src_keys[$matching_table_index])) {        $source_key_values = PMA_get_column_values($src_db, $matching_table[$matching_table_index], $src_keys[$matching_table_index], $src_link);    }    $all_keys_match = 1;    for ($a = 0; $a < sizeof($trg_keys[$matching_table_index]); $a++) {        if (isset($trg_keys[$matching_table_index][$a])) {            if (! (in_array($trg_keys[$matching_table_index][$a], $src_keys[$matching_table_index]))) {                $all_keys_match = 0;            }        }    }    if (! ($all_keys_match)) {        if (isset($target_key_values)) {            $delete_array[$matching_table_index] = $target_key_values;        }    }    if (isset($trg_keys[$matching_table_index])) {        if ((sizeof($trg_keys[$matching_table_index]) == 1) && $all_keys_match) {            $row = 0;            if (isset($target_key_values)) {                for ($i = 0; $i < sizeof($target_key_values); $i++) {                    if (! (in_array($target_key_values[$i], $source_key_values))) {                        $delete_array[$matching_table_index][$row] = $target_key_values[$i];                        $row++;                    }                }            }        } elseif ((sizeof($trg_keys[$matching_table_index]) > 1) && $all_keys_match) {            $row = 0;            if (isset($target_key_values)) {                for ($i = 0; $i < sizeof($target_key_values); $i++) {                    $is_present = false;                    for ($j = 0; $j < sizeof($source_key_values) && ($is_present == false) ; $j++) {                        $check = true;                        for ($k = 0; $k < sizeof($trg_keys[$matching_table_index]); $k++) {                            if ($target_key_values[$i][$trg_keys[$matching_table_index][$k]] != $source_key_values[$j][$trg_keys[$matching_table_index][$k]]) {                                $check = false;                            }                        }                        if ($check) {                            $is_present = true;                        }                    }                    if (! ($is_present)) {                        for ($l = 0; $l < sizeof($trg_keys[$matching_table_index]); $l++) {                            $delete_array[$matching_table_index][$row][$trg_keys[$matching_table_index][$l]] = $target_key_values[$i][$trg_keys[$matching_table_index][$l]];                        }                        $row++;                    }                }            }        }    }}/** * PMA_dataDiffInUncommonTables() finds the data difference in  $source_tables_uncommon * * @param array  $source_tables_uncommon table names that are in source db and not in target db * @param string $src_db                 name of source database * @param mixed  $src_link               connection established with source server * @param int    $index                  index of a table from $matching_table array * @param array  &$row_count             number of rows * * @return nothing */function PMA_dataDiffInUncommonTables($source_tables_uncommon, $src_db, $src_link, $index, &$row_count){    $query = "SELECT COUNT(*) FROM " . PMA_backquote($src_db) . "." . PMA_backquote($source_tables_uncommon[$index]);    $rows  = PMA_DBI_fetch_result($query, null, null, $src_link);    $row_count[$index] = $rows[0];}/** * PMA_updateTargetTables() sets the updated field values to target table rows using $update_array[$matching_table_index] * * @param array   $table                Matching tables' names * @param array   $update_array         A three dimensional array containing field *                                      value updates required for each matching table * @param string  $src_db               Name of source database * @param string  $trg_db               Name of target database * @param mixed   $trg_link             Connection established with target server * @param int     $matching_table_index index of matching table in matching_table_array * @param array   $matching_table_keys * @param boolean $display */function PMA_updateTargetTables($table, $update_array, $src_db, $trg_db, $trg_link, $matching_table_index, $matching_table_keys, $display){    if (isset($update_array[$matching_table_index])) {        if (sizeof($update_array[$matching_table_index])) {            for ($update_row = 0; $update_row < sizeof($update_array[$matching_table_index]); $update_row++) {                if (isset($update_array[$matching_table_index][$update_row])) {                    $update_fields_num = sizeof($update_array[$matching_table_index][$update_row])-sizeof($matching_table_keys[$matching_table_index]);                    if ($update_fields_num > 0) {                        $query = "UPDATE " . PMA_backquote($trg_db) . "." .PMA_backquote($table[$matching_table_index]) . " SET ";                        for ($update_field = 0; $update_field < $update_fields_num; $update_field = $update_field+2) {                            if (isset($update_array[$matching_table_index][$update_row][$update_field]) && isset($update_array[$matching_table_index][$update_row][$update_field+1])) {                                $query .= PMA_backquote($update_array[$matching_table_index][$update_row][$update_field]) . "='" . $update_array[$matching_table_index][$update_row][$update_field+1] . "'";                            }                            if ($update_field < ($update_fields_num - 2)) {                                $query .= ", ";                            }                        }                        $query .= " WHERE ";                        if (isset($matching_table_keys[$matching_table_index])) {                            for ($key = 0; $key < sizeof($matching_table_keys[$matching_table_index]); $key++) {                                if (isset($matching_table_keys[$matching_table_index][$key])) {                                    $query .= PMA_backquote($matching_table_keys[$matching_table_index][$key]) . "='" . $update_array[$matching_table_index][$update_row][$matching_table_keys[$matching_table_index][$key]] . "'";                                }                                if ($key < (sizeof($matching_table_keys[$matching_table_index]) - 1)) {                                    $query .= " AND ";                                }                            }                        }                        $query .= ';';                        if ($display == true) {                            echo "<p>" . $query . "</p>";                        }                        PMA_DBI_try_query($query, $trg_link, 0);                    }                }            }        }    }}/** * PMA_insertIntoTargetTable() inserts missing rows in the target table using $array_insert[$matching_table_index] * * @todo this function uses undefined variables and is possibly broken: $matching_tables, *       $matching_tables_fields, $remove_indexes_array, $matching_table_keys * * @param array  $matching_table          matching table names * @param string $src_db                  name of source database * @param string $trg_db                  name of target database * @param mixed  $src_link                connection established with source server * @param mixed  $trg_link                connection established with target server * @param array  $table_fields            field names of a table * @param array  &$array_insert * @param int    $matching_table_index    index of matching table in matching_table_array * @param array  $matching_tables_keys    field names that are keys in the matching table * @param array  $source_columns          source column information * @param array  &$add_column_array       column names that are to be added in target table * @param array  $criteria                criteria like type, null, collation, default etc * @param array  $target_tables_keys      field names that are keys in the target table * @param array  $uncommon_tables         table names that are present in source db but not in targt db * @param array  &$uncommon_tables_fields field names of the uncommon tables * @param array  $uncommon_cols           column names that are present in target table and not in source table * @param array  &$alter_str_array        column names that are to be altered * @param array  &$source_indexes         column names on which indexes are made in source table * @param array  &$target_indexes         column names on which indexes are made in target table * @param array  &$add_indexes_array      column names on which index is to be added in target table * @param array  &$alter_indexes_array    column names whose indexes are to be altered. Only index name and uniqueness of an index can be changed * @param array  &$delete_array           rows that are to be deleted * @param array  &$update_array           rows that are to be updated in target * @param bool   $display */function PMA_insertIntoTargetTable($matching_table, $src_db, $trg_db, $src_link, $trg_link, $table_fields, &$array_insert, $matching_table_index, $matching_tables_keys, $source_columns, &$add_column_array, $criteria, $target_tables_keys, $uncommon_tables, &$uncommon_tables_fields, $uncommon_cols, &$alter_str_array, &$source_indexes, &$target_indexes, &$add_indexes_array, &$alter_indexes_array, &$delete_array, &$update_array, $display){    if (isset($array_insert[$matching_table_index])) {        if (sizeof($array_insert[$matching_table_index])) {            for ($insert_row = 0; $insert_row< sizeof($array_insert[$matching_table_index]); $insert_row++) {                if (isset($array_insert[$matching_table_index][$insert_row][$matching_tables_keys[$matching_table_index][0]])) {                    $select_query = "SELECT * FROM " . PMA_backquote($src_db) . "." . PMA_backquote($matching_table[$matching_table_index]) . " WHERE ";                    for ($i = 0; $i < sizeof($matching_tables_keys[$matching_table_index]); $i++) {                        $select_query .= $matching_tables_keys[$matching_table_index][$i] . "='";                        $select_query .= $array_insert[$matching_table_index][$insert_row][$matching_tables_keys[$matching_table_index][$i]] . "'" ;                        if ($i < (sizeof($matching_tables_keys[$matching_table_index]) - 1)) {                            $select_query.= " AND ";                        }                    }                    $select_query .= "; ";                    $result = PMA_DBI_fetch_result($select_query, null, null, $src_link);                    $insert_query = "INSERT INTO " . PMA_backquote($trg_db) . "." . PMA_backquote($matching_table[$matching_table_index]) ." (";                    for ($field_index = 0; $field_index < sizeof($table_fields[$matching_table_index]); $field_index++) {                        $insert_query .=  PMA_backquote($table_fields[$matching_table_index][$field_index]);                        $is_fk_query = "SELECT * FROM  information_schema.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '" . $trg_db ."'                                         AND TABLE_NAME = '" . $matching_table[$matching_table_index]. "'AND COLUMN_NAME = '" .                                         $table_fields[$matching_table_index][$field_index] . "' AND TABLE_NAME <> REFERENCED_TABLE_NAME;" ;                        $is_fk_result = PMA_DBI_fetch_result($is_fk_query, null, null, $trg_link);                        if (sizeof($is_fk_result) > 0) {                            for ($j = 0; $j < sizeof($is_fk_result); $j++) {                                $table_index = array_keys($matching_table, $is_fk_result[$j]['REFERENCED_TABLE_NAME']);                                if (isset($alter_str_array[$table_index[0]])) {                                    PMA_alterTargetTableStructure(                                        $trg_db, $trg_link, $matching_tables, $source_columns, $alter_str_array, $matching_tables_fields,                                        $criteria, $matching_tables_keys, $target_tables_keys, $table_index[0], $display                                    );                                    unset($alter_str_array[$table_index[0]]);                                }                                if (isset($uncommon_columns[$table_index[0]])) {                                    PMA_removeColumnsFromTargetTable($trg_db, $trg_link, $matching_tables, $uncommon_columns, $table_index[0], $display);                                    unset($uncommon_columns[$table_index[0]]);                                }                                if (isset($add_column_array[$table_index[0]])) {                                    PMA_findDeleteRowsFromTargetTables(                                        $delete_array, $matching_tables, $table_index[0], $target_tables_keys,                                        $matching_tables_keys, $trg_db, $trg_link, $src_db, $src_link                                    );                                    if (isset($delete_array[$table_index[0]])) {                                        PMA_deleteFromTargetTable($trg_db, $trg_link, $matching_tables, $table_index[0], $target_tables_keys, $delete_array, $display);                                        unset($delete_array[$table_index[0]]);                                    }                                    PMA_addColumnsInTargetTable(                                        $src_db, $trg_db, $src_link, $trg_link, $matching_tables, $source_columns, $add_column_array,                                        $matching_tables_fields, $criteria, $matching_tables_keys, $target_tables_keys, $uncommon_tables,                                        $uncommon_tables_fields, $table_index[0], $uncommon_cols, $display                                    );                                    unset($add_column_array[$table_index[0]]);                                }                                if (isset($add_indexes_array[$table_index[0]])                                    || isset($remove_indexes_array[$table_index[0]])                                    || isset($alter_indexes_array[$table_index[0]])                                ) {                                    PMA_applyIndexesDiff(                                        $trg_db, $trg_link, $matching_tables, $source_indexes, $target_indexes, $add_indexes_array,                                        $alter_indexes_array, $remove_indexes_array, $table_index[0], $display                                    );                                    unset($add_indexes_array[$table_index[0]]);                                    unset($alter_indexes_array[$table_index[0]]);                                    unset($remove_indexes_array[$table_index[0]]);                                }                                if (isset($update_array[$table_index[0]])) {                                    PMA_updateTargetTables(                                        $matching_tables, $update_array, $src_db, $trg_db, $trg_link,                                        $table_index[0], $matching_table_keys, $display                                    );                                    unset($update_array[$table_index[0]]);                                }                                if (isset($array_insert[$table_index[0]])) {                                     PMA_insertIntoTargetTable(                                         $matching_table, $src_db, $trg_db, $src_link, $trg_link, $table_fields, $array_insert, $table_index[0],                                         $matching_tables_keys, $source_columns, $add_column_array, $criteria, $target_tables_keys, $uncommon_tables,                                         $uncommon_tables_fields, $uncommon_cols, $alter_str_array, $source_indexes, $target_indexes, $add_indexes_array,                                         $alter_indexes_array, $delete_array, $update_array, $display                                     );                                     unset($array_insert[$table_index[0]]);                                }                            }                        }                        if ($field_index < sizeof($table_fields[$matching_table_index])-1) {                            $insert_query .= ", ";                        }                    }                    $insert_query .= ") VALUES(";                    if (sizeof($table_fields[$matching_table_index]) == 1) {                         $insert_query .= "'" . PMA_sqlAddSlashes($result[0]) . "'";                    } else {                        for ($field_index = 0; $field_index < sizeof($table_fields[$matching_table_index]); $field_index++) {                            if (isset($result[0][$table_fields[$matching_table_index][$field_index]])) {                                $insert_query .= "'" . PMA_sqlAddSlashes($result[0][$table_fields[$matching_table_index][$field_index]]) . "'";                            } else {                                $insert_query .= "'NULL'";                            }                            if ($field_index < (sizeof($table_fields[$matching_table_index])) - 1) {                                    $insert_query .= " ," ;                            }                        }                    }                    $insert_query .= ");";                    if ($display == true) {                        PMA_displayQuery($insert_query);                    }                    PMA_DBI_try_query($insert_query, $trg_link, 0);                }            }        }    }}/** * PMA_createTargetTables() Create the missing table $uncommon_table in target database * * @param string $src_db                  name of source database * @param string $trg_db                  name of target database * @param mixed  $src_link                connection established with source server * @param mixed  $trg_link                connection established with target server * @param array  &$uncommon_tables        names of tables present in source but not in target * @param int    $table_index             index of table in $uncommon_tables array * @param array  &$uncommon_tables_fields field names of the uncommon table * @param bool   $display */function PMA_createTargetTables($src_db, $trg_db, $src_link, $trg_link, &$uncommon_tables, $table_index, &$uncommon_tables_fields, $display){    if (isset($uncommon_tables[$table_index])) {        $fields_result = PMA_DBI_get_columns($src_db, $uncommon_tables[$table_index], null, true, $src_link);        $fields = array();        foreach ($fields_result as $each_field) {            $field_name = $each_field['Field'];            $fields[] = $field_name;        }        $uncommon_tables_fields[$table_index] = $fields;        $Create_Query = PMA_DBI_fetch_value("SHOW CREATE TABLE " . PMA_backquote($src_db) . '.' . PMA_backquote($uncommon_tables[$table_index]), 0, 1, $src_link);        // Replace the src table name with a `dbname`.`tablename`        $Create_Table_Query = preg_replace('/' . preg_quote(PMA_backquote($uncommon_tables[$table_index]), '/') . '/',                                            PMA_backquote($trg_db) . '.' .PMA_backquote($uncommon_tables[$table_index]),                                            $Create_Query,                                            $limit = 1        );        $is_fk_query = "SELECT * FROM  information_schema.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '" . $src_db . "'                        AND TABLE_NAME = '" . $uncommon_tables[$table_index] . "' AND TABLE_NAME <> REFERENCED_TABLE_NAME;" ;        $is_fk_result = PMA_DBI_fetch_result($is_fk_query, null, null, $src_link);        if (sizeof($is_fk_result) > 0) {            for ($j = 0; $j < sizeof($is_fk_result); $j++) {                if (in_array($is_fk_result[$j]['REFERENCED_TABLE_NAME'], $uncommon_tables)) {                    $table_index = array_keys($uncommon_tables, $is_fk_result[$j]['REFERENCED_TABLE_NAME']);                    PMA_createTargetTables($src_db, $trg_db, $trg_link, $src_link, $uncommon_tables, $table_index[0], $uncommon_tables_fields, $display);                    unset($uncommon_tables[$table_index[0]]);                }            }        }        $Create_Table_Query .= ';';        if ($display == true) {            echo '<p>' . $Create_Table_Query . '</p>';        }        PMA_DBI_try_query($Create_Table_Query, $trg_link, 0);    }}/** * PMA_populateTargetTables() inserts data into uncommon tables after they have been created * * @param string $src_db                 name of source database * @param string $trg_db                 name of target database * @param mixed  $src_link               connection established with source server * @param mixed  $trg_link               connection established with target server * @param array  $uncommon_tables        uncommon table names (table names that are present in source but not in target db) * @param int    $table_index            index of table in matching_table_array * @param array  $uncommon_tables_fields field names of the uncommon table * @param bool   $display * * @todo This turns NULL values into '' (empty string) */function PMA_populateTargetTables($src_db, $trg_db, $src_link, $trg_link, $uncommon_tables, $table_index, $uncommon_tables_fields, $display){    $display = false; // todo: maybe display some of the queries if they are not too numerous    $unbuffered_result = PMA_DBI_try_query('SELECT * FROM ' . PMA_backquote($src_db) . '.' . PMA_backquote($uncommon_tables[$table_index]), $src_link, PMA_DBI_QUERY_UNBUFFERED);    if (false !== $unbuffered_result) {        $insert_query = 'INSERT INTO ' . PMA_backquote($trg_db) . '.' .PMA_backquote($uncommon_tables[$table_index]) . ' VALUES';        while ($one_row = PMA_DBI_fetch_row($unbuffered_result)) {            $insert_query .= '(';            $key_of_last_value = count($one_row) - 1;            foreach ($one_row as $key => $value) {                $insert_query .= "'" . PMA_sqlAddSlashes($value) . "'";                if ($key < $key_of_last_value) {                    $insert_query .= ",";                }            }            $insert_query .= '),';        }        $insert_query = substr($insert_query, 0, -1);        $insert_query .= ';';        if ($display == true) {            PMA_displayQuery($insert_query);        }        PMA_DBI_try_query($insert_query, $trg_link, 0);    }}/** * PMA_deleteFromTargetTable() delete rows from target table * * @param string $trg_db             name of target database * @param mixed  $trg_link           connection established with target server * @param array  $matching_tables    matching table names * @param int    $table_index        index of table in matching_table_array * @param array  $target_tables_keys primary key names of the target tables * @param array  $delete_array       key values of rows that are to be deleted * @param bool   $display */function PMA_deleteFromTargetTable($trg_db, $trg_link, $matching_tables, $table_index, $target_tables_keys, $delete_array, $display){    for ($i = 0; $i < sizeof($delete_array[$table_index]); $i++) {        if (isset($target_tables_keys[$table_index])) {            $delete_query = 'DELETE FROM ' . PMA_backquote($trg_db) . '.' .PMA_backquote($matching_tables[$table_index]) . ' WHERE ';            for ($y = 0; $y < sizeof($target_tables_keys[$table_index]); $y++) {                $delete_query .= PMA_backquote($target_tables_keys[$table_index][$y]) . " = '";                if (sizeof($target_tables_keys[$table_index]) == 1) {                    $delete_query .= $delete_array[$table_index][$i] . "'";                } elseif (sizeof($target_tables_keys[$table_index]) > 1) {                    $delete_query .= $delete_array[$table_index][$i][$target_tables_keys[$table_index][$y]] . "'";                }                if ($y < (sizeof($target_tables_keys[$table_index]) - 1)) {                    $delete_query .= ' AND ';                }                $pk_query = "SELECT * FROM information_schema.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_SCHEMA = '" . $trg_db . "'                            AND REFERENCED_TABLE_NAME = '" . $matching_tables[$table_index]."' AND REFERENCED_COLUMN_NAME = '"                           . $target_tables_keys[$table_index][$y] . "' AND TABLE_NAME <> REFERENCED_TABLE_NAME;";                $pk_query_result = PMA_DBI_fetch_result($pk_query, null, null, $trg_link);                $result_size = sizeof($pk_query_result);                if ($result_size > 0) {                    for ($b = 0; $b < $result_size; $b++) {                        $drop_pk_query = "DELETE FROM " . PMA_backquote($pk_query_result[$b]['TABLE_SCHEMA']) . "." . PMA_backquote($pk_query_result[$b]['TABLE_NAME']) . " WHERE " . PMA_backquote($pk_query_result[$b]['COLUMN_NAME']) . " = " . $target_tables_keys[$table_index][$y] . ";";                        PMA_DBI_try_query($drop_pk_query, $trg_link, 0);                    }                }            }        }        if ($display == true) {            echo '<p>' . $delete_query . '</p>';        }        PMA_DBI_try_query($delete_query, $trg_link, 0);    }}/** * PMA_structureDiffInTables() Gets all the column information for source and target table. * Compare columns on their names. * If column exists in target then compare Type, Null, Collation, Key, Default and Comment for that column. * If column does not exist in target table then it is placed in  $add_column_array. * If column exists in target table but criteria is different then it is palced in $alter_str_array. * If column does not exist in source table but is present in target table then it is placed in  $uncommon_columns. * Keys for all the source tables that have a corresponding target table are placed  in $matching_tables_keys. * Keys for all the target tables that have a corresponding source table are placed  in $target_tables_keys. * * @param string $src_db                 name of source database * @param string $trg_db                 name of target database * @param mixed  $src_link               connection established with source server * @param mixed  $trg_link               connection established with target server * @param array  $matching_tables        names of matching tables * @param array  &$source_columns        columns information of the source tables * @param array  &$target_columns        columns information of the target tables * @param array  &$alter_str_array       three dimensional associative array first index being the matching table index, second index being column name for which target *                                       column have some criteria different and third index containing the criteria which is different. * @param array  &$add_column_array      two dimensional associative array, first index of the array contain the matching table number and second index contain the *                                       column name which is to be added in the target table * @param array  &$uncommon_columns      columns that are present in the target table but not in the source table * @param array  $criteria               criteria which are to be checked for field that is present in source table and target table * @param array  &$target_tables_keys    field names which is key in the target table * @param int    $matching_table_index   number of the matching table */function PMA_structureDiffInTables($src_db, $trg_db, $src_link, $trg_link, $matching_tables, &$source_columns, &$target_columns, &$alter_str_array, &$add_column_array, &$uncommon_columns, $criteria, &$target_tables_keys, $matching_table_index){    //Gets column information for source and target table    $source_columns[$matching_table_index] = PMA_DBI_get_columns_full($src_db, $matching_tables[$matching_table_index], null, $src_link);    $target_columns[$matching_table_index] = PMA_DBI_get_columns_full($trg_db, $matching_tables[$matching_table_index], null, $trg_link);    foreach ($source_columns[$matching_table_index] as $column_name => $each_column) {        if (isset($target_columns[$matching_table_index][$column_name]['Field'])) {            //If column exists in target table then matches criteria like type, null, collation, key, default, comment of the column            for ($i = 0; $i < sizeof($criteria); $i++) {                if ($source_columns[$matching_table_index][$column_name][$criteria[$i]] != $target_columns[$matching_table_index][$column_name][$criteria[$i]]) {                    if (($criteria[$i] == 'Default') && ($source_columns[$matching_table_index][$column_name][$criteria[$i]] == '' )) {                        $alter_str_array[$matching_table_index][$column_name][$criteria[$i]] = 'None';                    } else {                        if (! (($criteria[$i] == 'Key') && (($source_columns[$matching_table_index][$column_name][$criteria[$i]] == 'MUL')                            || ($target_columns[$matching_table_index][$column_name][$criteria[$i]] == 'MUL')                            || ($source_columns[$matching_table_index][$column_name][$criteria[$i]] == 'UNI')                            || ($target_columns[$matching_table_index][$column_name][$criteria[$i]] == 'UNI')))                        ) {                            $alter_str_array[$matching_table_index][$column_name][$criteria[$i]] = $source_columns[$matching_table_index][$column_name][$criteria[$i]];                        }                    }                }            }        } else {            $add_column_array[$matching_table_index][$column_name]= $column_name;        }    }    //Finds column names that are present in target table but not in source table    foreach ($target_columns[$matching_table_index] as $fld_name => $each_column) {        if (! (isset($source_columns[$matching_table_index][$fld_name]['Field']))) {            $fields_uncommon[] = $fld_name;        }        if ($target_columns[$matching_table_index][$fld_name]['Key'] == 'PRI') {            $keys[] = $fld_name;        }    }    if (isset($fields_uncommon)) {        $uncommon_columns[$matching_table_index] = $fields_uncommon;    }    if (isset($keys)) {        $target_tables_keys[$matching_table_index] = $keys;    }}/** * PMA_addColumnsInTargetTable() adds column that are present in source table but not in target table * * @param string $src_db                  name of source database * @param string $trg_db                  name of target database * @param mixed  $src_link                connection established with source server * @param mixed  $trg_link                connection established with target server * @param array  $matching_tables         names of matching tables * @param array  $source_columns          columns information of the source tables * @param array  &$add_column_array       the names of the column(field) that are to be added in the target * @param array  $matching_tables_fields * @param array  $criteria                criteria * @param array  $matching_tables_keys    field names which is key in the source table * @param array  $target_tables_keys      field names which is key in the target table * @param array  $uncommon_tables         table names that are present in source db and not in target db * @param array  &$uncommon_tables_fields names of the fields of the uncommon tables * @param int    $table_counter           number of the matching table * @param array  $uncommon_cols * @param bool   $display */function PMA_addColumnsInTargetTable($src_db, $trg_db, $src_link, $trg_link, $matching_tables, $source_columns, &$add_column_array, $matching_tables_fields,         $criteria, $matching_tables_keys, $target_tables_keys, $uncommon_tables, &$uncommon_tables_fields, $table_counter, $uncommon_cols, $display){    for ($i = 0; $i < sizeof($matching_tables_fields[$table_counter]); $i++) {        if (isset($add_column_array[$table_counter][$matching_tables_fields[$table_counter][$i]])) {            $query = "ALTER TABLE " . PMA_backquote($trg_db) . '.' . PMA_backquote($matching_tables[$table_counter]). " ADD COLUMN " .            PMA_backquote($add_column_array[$table_counter][$matching_tables_fields[$table_counter][$i]]) . " " . $source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Type'];            if ($source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Null'] == 'NO') {                $query .= ' Not Null ';            } elseif ($source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Null'] == 'YES') {                $query .= ' Null ';            }            if ($source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Collation'] != '') {                $query .= ' COLLATE ' . $source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Collation'];            }            if ($source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Default'] != '') {                $query .= " DEFAULT " . $source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Default'];            }            if ($source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Comment'] != '') {                $query .= " COMMENT " . $source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Comment'];            }            if ($source_columns[$table_counter][$matching_tables_fields[$table_counter][$i]]['Key'] == 'PRI' ) {                $trg_key_size = sizeof($target_tables_keys[$table_counter]);                if ($trg_key_size) {                    $check = true;                    for ($a = 0; ($a < $trg_key_size) && ($check); $a++) {                        if (! (in_array($target_tables_keys[$table_counter], $uncommon_cols))) {                             $check = false;                        }                    }                    if (! $check) {                        $query .= " ,DROP PRIMARY KEY " ;                    }                }                $query .= " , ADD PRIMARY KEY (";                for ($t = 0; $t < sizeof($matching_tables_keys[$table_counter]); $t++) {                    $query .= PMA_backquote($matching_tables_keys[$table_counter][$t]);                    if ($t < (sizeof($matching_tables_keys[$table_counter]) - 1)) {                        $query .= " , " ;                    }                }                $query .= ")";            }            $query .= ";";            if ($display == true) {                echo '<p>' . $query . '</p>';            }            PMA_DBI_try_query($query, $trg_link, 0);            //Checks if column to be added is a foreign key or not            $is_fk_query = "SELECT * FROM  information_schema.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '" . $trg_db . "' AND TABLE_NAME = '"            . $matching_tables[$table_counter] . "' AND COLUMN_NAME ='" . $add_column_array[$table_counter][$matching_tables_fields[$table_counter][$i]] .            "' AND TABLE_NAME <> REFERENCED_TABLE_NAME;";            $is_fk_result = PMA_DBI_fetch_result($is_fk_query, null, null, $src_link);            //If column is a foreign key then it is checked that referenced table exist in target db. If referenced table does not exist in target db then            //it is created first.            if (isset($is_fk_result)) {                if (in_array($is_fk_result[0]['REFERENCED_TABLE_NAME'], $uncommon_tables)) {                    $table_index = array_keys($uncommon_tables, $is_fk_result[0]['REFERENCED_TABLE_NAME']);                    PMA_checkForeignKeys($src_db, $src_link, $trg_db, $trg_link, $is_fk_result[0]['REFERENCED_TABLE_NAME'], $uncommon_tables, $uncommon_tables_fields, $display);                    PMA_createTargetTables($src_db, $trg_db, $trg_link, $src_link, $uncommon_tables, $table_index[0], $uncommon_tables_fields, $display);                    unset($uncommon_tables[$table_index[0]]);                }                $fk_query = "ALTER TABLE " . PMA_backquote($trg_db) . '.' . PMA_backquote($matching_tables[$table_counter]) .                            "ADD CONSTRAINT FOREIGN KEY " . PMA_backquote($add_column_array[$table_counter][$matching_tables_fields[$table_counter][$i]]) . "                            (" . $add_column_array[$table_counter][$matching_tables_fields[$table_counter][$i]] . ") REFERENCES " . PMA_backquote($trg_db) .                             '.' . PMA_backquote($is_fk_result[0]['REFERENCED_TABLE_NAME']) . " (" . $is_fk_result[0]['REFERENCED_COLUMN_NAME'] . ");";                PMA_DBI_try_query($fk_query, $trg_link, null);            }        }    }}/** * PMA_checkForeignKeys() checks if the referenced table have foreign keys. * uses    PMA_createTargetTables() * * @param string $src_db                  name of source database * @param mixed  $src_link                connection established with source server * @param string $trg_db                  name of target database * @param mixed  $trg_link                connection established with target server * @param string $referenced_table        table whose column is a foreign key in another table * @param array  &$uncommon_tables        names that are uncommon * @param array  &$uncommon_tables_fields field names of the uncommon table * @param bool   $display */function PMA_checkForeignKeys($src_db, $src_link, $trg_db, $trg_link, $referenced_table, &$uncommon_tables, &$uncommon_tables_fields, $display){    $is_fk_query = "SELECT * FROM  information_schema.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '" . $src_db . "'                    AND TABLE_NAME = '" . $referenced_table . "' AND TABLE_NAME <> REFERENCED_TABLE_NAME;";    $is_fk_result = PMA_DBI_fetch_result($is_fk_query, null, null, $src_link);    if (sizeof($is_fk_result) > 0) {        for ($j = 0; $j < sizeof($is_fk_result); $j++) {            if (in_array($is_fk_result[$j]['REFERENCED_TABLE_NAME'], $uncommon_tables)) {                $table_index = array_keys($uncommon_tables, $is_fk_result[$j]['REFERENCED_TABLE_NAME']);                PMA_checkForeignKeys(                    $src_db, $src_link, $trg_db, $trg_link, $is_fk_result[$j]['REFERENCED_TABLE_NAME'],                    $uncommon_tables, $uncommon_tables_fields, $display                );                PMA_createTargetTables($src_db, $trg_db, $trg_link, $src_link, $uncommon_tables, $table_index[0], $uncommon_tables_fields, $display);                unset($uncommon_tables[$table_index[0]]);            }        }    }}/** * PMA_alterTargetTableStructure() alters structure of the target table using $alter_str_array * * @param string $trg_db                 name of target database * @param mixed  $trg_link               connection established with target server * @param array  $matching_tables        names of matching tables * @param array  &$source_columns        columns information of the source table * @param array  &$alter_str_array       column name and criteria which is to be altered for the targert table * @param array  $matching_tables_fields name of the fields for the matching table * @param array  $criteria               criteria * @param array  &$matching_tables_keys  field names which is key in the source table * @param array  &$target_tables_keys    field names which is key in the target table * @param int    $matching_table_index   number of the matching table * @param bool   $display */function PMA_alterTargetTableStructure($trg_db, $trg_link, $matching_tables, &$source_columns, &$alter_str_array, $matching_tables_fields, $criteria, &$matching_tables_keys, &$target_tables_keys, $matching_table_index, $display){    $check = true;    $sql_query = '';    $found = false;    //Checks if the criteria to be altered is primary key    for ($v = 0; $v < sizeof($matching_tables_fields[$matching_table_index]); $v++) {        if (isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$v]]['Key'])) {            if ($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$v]]['Key'] == 'PRI' ) {                $check = false;            }        }    }    $pri_query = null;    if (! $check) {        $pri_query = "ALTER TABLE " . PMA_backquote($trg_db) . '.' . PMA_backquote($matching_tables[$matching_table_index]);        if (sizeof($target_tables_keys[$matching_table_index]) > 0) {            $pri_query .= "  DROP PRIMARY KEY ," ;        }        $pri_query .= "  ADD PRIMARY KEY (";        for ($z = 0; $z < sizeof($matching_tables_keys[$matching_table_index]); $z++) {            $pri_query .= PMA_backquote($matching_tables_keys[$matching_table_index][$z]);            if ($z < (sizeof($matching_tables_keys[$matching_table_index]) - 1)) {                $pri_query .= " , " ;            }        }        $pri_query .= ");";    }    if (isset($pri_query)) {        if ($display == true) {            echo '<p>' . $pri_query . '</p>';        }        PMA_DBI_try_query($pri_query, $trg_link, 0);    }    for ($t = 0; $t < sizeof($matching_tables_fields[$matching_table_index]); $t++) {        if ((isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]])) && (sizeof($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]]) > 0)) {            $sql_query = 'ALTER TABLE ' . PMA_backquote($trg_db) . '.' . PMA_backquote($matching_tables[$matching_table_index]) . ' MODIFY ' .            PMA_backquote($matching_tables_fields[$matching_table_index][$t]) . ' ' . $source_columns[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]]['Type'];            $found = false;            for ($i = 0; $i < sizeof($criteria); $i++) {                if (isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]]) && $criteria[$i] != 'Key') {                    $found = true;                    if (($criteria[$i] == 'Type') && (! isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i+1]]))) {                        if ($source_columns[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i + 1]] == 'NO') {                            $sql_query .= " Not Null" ;                        } elseif ($source_columns[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i + 1]] == 'YES') {                            $sql_query .= " Null" ;                        }                    }                    if (($criteria[$i] == 'Null') && ( $alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]] == 'NO')) {                        $sql_query .= " Not Null "  ;                    } elseif (($criteria[$i] == 'Null') && ($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]] == 'YES')) {                        $sql_query .= " Null "  ;                    }                    if ($criteria[$i] == 'Collation') {                        if ( !(isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[2]]))) {                            $sql_query .= " Not Null " ;                        }                        $sql_query .=  " COLLATE " . $alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]] ;                    }                    if (($criteria[$i] == 'Default') && ($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]] == 'None')) {                        if ( !(isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[2]]))) {                            $sql_query .= " Not Null " ;                        }                    } elseif ($criteria[$i] == 'Default') {                        if (! (isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[2]]))) {                            $sql_query .= " Not Null " ;                        }                        if (is_string($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]])) {                            if ($source_columns[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]]['Type'] != 'timestamp') {                                $sql_query .=  " DEFAULT '" . $alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]] . "'";                            } elseif ($source_columns[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]]['Type'] == 'timestamp') {                                $sql_query .=  " DEFAULT " . $alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]];                            }                        } elseif (is_numeric($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]])) {                            $sql_query .=  " DEFAULT " . $alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]];                        }                    }                    if ($criteria[$i] == 'Comment') {                        if ( !(isset($alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[2]]))) {                            $sql_query .= " Not Null " ;                        }                        $sql_query .=  " COMMENT '" . $alter_str_array[$matching_table_index][$matching_tables_fields[$matching_table_index][$t]][$criteria[$i]] . "'" ;                    }                }            }        }        $sql_query .= ";";        if ($found) {            if ($display == true) {                echo '<p>' . $sql_query . '</p>';            }            PMA_DBI_try_query($sql_query, $trg_link, 0);        }    }    $check = false;    $query = "ALTER TABLE " . PMA_backquote($trg_db) . '.' . PMA_backquote($matching_tables[$matching_table_index]);    for ($p = 0; $p < sizeof($matching_tables_keys[$matching_table_index]); $p++) {        if ((isset($alter_str_array[$matching_table_index][$matching_tables_keys[$matching_table_index][$p]]['Key']))) {            $check = true;            $query .= ' MODIFY ' . PMA_backquote($matching_tables_keys[$matching_table_index][$p]) . ' '            . $source_columns[$matching_table_index][$matching_tables_fields[$matching_table_index][$p]]['Type'] . ' Not Null ';            if ($p < (sizeof($matching_tables_keys[$matching_table_index]) - 1)) {                $query .= ', ';            }        }    }    $query .= ';';    if ($check) {        if ($display == true) {            echo '<p>' . $query . '</p>';        }        PMA_DBI_try_query($query, $trg_link, 0);    }}/** * PMA_removeColumnsFromTargetTable() removes the columns which are present in target table but not in source table. * * @param string $trg_db           name of target database * @param mixed  $trg_link         connection established with target server * @param array  $matching_tables  names of matching tables * @param array  $uncommon_columns array containing the names of the column which are to be dropped from the target table * @param int    $table_counter    index of the matching table as in $matchiing_tables array * @param bool   $display */function PMA_removeColumnsFromTargetTable($trg_db, $trg_link, $matching_tables, $uncommon_columns, $table_counter, $display){    if (isset($uncommon_columns[$table_counter])) {        $drop_query = "ALTER TABLE " . PMA_backquote($trg_db) . "." . PMA_backquote($matching_tables[$table_counter]);        for ($a = 0; $a < sizeof($uncommon_columns[$table_counter]); $a++) {            //Checks if column to be removed is a foreign key in any table            $pk_query = "SELECT * FROM information_schema.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_SCHEMA = '" . $trg_db . "'                         AND REFERENCED_TABLE_NAME = '" . $matching_tables[$table_counter]."' AND REFERENCED_COLUMN_NAME = '"                         . $uncommon_columns[$table_counter][$a] . "' AND TABLE_NAME <> REFERENCED_TABLE_NAME;";            $pk_query_result = PMA_DBI_fetch_result($pk_query, null, null, $trg_link);            $result_size = sizeof($pk_query_result);            if ($result_size > 0) {                for ($b = 0; $b < $result_size; $b++) {                    $drop_pk_query = "ALTER TABLE " . PMA_backquote($pk_query_result[$b]['TABLE_SCHEMA']) . "." . PMA_backquote($pk_query_result[$b]['TABLE_NAME']) . "                                      DROP FOREIGN KEY " . PMA_backquote($pk_query_result[$b]['CONSTRAINT_NAME']) . ", DROP COLUMN " . PMA_backquote($pk_query_result[$b]['COLUMN_NAME']) . ";";                    PMA_DBI_try_query($drop_pk_query, $trg_link, 0);                }            }            $query = "SELECT * FROM information_schema.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA = '" . $trg_db . "' AND TABLE_NAME = '"                     . $matching_tables[$table_counter]. "' AND COLUMN_NAME = '" . $uncommon_columns[$table_counter][$a] . "'                      AND TABLE_NAME <> REFERENCED_TABLE_NAME;";            $result = PMA_DBI_fetch_result($query, null, null, $trg_link);            if (sizeof($result) > 0) {                $drop_query .= " DROP FOREIGN KEY " . PMA_backquote($result[0]['CONSTRAINT_NAME']) . ",";            }            $drop_query .=  " DROP COLUMN " . PMA_backquote($uncommon_columns[$table_counter][$a]);            if ($a < (sizeof($uncommon_columns[$table_counter]) - 1)) {                $drop_query .= " , " ;            }        }        $drop_query .= ";" ;        if ($display == true) {            echo '<p>' . $drop_query . '</p>';        }        PMA_DBI_try_query($drop_query, $trg_link, 0);    }}/** * PMA_indexesDiffInTables() compares the source table indexes with target table indexes and keep the indexes to be added in target table in $add_indexes_array * indexes to be altered in $alter_indexes_array and indexes to be removed from target table in $remove_indexes_array. * Only keyname and uniqueness characteristic of the indexes are altered. * * @param string $src_db                name of source database * @param string $trg_db                name of target database * @param mixed  $src_link              connection established with source server * @param mixed  $trg_link              connection established with target server * @param array  $matching_tables       matching tables name * @param array  &$source_indexes       indexes of the source table * @param array  &$target_indexes       indexes of the target table * @param array  &$add_indexes_array    name of the column on which the index is to be added in the target table * @param array  &$alter_indexes_array  key name which needs to be altered * @param array  &$remove_indexes_array key name of the index which is to be removed from the target table * @param int    $table_counter         number of the matching table */function PMA_indexesDiffInTables($src_db, $trg_db, $src_link, $trg_link, $matching_tables, &$source_indexes, &$target_indexes, &$add_indexes_array, &$alter_indexes_array, &$remove_indexes_array, $table_counter){    //Gets indexes information for source and target table    $source_indexes[$table_counter] = PMA_DBI_get_table_indexes($src_db, $matching_tables[$table_counter], $src_link);    $target_indexes[$table_counter] = PMA_DBI_get_table_indexes($trg_db, $matching_tables[$table_counter], $trg_link);    for ($a = 0; $a < sizeof($source_indexes[$table_counter]); $a++) {        $found = false;        $z = 0;        //Compares key name and non_unique characteristic of source indexes with target indexes        /*         * @todo compare the length of each sub part         */        while (($z <= sizeof($target_indexes[$table_counter])) && ($found == false)) {            if (isset($source_indexes[$table_counter][$a]) && isset($target_indexes[$table_counter][$z]) && $source_indexes[$table_counter][$a]['Key_name'] == $target_indexes[$table_counter][$z]['Key_name']) {                $found = true;                if (($source_indexes[$table_counter][$a]['Column_name'] != $target_indexes[$table_counter][$z]['Column_name']) || ($source_indexes[$table_counter][$a]['Non_unique'] != $target_indexes[$table_counter][$z]['Non_unique'])) {                    if (! (($source_indexes[$table_counter][$a]['Key_name'] == "PRIMARY") || ($target_indexes[$table_counter][$z]['Key_name'] == 'PRIMARY'))) {                        $alter_indexes_array[$table_counter][] = $source_indexes[$table_counter][$a]['Key_name'];                    }                }            }            $z++;        }        if ($found === false) {            if (! ($source_indexes[$table_counter][$a]['Key_name'] == 'PRIMARY')) {                $add_indexes_array [$table_counter][] = $source_indexes[$table_counter][$a]['Column_name'];            }        }    }    //Finds indexes that exist on target table but not on source table    for ($b = 0; $b < sizeof($target_indexes[$table_counter]); $b++) {        $found = false;        $c = 0;        while (($c <= sizeof($source_indexes[$table_counter])) && ($found == false)) {            if ($target_indexes[$table_counter][$b]['Column_name'] == $source_indexes[$table_counter][$c]['Column_name']) {                $found = true;            }            $c++;        }        if ($found === false) {            $remove_indexes_array[$table_counter][] = $target_indexes[$table_counter][$b]['Key_name'];        }    }}/** * PMA_applyIndexesDiff() create indexes, alters indexes and remove indexes. * * @param string $trg_db               name of target database * @param mixed  $trg_link             connection established with target server * @param array  $matching_tables      matching tables name * @param array  $source_indexes       indexes of the source table * @param array  $target_indexes       indexes of the target table * @param array  $add_indexes_array    column names on which indexes are to be created in target table * @param array  $alter_indexes_array  column names for which indexes are to be altered * @param array  $remove_indexes_array key name of the indexes which are to be removed from the target table * @param int    $table_counter        number of the matching table * @param $display */function PMA_applyIndexesDiff ($trg_db, $trg_link, $matching_tables, $source_indexes, $target_indexes, $add_indexes_array, $alter_indexes_array,          $remove_indexes_array, $table_counter, $display){    //Adds indexes on target table    if (isset($add_indexes_array[$table_counter])) {        $sql = "ALTER TABLE " . PMA_backquote($trg_db) . "." . PMA_backquote($matching_tables[$table_counter]) . " ADD" ;        for ($a = 0; $a < sizeof($source_indexes[$table_counter]); $a++) {            if (isset($add_indexes_array[$table_counter][$a])) {                for ($b = 0; $b < sizeof($source_indexes[$table_counter]); $b++) {                    if ($source_indexes[$table_counter][$b]['Column_name'] == $add_indexes_array[$table_counter][$a]) {                        if ($source_indexes[$table_counter][$b]['Non_unique'] == '0') {                            $sql .= " UNIQUE ";                        }                        $sql .= " INDEX " . PMA_backquote($source_indexes[$table_counter][$b]['Key_name']) . " (" . $add_indexes_array[$table_counter][$a] . " );";                        if ($display == true) {                            echo '<p>' . $sql . '</p>';                        }                        PMA_DBI_try_query($sql, $trg_link, 0);                    }                }            }        }    }    //Alter indexes of target table    if (isset($alter_indexes_array[$table_counter])) {        $query = "ALTER TABLE " . PMA_backquote($trg_db) . "." . PMA_backquote($matching_tables[$table_counter]);        for ($a = 0; $a < sizeof($alter_indexes_array[$table_counter]); $a++) {            if (isset($alter_indexes_array[$table_counter][$a])) {                $query .= ' DROP INDEX ' . PMA_backquote($alter_indexes_array[$table_counter][$a]) . " , ADD ";                $got_first_index_column = false;                for ($z = 0; $z < sizeof($source_indexes[$table_counter]); $z++) {                    if ($source_indexes[$table_counter][$z]['Key_name'] == $alter_indexes_array[$table_counter][$a]) {                        if (! $got_first_index_column) {                            if ($source_indexes[$table_counter][$z]['Non_unique'] == '0') {                                $query .= " UNIQUE ";                            }                            $query .= " INDEX " . PMA_backquote($source_indexes[$table_counter][$z]['Key_name']) . " (" . PMA_backquote($source_indexes[$table_counter][$z]['Column_name']);                            $got_first_index_column = true;                        } else {                            // another column for this index                            $query .= ', ' . PMA_backquote($source_indexes[$table_counter][$z]['Column_name']);                        }                    }                }                $query .= " )";            }        }        $query .= ';';        if ($display == true) {            echo '<p>' . $query . '</p>';        }        PMA_DBI_try_query($query, $trg_link, 0);    }    //Removes indexes from target table    if (isset($remove_indexes_array[$table_counter])) {        $drop_index_query = "ALTER TABLE " . PMA_backquote($trg_db) . "." . PMA_backquote($matching_tables[$table_counter]);        for ($a = 0; $a < sizeof($target_indexes[$table_counter]); $a++) {            if (isset($remove_indexes_array[$table_counter][$a])) {                $drop_index_query .= " DROP INDEX " . PMA_backquote($remove_indexes_array[$table_counter][$a]);            }            if ($a < (sizeof($remove_indexes_array[$table_counter]) - 1)) {                $drop_index_query .= " , " ;            }        }        $drop_index_query .= " ; " ;        if ($display == true) {            echo '<p>' . $drop_index_query . '</p>';        }        PMA_DBI_try_query($drop_index_query, $trg_link, 0);    }}/** * PMA_displayQuery() displays a query, taking the maximum display size * into account * * @param string $query the query to display * * @return nothing */function PMA_displayQuery($query){    if (strlen($query) > $GLOBALS['cfg']['MaxCharactersInDisplayedSQL']) {        $query = substr($query, 0, $GLOBALS['cfg']['MaxCharactersInDisplayedSQL']) . '[...]';    }    echo '<p>' . htmlspecialchars($query) . '</p>';}/** * PMA_syncDisplayHeaderCompare() shows the header for source database * * @param string $src_db source db name * @param string $trg_db target db name * * @return nothing */function PMA_syncDisplayHeaderCompare($src_db, $trg_db){    echo '<fieldset style="padding:0"><div style="padding:1.5em; overflow:auto; height:220px">';    echo '<table class="data">';    echo '<tr>';    echo '<th>' . __('Source database') . ':  ' . htmlspecialchars($src_db) . '<br />(';    if ('cur' == $_SESSION['src_type']) {        echo __('Current server');    } else {        echo __('Remote server') . ' ' . htmlspecialchars($_SESSION['src_server']['host']);    }    echo ')</th>';    echo '<th>' . __('Difference') . '</th>';    echo '<th>' . __('Target database') . ':  '. htmlspecialchars($trg_db) . '<br />(';    if ('cur' == $_SESSION['trg_type']) {        echo __('Current server');    } else {        echo __('Remote server') . ' ' . htmlspecialchars($_SESSION['trg_server']['host']);    }    echo ')</th>';    echo '</tr>';}/** * Prints table row * * $rows contains following keys: * - src_table_name - source server table name * - dst_table_name - target server table name * - btn_type - 'M' or 'U' * - btn_structure - null or arguments for showDetails in server_synchronize.js (without img_obj and table_name): *                       i, update_size, insert_size, remove_size, insert_index, remove_index * * @param array $rows */function PMA_syncDisplayDataCompare($rows){    global $pmaThemeImage;    $odd_row = true;    foreach ($rows as $row) {        echo '<tr class=" ' . ($odd_row ? 'odd' : 'even') . '">';        echo '<td>' . htmlspecialchars($row['src_table_name']) . '</td><td style="text-align:center">';        if (isset($row['btn_structure']) && $row['btn_structure']) {            // parameters: i, update_size, insert_size, remove_size, insert_index, remove_index            $p = $row['btn_structure'];            $p[0] = $row['btn_type'] . 'S' . $p[0];            echo '<img class="icon struct_img" src="' . $pmaThemeImage . 'new_struct.png" width="16" height="16"                 alt="Structure" title="' . __('Click to select') . '" style="cursor:pointer" onclick="showDetails('                 . "'" . implode($p, "','") . "'"                 . ', this, ' . "'" . PMA_escapeJsString(htmlspecialchars($row['src_table_name'])) . "'" . ')" /> ';        }        if (isset($row['btn_data']) && $row['btn_data']) {            // parameters: i, update_size, insert_size, remove_size, insert_index, remove_index            $p = $row['btn_data'];            $p[0] = $row['btn_type'] . 'D' . $p[0];            echo '<img class="icon data_img" src="' . $pmaThemeImage . 'new_data.png" width="16" height="16"                alt="Data" title="' . __('Click to select') . '" style="cursor:pointer" onclick="showDetails('                . "'" . implode($p, "','") . "'"                . ', this, ' . "'" . PMA_escapeJsString(htmlspecialchars($row['src_table_name'])) . "'" . ')" />';        }        echo '</td><td>' . htmlspecialchars($row['dst_table_name']) . '</td></tr>';        $odd_row = !$odd_row;    }}/** * array PMA_get_column_values (string $database, string $table, string $column , mysql db link $link = null) * * @param string $database name of database * @param string $table    name of table to retrieve columns from * @param string $column   name of the column to retrieve data from * @param mixed  $link     mysql link resource * * @return array $field_values */function PMA_get_column_values($database, $table, $column, $link = null){    $query = 'SELECT ';    for ($i=0; $i< sizeof($column); $i++) {        $query.= PMA_backquote($column[$i]);        if ($i < (sizeof($column)-1)) {            $query.= ', ';        }    }    $query.= ' FROM ' . PMA_backquote($database) . '.' . PMA_backquote($table);    $field_values = PMA_DBI_fetch_result($query, null, null, $link);    if (! is_array($field_values) || count($field_values) < 1) {        return false;    }    return $field_values;}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Config file management * * @package PhpMyAdmin *//** * Config file management class. * Stores its data in $_SESSION * * @package    phpMyAdmin */class ConfigFile{    /**     * Stores default PMA config from config.default.php     * @var array     */    private $cfg;    /**     * Stores original PMA_Config object, not modified by user preferences     * @var PMA_Config     */    private $orgCfgObject;    /**     * Stores allowed values for non-standard fields     * @var array     */    private $cfgDb;    /**     * Keys which will be always written to config file     * @var array     */    private $persistKeys = array();    /**     * Changes keys while updating config in {@link updateWithGlobalConfig()} or reading     * by {@link getConfig()} or {@link getConfigArray()}     * @var array     */    private $cfgUpdateReadMapping = array();    /**     * Key filter for {@link set()}     * @var array|null     */    private $setFilter;    /**     * Instance id (key in $_SESSION array, separate for each server - ConfigFile{server id})     * @var string     */    private $id;    /**     * Result for {@link _flattenArray()}     * @var array     */    private $_flattenArrayResult;    /**     * ConfigFile instance     * @var ConfigFile     */    private static $_instance;    /**     * Private constructor, use {@link getInstance()}     *     */    private function __construct()    {        // load default config values        $cfg = &$this->cfg;        include './libraries/config.default.php';        $cfg['fontsize'] = '82%';        // create PMA_Config to read config.inc.php values        $this->orgCfgObject = new PMA_Config(CONFIG_FILE);        // load additional config information        $cfg_db = &$this->cfgDb;        include './libraries/config.values.php';        // apply default values overrides        if (count($cfg_db['_overrides'])) {            foreach ($cfg_db['_overrides'] as $path => $value) {                PMA_array_write($path, $cfg, $value);            }        }        $this->id = 'ConfigFile' . $GLOBALS['server'];        if (!isset($_SESSION[$this->id])) {            $_SESSION[$this->id] = array();        }    }    /**     * Returns class instance     *     * @return ConfigFile     */    public static function getInstance()    {        if (is_null(self::$_instance)) {            self::$_instance = new ConfigFile();        }        return self::$_instance;    }    /**     * Returns PMA_Config without user preferences applied     *     * @return PMA_Config     */    public function getOrgConfigObj()    {        return $this->orgCfgObject;    }    /**     * Sets names of config options which will be placed in config file even if they are set     * to their default values (use only full paths)     *     * @param array $keys     */    public function setPersistKeys($keys)    {        // checking key presence is much faster than searching so move values to keys        $this->persistKeys = array_flip($keys);    }    /**     * Returns flipped array set by {@link setPersistKeys()}     *     * @return array     */    public function getPersistKeysMap()    {        return $this->persistKeys;    }    /**     * By default ConfigFile allows setting of all configuration keys, use this method     * to set up a filter on {@link set()} method     *     * @param array|null $keys array of allowed keys or null to remove filter     */    public function setAllowedKeys($keys)    {        if ($keys === null) {            $this->setFilter = null;            return;        }        // checking key presence is much faster than searching so move values to keys        $this->setFilter = array_flip($keys);    }    /**     * Sets path mapping for updating config in {@link updateWithGlobalConfig()} or reading     * by {@link getConfig()} or {@link getConfigArray()}     * @var array     */    public function setCfgUpdateReadMapping(array $mapping)    {        $this->cfgUpdateReadMapping = $mapping;    }    /**     * Resets configuration data     */    public function resetConfigData()    {        $_SESSION[$this->id] = array();    }    /**     * Sets configuration data (overrides old data)     *     * @param array $cfg     */    public function setConfigData(array $cfg)    {        $_SESSION[$this->id] = $cfg;    }    /**     * Sets config value     *     * @param string $path     * @param mixed  $value     * @param string $canonical_path     */    public function set($path, $value, $canonical_path = null)    {        if ($canonical_path === null) {            $canonical_path = $this->getCanonicalPath($path);        }        // apply key whitelist        if ($this->setFilter !== null && !isset($this->setFilter[$canonical_path])) {            return;        }        // remove if the path isn't protected and it's empty or has a default value        if (!isset($this->persistKeys[$canonical_path])) {            $default_value = $this->getDefault($canonical_path);            // we need oryginal config values not overwritten by user preferences            // to allow for overwriting options set in config.inc.php with default values            $instance_default_value = PMA_array_read($canonical_path, $this->orgCfgObject->settings);            if (($value === $default_value && (defined('PMA_SETUP') || $instance_default_value === $default_value))                    || (empty($value) && empty($default_value) && (defined('PMA_SETUP') || empty($current_global)))) {                PMA_array_remove($path, $_SESSION[$this->id]);                return;            }        }        PMA_array_write($path, $_SESSION[$this->id], $value);    }    /**     * Flattens multidimensional array, changes indices to paths (eg. 'key/subkey').     * Used as array_walk() callback.     *     * @param mixed $value     * @param mixed $key     * @param mixed $prefix     */    private function _flattenArray($value, $key, $prefix)    {        // no recursion for numeric arrays        if (is_array($value) && !isset($value[0])) {            $prefix .= $key . '/';            array_walk($value, array($this, '_flattenArray'), $prefix);        } else {            $this->_flattenArrayResult[$prefix . $key] = $value;        }    }    /**     * Returns default config in a flattened array     *     * @return array     */    public function getFlatDefaultConfig()    {        $this->_flattenArrayResult = array();        array_walk($this->cfg, array($this, '_flattenArray'), '');        $flat_cfg = $this->_flattenArrayResult;        $this->_flattenArrayResult = null;        return $flat_cfg;    }    /**     * Updates config with values read from given array     * (config will contain differences to defaults from config.defaults.php).     *     * @param array $cfg     */    public function updateWithGlobalConfig(array $cfg)    {        // load config array and flatten it        $this->_flattenArrayResult = array();        array_walk($cfg, array($this, '_flattenArray'), '');        $flat_cfg = $this->_flattenArrayResult;        $this->_flattenArrayResult = null;        // save values        // map for translating a few user preferences paths, should be complemented        // by code reading from generated config to perform inverse mapping        foreach ($flat_cfg as $path => $value) {            if (isset($this->cfgUpdateReadMapping[$path])) {                $path = $this->cfgUpdateReadMapping[$path];            }            $this->set($path, $value, $path);        }    }    /**     * Returns config value or $default if it's not set     *     * @param  string $path     * @param  mixed  $default     * @return mixed     */    public function get($path, $default = null)    {        return PMA_array_read($path, $_SESSION[$this->id], $default);    }    /**     * Returns default config value or $default it it's not set ie. it doesn't     * exist in config.default.php ($cfg) and config.values.php     * ($_cfg_db['_overrides'])     *     * @param  string $canonical_path     * @param  mixed  $default     * @return mixed     */    public function getDefault($canonical_path, $default = null)    {        return PMA_array_read($canonical_path, $this->cfg, $default);    }    /**     * Returns config value, if it's not set uses the default one; returns     * $default if the path isn't set and doesn't contain a default value     *     * @param  string $path     * @param  mixed  $default     * @return mixed     */    public function getValue($path, $default = null)    {        $v = PMA_array_read($path, $_SESSION[$this->id], null);        if ($v !== null) {            return $v;        }        $path = $this->getCanonicalPath($path);        return $this->getDefault($path, $default);    }    /**     * Returns canonical path     *     * @param string $path     * @return string     */    public function getCanonicalPath($path) {        return preg_replace('#^Servers/([\d]+)/#', 'Servers/1/', $path);    }    /**     * Returns config database entry for $path ($cfg_db in config_info.php)     *     * @param  string $path     * @param  mixed  $default     * @return mixed     */    public function getDbEntry($path, $default = null)    {        return PMA_array_read($path, $this->cfgDb, $default);    }    /**     * Returns server count     *     * @return int     */    public function getServerCount()    {        return isset($_SESSION[$this->id]['Servers'])            ? count($_SESSION[$this->id]['Servers'])            : 0;    }    /**     * Returns server list     *     * @return array|null     */    public function getServers()    {      return isset($_SESSION[$this->id]['Servers'])          ? $_SESSION[$this->id]['Servers']          : null;    }    /**     * Returns DSN of given server     *     * @param integer $server     * @return string     */    function getServerDSN($server)    {        if (!isset($_SESSION[$this->id]['Servers'][$server])) {            return '';        }        $path = 'Servers/' . $server;        $dsn = $this->getValue("$path/extension") . '://';        if ($this->getValue("$path/auth_type") == 'config') {            $dsn .= $this->getValue("$path/user");            if (!$this->getValue("$path/nopassword")) {                $dsn .= ':***';            }            $dsn .= '@';        }        if ($this->getValue("$path/connect_type") == 'tcp') {            $dsn .= $this->getValue("$path/host");            $port = $this->getValue("$path/port");            if ($port) {                $dsn .= ':' . $port;            }        } else {            $dsn .= $this->getValue("$path/socket");        }        return $dsn;    }    /**     * Returns server name     *     * @param int $id     * @return string     */    public function getServerName($id)    {        if (!isset($_SESSION[$this->id]['Servers'][$id])) {            return '';        }        $verbose = $this->get("Servers/$id/verbose");        if (!empty($verbose)) {            return $verbose;        }        $host = $this->get("Servers/$id/host");        return empty($host) ? 'localhost' : $host;    }    /**     * Removes server     *     * @param int $server     */    public function removeServer($server)    {        if (!isset($_SESSION[$this->id]['Servers'][$server])) {            return;        }        $last_server = $this->getServerCount();        for ($i = $server; $i < $last_server; $i++) {            $_SESSION[$this->id]['Servers'][$i] = $_SESSION[$this->id]['Servers'][$i+1];        }        unset($_SESSION[$this->id]['Servers'][$last_server]);        if (isset($_SESSION[$this->id]['ServerDefault'])            && $_SESSION[$this->id]['ServerDefault'] >= 0) {            unset($_SESSION[$this->id]['ServerDefault']);        }    }    /**     * Returns config file path, relative to phpMyAdmin's root path     *     * @return string     */    public function getFilePath()    {        // Load paths        if (!defined('SETUP_CONFIG_FILE')) {            include_once './libraries/vendor_config.php';        }        return SETUP_CONFIG_FILE;    }    /**     * Returns configuration array (full, multidimensional format)     *     * @return array     */    public function getConfig()    {        $c = $_SESSION[$this->id];        foreach ($this->cfgUpdateReadMapping as $map_to => $map_from) {            PMA_array_write($map_to, $c, PMA_array_read($map_from, $c));            PMA_array_remove($map_from, $c);        }        return $c;    }    /**     * Returns configuration array (flat format)     *     * @return array     */    public function getConfigArray()    {        $this->_flattenArrayResult = array();        array_walk($_SESSION[$this->id], array($this, '_flattenArray'), '');        $c = $this->_flattenArrayResult;        $this->_flattenArrayResult = null;        $persistKeys = array_diff(array_keys($this->persistKeys), array_keys($c));        foreach ($persistKeys as $k) {            $c[$k] = $this->getDefault($k);        }        foreach ($this->cfgUpdateReadMapping as $map_to => $map_from) {            if (!isset($c[$map_from])) {                continue;            }            $c[$map_to] = $c[$map_from];            unset($c[$map_from]);        }        return $c;    }}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package PhpMyAdmin-Transformation */function PMA_transformation_text_plain__longToIpv4_info(){    return array(        'info' => __('Converts an (IPv4) Internet network address into a string in Internet standard dotted format.'),        );}/** * returns IPv4 address * * @see http://php.net/long2ip */function PMA_transformation_text_plain__longToIpv4($buffer, $options = array(), $meta = ''){    if ($buffer < 0 || $buffer > 4294967295) {        return $buffer;    }    return long2ip($buffer);}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * PHP interface to MimerSQL Validator * * Copyright 2002, 2003 Robin Johnson <robbat2@users.sourceforge.net> * http://www.orbis-terrarum.net/?l=people.robbat2 * * All data is transported over HTTP-SOAP * And uses either the PEAR SOAP Module or PHP SOAP extension * * Install instructions for PEAR SOAP: * Make sure you have a really recent PHP with PEAR support * run this: "pear install Mail_Mime Net_DIME SOAP" * * @access   public * * @package PhpMyAdmin */if (! defined('PHPMYADMIN')) {    exit;}/** * Load SOAP client. */if (class_exists('SOAPClient')) {    $GLOBALS['sqlvalidator_error'] = false;    $GLOBALS['sqlvalidator_soap'] = 'PHP';} else {    @include_once 'SOAP/Client.php';    if (class_exists('SOAP_Client')) {        $GLOBALS['sqlvalidator_soap'] = 'PEAR';        $GLOBALS['sqlvalidator_error'] = false;    } else {        $GLOBALS['sqlvalidator_soap'] = 'NONE';        $GLOBALS['sqlvalidator_error'] = true;        PMA_warnMissingExtension('soap');    }}if (!$GLOBALS['sqlvalidator_error']) {    // Ok, we have SOAP Support, so let's use it!/** * @package PhpMyAdmin */    class PMA_SQLValidator    {        var $url;        var $service_name;        var $wsdl;        var $output_type;        var $username;        var $password;        var $calling_program;        var $calling_program_version;        var $target_dbms;        var $target_dbms_version;        var $connectionTechnology;        var $connection_technology_version;        var $interactive;        var $service_link = null;        var $session_data = null;        /**         * Private functions - You don't need to mess with these         */        /**         * Service opening         *         * @param string  URL of Mimer SQL Validator WSDL file         *         * @return object  Object to use         *         * @access private         */        function _openService($url)        {            if ($GLOBALS['sqlvalidator_soap'] == 'PHP') {                $obj = new SOAPClient($url);            } else {                $obj = new SOAP_Client($url, true);            }            return $obj;        } // end of the "openService()" function        /**         * Service initializer to connect to server         *         * @param object   Service object         * @param string   Username         * @param string   Password         * @param string   Name of calling program         * @param string   Version of calling program         * @param string   Target DBMS         * @param string   Version of target DBMS         * @param string   Connection Technology         * @param string   version of Connection Technology         * @param integer  boolean of 1/0 to specify if we are an interactive system         *         * @return object   stdClass return object with data         *         * @access private         */        function _openSession($obj, $username, $password,                                      $calling_program, $calling_program_version,                                      $target_dbms, $target_dbms_version,                                      $connection_technology, $connection_technology_version,                                      $interactive)        {            $use_array = array(                "a_userName" => $username,                "a_password" => $password,                "a_callingProgram" => $calling_program,                "a_callingProgramVersion" => $calling_program_version,                "a_targetDbms" => $target_dbms,                "a_targetDbmsVersion" => $target_dbms_version,                "a_connectionTechnology" => $connection_technology,                "a_connectionTechnologyVersion" => $connection_technology_version,                "a_interactive" => $interactive,            );            if ($GLOBALS['sqlvalidator_soap'] == 'PHP') {                $ret = $obj->__soapCall("openSession", $use_array);            } else {                $ret = $obj->call("openSession", $use_array);            }            return $ret;        } // end of the "_openSession()" function        /**         * Validator sytem call         *         * @param object  Service object         * @param object  Session object         * @param string  SQL Query to validate         * @param string  Data return type         *         * @return object  stClass return with data         *         * @access private         */        function _validateSQL($obj, $session, $sql, $method)        {            $use_array = array(                "a_sessionId" => $session->sessionId,                "a_sessionKey" => $session->sessionKey,                "a_SQL" => $sql,                "a_resultType" => $this->output_type,            );            if ($GLOBALS['sqlvalidator_soap'] == 'PHP') {                $res = $obj->__soapCall("validateSQL", $use_array);            } else {                $res = $obj->call("validateSQL", $use_array);            }            return $res;        } // end of the "validateSQL()" function        /**         * Validator sytem call         *         * @param string  SQL Query to validate         *         * @return object  stdClass return with data         *         * @access private         *         * @see    validateSQL()         */        function _validate($sql)        {            $ret = $this->_validateSQL($this->service_link, $this->session_data,                                               $sql, $this->output_type);            return $ret;        } // end of the "validate()" function        /**         * Public functions         */        /**         * Constructor         *         * @access public         */        function __construct()        {            $this->url                           = 'http://sqlvalidator.mimer.com/v1/services';            $this->service_name                  = 'SQL99Validator';            $this->wsdl                          = '?wsdl';            $this->output_type                   = 'html';            $this->username                      = 'anonymous';            $this->password                      = '';            $this->calling_program               = 'PHP_SQLValidator';            $this->calling_program_version       = PMA_VERSION;            $this->target_dbms                   = 'N/A';            $this->target_dbms_version           = 'N/A';            $this->connection_technology         = 'PHP';            $this->connection_technology_version = phpversion();            $this->interactive = 1;            $this->service_link = null;            $this->session_data = null;        } // end of the "PMA_SQLValidator()" function        /**         * Sets credentials         *         * @param string  the username         * @param string  the password         *         * @access public         */        function setCredentials($username, $password)        {            $this->username = $username;            $this->password = $password;        } // end of the "setCredentials()" function        /**         * Sets the calling program         *         * @param string  the calling program name         * @param string  the calling program revision         *         * @access public         */        function setCallingProgram($calling_program, $calling_program_version)        {            $this->calling_program         = $calling_program;            $this->calling_program_version = $calling_program_version;        } // end of the "setCallingProgram()" function        /**         * Appends the calling program         *         * @param string  the calling program name         * @param string  the calling program revision         *         * @access public         */        function appendCallingProgram($calling_program, $calling_program_version)        {            $this->calling_program         .= ' - ' . $calling_program;            $this->calling_program_version .= ' - ' . $calling_program_version;        } // end of the "appendCallingProgram()" function        /**         * Sets the target DBMS         *         * @param string  the target DBMS name         * @param string  the target DBMS revision         *         * @access public         */        function setTargetDbms($target_dbms, $target_dbms_version)        {            $this->target_dbms         = $target_dbms;            $this->target_dbms_version = $target_dbms_version;        } // end of the "setTargetDbms()" function        /**         * Appends the target DBMS         *         * @param string  the target DBMS name         * @param string  the target DBMS revision         *         * @access public         */        function appendTargetDbms($target_dbms, $target_dbms_version)        {            $this->target_dbms         .= ' - ' . $target_dbms;            $this->target_dbms_version .= ' - ' . $target_dbms_version;        } // end of the "appendTargetDbms()" function        /**         * Sets the connection technology used         *         * @param string  the connection technology name         * @param string  the connection technology revision         *         * @access public         */        function setConnectionTechnology($connection_technology, $connection_technology_version)        {            $this->connection_technology         = $connection_technology;            $this->connection_technology_version = $connection_technology_version;        } // end of the "setConnectionTechnology()" function        /**         * Appends the connection technology used         *         * @param string  the connection technology name         * @param string  the connection technology revision         *         * @access public         */        function appendConnectionTechnology($connection_technology, $connection_technology_version)        {            $this->connection_technology         .= ' - ' . $connection_technology;            $this->connection_technology_version .= ' - ' . $connection_technology_version;        } // end of the "appendConnectionTechnology()" function        /**         * Sets whether interactive mode should be used or not         *         * @param integer  whether interactive mode should be used or not         *         * @access public         */        function setInteractive($interactive)        {            $this->interactive = $interactive;        } // end of the "setInteractive()" function        /**         * Sets the output type to use         *         * @param string  the output type to use         *         * @access public         */        function setOutputType($output_type)        {            $this->output_type = $output_type;        } // end of the "setOutputType()" function        /**         * Starts service         *         * @access public         */        function startService()        {            $this->service_link = $this->_openService($this->url . '/' . $this->service_name . $this->wsdl);        } // end of the "startService()" function        /**         * Starts session         *         * @access public         */        function startSession()        {            $this->session_data = $this->_openSession($this->service_link, $this->username, $this->password,                                                              $this->calling_program, $this->calling_program_version,                                                              $this->target_dbms, $this->target_dbms_version,                                                              $this->connection_technology, $this->connection_technology_version,                                                              $this->interactive);            if (isset($this->session_data) && ($this->session_data != null)                && ($this->session_data->target != $this->url)) {                // Reopens the service on the new URL that was provided                $url = $this->session_data->target;                $this->startService();            }        } // end of the "startSession()" function        /**         * Do start service and session         *         * @access public         */        function start()        {            $this->startService();            $this->startSession();        } // end of the "start()" function        /**         * Call to determine just if a query is valid or not.         *         * @param string SQL statement to validate         *         * @return string Validator string from Mimer         *         * @see _validate         */        function isValid($sql)        {            $res = $this->_validate($sql);            return $res->standard;        } // end of the "isValid()" function        /**         * Call for complete validator response         *         * @param string SQL statement to validate         *         * @return string Validator string from Mimer         *         * @see _validate         */        function validationString($sql)        {            $res = $this->_validate($sql);            return $res->data;        } // end of the "validationString()" function    } // end class PMA_SQLValidator    //add an extra check to ensure that the class was defined without errors    if (!class_exists('PMA_SQLValidator')) {        $GLOBALS['sqlvalidator_error'] = true;    }} // end else?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Library for extracting information about system memory and cpu. Currently supports all * Windows and Linux plattforms * * This code is based on the OS Classes from the phpsysinfo project (http://phpsysinfo.sourceforge.net/) * * @package PhpMyAdmin *//** * @return array */function getSysInfo(){    $supported = array('Linux', 'WINNT');    $sysinfo = array();    if (in_array(PHP_OS, $supported)) {        return eval("return new ".PHP_OS."();");    }    return $sysinfo;}class WINNT{    private $_wmi;    public $os = 'WINNT';    public function __construct() {        // initialize the wmi object        $objLocator = new COM('WbemScripting.SWbemLocator');        $this->_wmi = $objLocator->ConnectServer();    }    function loadavg() {        $loadavg = "";        $sum = 0;        $buffer = $this->_getWMI('Win32_Processor', array('LoadPercentage'));        foreach ($buffer as $load) {            $value = $load['LoadPercentage'];            $loadavg .= $value.' ';            $sum += $value;        }        return array('loadavg' => $sum / count($buffer));    }    private function _getWMI($strClass, $strValue = array()) {        $arrData = array();        $value = "";        $objWEBM = $this->_wmi->Get($strClass);        $arrProp = $objWEBM->Properties_;        $arrWEBMCol = $objWEBM->Instances_();        foreach ($arrWEBMCol as $objItem) {            if (is_array($arrProp)) {                reset($arrProp);            }            $arrInstance = array();            foreach ($arrProp as $propItem) {                if ( empty($strValue)) {                    eval("\$value = \$objItem->".$propItem->Name.";");                    $arrInstance[$propItem->Name] = trim($value);                } else {                    if (in_array($propItem->Name, $strValue)) {                        eval("\$value = \$objItem->".$propItem->Name.";");                        $arrInstance[$propItem->Name] = trim($value);                    }                }            }            $arrData[] = $arrInstance;        }        return $arrData;    }    function memory() {        $buffer = $this->_getWMI("Win32_OperatingSystem", array('TotalVisibleMemorySize', 'FreePhysicalMemory'));        $mem = Array();        $mem['MemTotal'] = $buffer[0]['TotalVisibleMemorySize'];        $mem['MemFree'] = $buffer[0]['FreePhysicalMemory'];        $mem['MemUsed'] = $mem['MemTotal'] - $mem['MemFree'];        $buffer = $this->_getWMI('Win32_PageFileUsage');        $mem['SwapTotal'] = 0;        $mem['SwapUsed'] = 0;        $mem['SwapPeak'] = 0;        foreach ($buffer as $swapdevice) {            $mem['SwapTotal'] += $swapdevice['AllocatedBaseSize'] * 1024;            $mem['SwapUsed'] += $swapdevice['CurrentUsage'] * 1024;            $mem['SwapPeak'] += $swapdevice['PeakUsage'] * 1024;        }        return $mem;    }}class Linux{    public $os = 'Linux';    function loadavg() {        $buf = file_get_contents('/proc/stat');        $nums=preg_split("/\s+/", substr($buf, 0, strpos($buf, "\n")));        return Array('busy' => $nums[1]+$nums[2]+$nums[3], 'idle' => intval($nums[4]));    }    function memory() {        preg_match_all('/^(MemTotal|MemFree|Cached|Buffers|SwapCached|SwapTotal|SwapFree):\s+(.*)\s*kB/im', file_get_contents('/proc/meminfo'), $matches);        $mem = array_combine( $matches[1], $matches[2] );        $mem['MemUsed'] = $mem['MemTotal'] - $mem['MemFree'] - $mem['Cached'] - $mem['Buffers'];        $mem['SwapUsed'] = $mem['SwapTotal'] - $mem['SwapFree'] - $mem['SwapCached'];        foreach ($mem as $idx=>$value)            $mem[$idx] = intval($value);        return $mem;    }}
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * hold the PMA_List base class * * @package PhpMyAdmin *//** * @todo add caching * @since phpMyAdmin 2.9.10 * @abstract * @package PhpMyAdmin */abstract class PMA_List extends ArrayObject{    /**     * @var mixed   empty item     */    protected $item_empty = '';    public function __construct($array = array(), $flags = 0, $iterator_class = "ArrayIterator")    {        parent::__construct($array, $flags, $iterator_class);    }    /**     * returns item only if there is only one in the list     *     * @return  single item     */    public function getSingleItem()    {        if (count($this) === 1) {            return reset($this);        }        return $this->getEmpty();    }    /**     * defines what is an empty item (0, '', false or null)     *     * @return  mixed   an empty item     */    public function getEmpty()    {        return $this->item_empty;    }    /**     * checks if the given db names exists in the current list, if there is     * missing at least one item it returns false otherwise true     *     * @param string  $db_name,..     one or more mysql result resources     * @return  boolean true if all items exists, otheriwse false     */    public function exists()    {        $this_elements = $this->getArrayCopy();        foreach (func_get_args() as $result) {            if (! in_array($result, $this_elements)) {                return false;            }        }        return true;    }    /**     * returns HTML <option>-tags to be used inside <select></select>     *     * @param mixed   $selected   the selected db or true for selecting current db     * @param boolean $include_information_schema     * @return  string  HTML option tags     */    public function getHtmlOptions($selected = '', $include_information_schema = true)    {        if (true === $selected) {            $selected = $this->getDefault();        }        $options = '';        foreach ($this as $each_item) {            if (false === $include_information_schema                    && PMA_is_system_schema($each_item)) {                continue;            }            $options .= '<option value="' . htmlspecialchars($each_item) . '"';            if ($selected === $each_item) {                $options .= ' selected="selected"';            }            $options .= '>' . htmlspecialchars($each_item) . '</option>' . "\n";        }        return $options;    }    /**     * returns default item     *     * @return  string  default item     */    public function getDefault()    {        return $this->getEmpty();    }    /**     * builds up the list     *     */    abstract public function build();}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Messages for phpMyAdmin. * * This file defines variables in a special format suited for the * configuration subsystem, with $strConfig as a prefix, _desc or _name * as a suffix, and the directive name in between. * * @package PhpMyAdmin */if (!function_exists('__')) {    die('Bad invocation!');}$strConfigAjaxEnable_desc = __('Improves efficiency of screen refresh');$strConfigAjaxEnable_name = __('Enable Ajax');$strConfigAllowArbitraryServer_desc = __('If enabled user can enter any MySQL server in login form for cookie auth');$strConfigAllowArbitraryServer_name = __('Allow login to any MySQL server');$strConfigAllowThirdPartyFraming_desc = __('Enabling this allows a page located on a different domain to call phpMyAdmin inside a frame, and is a potential [strong]security hole[/strong] allowing cross-frame scripting attacks');$strConfigAllowThirdPartyFraming_name = __('Allow third party framing');$strConfigAllowUserDropDatabase_name = __('Show &quot;Drop database&quot; link to normal users');$strConfigblowfish_secret_desc = __('Secret passphrase used for encrypting cookies in [kbd]cookie[/kbd] authentication');$strConfigblowfish_secret_name = __('Blowfish secret');$strConfigBrowseMarkerEnable_desc = __('Highlight selected rows');$strConfigBrowseMarkerEnable_name = __('Row marker');$strConfigBrowsePointerEnable_desc = __('Highlight row pointed by the mouse cursor');$strConfigBrowsePointerEnable_name = __('Highlight pointer');$strConfigBZipDump_desc = __('Enable [a@http://en.wikipedia.org/wiki/Bzip2]bzip2[/a] compression for import and export operations');$strConfigBZipDump_name = __('Bzip2');$strConfigCharEditing_desc = __('Defines which type of editing controls should be used for CHAR and VARCHAR columns; [kbd]input[/kbd] - allows limiting of input length, [kbd]textarea[/kbd] - allows newlines in columns');$strConfigCharEditing_name = __('CHAR columns editing');$strConfigMinSizeForInputField_desc = __('Defines the minimum size for input fields generated for CHAR and VARCHAR columns');$strConfigMinSizeForInputField_name = __('Minimum size for input field');$strConfigMaxSizeForInputField_desc = __('Defines the maximum size for input fields generated for CHAR and VARCHAR columns');$strConfigMaxSizeForInputField_name = __('Maximum size for input field');$strConfigCharTextareaCols_desc = __('Number of columns for CHAR/VARCHAR textareas');$strConfigCharTextareaCols_name = __('CHAR textarea columns');$strConfigCharTextareaRows_desc = __('Number of rows for CHAR/VARCHAR textareas');$strConfigCharTextareaRows_name = __('CHAR textarea rows');$strConfigCheckConfigurationPermissions_name = __('Check config file permissions');$strConfigCompressOnFly_desc = __('Compress gzip/bzip2 exports on the fly without the need for much memory; if you encounter problems with created gzip/bzip2 files disable this feature');$strConfigCompressOnFly_name = __('Compress on the fly');$strConfigConfigurationFile = __('Configuration file');$strConfigConfirm_desc = __('Whether a warning (&quot;Are your really sure...&quot;) should be displayed when you\'re about to lose data');$strConfigConfirm_name = __('Confirm DROP queries');$strConfigDBG_sql_name = __('Debug SQL');$strConfigDefaultDisplay_name = __('Default display direction');$strConfigDefaultTabDatabase_desc = __('Tab that is displayed when entering a database');$strConfigDefaultTabDatabase_name = __('Default database tab');$strConfigDefaultTabServer_desc = __('Tab that is displayed when entering a server');$strConfigDefaultTabServer_name = __('Default server tab');$strConfigDefaultTabTable_desc = __('Tab that is displayed when entering a table');$strConfigDefaultTabTable_name = __('Default table tab');$strConfigDisplayBinaryAsHex_desc = __('Show binary contents as HEX by default');$strConfigDisplayBinaryAsHex_name = __('Show binary contents as HEX');$strConfigDisplayDatabasesList_desc = __('Show database listing as a list instead of a drop down');$strConfigDisplayDatabasesList_name = __('Display databases as a list');$strConfigDisplayServersList_desc = __('Show server listing as a list instead of a drop down');$strConfigDisplayServersList_name = __('Display servers as a list');$strConfigDisableMultiTableMaintenance_desc = __('Disable the table maintenance mass operations, like optimizing or repairing the selected tables of a database.');$strConfigDisableMultiTableMaintenance_name = __('Disable multi table maintenance');$strConfigEditInWindow_desc = __('Edit SQL queries in popup window');$strConfigEditInWindow_name = __('Edit in window');$strConfigError_Handler_display_name = __('Display errors');$strConfigError_Handler_gather_name = __('Gather errors');$strConfigErrorIconic_desc = __('Show icons for warning, error and information messages');$strConfigErrorIconic_name = __('Iconic errors');$strConfigExecTimeLimit_desc = __('Set the number of seconds a script is allowed to run ([kbd]0[/kbd] for no limit)');$strConfigExecTimeLimit_name = __('Maximum execution time');$strConfigExport_asfile_name = __('Save as file');$strConfigExport_charset_name = __('Character set of the file');$strConfigExport_codegen_format_name = __('Format');$strConfigExport_compression_name = __('Compression');$strConfigExport_csv_columns_name = __('Put columns names in the first row');$strConfigExport_csv_enclosed_name = __('Columns enclosed by');$strConfigExport_csv_escaped_name = __('Columns escaped by');$strConfigExport_csv_null_name = __('Replace NULL by');$strConfigExport_csv_removeCRLF_name = __('Remove CRLF characters within columns');$strConfigExport_csv_separator_name = __('Columns terminated by');$strConfigExport_csv_terminated_name = __('Lines terminated by');$strConfigExport_excel_columns_name = __('Put columns names in the first row');$strConfigExport_excel_edition_name = __('Excel edition');$strConfigExport_excel_null_name = __('Replace NULL by');$strConfigExport_excel_removeCRLF_name = __('Remove CRLF characters within columns');$strConfigExport_file_template_database_name = __('Database name template');$strConfigExport_file_template_server_name = __('Server name template');$strConfigExport_file_template_table_name = __('Table name template');$strConfigExport_format_name = __('Format');$strConfigExport_htmlword_columns_name = __('Put columns names in the first row');$strConfigExport_htmlword_null_name = __('Replace NULL by');$strConfigExport_htmlword_structure_or_data_name = __('Dump table');$strConfigExport_latex_caption_name = __('Include table caption');$strConfigExport_latex_columns_name = __('Put columns names in the first row');$strConfigExport_latex_comments_name = __('Comments');$strConfigExport_latex_data_caption_name = __('Table caption');$strConfigExport_latex_data_continued_caption_name = __('Continued table caption');$strConfigExport_latex_data_label_name = __('Label key');$strConfigExport_latex_mime_name = __('MIME type');$strConfigExport_latex_null_name  = __('Replace NULL by');$strConfigExport_latex_relation_name = __('Relations');$strConfigExport_latex_structure_caption_name = __('Table caption');$strConfigExport_latex_structure_continued_caption_name = __('Continued table caption');$strConfigExport_latex_structure_label_name = __('Label key');$strConfigExport_latex_structure_or_data_name = __('Dump table');$strConfigExport_method_name = __('Export method');$strConfigExport_ods_columns_name = __('Put columns names in the first row');$strConfigExport_ods_null_name = __('Replace NULL by');$strConfigExport_odt_columns_name = __('Put columns names in the first row');$strConfigExport_odt_comments_name = __('Comments');$strConfigExport_odt_mime_name = __('MIME type');$strConfigExport_odt_null_name = __('Replace NULL by');$strConfigExport_odt_relation_name = __('Relations');$strConfigExport_odt_structure_or_data_name = __('Dump table');$strConfigExport_onserver_name = __('Save on server');$strConfigExport_onserver_overwrite_name = __('Overwrite existing file(s)');$strConfigExport_quick_export_onserver_name = __('Save on server');$strConfigExport_quick_export_onserver_overwrite_name = __('Overwrite existing file(s)');$strConfigExport_remember_file_template_name = __('Remember file name template');$strConfigExport_sql_auto_increment_name = __('Add AUTO_INCREMENT value');$strConfigExport_sql_backquotes_name = __('Enclose table and column names with backquotes');$strConfigExport_sql_compatibility_name = __('SQL compatibility mode');$strConfigExport_sql_create_table_statements_name = __('<code>CREATE TABLE</code> options:');$strConfigExport_sql_dates_name = __('Creation/Update/Check dates');$strConfigExport_sql_delayed_name = __('Use delayed inserts');$strConfigExport_sql_disable_fk_name = __('Disable foreign key checks');$strConfigExport_sql_drop_database_name = sprintf(__('Add %s'), 'DROP DATABASE');$strConfigExport_sql_drop_table_name = sprintf(__('Add %s'), 'DROP TABLE / VIEW / PROCEDURE / FUNCTION / EVENT');$strConfigExport_sql_hex_for_blob_name = __('Use hexadecimal for BLOB');$strConfigExport_sql_if_not_exists_name = sprintf(__('Add %s'), 'IF NOT EXISTS');$strConfigExport_sql_ignore_name = __('Use ignore inserts');$strConfigExport_sql_include_comments_name = __('Comments');$strConfigExport_sql_insert_syntax_name = __('Syntax to use when inserting data');$strConfigExport_sql_max_query_size_name = __('Maximal length of created query');$strConfigExport_sql_mime_name = __('MIME type');$strConfigExport_sql_procedure_function_name = sprintf(__('Add %s'), 'CREATE PROCEDURE / FUNCTION / EVENT');$strConfigExport_sql_relation_name = __('Relations');$strConfigExport_sql_structure_or_data_name = __('Dump table');$strConfigExport_sql_type_name = __('Export type');$strConfigExport_sql_use_transaction_name = __('Enclose export in a transaction');$strConfigExport_sql_utc_time_name = __('Export time in UTC');$strConfigExport_texytext_columns_name = __('Put columns names in the first row');$strConfigExport_texytext_null_name = __('Replace NULL by');$strConfigExport_texytext_structure_or_data_name = __('Dump table');$strConfigExport_xls_columns_name = __('Put columns names in the first row');$strConfigExport_xls_null_name = __('Replace NULL by');$strConfigExport_xlsx_columns_name = __('Put columns names in the first row');$strConfigExport_xlsx_null_name = __('Replace NULL by');$strConfigForceSSL_desc = __('Force secured connection while using phpMyAdmin');$strConfigForceSSL_name = __('Force SSL connection');$strConfigForeignKeyDropdownOrder_desc = __('Sort order for items in a foreign-key dropdown box; [kbd]content[/kbd] is the referenced data, [kbd]id[/kbd] is the key value');$strConfigForeignKeyDropdownOrder_name = __('Foreign key dropdown order');$strConfigForeignKeyMaxLimit_desc = __('A dropdown will be used if fewer items are present');$strConfigForeignKeyMaxLimit_name = __('Foreign key limit');$strConfigForm_Browse = __('Browse mode');$strConfigForm_Browse_desc = __('Customize browse mode');$strConfigForm_CodeGen = 'CodeGen';$strConfigForm_CodeGen_desc = __('Customize default options');$strConfigForm_Csv = __('CSV');$strConfigForm_Csv_desc = __('Customize default options');$strConfigForm_Developer = __('Developer');$strConfigForm_Developer_desc = __('Settings for phpMyAdmin developers');$strConfigForm_Edit = __('Edit mode');$strConfigForm_Edit_desc = __('Customize edit mode');$strConfigForm_Export = __('Export');$strConfigForm_Export_defaults = __('Export defaults');$strConfigForm_Export_defaults_desc = __('Customize default export options');$strConfigForm_Features = __('Features');$strConfigForm_General = __('General');$strConfigForm_General_desc = __('Set some commonly used options');$strConfigForm_Import = __('Import');$strConfigForm_Import_defaults = __('Import defaults');$strConfigForm_Import_defaults_desc = __('Customize default common import options');$strConfigForm_Import_export = __('Import / export');$strConfigForm_Import_export_desc = __('Set import and export directories and compression options');$strConfigForm_Latex = __('LaTeX');$strConfigForm_Latex_desc = __('Customize default options');$strConfigForm_Left_databases = __('Databases');$strConfigForm_Left_databases_desc = __('Databases display options');$strConfigForm_Left_frame = __('Navigation frame');$strConfigForm_Left_frame_desc = __('Customize appearance of the navigation frame');$strConfigForm_Left_servers = __('Servers');$strConfigForm_Left_servers_desc = __('Servers display options');$strConfigForm_Left_tables = __('Tables');$strConfigForm_Left_tables_desc = __('Tables display options');$strConfigForm_Main_frame = __('Main frame');$strConfigForm_Microsoft_Office = __('Microsoft Office');$strConfigForm_Microsoft_Office_desc = __('Customize default options');$strConfigForm_Open_Document = __('Open Document');$strConfigForm_Open_Document_desc = __('Customize default options');$strConfigForm_Other_core_settings = __('Other core settings');$strConfigForm_Other_core_settings_desc = __('Settings that didn\'t fit enywhere else');$strConfigForm_Page_titles = __('Page titles');$strConfigForm_Page_titles_desc = __('Specify browser\'s title bar text. Refer to [a@Documentation.html#cfg_TitleTable]documentation[/a] for magic strings that can be used to get special values.');$strConfigForm_Query_window = __('Query window');$strConfigForm_Query_window_desc = __('Customize query window options');$strConfigForm_Security = __('Security');$strConfigForm_Security_desc = __('Please note that phpMyAdmin is just a user interface and its features do not limit MySQL');$strConfigForm_Server = __('Basic settings');$strConfigForm_Server_auth = __('Authentication');$strConfigForm_Server_auth_desc = __('Authentication settings');$strConfigForm_Server_config = __('Server configuration');$strConfigForm_Server_config_desc = __('Advanced server configuration, do not change these options unless you know what they are for');$strConfigForm_Server_desc = __('Enter server connection parameters');$strConfigForm_Server_pmadb = __('Configuration storage');$strConfigForm_Server_pmadb_desc = __('Configure phpMyAdmin configuration storage to gain access to additional features, see [a@Documentation.html#linked-tables]phpMyAdmin configuration storage[/a] in documentation');$strConfigForm_Server_tracking = __('Changes tracking');$strConfigForm_Server_tracking_desc = __('Tracking of changes made in database. Requires the phpMyAdmin configuration storage.');$strConfigFormset_Export = __('Customize export options');$strConfigFormset_Features = __('Features');$strConfigFormset_Import = __('Customize import defaults');$strConfigFormset_Left_frame = __('Customize navigation frame');$strConfigFormset_Main_frame = __('Customize main frame');$strConfigFormset_Sql_queries = __('SQL queries');$strConfigForm_Sql = __('SQL');$strConfigForm_Sql_box = __('SQL Query box');$strConfigForm_Sql_box_desc = __('Customize links shown in SQL Query boxes');$strConfigForm_Sql_desc = __('Customize default options');$strConfigForm_Sql_queries = __('SQL queries');$strConfigForm_Sql_queries_desc = __('SQL queries settings');$strConfigForm_Sql_validator = __('SQL Validator');$strConfigForm_Sql_validator_desc = __('If you wish to use the SQL Validator service, you should be aware that [strong]all SQL statements are stored anonymously for statistical purposes[/strong].[br][em][a@http://sqlvalidator.mimer.com/]Mimer SQL Validator[/a], Copyright 2002 Upright Database Technology. All rights reserved.[/em]');$strConfigForm_Startup = __('Startup');$strConfigForm_Startup_desc = __('Customize startup page');$strConfigForm_Tabs = __('Tabs');$strConfigForm_Tabs_desc = __('Choose how you want tabs to work');$strConfigForm_Text_fields = __('Text fields');$strConfigForm_Text_fields_desc = __('Customize text input fields');$strConfigForm_Texy = __('Texy! text');$strConfigForm_Texy_desc = __('Customize default options');$strConfigForm_Warnings = __('Warnings');$strConfigForm_Warnings_desc = __('Disable some of the warnings shown by phpMyAdmin');$strConfigGZipDump_desc = __('Enable [a@http://en.wikipedia.org/wiki/Gzip]gzip[/a] compression for import and export operations');$strConfigGZipDump_name = __('GZip');$strConfigIconvExtraParams_name = __('Extra parameters for iconv');$strConfigIgnoreMultiSubmitErrors_desc = __('If enabled, phpMyAdmin continues computing multiple-statement queries even if one of the queries failed');$strConfigIgnoreMultiSubmitErrors_name = __('Ignore multiple statement errors');$strConfigImport_allow_interrupt_desc = __('Allow interrupt of import in case script detects it is close to time limit. This might be good way to import large files, however it can break transactions.');$strConfigImport_allow_interrupt_name = __('Partial import: allow interrupt');$strConfigImport_charset_name = __('Character set of the file');$strConfigImport_csv_col_names_name = __('Lines terminated by');$strConfigImport_csv_enclosed_name = __('Columns enclosed by');$strConfigImport_csv_escaped_name = __('Columns escaped by');$strConfigImport_csv_ignore_name = __('Do not abort on INSERT error');$strConfigImport_csv_replace_name = __('Replace table data with file');$strConfigImport_csv_terminated_name = __('Columns terminated by');$strConfigImport_format_desc = __('Default format; be aware that this list depends on location (database, table) and only SQL is always available');$strConfigImport_format_name = __('Format of imported file');$strConfigImport_ldi_enclosed_name = __('Columns enclosed by');$strConfigImport_ldi_escaped_name = __('Columns escaped by');$strConfigImport_ldi_ignore_name = __('Do not abort on INSERT error');$strConfigImport_ldi_local_option_name = __('Use LOCAL keyword');$strConfigImport_ldi_replace_name = __('Replace table data with file');$strConfigImport_ldi_terminated_name = __('Columns terminated by');$strConfigImport_ods_col_names_name = __('Column names in first row');$strConfigImport_ods_empty_rows_name = __('Do not import empty rows');$strConfigImport_ods_recognize_currency_name = __('Import currencies ($5.00 to 5.00)');$strConfigImport_ods_recognize_percentages_name = __('Import percentages as proper decimals (12.00% to .12)');$strConfigImport_skip_queries_desc = __('Number of queries to skip from start');$strConfigImport_skip_queries_name = __('Partial import: skip queries');$strConfigImport_sql_compatibility_name = __('SQL compatibility mode');$strConfigImport_sql_no_auto_value_on_zero_name = __('Do not use AUTO_INCREMENT for zero values');$strConfigImport_xls_col_names_name = __('Column names in first row');$strConfigImport_xlsx_col_names_name = __('Column names in first row');$strConfigInitialSlidersState_name = __('Initial state for sliders');$strConfigInsertRows_desc = __('How many rows can be inserted at one time');$strConfigInsertRows_name = __('Number of inserted rows');$strConfigLeftDefaultTabTable_name = __('Target for quick access icon');$strConfigLeftDisplayLogo_desc = __('Show logo in left frame');$strConfigLeftDisplayLogo_name = __('Display logo');$strConfigLeftDisplayServers_desc = __('Display server choice at the top of the left frame');$strConfigLeftDisplayServers_name = __('Display servers selection');$strConfigLeftDisplayTableFilterMinimum_name = __('Minimum number of tables to display the table filter box');$strConfigLeftFrameDBSeparator_desc = __('String that separates databases into different tree levels');$strConfigLeftFrameDBSeparator_name = __('Database tree separator');$strConfigLeftFrameDBTree_desc = __('Only light version; display databases in a tree (determined by the separator defined below)');$strConfigLeftFrameDBTree_name = __('Display databases in a tree');$strConfigLeftFrameLight_desc = __('Disable this if you want to see all databases at once');$strConfigLeftFrameLight_name = __('Use light version');$strConfigLeftFrameTableLevel_name = __('Maximum table tree depth');$strConfigLeftFrameTableSeparator_desc = __('String that separates tables into different tree levels');$strConfigLeftFrameTableSeparator_name = __('Table tree separator');$strConfigLeftLogoLink_desc = __('URL where logo in the navigation frame will point to');$strConfigLeftLogoLink_name = __('Logo link URL');$strConfigLeftLogoLinkWindow_desc = __('Open the linked page in the main window ([kbd]main[/kbd]) or in a new one ([kbd]new[/kbd])');$strConfigLeftLogoLinkWindow_name = __('Logo link target');$strConfigLeftPointerEnable_desc = __('Highlight server under the mouse cursor');$strConfigLeftPointerEnable_name = __('Enable highlighting');$strConfigLeftRecentTable_desc = __('Maximum number of recently used tables; set 0 to disable');$strConfigLeftRecentTable_name = __('Recently used tables');$strConfigLightTabs_desc = __('Use less graphically intense tabs');$strConfigLightTabs_name = __('Light tabs');$strConfigLimitChars_desc = __('Maximum number of characters shown in any non-numeric column on browse view');$strConfigLimitChars_name = __('Limit column characters');$strConfigLoginCookieDeleteAll_desc = __('If TRUE, logout deletes cookies for all servers; when set to FALSE, logout only occurs for the current server. Setting this to FALSE makes it easy to forget to log out from other servers when connected to multiple servers.');$strConfigLoginCookieDeleteAll_name = __('Delete all cookies on logout');$strConfigLoginCookieRecall_desc = __('Define whether the previous login should be recalled or not in cookie authentication mode');$strConfigLoginCookieRecall_name = __('Recall user name');$strConfigLoginCookieStore_desc = __('Defines how long (in seconds) a login cookie should be stored in browser. The default of 0 means that it will be kept for the existing session only, and will be deleted as soon as you close the browser window. This is recommended for non-trusted environments.');$strConfigLoginCookieStore_name = __('Login cookie store');$strConfigLoginCookieValidity_desc = __('Define how long (in seconds) a login cookie is valid');$strConfigLoginCookieValidity_name = __('Login cookie validity');$strConfigLongtextDoubleTextarea_desc = __('Double size of textarea for LONGTEXT columns');$strConfigLongtextDoubleTextarea_name = __('Bigger textarea for LONGTEXT');$strConfigMainPageIconic_name = __('Use icons on main page');$strConfigMaxCharactersInDisplayedSQL_desc = __('Maximum number of characters used when a SQL query is displayed');$strConfigMaxCharactersInDisplayedSQL_name = __('Maximum displayed SQL length');$strConfigMaxDbList_cmt = __('Users cannot set a higher value');$strConfigMaxDbList_desc = __('Maximum number of databases displayed in left frame and database list');$strConfigMaxDbList_name = __('Maximum databases');$strConfigMaxRows_desc = __('Number of rows displayed when browsing a result set. If the result set contains more rows, &quot;Previous&quot; and &quot;Next&quot; links will be shown.');$strConfigMaxRows_name = __('Maximum number of rows to display');$strConfigMaxTableList_cmt = __('Users cannot set a higher value');$strConfigMaxTableList_desc = __('Maximum number of tables displayed in table list');$strConfigMaxTableList_name = __('Maximum tables');$strConfigMcryptDisableWarning_desc = __('Disable the default warning that is displayed if mcrypt is missing for cookie authentication');$strConfigMcryptDisableWarning_name = __('mcrypt warning');$strConfigMemoryLimit_desc = __('The number of bytes a script is allowed to allocate, eg. [kbd]32M[/kbd] ([kbd]0[/kbd] for no limit)');$strConfigMemoryLimit_name = __('Memory limit');$strConfigRowActionLinks_desc = __('These are Edit, Copy and Delete links');$strConfigRowActionLinks_name = __('Where to show the table row links');$strConfigNaturalOrder_desc = __('Use natural order for sorting table and database names');$strConfigNaturalOrder_name = __('Natural order');$strConfigNavigationBarIconic_desc = __('Use only icons, only text or both');$strConfigNavigationBarIconic_name = __('Iconic navigation bar');$strConfigOBGzip_desc = __('use GZip output buffering for increased speed in HTTP transfers');$strConfigOBGzip_name = __('GZip output buffering');$strConfigOrder_desc = __('[kbd]SMART[/kbd] - i.e. descending order for columns of type TIME, DATE, DATETIME and TIMESTAMP, ascending order otherwise');$strConfigOrder_name = __('Default sorting order');$strConfigPersistentConnections_desc = __('Use persistent connections to MySQL databases');$strConfigPersistentConnections_name = __('Persistent connections');$strConfigPmaNoRelation_DisableWarning_desc = __('Disable the default warning that is displayed on the database details Structure page if any of the required tables for the phpMyAdmin configuration storage could not be found');$strConfigPmaNoRelation_DisableWarning_name = __('Missing phpMyAdmin configuration storage tables');$strConfigPropertiesIconic_desc = __('Use only icons, only text or both');$strConfigPropertiesIconic_name = __('Iconic table operations');$strConfigProtectBinary_desc = __('Disallow BLOB and BINARY columns from editing');$strConfigProtectBinary_name = __('Protect binary columns');$strConfigQueryHistoryDB_desc = __('Enable if you want DB-based query history (requires phpMyAdmin configuration storage). If disabled, this utilizes JS-routines to display query history (lost by window close).');$strConfigQueryHistoryDB_name = __('Permanent query history');$strConfigQueryHistoryMax_cmt = __('Users cannot set a higher value');$strConfigQueryHistoryMax_desc = __('How many queries are kept in history');$strConfigQueryHistoryMax_name = __('Query history length');$strConfigQueryWindowDefTab_desc = __('Tab displayed when opening a new query window');$strConfigQueryWindowDefTab_name = __('Default query window tab');$strConfigQueryWindowHeight_desc = __('Query window height (in pixels)');$strConfigQueryWindowHeight_name = __('Query window height');$strConfigQueryWindowWidth_desc = __('Query window width (in pixels)');$strConfigQueryWindowWidth_name = __('Query window width');$strConfigRecodingEngine_desc = __('Select which functions will be used for character set conversion');$strConfigRecodingEngine_name = __('Recoding engine');$strConfigRememberSorting_desc = __('When browsing tables, the sorting of each table is remembered');$strConfigRememberSorting_name = __('Remember table\'s sorting');$strConfigRepeatCells_desc = __('Repeat the headers every X cells, [kbd]0[/kbd] deactivates this feature');$strConfigRepeatCells_name = __('Repeat headers');$strConfigReplaceHelpImg_desc = __('Show help button instead of Documentation text');$strConfigReplaceHelpImg_name = __('Show help button');$strConfigRestoreDefaultValue = __('Restore default value');$strConfigSaveCellsAtOnce_name = __('Save all edited cells at once');$strConfigSaveDir_desc = __('Directory where exports can be saved on server');$strConfigSaveDir_name = __('Save directory');$strConfigServers_AllowDeny_order_desc = __('Leave blank if not used');$strConfigServers_AllowDeny_order_name = __('Host authorization order');$strConfigServers_AllowDeny_rules_desc = __('Leave blank for defaults');$strConfigServers_AllowDeny_rules_name = __('Host authorization rules');$strConfigServers_AllowNoPassword_name = __('Allow logins without a password');$strConfigServers_AllowRoot_name = __('Allow root login');$strConfigServers_auth_http_realm_desc = __('HTTP Basic Auth Realm name to display when doing HTTP Auth');$strConfigServers_auth_http_realm_name = __('HTTP Realm');$strConfigServers_auth_swekey_config_desc = __('The path for the config file for [a@http://swekey.com]SweKey hardware authentication[/a] (not located in your document root; suggested: /etc/swekey.conf)');$strConfigServers_auth_swekey_config_name = __('SweKey config file');$strConfigServers_auth_type_desc = __('Authentication method to use');$strConfigServers_auth_type_name = __('Authentication type');$strConfigServers_bookmarktable_desc = __('Leave blank for no [a@http://wiki.phpmyadmin.net/pma/bookmark]bookmark[/a] support, suggested: [kbd]pma_bookmark[/kbd]');$strConfigServers_bookmarktable_name = __('Bookmark table');$strConfigServers_column_info_desc = __('Leave blank for no column comments/mime types, suggested: [kbd]pma_column_info[/kbd]');$strConfigServers_column_info_name = __('Column information table');$strConfigServers_compress_desc = __('Compress connection to MySQL server');$strConfigServers_compress_name = __('Compress connection');$strConfigServers_connect_type_desc = __('How to connect to server, keep [kbd]tcp[/kbd] if unsure');$strConfigServers_connect_type_name = __('Connection type');$strConfigServers_controlpass_name = __('Control user password');$strConfigServers_controluser_desc = __('A special MySQL user configured with limited permissions, more information available on [a@http://wiki.phpmyadmin.net/pma/controluser]wiki[/a]');$strConfigServers_controluser_name = __('Control user');$strConfigServers_controlhost_desc = __('An alternate host to hold the configuration storage; leave blank to use the already defined host');$strConfigServers_controlhost_name = __('Control host');$strConfigServers_CountTables_desc = __('Count tables when showing database list');$strConfigServers_CountTables_name = __('Count tables');$strConfigServers_designer_coords_desc = __('Leave blank for no Designer support, suggested: [kbd]pma_designer_coords[/kbd]');$strConfigServers_designer_coords_name = __('Designer table');$strConfigServers_DisableIS_desc = __('More information on [a@http://sf.net/support/tracker.php?aid=1849494]PMA bug tracker[/a] and [a@http://bugs.mysql.com/19588]MySQL Bugs[/a]');$strConfigServers_DisableIS_name = __('Disable use of INFORMATION_SCHEMA');$strConfigServers_extension_desc = __('What PHP extension to use; you should use mysqli if supported');$strConfigServers_extension_name = __('PHP extension to use');$strConfigServers_hide_db_desc = __('Hide databases matching regular expression (PCRE)');$strConfigServers_hide_db_name = __('Hide databases');$strConfigServers_history_desc = __('Leave blank for no SQL query history support, suggested: [kbd]pma_history[/kbd]');$strConfigServers_history_name = __('SQL query history table');$strConfigServers_host_desc = __('Hostname where MySQL server is running');$strConfigServers_host_name = __('Server hostname');$strConfigServers_LogoutURL_name = __('Logout URL');$strConfigServers_MaxTableUiprefs_desc = __('Limits number of table preferences which are stored in database, the oldest records are automatically removed');$strConfigServers_MaxTableUiprefs_name = __('Maximal number of table preferences to store');$strConfigServers_nopassword_desc = __('Try to connect without password');$strConfigServers_nopassword_name = __('Connect without password');$strConfigServers_only_db_desc = __('You can use MySQL wildcard characters (% and _), escape them if you want to use their literal instances, i.e. use [kbd]\'my\_db\'[/kbd] and not [kbd]\'my_db\'[/kbd]. Using this option you can sort database list, just enter their names in order and use [kbd]*[/kbd] at the end to show the rest in alphabetical order.');$strConfigServers_only_db_name = __('Show only listed databases');$strConfigServers_password_desc = __('Leave empty if not using config auth');$strConfigServers_password_name = __('Password for config auth');$strConfigServers_pdf_pages_desc = __('Leave blank for no PDF schema support, suggested: [kbd]pma_pdf_pages[/kbd]');$strConfigServers_pdf_pages_name = __('PDF schema: pages table');$strConfigServers_pmadb_desc = __('Database used for relations, bookmarks, and PDF features. See [a@http://wiki.phpmyadmin.net/pma/pmadb]pmadb[/a] for complete information. Leave blank for no support. Suggested: [kbd]phpmyadmin[/kbd]');$strConfigServers_pmadb_name = __('Database name');$strConfigServers_port_desc = __('Port on which MySQL server is listening, leave empty for default');$strConfigServers_port_name = __('Server port');$strConfigServers_recent_desc = __('Leave blank for no "persistent" recently used tables across sessions, suggested: [kbd]pma_recent[/kbd]');$strConfigServers_recent_name = __('Recently used table');$strConfigServers_relation_desc = __('Leave blank for no [a@http://wiki.phpmyadmin.net/pma/relation]relation-links[/a] support, suggested: [kbd]pma_relation[/kbd]');$strConfigServers_relation_name = __('Relation table');$strConfigServers_ShowDatabasesCommand_desc = __('SQL command to fetch available databases');$strConfigServers_ShowDatabasesCommand_name = __('SHOW DATABASES command');$strConfigServers_SignonSession_desc = __('See [a@http://wiki.phpmyadmin.net/pma/auth_types#signon]authentication types[/a] for an example');$strConfigServers_SignonSession_name = __('Signon session name');$strConfigServers_SignonURL_name = __('Signon URL');$strConfigServers_socket_desc = __('Socket on which MySQL server is listening, leave empty for default');$strConfigServers_socket_name = __('Server socket');$strConfigServers_ssl_desc = __('Enable SSL for connection to MySQL server');$strConfigServers_ssl_name = __('Use SSL');$strConfigServers_table_coords_desc = __('Leave blank for no PDF schema support, suggested: [kbd]pma_table_coords[/kbd]');$strConfigServers_table_coords_name = __('PDF schema: table coordinates');$strConfigServers_table_info_desc = __('Table to describe the display columns, leave blank for no support; suggested: [kbd]pma_table_info[/kbd]');$strConfigServers_table_info_name = __('Display columns table');$strConfigServers_table_uiprefs_desc = __('Leave blank for no "persistent" tables\'UI preferences across sessions, suggested: [kbd]pma_table_uiprefs[/kbd]');$strConfigServers_table_uiprefs_name = __('UI preferences table');$strConfigServers_tracking_add_drop_database_desc = __('Whether a DROP DATABASE IF EXISTS statement will be added as first line to the log when creating a database.');$strConfigServers_tracking_add_drop_database_name = __('Add DROP DATABASE');$strConfigServers_tracking_add_drop_table_desc = __('Whether a DROP TABLE IF EXISTS statement will be added as first line to the log when creating a table.');$strConfigServers_tracking_add_drop_table_name = __('Add DROP TABLE');$strConfigServers_tracking_add_drop_view_desc = __('Whether a DROP VIEW IF EXISTS statement will be added as first line to the log when creating a view.');$strConfigServers_tracking_add_drop_view_name = __('Add DROP VIEW');$strConfigServers_tracking_default_statements_desc = __('Defines the list of statements the auto-creation uses for new versions.');$strConfigServers_tracking_default_statements_name = __('Statements to track');$strConfigServers_tracking_desc = __('Leave blank for no SQL query tracking support, suggested: [kbd]pma_tracking[/kbd]');$strConfigServers_tracking_name = __('SQL query tracking table');$strConfigServers_tracking_version_auto_create_desc = __('Whether the tracking mechanism creates versions for tables and views automatically.');$strConfigServers_tracking_version_auto_create_name = __('Automatically create versions');$strConfigServers_userconfig_desc = __('Leave blank for no user preferences storage in database, suggested: [kbd]pma_userconfig[/kbd]');$strConfigServers_userconfig_name = __('User preferences storage table');$strConfigServers_user_desc = __('Leave empty if not using config auth');$strConfigServers_user_name = __('User for config auth');$strConfigServers_verbose_check_desc = __('Disable if you know that your pma_* tables are up to date. This prevents compatibility checks and thereby increases performance');$strConfigServers_verbose_check_name = __('Verbose check');$strConfigServers_verbose_desc = __('A user-friendly description of this server. Leave blank to display the hostname instead.');$strConfigServers_verbose_name = __('Verbose name of this server');$strConfigShowAll_desc = __('Whether a user should be displayed a &quot;show all (rows)&quot; button');$strConfigShowAll_name = __('Allow to display all the rows');$strConfigShowChgPassword_desc = __('Please note that enabling this has no effect with [kbd]config[/kbd] authentication mode because the password is hard coded in the configuration file; this does not limit the ability to execute the same command directly');$strConfigShowChgPassword_name = __('Show password change form');$strConfigShowCreateDb_name = __('Show create database form');$strConfigShowDisplayDirection_desc = __('Defines whether or not type display direction option is shown when browsing a table');$strConfigShowDisplayDirection_name = __('Show display direction');$strConfigShowFieldTypesInDataEditView_desc = __('Defines whether or not type fields should be initially displayed in edit/insert mode');$strConfigShowFieldTypesInDataEditView_name = __('Show field types');$strConfigShowFunctionFields_desc = __('Display the function fields in edit/insert mode');$strConfigShowFunctionFields_name = __('Show function fields');$strConfigShowHint_desc = __('Whether to show hint or not');$strConfigShowHint_name = __('Show hint');$strConfigShowPhpInfo_desc = __('Shows link to [a@http://php.net/manual/function.phpinfo.php]phpinfo()[/a] output');$strConfigShowPhpInfo_name = __('Show phpinfo() link');$strConfigShowServerInfo_name = __('Show detailed MySQL server information');$strConfigShowSQL_desc = __('Defines whether SQL queries generated by phpMyAdmin should be displayed');$strConfigShowSQL_name = __('Show SQL queries');$strConfigRetainQueryBox_desc = __('Defines whether the query box should stay on-screen after its submission');$strConfigRetainQueryBox_name = __('Retain query box');$strConfigShowStats_desc = __('Allow to display database and table statistics (eg. space usage)');$strConfigShowStats_name = __('Show statistics');$strConfigShowTooltipAliasDB_desc = __('If tooltips are enabled and a database comment is set, this will flip the comment and the real name');$strConfigShowTooltipAliasDB_name = __('Display database comment instead of its name');$strConfigShowTooltipAliasTB_desc = __('When setting this to [kbd]nested[/kbd], the alias of the table name is only used to split/nest the tables according to the $cfg[\'LeftFrameTableSeparator\'] directive, so only the folder is called like the alias, the table name itself stays unchanged');$strConfigShowTooltipAliasTB_name = __('Display table comment instead of its name');$strConfigShowTooltip_name = __('Display table comments in tooltips');$strConfigSkipLockedTables_desc = __('Mark used tables and make it possible to show databases with locked tables');$strConfigSkipLockedTables_name = __('Skip locked tables');$strConfigSQLQuery_Edit_name = __('Edit');$strConfigSQLQuery_Explain_name = __('Explain SQL');$strConfigSQLQuery_Refresh_name = __('Refresh');$strConfigSQLQuery_ShowAsPHP_name = __('Create PHP Code');$strConfigSQLQuery_Validate_desc = __('Requires SQL Validator to be enabled');$strConfigSQLQuery_Validate_name = __('Validate SQL');$strConfigSQLValidator_password_name = __('Password');$strConfigSQLValidator_use_desc = __('[strong]Warning:[/strong] requires PHP SOAP extension or PEAR SOAP to be installed');$strConfigSQLValidator_use_name = __('Enable SQL Validator');$strConfigSQLValidator_username_desc = __('If you have a custom username, specify it here (defaults to [kbd]anonymous[/kbd])');$strConfigSQLValidator_username_name = __('Username');$strConfigSuggestDBName_desc = __('Suggest a database name on the &quot;Create Database&quot; form (if possible) or keep the text field empty');$strConfigSuggestDBName_name = __('Suggest new database name');$strConfigSuhosinDisableWarning_desc = __('A warning is displayed on the main page if Suhosin is detected');$strConfigSuhosinDisableWarning_name = __('Suhosin warning');$strConfigTextareaCols_desc = __('Textarea size (columns) in edit mode, this value will be emphasized for SQL query textareas (*2) and for query window (*1.25)');$strConfigTextareaCols_name = __('Textarea columns');$strConfigTextareaRows_desc = __('Textarea size (rows) in edit mode, this value will be emphasized for SQL query textareas (*2) and for query window (*1.25)');$strConfigTextareaRows_name = __('Textarea rows');$strConfigTitleDatabase_desc = __('Title of browser window when a database is selected');$strConfigTitleDatabase_name = __('Database');$strConfigTitleDefault_desc = __('Title of browser window when nothing is selected');$strConfigTitleDefault_name = __('Default title');$strConfigTitleServer_desc = __('Title of browser window when a server is selected');$strConfigTitleServer_name = __('Server');$strConfigTitleTable_desc = __('Title of browser window when a table is selected');$strConfigTitleTable_name = __('Table');$strConfigTrustedProxies_desc = __('Input proxies as [kbd]IP: trusted HTTP header[/kbd]. The following example specifies that phpMyAdmin should trust a HTTP_X_FORWARDED_FOR (X-Forwarded-For) header coming from the proxy 1.2.3.4:[br][kbd]1.2.3.4: HTTP_X_FORWARDED_FOR[/kbd]');$strConfigTrustedProxies_name = __('List of trusted proxies for IP allow/deny');$strConfigUploadDir_desc = __('Directory on server where you can upload files for import');$strConfigUploadDir_name = __('Upload directory');$strConfigUseDbSearch_desc = __('Allow for searching inside the entire database');$strConfigUseDbSearch_name = __('Use database search');$strConfigUserprefsDeveloperTab_desc = __('When disabled, users cannot set any of the options below, regardless of the checkbox on the right');$strConfigUserprefsDeveloperTab_name = __('Enable the Developer tab in settings');$strConfigVerboseMultiSubmit_desc = __('Show affected rows of each statement on multiple-statement queries. See libraries/import.lib.php for defaults on how many queries a statement may contain.');$strConfigVerboseMultiSubmit_name = __('Verbose multiple statements');$strConfigVersionCheckLink = __('Check for latest version');$strConfigVersionCheck_desc = __('Enables check for latest version on main phpMyAdmin page');$strConfigVersionCheck_name = __('Version check');$strConfigZipDump_desc = __('Enable [a@http://en.wikipedia.org/wiki/ZIP_(file_format)]ZIP[/a] compression for import and export operations');$strConfigZipDump_name = __('ZIP');?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package     BLOBStreaming *//** * Core library. */require_once './libraries/common.inc.php';// Check URL parametersPMA_checkParameters(array('reference', 'c_type'));// Increase time limit, because fetching blob might take some time@set_time_limit(0);$reference = $_REQUEST['reference'];/* * FIXME: Maybe it would be better to check MIME type against whitelist as * this code sems to support only few MIME types (check * function PMA_BS_CreateReferenceLink in libraries/blobstreaming.lib.php). */$c_type = preg_replace('/[^A-Za-z0-9/_-]/', '_', $_REQUEST['c_type']);// Get the blob streaming URL$filename = PMA_BS_getURL($reference);if (empty($filename)) {    die(__('No blob streaming server configured!'));}$hdrs = get_headers($filename, 1);if ($hdrs === false) {    die(__('Failed to fetch headers'));}$fHnd = fopen($filename, "rb");if ($fHnd === false) {    die(__('Failed to open remote URL'));}$f_size = $hdrs['Content-Length'];PMA_download_header(basename($filename), $c_type, $f_size);$pos = 0;$content = "";while (!feof($fHnd)) {    $content .= fread($fHnd, $f_size);    $pos = strlen($content);    if ($pos >= $f_size) {        break;    }}echo $content;flush();fclose($fHnd);
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * This file generates the CSS code for the sprites of a theme * * @package PhpMyAdmin-theme */// unplanned execution pathif (!defined('PMA_MINIMUM_COMMON')) {    exit();}$bg = $_SESSION['PMA_Theme']->getImgPath() . 'sprites.png';?>/* Icon sprites */.icon, .footnotemarker {    margin:              0 0.3em;    padding:             0 !important;    width:               16px;    height:              16px;    background-image:    url('<?php echo $bg; ?>') !important;    background-repeat:   no-repeat !important;    background-position: top left !important;}<?php    /* Check if there is a valid data file for sprites */    if (is_readable($_SESSION['PMA_Theme']->getPath() . '/sprites.lib.php')) {        include_once $_SESSION['PMA_Theme']->getPath() . '/sprites.lib.php';        $sprites = array();        if (function_exists('PMA_sprites')) {            $sprites = PMA_sprites();        }        $template = ".ic_%s { background-position: 0 -%upx !important;%s%s }\n";        foreach ($sprites as $name => $data) {            // generate the CSS code for each icon            $width = '';            $height = '';            // if either the height or width of an icon is 16px,            // then it's pointless to set this as a parameter,            //since it will be inherited from the "icon" class            if ($data['width'] != 16) {                $width = " width: " . $data['width'] . "px;";            }            if ($data['height'] != 16) {                $height = " height: " . $data['height'] . "px;";            }            printf(                $template,                $name,                ($data['position'] * 16),                $width,                $height            );        }        // Here we map some of the classes that we        // defined above to other CSS selectors.        // The indexes of the array correspond to        // already defined classes and the values        // are the selectors that we want to map to.        $elements = array(            's_sortable' => 'img.sortableIcon',            's_asc'      => 'th.headerSortUp img.sortableIcon',            's_desc'     => 'th.headerSortDown img.sortableIcon'        );        $template = "%s { background-position: 0 -%upx; "                  . "height: %upx; width: %upx; }\n";        foreach ($elements as $key => $value) {            if (isset($sprites[$key])) { // If the CSS class has been defined                printf(                    $template,                    $value,                    ($sprites[$key]['position'] * 16),                    $sprites[$key]['height'],                    $sprites[$key]['width']                );            }        }    }?>
<?php/** * Handles the visualization of GIS POLYGON objects. * * @package PhpMyAdmin-GIS */class PMA_GIS_Polygon extends PMA_GIS_Geometry{    // Hold the singleton instance of the class    private static $_instance;    /**     * A private constructor; prevents direct creation of object.     */    private function __construct()    {    }    /**     * Returns the singleton.     *     * @return the singleton     */    public static function singleton()    {        if (!isset(self::$_instance)) {            $class = __CLASS__;            self::$_instance = new $class;        }        return self::$_instance;    }    /**     * Scales each row.     *     * @param string $spatial spatial data of a row     *     * @return array containing the min, max values for x and y cordinates     */    public function scaleRow($spatial)    {        // Trim to remove leading 'POLYGON((' and trailing '))'        $polygon = substr($spatial, 9, (strlen($spatial) - 11));        // If the polygon doesn't have an inner ring, use polygon itself        if (strpos($polygon, "),(") === false) {            $ring = $polygon;        } else {            // Seperate outer ring and use it to determin min-max            $parts = explode("),(", $polygon);            $ring = $parts[0];        }        return $this->setMinMax($ring, array());    }    /**     * Adds to the PNG image object, the data related to a row in the GIS dataset.     *     * @param string $spatial    GIS POLYGON object     * @param string $label      Label for the GIS POLYGON object     * @param string $fill_color Color for the GIS POLYGON object     * @param array  $scale_data Array containing data related to scaling     * @param image  $image      Image object     *     * @return the modified image object     */    public function prepareRowAsPng($spatial, $label, $fill_color, $scale_data, $image)    {        // allocate colors        $black = imagecolorallocate($image, 0, 0, 0);        $red   = hexdec(substr($fill_color, 1, 2));        $green = hexdec(substr($fill_color, 3, 2));        $blue  = hexdec(substr($fill_color, 4, 2));        $color = imagecolorallocate($image, $red, $green, $blue);        // Trim to remove leading 'POLYGON((' and trailing '))'        $polygon = substr($spatial, 9, (strlen($spatial) - 11));        // If the polygon doesnt have an inner polygon        if (strpos($polygon, "),(") === false) {            $points_arr = $this->extractPoints($polygon, $scale_data, true);        } else {            // Seperate outer and inner polygons            $parts = explode("),(", $polygon);            $outer = $parts[0];            $inner = array_slice($parts, 1);            $points_arr = $this->extractPoints($outer, $scale_data, true);            foreach ($inner as $inner_poly) {                $points_arr = array_merge(                    $points_arr, $this->extractPoints($inner_poly, $scale_data, true)                );            }        }        // draw polygon        imagefilledpolygon($image, $points_arr, sizeof($points_arr) / 2, $color);        // print label if applicable        if (isset($label) && trim($label) != '') {            imagestring($image, 1, $points_arr[2], $points_arr[3], trim($label), $black);        }        return $image;    }    /**     * Adds to the TCPDF instance, the data related to a row in the GIS dataset.     *     * @param string $spatial    GIS POLYGON object     * @param string $label      Label for the GIS POLYGON object     * @param string $fill_color Color for the GIS POLYGON object     * @param array  $scale_data Array containing data related to scaling     * @param image  $pdf        TCPDF instance     *     * @return the modified TCPDF instance     */    public function prepareRowAsPdf($spatial, $label, $fill_color, $scale_data, $pdf)    {        // allocate colors        $red   = hexdec(substr($fill_color, 1, 2));        $green = hexdec(substr($fill_color, 3, 2));        $blue  = hexdec(substr($fill_color, 4, 2));        $color = array($red, $green, $blue);        // Trim to remove leading 'POLYGON((' and trailing '))'        $polygon = substr($spatial, 9, (strlen($spatial) - 11));        // If the polygon doesnt have an inner polygon        if (strpos($polygon, "),(") === false) {            $points_arr = $this->extractPoints($polygon, $scale_data, true);        } else {            // Seperate outer and inner polygons            $parts = explode("),(", $polygon);            $outer = $parts[0];            $inner = array_slice($parts, 1);            $points_arr = $this->extractPoints($outer, $scale_data, true);            foreach ($inner as $inner_poly) {                $points_arr = array_merge(                    $points_arr, $this->extractPoints($inner_poly, $scale_data, true)                );            }        }        // draw polygon        $pdf->Polygon($points_arr, 'F*', array(), $color, true);        // print label if applicable        if (isset($label) && trim($label) != '') {            $pdf->SetXY($points_arr[2], $points_arr[3]);            $pdf->SetFontSize(5);            $pdf->Cell(0, 0, trim($label));        }        return $pdf;    }    /**     * Prepares and returns the code related to a row in the GIS dataset as SVG.     *     * @param string $spatial    GIS POLYGON object     * @param string $label      Label for the GIS POLYGON object     * @param string $fill_color Color for the GIS POLYGON object     * @param array  $scale_data Array containing data related to scaling     *     * @return the code related to a row in the GIS dataset     */    public function prepareRowAsSvg($spatial, $label, $fill_color, $scale_data)    {        $polygon_options = array(            'name'        => $label,            'id'          => $label . rand(),            'class'       => 'polygon vector',            'stroke'      => 'black',            'stroke-width'=> 0.5,            'fill'        => $fill_color,            'fill-rule'   => 'evenodd',            'fill-opacity'=> 0.8,        );        // Trim to remove leading 'POLYGON((' and trailing '))'        $polygon = substr($spatial, 9, (strlen($spatial) - 11));        $row = '<path d="';        // If the polygon doesnt have an inner polygon        if (strpos($polygon, "),(") === false) {            $row .= $this->_drawPath($polygon, $scale_data);        } else {            // Seperate outer and inner polygons            $parts = explode("),(", $polygon);            $outer = $parts[0];            $inner = array_slice($parts, 1);            $row .= $this->_drawPath($outer, $scale_data);            foreach ($inner as $inner_poly) {                $row .= $this->_drawPath($inner_poly, $scale_data);            }        }        $row .= '"';        foreach ($polygon_options as $option => $val) {            $row .= ' ' . $option . '="' . trim($val) . '"';        }        $row .= '/>';        return $row;    }    /**     * Prepares JavaScript related to a row in the GIS dataset     * to visualize it with OpenLayers.     *     * @param string $spatial    GIS POLYGON object     * @param int    $srid       Spatial reference ID     * @param string $label      Label for the GIS POLYGON object     * @param string $fill_color Color for the GIS POLYGON object     * @param array  $scale_data Array containing data related to scaling     *     * @return JavaScript related to a row in the GIS dataset     */    public function prepareRowAsOl($spatial, $srid, $label, $fill_color, $scale_data)    {        $style_options = array(            'strokeColor' => '#000000',            'strokeWidth' => 0.5,            'fillColor'   => $fill_color,            'fillOpacity' => 0.8,            'label'       => $label,            'fontSize'    => 10,        );        if ($srid == 0) {            $srid = 4326;        }        $row = $this->getBoundsForOl($srid, $scale_data);        // Trim to remove leading 'POLYGON((' and trailing '))'        $polygon = substr($spatial, 9, (strlen($spatial) - 11));        $row .= 'vectorLayer.addFeatures(new OpenLayers.Feature.Vector(';        $row .= $this->addPointsForOpenLayersPolygon($polygon, $srid);        $row .= 'null, ' . json_encode($style_options) . '));';        return $row;    }    /**     * Draws a ring of the polygon using SVG path element.     *     * @param string $polygon    The ring     * @param array  $scale_data Array containing data related to scaling     *     * @return the code to draw the ring     */    private function _drawPath($polygon, $scale_data)    {        $points_arr = $this->extractPoints($polygon, $scale_data);        $row = ' M ' . $points_arr[0][0] . ', ' . $points_arr[0][1];        $other_points = array_slice($points_arr, 1, count($points_arr) - 2);        foreach ($other_points as $point) {            $row .= ' L ' . $point[0] . ', ' . $point[1];        }        $row .= ' Z ';        return $row;    }    /**     * Generate the WKT with the set of parameters passed by the GIS editor.     *     * @param array  $gis_data GIS data     * @param int    $index    Index into the parameter object     * @param string $empty    Value for empty points     *     * @return WKT with the set of parameters passed by the GIS editor     */    public function generateWkt($gis_data, $index, $empty = '')    {        $no_of_lines = isset($gis_data[$index]['POLYGON']['no_of_lines'])            ? $gis_data[$index]['POLYGON']['no_of_lines'] : 1;        if ($no_of_lines < 1) {            $no_of_lines = 1;        }        $wkt = 'POLYGON(';        for ($i = 0; $i < $no_of_lines; $i++) {            $no_of_points = isset($gis_data[$index]['POLYGON'][$i]['no_of_points'])                ? $gis_data[$index]['POLYGON'][$i]['no_of_points'] : 4;            if ($no_of_points < 4) {                $no_of_points = 4;            }            $wkt .= '(';            for ($j = 0; $j < $no_of_points; $j++) {                $wkt .= ((isset($gis_data[$index]['POLYGON'][$i][$j]['x'])                    && trim($gis_data[$index]['POLYGON'][$i][$j]['x']) != '')                    ? $gis_data[$index]['POLYGON'][$i][$j]['x'] : $empty)                    . ' ' . ((isset($gis_data[$index]['POLYGON'][$i][$j]['y'])                    && trim($gis_data[$index]['POLYGON'][$i][$j]['y']) != '')                    ? $gis_data[$index]['POLYGON'][$i][$j]['y'] : $empty) .',';            }            $wkt = substr($wkt, 0, strlen($wkt) - 1);            $wkt .= '),';        }        $wkt = substr($wkt, 0, strlen($wkt) - 1);        $wkt .= ')';        return $wkt;    }    /**     * Calculates the area of a closed simple polygon.     *     * @param array $ring array of points forming the ring     *     * @return the area of a closed simple polygon.     */    public static function area($ring)    {        $no_of_points = count($ring);        // If the last point is same as the first point ignore it        $last = count($ring) - 1;        if (($ring[0]['x'] == $ring[$last]['x'])            && ($ring[0]['y'] == $ring[$last]['y'])        ) {            $no_of_points--;        }        //         _n-1        // A = _1_ \    (X(i) * Y(i+1)) - (Y(i) * X(i+1))        //      2  /__        //         i=0        $area = 0;        for ($i = 0; $i < $no_of_points; $i++) {            $j = ($i + 1) % $no_of_points;            $area += $ring[$i]['x'] * $ring[$j]['y'];            $area -= $ring[$i]['y'] * $ring[$j]['x'];        }        $area /= 2.0;        return $area;    }    /**     * Determines whether a set of points represents an outer ring.     * If points are in clockwise orientation then, they form an outer ring.     *     * @param array $ring array of points forming the ring     *     * @return whether a set of points represents an outer ring.     */    public static function isOuterRing($ring)    {        // If area is negative then it's in clockwise orientation,        // i.e. it's an outer ring        if (PMA_GIS_Polygon::area($ring) < 0) {            return true;        }        return false;    }    /**     * Determines whether a given point is inside a given polygon.     *     * @param array $point   x, y coordinates of the point     * @param array $polygon array of points forming the ring     *     * @return whether a given point is inside a given polygon     */    public static function isPointInsidePolygon($point, $polygon)    {        // If first point is repeated at the end remove it        $last = count($polygon) - 1;        if (($polygon[0]['x'] == $polygon[$last]['x'])            && ($polygon[0]['y'] == $polygon[$last]['y'])        ) {            $polygon = array_slice($polygon, 0, $last);        }        $no_of_points = count($polygon);        $counter = 0;        // Use ray casting algorithm        $p1 = $polygon[0];        for ($i = 1; $i <= $no_of_points; $i++) {            $p2 = $polygon[$i % $no_of_points];            if ($point['y'] > min(array($p1['y'], $p2['y']))) {                if ($point['y'] <= max(array($p1['y'], $p2['y']))) {                    if ($point['x'] <= max(array($p1['x'], $p2['x']))) {                        if ($p1['y'] != $p2['y']) {                            $xinters = ($point['y'] - $p1['y'])                                * ($p2['x'] - $p1['x'])                                / ($p2['y'] - $p1['y']) + $p1['x'];                            if ($p1['x'] == $p2['x'] || $point['x'] <= $xinters) {                                $counter++;                            }                        }                    }                }            }            $p1 = $p2;        }        if ($counter % 2 == 0) {            return  false;        } else {            return true;        }    }    /**     * Returns a point that is guaranteed to be on the surface of the ring.     * (for simple closed rings)     *     * @param array $ring array of points forming the ring     *     * @return a point on the surface of the ring     */    public static function getPointOnSurface($ring)    {        // Find two consecutive distinct points.        for ($i = 0; $i < count($ring) - 1; $i++) {            if ($ring[$i]['y'] != $ring[$i + 1]['y']) {                $x0 = $ring[$i]['x'];                $x1 = $ring[$i + 1]['x'];                $y0 = $ring[$i]['y'];                $y1 = $ring[$i + 1]['y'];                break;            }        }        if (! isset($x0)) {            return false;        }        // Find the mid point        $x2 = ($x0 + $x1) / 2;        $y2 = ($y0 + $y1) / 2;        // Always keep $epsilon < 1 to go with the reduction logic down here        $epsilon = 0.1;        $denominator = sqrt(pow(($y1 - $y0), 2) + pow(($x0 - $x1), 2));        $pointA = array(); $pointB = array();        while (true) {            // Get the points on either sides of the line            // with a distance of epsilon to the mid point            $pointA['x'] = $x2 + ($epsilon * ($y1 - $y0)) / $denominator;            $pointA['y'] = $y2 + ($pointA['x'] - $x2) * ($x0 - $x1) / ($y1 - $y0);            $pointB['x'] = $x2 + ($epsilon * ($y1 - $y0)) / (0 - $denominator);            $pointB['y'] = $y2 + ($pointB['x'] - $x2) * ($x0 - $x1) / ($y1 - $y0);            // One of the points should be inside the polygon,            // unless epcilon chosen is too large            if (PMA_GIS_Polygon::isPointInsidePolygon($pointA, $ring)) {                return $pointA;            } elseif (PMA_GIS_Polygon::isPointInsidePolygon($pointB, $ring)) {                return $pointB;            } else {                //If both are outside the polygon reduce the epsilon and                //recalculate the points(reduce exponentially for faster convergance)                $epsilon = pow($epsilon, 2);                if ($epsilon == 0) {                    return false;                }            }        }    }    /** Generate parameters for the GIS data editor from the value of the GIS column.     *     * @param string $value of the GIS column     * @param index  $index of the geometry     *     * @return  parameters for the GIS data editor from the value of the GIS column     */    public function generateParams($value, $index = -1)    {        if ($index == -1) {            $index = 0;            $params = array();            $data = PMA_GIS_Geometry::generateParams($value);            $params['srid'] = $data['srid'];            $wkt = $data['wkt'];        } else {            $params[$index]['gis_type'] = 'POLYGON';            $wkt = $value;        }        // Trim to remove leading 'POLYGON((' and trailing '))'        $polygon = substr($wkt, 9, (strlen($wkt) - 11));        // Seperate each linestring        $linerings = explode("),(", $polygon);        $params[$index]['POLYGON']['no_of_lines'] = count($linerings);        $j = 0;        foreach ($linerings as $linering) {            $points_arr = $this->extractPoints($linering, null);            $no_of_points = count($points_arr);            $params[$index]['POLYGON'][$j]['no_of_points'] = $no_of_points;            for ($i = 0; $i < $no_of_points; $i++) {                $params[$index]['POLYGON'][$j][$i]['x'] = $points_arr[$i][0];                $params[$index]['POLYGON'][$j][$i]['y'] = $points_arr[$i][1];            }            $j++;        }        return $params;    }}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Specialized String Functions for phpMyAdmin * * Copyright 2002 Robin Johnson <robbat2@users.sourceforge.net> * http://www.orbis-terrarum.net/?l=people.robbat2 * * Defines a set of function callbacks that have a pure C version available if * the "ctype" extension is available, but otherwise have PHP versions to use * (that are slower). * * The SQL Parser code relies heavily on these functions. * * @package PhpMyAdmin-StringType-CType *//** * Checks if a character is an alphanumeric one * * @param string   character to check for * @return  boolean  whether the character is an alphanumeric one or not */function PMA_STR_isAlnum($c){    return ctype_alnum($c);} // end of the "PMA_STR_isAlnum()" function/** * Checks if a character is an alphabetic one * * @param string   character to check for * @return  boolean  whether the character is an alphabetic one or not */function PMA_STR_isAlpha($c){    return ctype_alpha($c);} // end of the "PMA_STR_isAlpha()" function/** * Checks if a character is a digit * * @param string   character to check for * @return  boolean  whether the character is a digit or not */function PMA_STR_isDigit($c){    return ctype_digit($c);} // end of the "PMA_STR_isDigit()" function/** * Checks if a character is an upper alphabetic one * * @param string   character to check for * @return  boolean  whether the character is an upper alphabetic one or not */function PMA_STR_isUpper($c){    return ctype_upper($c);} // end of the "PMA_STR_isUpper()" function/** * Checks if a character is a lower alphabetic one * * @param string   character to check for * @return  boolean  whether the character is a lower alphabetic one or not */function PMA_STR_isLower($c){    return ctype_lower($c);} // end of the "PMA_STR_isLower()" function/** * Checks if a character is a space one * * @param string   character to check for * @return  boolean  whether the character is a space one or not */function PMA_STR_isSpace($c){    return ctype_space($c);} // end of the "PMA_STR_isSpace()" function/** * Checks if a character is an hexadecimal digit * * @param string   character to check for * @return  boolean  whether the character is an hexadecimal digit or not */function PMA_STR_isHexDigit($c){    return ctype_xdigit($c);} // end of the "PMA_STR_isHexDigit()" function?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * * @package PhpMyAdmin */if (! defined('PHPMYADMIN')) {    exit;}/** * get master replication from server */$server_master_replication = PMA_DBI_fetch_result('SHOW MASTER STATUS');/** * get slave replication from server */$server_slave_replication = PMA_DBI_fetch_result('SHOW SLAVE STATUS');/** * replication types */$replication_types = array('master', 'slave');/** * define variables for master status */$master_variables = array(    'File',    'Position',    'Binlog_Do_DB',    'Binlog_Ignore_DB',);/** * Define variables for slave status */$slave_variables  = array(    'Slave_IO_State',    'Master_Host',    'Master_User',    'Master_Port',    'Connect_Retry',    'Master_Log_File',    'Read_Master_Log_Pos',    'Relay_Log_File',    'Relay_Log_Pos',    'Relay_Master_Log_File',    'Slave_IO_Running',    'Slave_SQL_Running',    'Replicate_Do_DB',    'Replicate_Ignore_DB',    'Replicate_Do_Table',    'Replicate_Ignore_Table',    'Replicate_Wild_Do_Table',    'Replicate_Wild_Ignore_Table',    'Last_Errno',    'Last_Error',    'Skip_Counter',    'Exec_Master_Log_Pos',    'Relay_Log_Space',    'Until_Condition',    'Until_Log_File',    'Until_Log_Pos',    'Master_SSL_Allowed',    'Master_SSL_CA_File',    'Master_SSL_CA_Path',    'Master_SSL_Cert',    'Master_SSL_Cipher',    'Master_SSL_Key',    'Seconds_Behind_Master',);/** * define important variables, which need to be watched for correct running of replication in slave mode * * @usedby PMA_replication_print_status_table() */// TODO change to regexp or something, to allow for negative match. To e.g. highlight 'Last_Error'//$slave_variables_alerts = array(    'Slave_IO_Running' => 'No',    'Slave_SQL_Running' => 'No',);$slave_variables_oks = array(    'Slave_IO_Running' => 'Yes',    'Slave_SQL_Running' => 'Yes',);// check which replication is available and set $server_{master/slave}_status and assign values// replication info is more easily passed to functions/* * @todo use $replication_info everywhere instead of the generated variable names */$replication_info = array();foreach ($replication_types as $type) {    if (count(${"server_{$type}_replication"}) > 0) {        ${"server_{$type}_status"} = true;        $replication_info[$type]['status'] = true;    } else {        ${"server_{$type}_status"} = false;        $replication_info[$type]['status'] = false;    }    if (${"server_{$type}_status"}) {        if ($type == "master") {            ${"server_{$type}_Do_DB"} = explode(",", $server_master_replication[0]["Binlog_Do_DB"]);            $replication_info[$type]['Do_DB'] = ${"server_{$type}_Do_DB"};            ${"server_{$type}_Ignore_DB"} = explode(",", $server_master_replication[0]["Binlog_Ignore_DB"]);            $replication_info[$type]['Ignore_DB'] = ${"server_{$type}_Ignore_DB"};        } elseif ($type == "slave") {            ${"server_{$type}_Do_DB"} = explode(",", $server_slave_replication[0]["Replicate_Do_DB"]);            $replication_info[$type]['Do_DB'] = ${"server_{$type}_Do_DB"};            ${"server_{$type}_Ignore_DB"} = explode(",", $server_slave_replication[0]["Replicate_Ignore_DB"]);            $replication_info[$type]['Ignore_DB'] = ${"server_{$type}_Ignore_DB"};            ${"server_{$type}_Do_Table"} = explode(",", $server_slave_replication[0]["Replicate_Do_Table"]);            $replication_info[$type]['Do_Table'] = ${"server_{$type}_Do_Table"};            ${"server_{$type}_Ignore_Table"} = explode(",", $server_slave_replication[0]["Replicate_Ignore_Table"]);            $replication_info[$type]['Ignore_Table'] = ${"server_{$type}_Ignore_Table"};            ${"server_{$type}_Wild_Do_Table"} = explode(",", $server_slave_replication[0]["Replicate_Wild_Do_Table"]);            $replication_info[$type]['Wild_Do_Table'] = ${"server_{$type}_Wild_Do_Table"};            ${"server_{$type}_Wild_Ignore_Table"} = explode(",", $server_slave_replication[0]["Replicate_Wild_Ignore_Table"]);            $replication_info[$type]['Wild_Ignore_Table'] = ${"server_{$type}_Wild_Ignore_Table"};        }    }}/** * @param $string contains "dbname.tablename" * @param $what   what to extract (db|table) * @return $string the extracted part */function PMA_extract_db_or_table($string, $what = 'db'){    $list = explode(".", $string);    if ('db' == $what) {        return $list[0];    } else {        return $list[1];    }}/** * @param string $action  possible values: START or STOP * @param string $control default: null, possible values: SQL_THREAD or IO_THREAD or null. If it is set to null, it controls both SQL_THREAD and IO_THREAD * @param mixed  $link    mysql link * * @return mixed output of PMA_DBI_try_query */function PMA_replication_slave_control($action, $control = null, $link = null){    $action = strtoupper($action);    $control = strtoupper($control);    if ($action != "START" && $action != "STOP") {        return -1;    }    if ($control != "SQL_THREAD" && $control != "IO_THREAD" && $control != null) {        return -1;    }    return PMA_DBI_try_query($action . " SLAVE " . $control . ";", $link);}/** * @param string $user     replication user on master * @param string $password password for the user * @param string $host     master's hostname or IP * @param int    $port     port, where mysql is running * @param array  $pos      position of mysql replication, array should contain fields File and Position * @param bool   $stop     shall we stop slave? * @param bool   $start    shall we start slave? * @param mixed  $link     mysql link * * @return output of CHANGE MASTER mysql command */function PMA_replication_slave_change_master($user, $password, $host, $port, $pos, $stop = true, $start = true, $link = null){    if ($stop) {        PMA_replication_slave_control("STOP", null, $link);    }    $out = PMA_DBI_try_query('CHANGE MASTER TO ' .        'MASTER_HOST=\'' . $host . '\',' .        'MASTER_PORT=' . ($port * 1) . ',' .        'MASTER_USER=\'' . $user . '\',' .        'MASTER_PASSWORD=\'' . $password . '\',' .        'MASTER_LOG_FILE=\'' . $pos["File"] . '\',' .        'MASTER_LOG_POS=' . $pos["Position"] . ';', $link);    if ($start) {        PMA_replication_slave_control("START", null, $link);    }    return $out;}/** * This function provides connection to remote mysql server * * @param string $user     mysql username * @param string $password password for the user * @param string $host     mysql server's hostname or IP * @param int    $port     mysql remote port * @param string $socket   path to unix socket * * @return mixed $link mysql link on success */function PMA_replication_connect_to_master($user, $password, $host = null, $port = null, $socket = null){    $server = array();    $server["host"] = $host;    $server["port"] = $port;    $server["socket"] = $socket;    // 5th parameter set to true means that it's an auxiliary connection    // and we must not go back to login page if it fails    return PMA_DBI_connect($user, $password, false, $server, true);}/** * @param mixed $link mysql link * * @return array - containing File and Position in MySQL replication on master server, useful for PMA_replication_slave_change_master */function PMA_replication_slave_bin_log_master($link = null){    $data = PMA_DBI_fetch_result('SHOW MASTER STATUS', null, null, $link);    $output = array();    if (! empty($data)) {        $output["File"] = $data[0]["File"];        $output["Position"] = $data[0]["Position"];    }    return $output;}/** * Get list of replicated databases on master server * * @param mixed $link mysql link * * @return array array of replicated databases */function PMA_replication_master_replicated_dbs($link = null){    $data = PMA_DBI_fetch_result('SHOW MASTER STATUS', null, null, $link); // let's find out, which databases are replicated    $do_db     = array();    $ignore_db = array();    if (! empty($data[0]['Binlog_Do_DB'])) {        $do_db     = explode(',', $data[0]['Binlog_Do_DB']);    }    if (! empty($data[0]['Binlog_Ignore_DB'])) {        $ignore_db = explode(',', $data[0]['Binlog_Ignore_DB']);    }    $tmp_alldbs = PMA_DBI_query('SHOW DATABASES;', $link);    while ($tmp_row = PMA_DBI_fetch_row($tmp_alldbs)) {        if (PMA_is_system_schema($tmp_row[0]))            continue;        if (count($do_db) == 0) {            if (array_search($tmp_row[0], $ignore_db) !== false) {                continue;            }            $dblist[] = $tmp_row[0];        } else {            if (array_search($tmp_row[0], $do_db) !== false) {                $dblist[] = $tmp_row[0];            }        }    } // end while    return $link;}/** * This function provides synchronization of structure and data between two mysql servers. * * @todo improve code sharing between the function and synchronization * * @param string $db       name of database, which should be synchronized * @param mixed  $src_link link of source server, note: if the server is current PMA server, use null * @param mixed  $trg_link link of target server, note: if the server is current PMA server, use null * @param bool   $data     if true, then data will be copied as well */function PMA_replication_synchronize_db($db, $src_link, $trg_link, $data = true){    $src_db = $trg_db = $db;    $src_tables = PMA_DBI_get_tables($src_db, $src_link);    $trg_tables = PMA_DBI_get_tables($trg_db, $trg_link);    /**     * initializing arrays to save table names     */    $source_tables_uncommon = array();    $target_tables_uncommon = array();    $matching_tables = array();    $matching_tables_num = 0;    /**     * Criterion for matching tables is just their names.     * Finding the uncommon tables for the source database     * BY comparing the matching tables with all the tables in the source database     */    PMA_getMatchingTables($trg_tables, $src_tables, $matching_tables, $source_tables_uncommon);    /**     * Finding the uncommon tables for the target database     * BY comparing the matching tables with all the tables in the target database     */    PMA_getNonMatchingTargetTables($trg_tables, $matching_tables, $target_tables_uncommon);    /**     *     * Comparing Data In the Matching Tables     * It is assumed that the matching tables are structurally     * and typely exactly the same     */    $fields_num = array();    $matching_tables_fields = array();    $matching_tables_keys   = array();    $insert_array = array(array(array()));    $update_array = array(array(array()));    $delete_array = array();    $row_count = array();    $uncommon_tables_fields = array();    $matching_tables_num = sizeof($matching_tables);    for ($i = 0; $i < sizeof($matching_tables); $i++) {        PMA_dataDiffInTables($src_db, $trg_db, $src_link, $trg_link, $matching_tables, $matching_tables_fields, $update_array, $insert_array,            $delete_array, $fields_num, $i, $matching_tables_keys);    }    for ($j = 0; $j < sizeof($source_tables_uncommon); $j++) {        PMA_dataDiffInUncommonTables($source_tables_uncommon, $src_db, $src_link, $j, $row_count);    }    /**     * INTEGRATION OF STRUCTURE DIFFERENCE CODE     *     */    $source_columns = array();    $target_columns = array();    $alter_str_array = array(array());    $add_column_array = array(array());    $uncommon_columns = array();    $target_tables_keys = array();    $source_indexes = array();    $target_indexes = array();    $add_indexes_array = array();    $alter_indexes_array = array();    $remove_indexes_array = array();    $criteria = array('Field', 'Type', 'Null', 'Collation', 'Key', 'Default', 'Comment');    for ($counter = 0; $counter < $matching_tables_num; $counter++) {        PMA_structureDiffInTables($src_db, $trg_db, $src_link, $trg_link, $matching_tables, $source_columns,            $target_columns, $alter_str_array, $add_column_array, $uncommon_columns, $criteria, $target_tables_keys, $counter);        PMA_indexesDiffInTables($src_db, $trg_db, $src_link, $trg_link, $matching_tables, $source_indexes, $target_indexes,            $add_indexes_array, $alter_indexes_array, $remove_indexes_array, $counter);    }    /**     * Generating Create Table query for all the non-matching tables present in Source but not in Target and populating tables.     */    for ($q = 0; $q < sizeof($source_tables_uncommon); $q++) {        if (isset($source_tables_uncommon[$q])) {            PMA_createTargetTables($src_db, $trg_db, $src_link, $trg_link, $source_tables_uncommon, $q, $uncommon_tables_fields, false);        }        if (isset($row_count[$q]) && $data) {            PMA_populateTargetTables($src_db, $trg_db, $src_link, $trg_link, $source_tables_uncommon, $q, $uncommon_tables_fields, false);        }    }}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * XML import plugin for phpMyAdmin * * @todo    Improve efficiency * @package PhpMyAdmin-Import * @subpackage XML */if (! defined('PHPMYADMIN')) {    exit;}/** * We need way to disable external XML entities processing. */if (!function_exists('libxml_disable_entity_loader')) {    return;}/** * The possible scopes for $plugin_param are: 'table', 'database', and 'server' */if (isset($plugin_list)) {    $plugin_list['xml'] = array(        'text' => __('XML'),        'extension' => 'xml',        'options' => array(            ),        'options_text' => __('Options'),        );    /* We do not define function when plugin is just queried for information above */    return;}$i = 0;$len = 0;$buffer = "";/** * Read in the file via PMA_importGetNextChunk so that * it can process compressed files */while (! ($finished && $i >= $len) && ! $error && ! $timeout_passed) {    $data = PMA_importGetNextChunk();    if ($data === false) {        /* subtract data we didn't handle yet and stop processing */        $offset -= strlen($buffer);        break;    } elseif ($data === true) {        /* Handle rest of buffer */    } else {        /* Append new data to buffer */        $buffer .= $data;        unset($data);    }}unset($data);/** * Disable loading of external XML entities. */libxml_disable_entity_loader();/** * Load the XML string * * The option LIBXML_COMPACT is specified because it can * result in increased performance without the need to * alter the code in any way. It's basically a freebee. */$xml = simplexml_load_string($buffer, "SimpleXMLElement", LIBXML_COMPACT);unset($buffer);/** * The XML was malformed */if ($xml === false) {    PMA_Message::error(__('The XML file specified was either malformed or incomplete. Please correct the issue and try again.'))->display();    unset($xml);    $GLOBALS['finished'] = false;    return;}/** * Table accumulator */$tables = array();/** * Row accumulator */$rows = array();/** * Temp arrays */$tempRow = array();$tempCells = array();/** * CREATE code included (by default: no) */$struct_present = false;/** * Analyze the data in each table */$namespaces = $xml->getNameSpaces(true);/** * Get the database name, collation and charset */$db_attr = $xml->children($namespaces['pma'])->{'structure_schemas'}->{'database'};if ($db_attr instanceof SimpleXMLElement) {    $db_attr = $db_attr->attributes();    $db_name = (string)$db_attr['name'];    $collation = (string)$db_attr['collation'];    $charset = (string)$db_attr['charset'];} else {    /**     * If the structure section is not present     * get the database name from the data section     */    $db_attr = $xml->children()->attributes();    $db_name = (string)$db_attr['name'];    $collation = null;    $charset = null;}/** * The XML was malformed */if ($db_name === null) {    PMA_Message::error(__('The XML file specified was either malformed or incomplete. Please correct the issue and try again.'))->display();    unset($xml);    $GLOBALS['finished'] = false;    return;}/** * Retrieve the structure information */if (isset($namespaces['pma'])) {    /**     * Get structures for all tables     */    $struct = $xml->children($namespaces['pma']);    $create = array();    foreach ($struct as $tier1 => $val1) {        foreach ($val1 as $tier2 => $val2) {            /* Need to select the correct database for the creation of tables, views, triggers, etc. */            /**             * @todo    Generating a USE here blocks importing of a table             *          into another database.             */            $attrs = $val2->attributes();            $create[] = "USE " . PMA_backquote($attrs["name"]);            foreach ($val2 as $val3) {                /**                 * Remove the extra cosmetic spacing                 */                $val3 = str_replace("                ", "", (string)$val3);                $create[] = $val3;            }        }    }    $struct_present = true;}/** * Move down the XML tree to the actual data */$xml = $xml->children()->children();$data_present = false;/** * Only attempt to analyze/collect data if there is data present */if ($xml && @$xml->count()) {    $data_present = true;    /**     * Process all database content     */    foreach ($xml as $k1 => $v1) {        $tbl_attr = $v1->attributes();        $isInTables = false;        for ($i = 0; $i < count($tables); ++$i) {            if (! strcmp($tables[$i][TBL_NAME], (string)$tbl_attr['name'])) {                $isInTables = true;                break;            }        }        if ($isInTables == false) {            $tables[] = array((string)$tbl_attr['name']);        }        foreach ($v1 as $k2 => $v2) {            $row_attr = $v2->attributes();            if (! array_search((string)$row_attr['name'], $tempRow)) {                $tempRow[] = (string)$row_attr['name'];            }            $tempCells[] = (string)$v2;        }        $rows[] = array((string)$tbl_attr['name'], $tempRow, $tempCells);        $tempRow = array();        $tempCells = array();    }    unset($tempRow);    unset($tempCells);    unset($xml);    /**     * Bring accumulated rows into the corresponding table     */    $num_tbls = count($tables);    for ($i = 0; $i < $num_tbls; ++$i) {        for ($j = 0; $j < count($rows); ++$j) {            if (! strcmp($tables[$i][TBL_NAME], $rows[$j][TBL_NAME])) {                if (! isset($tables[$i][COL_NAMES])) {                    $tables[$i][] = $rows[$j][COL_NAMES];                }                $tables[$i][ROWS][] = $rows[$j][ROWS];            }        }    }    unset($rows);    if (! $struct_present) {        $analyses = array();        $len = count($tables);        for ($i = 0; $i < $len; ++$i) {            $analyses[] = PMA_analyzeTable($tables[$i]);        }    }}unset($xml);unset($tempRows);unset($tempCells);unset($rows);/** * Only build SQL from data if there is data present */if ($data_present) {    /**     * Set values to NULL if they were not present     * to maintain PMA_buildSQL() call integrity     */    if (! isset($analyses)) {        $analyses = null;        if (! $struct_present) {            $create = null;        }    }}/** * string $db_name (no backquotes) * * array $table = array(table_name, array() column_names, array()() rows) * array $tables = array of "$table"s * * array $analysis = array(array() column_types, array() column_sizes) * array $analyses = array of "$analysis"s * * array $create = array of SQL strings * * array $options = an associative array of options *//* Set database name to the currently selected one, if applicable */if (strlen($db)) {    /* Override the database name in the XML file, if one is selected */    $db_name = $db;    $options = array('create_db' => false);} else {    if ($db_name === null) {        $db_name = 'XML_DB';    }    /* Set database collation/charset */    $options = array(        'db_collation' => $collation,        'db_charset'   => $charset,    );}/* Created and execute necessary SQL statements from data */PMA_buildSQL($db_name, $tables, $analyses, $create, $options);unset($analyses);unset($tables);unset($create);/* Commit any possible data in buffers */PMA_importRunQuery();?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * * @package PhpMyAdmin */require_once "Export_Relation_Schema.class.php";/** * This Class is EPS Library and * helps in developing structure of EPS Schema Export * * @access public * @see http://php.net/manual/en/book.xmlwriter.php */class PMA_EPS{    public $font;    public $fontSize;    public $stringCommands;    /**     * The "PMA_EPS" constructor     *     * Upon instantiation This starts writing the EPS Document.     * %!PS-Adobe-3.0 EPSF-3.0 This is the MUST first comment to include     * it shows/tells that the Post Script document is purely under     * Document Structuring Convention [DSC] and is Compliant     * Encapsulated Post Script Document     *     * @return void     * @access public     */    function __construct()    {        $this->stringCommands = "";        $this->stringCommands .= "%!PS-Adobe-3.0 EPSF-3.0 \n";    }    /**     * Set document title     *     * @param string $value sets the title text     *     * @return void     *     * @access public     */    function setTitle($value)    {        $this->stringCommands .= '%%Title: ' . $value . "\n";    }    /**     * Set document author     *     * @param string $value sets the author     *     * @return void     *     * @access public     */    function setAuthor($value)    {        $this->stringCommands .= '%%Creator: ' . $value . "\n";    }    /**     * Set document creation date     *     * @param string $value sets the date     *     * @return void     *     * @access public     */    function setDate($value)    {        $this->stringCommands .= '%%CreationDate: ' . $value . "\n";    }    /**     * Set document orientation     *     * @param string $value sets the author     *     * @return void     *     * @access public     */    function setOrientation($value)    {        $this->stringCommands .= "%%PageOrder: Ascend \n";        if ($value == "L") {            $value = "Landscape";            $this->stringCommands .= '%%Orientation: ' . $value . "\n";        } else {            $value = "Portrait";            $this->stringCommands .= '%%Orientation: ' . $value . "\n";        }        $this->stringCommands .= "%%EndComments \n";        $this->stringCommands .= "%%Pages 1 \n";        $this->stringCommands .= "%%BoundingBox: 72 150 144 170 \n";    }    /**     * Set the font and size     *     * font can be set whenever needed in EPS     *     * @param string  $value sets the font name e.g Arial     * @param integer $size  sets the size of the font e.g 10     *     * @return void     *     * @access public     */    function setFont($value, $size)    {        $this->font = $value;        $this->fontSize = $size;        $this->stringCommands .= "/" . $value . " findfont   % Get the basic font\n";        $this->stringCommands .= "" . $size . " scalefont            % Scale the font to $size points\n";        $this->stringCommands .= "setfont                 % Make it the current font\n";    }    /**     * Get the font     *     * @return string return the font name e.g Arial     * @access public     */    function getFont()    {        return $this->font;    }    /**     * Get the font Size     *     * @return string return the size of the font e.g 10     * @access public     */    function getFontSize()    {        return $this->fontSize;    }    /**     * Draw the line     *     * drawing the lines from x,y source to x,y destination and set the     * width of the line. lines helps in showing relationships of tables     *     * @param integer $x_from    The x_from attribute defines the start     *                           left position of the element     * @param integer $y_from    The y_from attribute defines the start     *                           right position of the element     * @param integer $x_to      The x_to attribute defines the end     *                           left position of the element     * @param integer $y_to      The y_to attribute defines the end     *                           right position of the element     * @param integer $lineWidth Sets the width of the line e.g 2     *     * @return void     *     * @access public     */    function line($x_from = 0, $y_from = 0, $x_to = 0, $y_to = 0, $lineWidth = 0)    {        $this->stringCommands .= $lineWidth . " setlinewidth  \n";        $this->stringCommands .= $x_from . ' ' . $y_from  . " moveto \n";        $this->stringCommands .= $x_to . ' ' . $y_to  . " lineto \n";        $this->stringCommands .= "stroke \n";    }    /**     * Draw the rectangle     *     * drawing the rectangle from x,y source to x,y destination and set the     * width of the line. rectangles drawn around the text shown of fields     *     * @param integer $x_from    The x_from attribute defines the start                                 left position of the element     * @param integer $y_from    The y_from attribute defines the start                                 right position of the element     * @param integer $x_to      The x_to attribute defines the end                                 left position of the element     * @param integer $y_to      The y_to attribute defines the end                                 right position of the element     * @param integer $lineWidth Sets the width of the line e.g 2     *     * @return void     *     * @access public     */    function rect($x_from, $y_from, $x_to, $y_to, $lineWidth)    {        $this->stringCommands .= $lineWidth . " setlinewidth  \n";        $this->stringCommands .= "newpath \n";        $this->stringCommands .= $x_from . " " . $y_from  . " moveto \n";        $this->stringCommands .= "0 " . $y_to  . " rlineto \n";        $this->stringCommands .= $x_to . " 0 rlineto \n";        $this->stringCommands .= "0 -" . $y_to  . " rlineto \n";        $this->stringCommands .= "closepath \n";        $this->stringCommands .= "stroke \n";    }    /**     * Set the current point     *     * The moveto operator takes two numbers off the stack and treats     * them as x and y coordinates to which to move. The coordinates     * specified become the current point.     *     * @param integer $x The x attribute defines the left position of the element     * @param integer $y The y attribute defines the right position of the element     *     * @return void     *     * @access public     */    function moveTo($x, $y)    {        $this->stringCommands .= $x . ' ' . $y . " moveto \n";    }    /**     * Output/Display the text     *     * @param string $text The string to be displayed     *     * @return void     *     * @access public     */    function show($text)    {        $this->stringCommands .=  '(' . $text  . ") show \n";    }    /**     * Output the text at specified co-ordinates     *     * @param string  $text String to be displayed     * @param integer $x    X attribute defines the left position of the element     * @param integer $y    Y attribute defines the right position of the element     *     * @return void     *     * @access public     */    function showXY($text, $x, $y)    {        $this->moveTo($x, $y);        $this->show($text);    }    /**     * get width of string/text     *     * EPS text width is calcualted depending on font name     * and font size. It is very important to know the width of text     * because rectangle is drawn around it.     *     * This is a bit hardcore method. I didn't found any other better than this.     * if someone found better than this. would love to hear that method     *     * @param string  $text     string that width will be calculated     * @param integer $font     name of the font like Arial,sans-serif etc     * @param integer $fontSize size of font     *     * @return integer width of the text     *     * @access public     */    function getStringWidth($text,$font,$fontSize)    {        /*         * Start by counting the width, giving each character a modifying value         */        $count = 0;        $count = $count + ((strlen($text) - strlen(str_replace(array("i", "j", "l"), "", $text))) * 0.23);//ijl        $count = $count + ((strlen($text) - strlen(str_replace(array("f"), "", $text))) * 0.27);//f        $count = $count + ((strlen($text) - strlen(str_replace(array("t", "I"), "", $text))) * 0.28);//tI        $count = $count + ((strlen($text) - strlen(str_replace(array("r"), "", $text))) * 0.34);//r        $count = $count + ((strlen($text) - strlen(str_replace(array("1"), "", $text))) * 0.49);//1        $count = $count + ((strlen($text) - strlen(str_replace(array("c", "k", "s", "v", "x", "y", "z", "J"), "", $text))) * 0.5);//cksvxyzJ        $count = $count + ((strlen($text) - strlen(str_replace(array("a", "b", "d", "e", "g", "h", "n", "o", "p", "q", "u", "L", "0", "2", "3", "4", "5", "6", "7", "8", "9"), "", $text))) * 0.56);//abdeghnopquL023456789        $count = $count + ((strlen($text) - strlen(str_replace(array("F", "T", "Z"), "", $text))) * 0.61);//FTZ        $count = $count + ((strlen($text) - strlen(str_replace(array("A", "B", "E", "K", "P", "S", "V", "X", "Y"), "", $text))) * 0.67);//ABEKPSVXY        $count = $count + ((strlen($text) - strlen(str_replace(array("w", "C", "D", "H", "N", "R", "U"), "", $text))) * 0.73);//wCDHNRU        $count = $count + ((strlen($text) - strlen(str_replace(array("G", "O", "Q"), "", $text))) * 0.78);//GOQ        $count = $count + ((strlen($text) - strlen(str_replace(array("m", "M"), "", $text))) * 0.84);//mM        $count = $count + ((strlen($text) - strlen(str_replace("W", "", $text))) * .95);//W        $count = $count + ((strlen($text) - strlen(str_replace(" ", "", $text))) * .28);//" "        $text  = str_replace(" ", "", $text);//remove the " "'s        $count = $count + (strlen(preg_replace("/[a-z0-9]/i", "", $text)) * 0.3); //all other chrs        $modifier = 1;        $font = strtolower($font);        switch($font){        /*         * no modifier for arial and sans-serif         */        case 'arial':        case 'sans-serif':            break;        /*         * .92 modifer for time, serif, brushscriptstd, and californian fb         */        case 'times':        case 'serif':        case 'brushscriptstd':        case 'californian fb':            $modifier = .92;            break;        /*         * 1.23 modifier for broadway         */        case 'broadway':            $modifier = 1.23;            break;        }        $textWidth = $count*$fontSize;        return ceil($textWidth*$modifier);    }    /**     * Ends EPS Document     *     * @return void     * @access public     */    function endEpsDoc()    {        $this->stringCommands .= "showpage \n";    }    /**     * Output EPS Document for download     *     * @param string $fileName name of the eps document     *     * @return void     *     * @access public     */    function showOutput($fileName)    {        // if(ob_get_clean()){            //ob_end_clean();        //}        $output = $this->stringCommands;        PMA_download_header($fileName . '.eps', 'image/x-eps', strlen($output));        print $output;    }}/** * Table preferences/statistics * * This class preserves the table co-ordinates,fields * and helps in drawing/generating the Tables in EPS. * * @name Table_Stats * @see PMA_EPS */class Table_Stats{    /**     * Defines properties     */    private $_tableName;    private $_showInfo = false;    public $width = 0;    public $height;    public $fields = array();    public $heightCell = 0;    public $currentCell = 0;    public $x, $y;    public $primary = array();    /**     * The "Table_Stats" constructor     *     * @param string  $tableName        The table name     * @param string  $font             The font  name     * @param integer $fontSize         The font size     * @param integer $pageNumber       Page number     * @param integer &$same_wide_width The max width among tables     * @param boolean $showKeys         Whether to display keys or not     * @param boolean $showInfo         Whether to display table position or not     *     * @global object    The current eps document     * @global integer   The current page number (from the     *                     $cfg['Servers'][$i]['table_coords'] table)     * @global array     The relations settings     * @global string    The current db name     *     * @access private     * @see PMA_EPS, Table_Stats::Table_Stats_setWidth,     *      Table_Stats::Table_Stats_setHeight     */    function __construct($tableName, $font, $fontSize, $pageNumber, &$same_wide_width,    $showKeys = false, $showInfo = false)    {        global $eps, $cfgRelation, $db;        $this->_tableName = $tableName;        $sql = 'DESCRIBE ' . PMA_backquote($tableName);        $result = PMA_DBI_try_query($sql, null, PMA_DBI_QUERY_STORE);        if (! $result || ! PMA_DBI_num_rows($result)) {            $eps->dieSchema(                $pageNumber, "EPS",                sprintf(__('The %s table doesn\'t exist!'), $tableName)            );        }        /*        * load fields        * check to see if it will load all fields or only the foreign keys        */        if ($showKeys) {            $indexes = PMA_Index::getFromTable($this->_tableName, $db);            $all_columns = array();            foreach ($indexes as $index) {                $all_columns = array_merge(                    $all_columns,                    array_flip(array_keys($index->getColumns()))                );            }            $this->fields = array_keys($all_columns);        } else {            while ($row = PMA_DBI_fetch_row($result)) {                $this->fields[] = $row[0];            }        }        $this->_showInfo = $showInfo;        // height and width        $this->_setHeightTable($fontSize);        // setWidth must me after setHeight, because title        // can include table height which changes table width        $this->_setWidthTable($font, $fontSize);        if ($same_wide_width < $this->width) {            $same_wide_width = $this->width;        }        // x and y        $sql = 'SELECT x, y FROM '            . PMA_backquote($GLOBALS['cfgRelation']['db']) . '.'            . PMA_backquote($cfgRelation['table_coords'])            . ' WHERE db_name = \'' . PMA_sqlAddSlashes($db) . '\''            . ' AND   table_name = \'' . PMA_sqlAddSlashes($tableName) . '\''            . ' AND   pdf_page_number = ' . $pageNumber;        $result = PMA_query_as_controluser($sql, false, PMA_DBI_QUERY_STORE);        if (! $result || ! PMA_DBI_num_rows($result)) {            $eps->dieSchema(                $pageNumber, "EPS",                sprintf(                    __('Please configure the coordinates for table %s'),                    $tableName                )            );        }        list($this->x, $this->y) = PMA_DBI_fetch_row($result);        $this->x = (double) $this->x;        $this->y = (double) $this->y;        // displayfield        $this->displayfield = PMA_getDisplayField($db, $tableName);        // index        $result = PMA_DBI_query(            'SHOW INDEX FROM ' . PMA_backquote($tableName) . ';',            null, PMA_DBI_QUERY_STORE        );        if (PMA_DBI_num_rows($result) > 0) {            while ($row = PMA_DBI_fetch_assoc($result)) {                if ($row['Key_name'] == 'PRIMARY') {                    $this->primary[] = $row['Column_name'];                }            }        }    }    /**     * Returns title of the current table,     * title can have the dimensions/co-ordinates of the table     *     * @return string The relation/table name     * @access private     */    private function _getTitle()    {        return ($this->_showInfo            ? sprintf('%.0f', $this->width) . 'x' . sprintf('%.0f', $this->heightCell)            : '') . ' ' . $this->_tableName;    }    /**     * Sets the width of the table     *     * @param string  $font     The font name     * @param integer $fontSize The font size     *     * @global object    The current eps document     *     * @return void     *     * @access private     * @see PMA_EPS     */    private function _setWidthTable($font,$fontSize)    {        global $eps;        foreach ($this->fields as $field) {            $this->width = max(                $this->width,                $eps->getStringWidth($field, $font, $fontSize)            );        }        $this->width += $eps->getStringWidth('      ', $font, $fontSize);        /*         * it is unknown what value must be added, because         * table title is affected by the tabe width value         */        while ($this->width < $eps->getStringWidth($this->_getTitle(), $font, $fontSize)) {            $this->width += 7;        }    }    /**     * Sets the height of the table     *     * @param integer $fontSize The font size     *     * @return void     * @access private     */    private function _setHeightTable($fontSize)    {        $this->heightCell = $fontSize + 4;        $this->height = (count($this->fields) + 1) * $this->heightCell;    }    /**     * Draw the table     *     * @param boolean $showColor Whether to display color     *     * @global object The current eps document     *     * @return void     *     * @access public     * @see PMA_EPS,PMA_EPS::line,PMA_EPS::rect     */    public function tableDraw($showColor)    {        global $eps;        //echo $this->_tableName.'<br />';        $eps->rect($this->x, $this->y + 12, $this->width, $this->heightCell, 1);        $eps->showXY($this->_getTitle(), $this->x + 5, $this->y + 14);        foreach ($this->fields as $field) {            $this->currentCell += $this->heightCell;            $showColor    = 'none';            if ($showColor) {                if (in_array($field, $this->primary)) {                    $showColor = '#0c0';                }                if ($field == $this->displayfield) {                    $showColor = 'none';                }            }            $eps->rect(                $this->x, $this->y + 12  + $this->currentCell,                $this->width, $this->heightCell, 1            );            $eps->showXY($field, $this->x + 5, $this->y + 14 + $this->currentCell);        }    }}/** * Relation preferences/statistics * * This class fetches the table master and foreign fields positions * and helps in generating the Table references and then connects * master table's master field to foreign table's foreign key * in EPS document. * * @name Relation_Stats * @see PMA_EPS */class Relation_Stats{    /**     * Defines properties     */    public $xSrc, $ySrc;    public $srcDir ;    public $destDir;    public $xDest, $yDest;    public $wTick = 10;    /**     * The "Relation_Stats" constructor     *     * @param string $master_table  The master table name     * @param string $master_field  The relation field in the master table     * @param string $foreign_table The foreign table name     * @param string $foreign_field The relation field in the foreign table     *     * @see Relation_Stats::_getXy     */    function __construct($master_table, $master_field, $foreign_table, $foreign_field)    {        $src_pos  = $this->_getXy($master_table, $master_field);        $dest_pos = $this->_getXy($foreign_table, $foreign_field);        /*        * [0] is x-left        * [1] is x-right        * [2] is y        */        $src_left   = $src_pos[0] - $this->wTick;        $src_right  = $src_pos[1] + $this->wTick;        $dest_left  = $dest_pos[0] - $this->wTick;        $dest_right = $dest_pos[1] + $this->wTick;        $d1 = abs($src_left - $dest_left);        $d2 = abs($src_right - $dest_left);        $d3 = abs($src_left - $dest_right);        $d4 = abs($src_right - $dest_right);        $d  = min($d1, $d2, $d3, $d4);        if ($d == $d1) {            $this->xSrc    = $src_pos[0];            $this->srcDir  = -1;            $this->xDest   = $dest_pos[0];            $this->destDir = -1;        } elseif ($d == $d2) {            $this->xSrc    = $src_pos[1];            $this->srcDir  = 1;            $this->xDest   = $dest_pos[0];            $this->destDir = -1;        } elseif ($d == $d3) {            $this->xSrc    = $src_pos[0];            $this->srcDir  = -1;            $this->xDest   = $dest_pos[1];            $this->destDir = 1;        } else {            $this->xSrc    = $src_pos[1];            $this->srcDir  = 1;            $this->xDest   = $dest_pos[1];            $this->destDir = 1;        }        $this->ySrc   = $src_pos[2] + 10;        $this->yDest = $dest_pos[2] + 10;    }    /**     * Gets arrows coordinates     *     * @param string $table  The current table name     * @param string $column The relation column name     *     * @return array Arrows coordinates     *     * @access private     */    private function _getXy($table, $column)    {        $pos = array_search($column, $table->fields);        // x_left, x_right, y        return array(            $table->x,            $table->x + $table->width,            $table->y + ($pos + 1.5) * $table->heightCell        );    }    /**     * draws relation links and arrows     * shows foreign key relations     *     * @param boolean $changeColor Whether to use one color per relation or not     *     * @global object The current EPS document     *     * @access public     * @see PMA_EPS     *     * @return void     */    public function relationDraw($changeColor)    {        global $eps;        if ($changeColor) {            $listOfColors = array(                'red',                'grey',                'black',                'yellow',                'green',                'cyan',            '    orange'            );            shuffle($listOfColors);            $color =  $listOfColors[0];        } else {            $color = 'black';        }        // draw a line like -- to foreign field        $eps->line(            $this->xSrc,            $this->ySrc,            $this->xSrc + $this->srcDir * $this->wTick,            $this->ySrc,            1        );        // draw a line like -- to master field        $eps->line(            $this->xDest + $this->destDir * $this->wTick,            $this->yDest,            $this->xDest,            $this->yDest,            1        );        // draw a line that connects to master field line and foreign field line        $eps->line(            $this->xSrc + $this->srcDir * $this->wTick,            $this->ySrc,            $this->xDest + $this->destDir * $this->wTick,            $this->yDest,            1        );        $root2 = 2 * sqrt(2);        $eps->line(            $this->xSrc + $this->srcDir * $this->wTick * 0.75,            $this->ySrc,            $this->xSrc + $this->srcDir * (0.75 - 1 / $root2) * $this->wTick,            $this->ySrc + $this->wTick / $root2,            1        );        $eps->line(            $this->xSrc + $this->srcDir * $this->wTick * 0.75,            $this->ySrc,            $this->xSrc + $this->srcDir * (0.75 - 1 / $root2) * $this->wTick,            $this->ySrc - $this->wTick / $root2,            1        );        $eps->line(            $this->xDest + $this->destDir * $this->wTick / 2,            $this->yDest,            $this->xDest + $this->destDir * (0.5 + 1 / $root2) * $this->wTick,            $this->yDest + $this->wTick / $root2,            1        );        $eps->line(            $this->xDest + $this->destDir * $this->wTick / 2,            $this->yDest,            $this->xDest + $this->destDir * (0.5 + 1 / $root2) * $this->wTick,            $this->yDest - $this->wTick / $root2,            1        );    }}/** end of the "Relation_Stats" class*//** * EPS Relation Schema Class * * Purpose of this class is to generate the EPS Document * which is used for representing the database diagrams. * This class uses post script commands and with * the combination of these commands actually helps in preparing EPS Document. * * This class inherits Export_Relation_Schema class has common functionality added * to this class * * @name Eps_Relation_Schema */class PMA_Eps_Relation_Schema extends PMA_Export_Relation_Schema{    private $tables = array();    private $_relations = array();    /**     * The "PMA_EPS_Relation_Schema" constructor     *     * Upon instantiation This starts writing the EPS document     * user will be prompted for download as .eps extension     *     * @return void     * @see PMA_EPS     */    function __construct()    {        global $eps,$db;        $this->setPageNumber($_POST['pdf_page_number']);        $this->setShowColor(isset($_POST['show_color']));        $this->setShowKeys(isset($_POST['show_keys']));        $this->setTableDimension(isset($_POST['show_table_dimension']));        $this->setAllTableSameWidth(isset($_POST['all_table_same_wide']));        $this->setOrientation($_POST['orientation']);        $this->setExportType($_POST['export_type']);        $eps = new PMA_EPS();        $eps->setTitle(            sprintf(                __('Schema of the %s database - Page %s'),                $db,                $this->pageNumber            )        );        $eps->setAuthor('phpMyAdmin ' . PMA_VERSION);        $eps->setDate(date("j F Y, g:i a"));        $eps->setOrientation($this->orientation);        $eps->setFont('Verdana', '10');        $alltables = $this->getAllTables($db, $this->pageNumber);        foreach ($alltables AS $table) {            if (! isset($this->tables[$table])) {                $this->tables[$table] = new Table_Stats(                    $table, $eps->getFont(), $eps->getFontSize(), $this->pageNumber,                    $this->_tablewidth, $this->showKeys, $this->tableDimension                );            }            if ($this->sameWide) {                $this->tables[$table]->width = $this->_tablewidth;            }        }        $seen_a_relation = false;        foreach ($alltables as $one_table) {            $exist_rel = PMA_getForeigners($db, $one_table, '', 'both');            if ($exist_rel) {                $seen_a_relation = true;                foreach ($exist_rel as $master_field => $rel) {                    /* put the foreign table on the schema only if selected                    * by the user                    * (do not use array_search() because we would have to                    * to do a === false and this is not PHP3 compatible)                    */                    if (in_array($rel['foreign_table'], $alltables)) {                        $this->_addRelation(                            $one_table, $eps->getFont(), $eps->getFontSize(),                            $master_field, $rel['foreign_table'],                            $rel['foreign_field'], $this->tableDimension                        );                    }                }            }        }        if ($seen_a_relation) {            $this->_drawRelations($this->showColor);        }        $this->_drawTables($this->showColor);        $eps->endEpsDoc();        $eps->showOutput($db.'-'.$this->pageNumber);        exit();    }    /**     * Defines relation objects     *     * @param string  $masterTable  The master table name     * @param string  $font         The font     * @param int     $fontSize     The font size     * @param string  $masterField  The relation field in the master table     * @param string  $foreignTable The foreign table name     * @param string  $foreignField The relation field in the foreign table     * @param boolean $showInfo     Whether to display table position or not     *     * @return void     *     * @access private     * @see _setMinMax,Table_Stats::__construct(),Relation_Stats::__construct()     */    private function _addRelation($masterTable, $font, $fontSize, $masterField,    $foreignTable, $foreignField, $showInfo)    {        if (! isset($this->tables[$masterTable])) {            $this->tables[$masterTable] = new Table_Stats(                $masterTable, $font, $fontSize, $this->pageNumber,                $this->_tablewidth, false, $showInfo            );        }        if (! isset($this->tables[$foreignTable])) {            $this->tables[$foreignTable] = new Table_Stats(                $foreignTable, $font, $fontSize, $this->pageNumber,                $this->_tablewidth, false, $showInfo            );        }        $this->_relations[] = new Relation_Stats(            $this->tables[$masterTable], $masterField,            $this->tables[$foreignTable], $foreignField        );    }    /**     * Draws relation arrows and lines connects master table's master field to     * foreign table's forein field     *     * @param boolean $changeColor Whether to use one color per relation or not     *     * @return void     *     * @access private     * @see Relation_Stats::relationDraw()     */    private function _drawRelations($changeColor)    {        foreach ($this->_relations as $relation) {            $relation->relationDraw($changeColor);        }    }    /**     * Draws tables     *     * @param boolean $changeColor Whether to show color for primary fields or not     *     * @return void     *     * @access private     * @see Table_Stats::Table_Stats_tableDraw()     */    private function _drawTables($changeColor)    {        foreach ($this->tables as $table) {            $table->tableDraw($changeColor);        }    }}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * * @package PhpMyAdmin */require_once './libraries/common.inc.php';require_once './libraries/display_import_ajax.lib.php';// AJAX requests can't be cached!PMA_no_cache_header();// $GLOBALS["message"] is used for asking for an import messageif (isset($GLOBALS["message"]) && $GLOBALS["message"]) {    header('Content-type: text/html');    // wait 0.3 sec before we check for $_SESSION variable, which is set inside import.php    usleep(300000);    // wait until message is available    while ($_SESSION['Import_message']['message'] == null) {        usleep(250000); // 0.25 sec    }    echo $_SESSION['Import_message']['message'];    echo '<fieldset class="tblFooters">' . "\n";    echo '    [ <a href="' . $_SESSION['Import_message']['go_back_url'] . '">' . __('Back') . '</a> ]' . "\n";    echo '</fieldset>'."\n";} else {    PMA_importAjaxStatus($GLOBALS["id"]);}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Specialized String Functions for phpMyAdmin * * Copyright 2002 Robin Johnson <robbat2@users.sourceforge.net> * http://www.orbis-terrarum.net/?l=people.robbat2 * * Defines a set of function callbacks that have a pure C version available if * the "ctype" extension is available, but otherwise have PHP versions to use * (that are slower). * * The SQL Parser code relies heavily on these functions. * * @package PhpMyAdmin-StringType-Native *//** * Checks if a character is an alphanumeric one * * @param string   character to check for * @return  boolean  whether the character is an alphanumeric one or not */function PMA_STR_isAlnum($c){    return (PMA_STR_isUpper($c) || PMA_STR_isLower($c) || PMA_STR_isDigit($c));} // end of the "PMA_STR_isAlnum()" function/** * Checks if a character is an alphabetic one * * @param string   character to check for * @return  boolean  whether the character is an alphabetic one or not */function PMA_STR_isAlpha($c){    return (PMA_STR_isUpper($c) || PMA_STR_isLower($c));} // end of the "PMA_STR_isAlpha()" function/** * Checks if a character is a digit * * @param string   character to check for * @return  boolean  whether the character is a digit or not */function PMA_STR_isDigit($c){    $ord_zero = 48; //ord('0');    $ord_nine = 57; //ord('9');    $ord_c    = ord($c);    return PMA_STR_numberInRangeInclusive($ord_c, $ord_zero, $ord_nine);} // end of the "PMA_STR_isDigit()" function/** * Checks if a character is an upper alphabetic one * * @param string   character to check for * @return  boolean  whether the character is an upper alphabetic one or not */function PMA_STR_isUpper($c){    $ord_zero = 65; //ord('A');    $ord_nine = 90; //ord('Z');    $ord_c    = ord($c);    return PMA_STR_numberInRangeInclusive($ord_c, $ord_zero, $ord_nine);} // end of the "PMA_STR_isUpper()" function/** * Checks if a character is a lower alphabetic one * * @param string   character to check for * @return  boolean  whether the character is a lower alphabetic one or not */function PMA_STR_isLower($c){    $ord_zero = 97;  //ord('a');    $ord_nine = 122; //ord('z');    $ord_c    = ord($c);    return PMA_STR_numberInRangeInclusive($ord_c, $ord_zero, $ord_nine);} // end of the "PMA_STR_isLower()" function/** * Checks if a character is a space one * * @param string   character to check for * @return  boolean  whether the character is a space one or not */function PMA_STR_isSpace($c){    $ord_space = 32;    //ord(' ')    $ord_tab   = 9;     //ord('\t')    $ord_CR    = 13;    //ord('\n')    $ord_NOBR  = 160;   //ord('U+00A0);    $ord_c     = ord($c);    return ($ord_c == $ord_space         || $ord_c == $ord_NOBR         || PMA_STR_numberInRangeInclusive($ord_c, $ord_tab, $ord_CR));} // end of the "PMA_STR_isSpace()" function/** * Checks if a character is an hexadecimal digit * * @param string   character to check for * @return  boolean  whether the character is an hexadecimal digit or not */function PMA_STR_isHexDigit($c){    $ord_Aupper = 65;  //ord('A');    $ord_Fupper = 70;  //ord('F');    $ord_Alower = 97;  //ord('a');    $ord_Flower = 102; //ord('f');    $ord_zero   = 48;  //ord('0');    $ord_nine   = 57;  //ord('9');    $ord_c      = ord($c);    return (PMA_STR_numberInRangeInclusive($ord_c, $ord_zero, $ord_nine)         || PMA_STR_numberInRangeInclusive($ord_c, $ord_Aupper, $ord_Fupper)         || PMA_STR_numberInRangeInclusive($ord_c, $ord_Alower, $ord_Flower));} // end of the "PMA_STR_isHexDigit()" function?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * * @package PhpMyAdmin-Designer */require_once './libraries/pmd_common.php';/** * If called directly from the designer, first save the positions */if (! isset($scale)) {    $no_die_save_pos = 1;    include_once 'pmd_save_pos.php';}if (isset($mode)) {    if ('create_export' != $mode && empty($pdf_page_number)) {        die("<script>alert('Pages not found!');history.go(-2);</script>");    }    $pmd_table = PMA_backquote($GLOBALS['cfgRelation']['db']) . '.' . PMA_backquote($GLOBALS['cfgRelation']['designer_coords']);    $pma_table = PMA_backquote($GLOBALS['cfgRelation']['db']) . '.' . PMA_backquote($cfgRelation['table_coords']);    $scale_q = PMA_sqlAddSlashes($scale);    if ('create_export' == $mode) {        $pdf_page_number = PMA_REL_create_page($newpage, $cfgRelation, $db);        if ($pdf_page_number > 0) {            $message = PMA_Message::success(__('Page has been created'));            $mode = 'export';        } else {            $message = PMA_Message::error(__('Page creation failed'));        }    }    $pdf_page_number_q = PMA_sqlAddSlashes($pdf_page_number);    if ('export' == $mode) {        $sql = "REPLACE INTO " . $pma_table . " (db_name, table_name, pdf_page_number, x, y) SELECT db_name, table_name, " . $pdf_page_number_q . ", ROUND(x/" . $scale_q . ") , ROUND(y/" . $scale_q . ") y FROM " . $pmd_table . " WHERE db_name = '" . PMA_sqlAddSlashes($db) . "'";        PMA_query_as_controluser($sql, true, PMA_DBI_QUERY_STORE);    }    if ('import' == $mode) {        PMA_query_as_controluser(        'UPDATE ' . $pma_table . ',' . $pmd_table .        ' SET ' . $pmd_table . '.`x`= ' . $pma_table . '.`x` * '. $scale_q . ',        ' . $pmd_table . '.`y`= ' . $pma_table . '.`y` * '. $scale_q .'        WHERE        ' . $pmd_table . '.`db_name`=' . $pma_table . '.`db_name`        AND        ' . $pmd_table . '.`table_name` = ' . $pma_table . '.`table_name`        AND        ' . $pmd_table . '.`db_name`=\''. PMA_sqlAddSlashes($db) .'\'        AND pdf_page_number = ' . $pdf_page_number_q . ';', true, PMA_DBI_QUERY_STORE);    }}// no need to use pmd/stylesrequire_once './libraries/header_meta_style.inc.php';?></head><body><br><div><?php    if (!empty($message)) {        $message->display();    }?>  <form name="form1" method="post" action="pmd_pdf.php"><?phpecho PMA_generate_common_hidden_inputs($db);echo '<div>';echo '<fieldset><legend>' . __('Import/Export coordinates for PDF schema') . '</legend>';$choices = array();$table_info_result = PMA_query_as_controluser('SELECT * FROM '            . PMA_backquote($GLOBALS['cfgRelation']['db']) . '.' . PMA_backquote($cfgRelation['pdf_pages'])            . ' WHERE db_name = \'' . PMA_sqlAddSlashes($db) . '\'');if (PMA_DBI_num_rows($table_info_result) > 0) {    echo '<p>' . __('Page') . ':';    echo '<select name="pdf_page_number">';    while ($page = PMA_DBI_fetch_assoc($table_info_result)) {        echo '<option value="' . $page['page_nr'] . '">';        echo htmlspecialchars($page['page_descr']);        echo '</option>';    }    echo '</select>';    echo '</p>';    $choices['import'] = __('Import from selected page');    $choices['export'] = __('Export to selected page');}$choices['create_export'] = __('Create a page and export to it');if (1 == count($choices)) {    echo $choices['create_export'];    echo '<input type="hidden" name="mode" value="create_export" />';} else {    PMA_display_html_radio('mode', $choices, $checked_choice = '', $line_break = true, $escape_label = false, $class = '');}echo '<br />';echo '<label for="newpage">' . __('New page name: ') . '</label>';echo '<input id="newpage" type="text" name="newpage" />';echo '<p>' . __('Export/Import to scale') . ':';?>      <select name="scale">        <option value="1">1:1</option>        <option value="2">1:2</option>        <option value="3" selected>1:3 (<?php echo __('recommended'); ?>)</option>        <option value="4">1:4</option>        <option value="5">1:5</option>        </select>      </p>      <input type="submit" value="<?php echo __('Go'); ?>">    </fieldset>    </div>  </form></div></body></html>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package PhpMyAdmin-Transformation */function PMA_transformation_text_plain__sql_info(){    return array(        'info' => __('Formats text as SQL query with syntax highlighting.'),        );}/** * */function PMA_transformation_text_plain__sql($buffer, $options = array(), $meta = ''){    $result = PMA_SQP_formatHtml(PMA_SQP_parse($buffer));    // Need to clear error state not to break subsequent queries display.    PMA_SQP_resetError();    return $result;}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Single signon for phpMyAdmin * * This is just example how to use session based single signon with * phpMyAdmin, it is not intended to be perfect code and look, only * shows how you can integrate this functionality in your application. * * @package PhpMyAdmin * @subpackage Example *//* Need to have cookie visible from parent directory */session_set_cookie_params(0, '/', '', 0);/* Create signon session */$session_name = 'SignonSession';session_name($session_name);session_start();/* Was data posted? */if (isset($_POST['user'])) {    /* Store there credentials */    $_SESSION['PMA_single_signon_user'] = $_POST['user'];    $_SESSION['PMA_single_signon_password'] = $_POST['password'];    $_SESSION['PMA_single_signon_host'] = $_POST['host'];    $_SESSION['PMA_single_signon_port'] = $_POST['port'];    /* Update another field of server configuration */    $_SESSION['PMA_single_signon_cfgupdate'] = array('verbose' => 'Signon test');    $id = session_id();    /* Close that session */    session_write_close();    /* Redirect to phpMyAdmin (should use absolute URL here!) */    header('Location: ../index.php');} else {    /* Show simple form */    header('Content-Type: text/html; charset=utf-8');    echo '<?xml version="1.0" encoding="utf-8"?>' . "\n";    ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head>    <link rel="icon" href="../favicon.ico" type="image/x-icon" />    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />    <title>phpMyAdmin single signon example</title></head><body><?phpif (isset($_SESSION['PMA_single_signon_error_message'])) {    echo '<p class="error">' . $_SESSION['PMA_single_signon_error_message'] . '</p>';}?><form action="signon.php" method="post">Username: <input type="text" name="user" /><br />Password: <input type="password" name="password" /><br />Host: (will use the one from config.inc.php by default) <input type="text" name="host" /><br />Port: (will use the one from config.inc.php by default) <input type="text" name="port" /><br /><input type="submit" /></form></body></html><?php}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package PhpMyAdmin-Engines *//** * the MyISAM storage engine * @package PhpMyAdmin-Engines */class PMA_StorageEngine_myisam extends PMA_StorageEngine{    /**     * returns array with variable names dedicated to MyISAM storage engine     *     * @return  array   variable names     */    function getVariables()    {        return array(            'myisam_data_pointer_size' => array(                'title' => __('Data pointer size'),                'desc'  => __('The default pointer size in bytes, to be used by CREATE TABLE for MyISAM tables when no MAX_ROWS option is specified.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_SIZE,            ),            'myisam_recover_options' => array(                'title' => __('Automatic recovery mode'),                'desc'  => __('The mode for automatic recovery of crashed MyISAM tables, as set via the --myisam-recover server startup option.'),            ),            'myisam_max_sort_file_size' => array(                'title' => __('Maximum size for temporary sort files'),                'desc'  => __('The maximum size of the temporary file MySQL is allowed to use while re-creating a MyISAM index (during REPAIR TABLE, ALTER TABLE, or LOAD DATA INFILE).'),                'type'  => PMA_ENGINE_DETAILS_TYPE_SIZE,            ),            'myisam_max_extra_sort_file_size' => array(                'title' => __('Maximum size for temporary files on index creation'),                'desc'  => __('If the temporary file used for fast MyISAM index creation would be larger than using the key cache by the amount specified here, prefer the key cache method.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_SIZE,            ),            'myisam_repair_threads' => array(                'title' => __('Repair threads'),                'desc'  => __('If this value is greater than 1, MyISAM table indexes are created in parallel (each index in its own thread) during the repair by sorting process.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_NUMERIC,            ),            'myisam_sort_buffer_size' => array(                'title' => __('Sort buffer size'),                'desc'  => __('The buffer that is allocated when sorting MyISAM indexes during a REPAIR TABLE or when creating indexes with CREATE INDEX or ALTER TABLE.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_SIZE,            ),            'myisam_stats_method' => array(            ),            'delay_key_write' => array(            ),            'bulk_insert_buffer_size' => array(                'type'  => PMA_ENGINE_DETAILS_TYPE_SIZE,            ),            'skip_external_locking' => array(            ),        );    }}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Simple interface for creating OASIS OpenDocument files. * * @package PhpMyAdmin */if (! defined('PHPMYADMIN')) {    exit;}/** * Load ZIP handler. */require_once './libraries/zip.lib.php';$GLOBALS['OpenDocumentNS'] = 'xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" '                . 'xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" '                . 'xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" '                . 'xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" '                . 'xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" ';/** * Minimalistic creator of OASIS OpenDocument * * @param string      desired MIME type * @param string      document content * * @return  string      OASIS OpenDocument data * * @access  public */function PMA_createOpenDocument($mime, $data){    $zipfile = new zipfile();    $zipfile -> addFile($mime, 'mimetype');    $zipfile -> addFile($data, 'content.xml');    $zipfile -> addFile('<?xml version="1.0" encoding="UTF-8"?'. '>'        . '<office:document-meta '            . 'xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" '            . 'xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" '            . 'office:version="1.0">'            . '<office:meta>'                . '<meta:generator>phpMyAdmin ' . PMA_VERSION . '</meta:generator>'                . '<meta:initial-creator>phpMyAdmin ' . PMA_VERSION . '</meta:initial-creator>'                . '<meta:creation-date>' . strftime('%Y-%m-%dT%H:%M:%S') . '</meta:creation-date>'            . '</office:meta>'        . '</office:document-meta>',        'meta.xml');    $zipfile -> addFile('<?xml version="1.0" encoding="UTF-8"?' . '>'        . '<office:document-styles '. $GLOBALS['OpenDocumentNS'] . 'office:version="1.0">'            . '<office:font-face-decls>'                . '<style:font-face style:name="Arial Unicode MS" svg:font-family="\'Arial Unicode MS\'" style:font-pitch="variable"/>'                . '<style:font-face style:name="DejaVu Sans1" svg:font-family="\'DejaVu Sans\'" style:font-pitch="variable"/>'                . '<style:font-face style:name="HG Mincho Light J" svg:font-family="\'HG Mincho Light J\'" style:font-pitch="variable"/>'                . '<style:font-face style:name="DejaVu Serif" svg:font-family="\'DejaVu Serif\'" style:font-family-generic="roman" style:font-pitch="variable"/>'                . '<style:font-face style:name="Thorndale" svg:font-family="Thorndale" style:font-family-generic="roman" style:font-pitch="variable"/>'                . '<style:font-face style:name="DejaVu Sans" svg:font-family="\'DejaVu Sans\'" style:font-family-generic="swiss" style:font-pitch="variable"/>'            . '</office:font-face-decls>'            . '<office:styles>'                . '<style:default-style style:family="paragraph">'                    . '<style:paragraph-properties fo:hyphenation-ladder-count="no-limit" style:text-autospace="ideograph-alpha" style:punctuation-wrap="hanging" style:line-break="strict" style:tab-stop-distance="0.4925in" style:writing-mode="page"/>'                    . '<style:text-properties style:use-window-font-color="true" style:font-name="DejaVu Serif" fo:font-size="12pt" fo:language="en" fo:country="US" style:font-name-asian="DejaVu Sans1" style:font-size-asian="12pt" style:language-asian="none" style:country-asian="none" style:font-name-complex="DejaVu Sans1" style:font-size-complex="12pt" style:language-complex="none" style:country-complex="none" fo:hyphenate="false" fo:hyphenation-remain-char-count="2" fo:hyphenation-push-char-count="2"/>'                . '</style:default-style>'                . '<style:style style:name="Standard" style:family="paragraph" style:class="text"/>'                . '<style:style style:name="Text_body" style:display-name="Text body" style:family="paragraph" style:parent-style-name="Standard" style:class="text">'                    . '<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.0835in"/>'                . '</style:style>'                . '<style:style style:name="Heading" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Text_body" style:class="text">'                    . '<style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.0835in" fo:keep-with-next="always"/>'                    . '<style:text-properties style:font-name="DejaVu Sans" fo:font-size="14pt" style:font-name-asian="DejaVu Sans1" style:font-size-asian="14pt" style:font-name-complex="DejaVu Sans1" style:font-size-complex="14pt"/>'                    . '</style:style>'                . '<style:style style:name="Heading_1" style:display-name="Heading 1" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_body" style:class="text" style:default-outline-level="1">'                    . '<style:text-properties style:font-name="Thorndale" fo:font-size="24pt" fo:font-weight="bold" style:font-name-asian="HG Mincho Light J" style:font-size-asian="24pt" style:font-weight-asian="bold" style:font-name-complex="Arial Unicode MS" style:font-size-complex="24pt" style:font-weight-complex="bold"/>'                . '</style:style>'                . '<style:style style:name="Heading_2" style:display-name="Heading 2" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_body" style:class="text" style:default-outline-level="2">'                    . '<style:text-properties style:font-name="DejaVu Serif" fo:font-size="18pt" fo:font-weight="bold" style:font-name-asian="DejaVu Sans1" style:font-size-asian="18pt" style:font-weight-asian="bold" style:font-name-complex="DejaVu Sans1" style:font-size-complex="18pt" style:font-weight-complex="bold"/>'                . '</style:style>'            . '</office:styles>'            . '<office:automatic-styles>'                . '<style:page-layout style:name="pm1">'                    . '<style:page-layout-properties fo:page-width="8.2673in" fo:page-height="11.6925in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="1in" fo:margin-bottom="1in" fo:margin-left="1.25in" fo:margin-right="1.25in" style:writing-mode="lr-tb" style:footnote-max-height="0in">'                        . '<style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>'                    . '</style:page-layout-properties>'                    . '<style:header-style/>'                    . '<style:footer-style/>'                . '</style:page-layout>'            . '</office:automatic-styles>'            . '<office:master-styles>'                . '<style:master-page style:name="Standard" style:page-layout-name="pm1"/>'            . '</office:master-styles>'        . '</office:document-styles>',        'styles.xml');    $zipfile -> addFile('<?xml version="1.0" encoding="UTF-8"?' . '>'        . '<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0">'        . '<manifest:file-entry manifest:media-type="' . $mime . '" manifest:full-path="/"/>'        . '<manifest:file-entry manifest:media-type="text/xml" manifest:full-path="content.xml"/>'        . '<manifest:file-entry manifest:media-type="text/xml" manifest:full-path="meta.xml"/>'        . '<manifest:file-entry manifest:media-type="text/xml" manifest:full-path="styles.xml"/>'        . '</manifest:manifest>',        'META-INF/manifest.xml');    return $zipfile -> file();}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Ensure the database and the table exist (else move to the "parent" script) * and display headers * * @package PhpMyAdmin */if (! defined('PHPMYADMIN')) {    exit;}if (empty($is_db)) {    if (strlen($db)) {        $is_db = @PMA_DBI_select_db($db);    } else {        $is_db = false;    }    if (! $is_db) {        // not a valid db name -> back to the welcome page        if (! defined('IS_TRANSFORMATION_WRAPPER')) {            $url_params = array('reload' => 1);            if (isset($message)) {                $url_params['message'] = $message;            }            if (! empty($sql_query)) {                $url_params['sql_query'] = $sql_query;            }            if (isset($show_as_php)) {                $url_params['show_as_php'] = $show_as_php;            }            PMA_sendHeaderLocation(                $cfg['PmaAbsoluteUri'] . 'main.php'                    . PMA_generate_common_url($url_params, '&'));        }        exit;    }} // end if (ensures db exists)if (empty($is_table) && !defined('PMA_SUBMIT_MULT') && ! defined('TABLE_MAY_BE_ABSENT')) {    // Not a valid table name -> back to the db_sql.php    if (strlen($table)) {        $is_table = isset(PMA_Table::$cache[$db][$table]);        if (! $is_table) {            $_result = PMA_DBI_try_query(                'SHOW TABLES LIKE \'' . PMA_sqlAddSlashes($table, true) . '\';',                null, PMA_DBI_QUERY_STORE);            $is_table = @PMA_DBI_num_rows($_result);            PMA_DBI_free_result($_result);        }    } else {        $is_table = false;    }    if (! $is_table) {        if (! defined('IS_TRANSFORMATION_WRAPPER')) {            if (strlen($table)) {                // SHOW TABLES doesn't show temporary tables, so try select                // (as it can happen just in case temporary table, it should be                // fast):                /**                 * @todo should this check really only happen if IS_TRANSFORMATION_WRAPPER?                 */                $_result = PMA_DBI_try_query(                    'SELECT COUNT(*) FROM ' . PMA_backquote($table) . ';',                    null, PMA_DBI_QUERY_STORE);                $is_table = ($_result && @PMA_DBI_num_rows($_result));                PMA_DBI_free_result($_result);            }            if (! $is_table) {                include './db_sql.php';                exit;            }        }        if (! $is_table) {            exit;        }    }} // end if (ensures table exists)?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * Functions for listing directories * * @todo rename to file_listing.lib.php * @package PhpMyAdmin *//** * Returns array of filtered file names * * @param string $dir        directory to list * @param string $expression regular expression to match files * @return array   sorted file list on success, false on failure */function PMA_getDirContent($dir, $expression = ''){    if (file_exists($dir) && $handle = @opendir($dir)) {        $result = array();        if (substr($dir, -1) != '/') {            $dir .= '/';        }        while ($file = @readdir($handle)) {        // for PHP < 5.2.4, is_file() gives a warning when using open_basedir        // and verifying '..' or '.'            if ('.' != $file && '..' != $file && is_file($dir . $file) && ($expression == '' || preg_match($expression, $file))) {                $result[] = $file;            }        }        @closedir($handle);        asort($result);        return $result;    } else {        return false;    }}/** * Returns options of filtered file names * * @param string $dir        directory to list * @param string $extensions regullar expression to match files * @param string $active     currently active choice * @return array   sorted file list on success, false on failure */function PMA_getFileSelectOptions($dir, $extensions = '', $active = ''){    $list = PMA_getDirContent($dir, $extensions);    if ($list === false) {        return false;    }    $result = '';    foreach ($list as $key => $val) {        $result .= '<option value="'. htmlspecialchars($val) . '"';        if ($val == $active) {            $result .= ' selected="selected"';        }        $result .= '>' . htmlspecialchars($val) . '</option>' . "\n";    }    return $result;}/** * Get currently supported decompressions. * * @return string | separated list of extensions usable in PMA_getDirContent */function PMA_supportedDecompressions(){    global $cfg;    $compressions = '';    if ($cfg['GZipDump'] && @function_exists('gzopen')) {        if (!empty($compressions)) {            $compressions .= '|';        }        $compressions .= 'gz';    }    if ($cfg['BZipDump'] && @function_exists('bzopen')) {        if (!empty($compressions)) {            $compressions .= '|';        }        $compressions .= 'bz2';    }    if ($cfg['ZipDump'] && @function_exists('gzinflate')) {        if (!empty($compressions)) {            $compressions .= '|';        }        $compressions .= 'zip';    }    return $compressions;}
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package PhpMyAdmin-Transformation */function PMA_transformation_image_jpeg__link_info(){    return array(        'info' => __('Displays a link to download this image.'),        );}/** * */function PMA_transformation_image_jpeg__link($buffer, $options = array(), $meta = ''){    include_once './libraries/transformations/global.inc.php';    $transform_options = array ('string' => '<a href="transformation_wrapper.php' . $options['wrapper_link'] . '" alt="[__BUFFER__]">[BLOB]</a>');    $buffer = PMA_transformation_global_html_replace($buffer, $transform_options);    return $buffer;}?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * * @package PhpMyAdmin */if (! defined('PHPMYADMIN')) {    exit;}/** * */require_once './libraries/common.inc.php';// Cross-framing protectionif ( false === $GLOBALS['cfg']['AllowThirdPartyFraming']) {    echo PMA_includeJS('cross_framing_protection.js');}// generate title (unless we already have $page_title, from cookie auth)if (! isset($page_title)) {    if ($GLOBALS['server'] > 0) {        $title = PMA_expandUserString(            ! empty($GLOBALS['table']) ? $GLOBALS['cfg']['TitleTable'] :            (! empty($GLOBALS['db']) ? $GLOBALS['cfg']['TitleDatabase'] :            (! empty($GLOBALS['cfg']['Server']['host']) ? $GLOBALS['cfg']['TitleServer'] :            $GLOBALS['cfg']['TitleDefault']))        );    }} else {    $title = $page_title;}// here, the function does not exist with this configuration: $cfg['ServerDefault'] = 0;$is_superuser    = function_exists('PMA_isSuperuser') && PMA_isSuperuser();$GLOBALS['js_include'][] = 'functions.js';$GLOBALS['js_include'][] = 'jquery/jquery.qtip-1.0.0-rc3.js';$params = array('lang' => $GLOBALS['lang']);if (isset($GLOBALS['db'])) {    $params['db'] = $GLOBALS['db'];}$GLOBALS['js_include'][] = 'messages.php' . PMA_generate_common_url($params);// Append the theme id to this url to invalidate the cache on a theme change$GLOBALS['js_include'][] = 'get_image.js.php?theme=' . urlencode($_SESSION['PMA_Theme']->getId());/** * Here we add a timestamp when loading the file, so that users who * upgrade phpMyAdmin are not stuck with older .js files in their * browser cache. This produces an HTTP 304 request for each file. */// avoid loading twice a js file$GLOBALS['js_include'] = array_unique($GLOBALS['js_include']);foreach ($GLOBALS['js_include'] as $js_script_file) {    echo PMA_includeJS($js_script_file);}// Below javascript Updates the title of the frameset if possible?><script type="text/javascript">// <![CDATA[if (typeof(parent.document) != 'undefined' && typeof(parent.document) != 'unknown'    && typeof(parent.document.title) == 'string') {    parent.document.title = '<?php echo (isset($title) ? PMA_sanitize(PMA_escapeJsString(htmlspecialchars($title))) : ''); ?>';}<?phpif (count($GLOBALS['js_script']) > 0) {    echo implode("\n", $GLOBALS['js_script'])."\n";}foreach ($GLOBALS['js_events'] as $js_event) {    echo "$(window.parent).bind('" . $js_event['event'] . "', "        . $js_event['function'] . ");\n";}?>// ]]></script><?php// Reloads the navigation frame via JavaScript if requiredPMA_reloadNavigation();?>
<?php/* vim: set expandtab sw=4 ts=4 sts=4: *//** * @package PhpMyAdmin-Engines *//** * the PBMS daemon * @package PhpMyAdmin-Engines */class PMA_StorageEngine_pbms extends PMA_StorageEngine{    /**     * returns array with variable names dedicated to PBMS daemon     *     * @return  array   variable names     */    function engine_init()    {        $this->engine  = "PBMS";        $this->title   = "PrimeBase Media Streaming Daemon";        $this->comment = "Provides BLOB streaming service for storage engines,";        $this->support = PMA_ENGINE_SUPPORT_YES;    }    function getVariables()    {        return array(            'pbms_garbage_threshold' => array(                'title' => __('Garbage Threshold'),                'desc'  => __('The percentage of garbage in a repository file before it is compacted.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),            'pbms_port' => array(                'title' => __('Port'),                'desc'  => __('The port for the PBMS stream-based communications. Setting this value to 0 will disable HTTP communication with the daemon.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),            'pbms_repository_threshold' => array(                'title' => __('Repository Threshold'),                'desc'  => __('The maximum size of a BLOB repository file. You may use Kb, MB or GB to indicate the unit of the value. A value in bytes is assumed when no unit is specified.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),            'pbms_temp_blob_timeout' => array(                'title' => __('Temp Blob Timeout'),                'desc'  => __('The timeout, in seconds, for temporary BLOBs. Uploaded BLOB data is removed after this time, unless they are referenced by a record in the database.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),            'pbms_temp_log_threshold' => array(                'title' => __('Temp Log Threshold'),                'desc'  => __('The maximum size of a temporary BLOB log file. You may use Kb, MB or GB to indicate the unit of the value. A value in bytes is assumed when no unit is specified.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),            'pbms_max_keep_alive' => array(                'title' => __('Max Keep Alive'),                'desc'  => __('The timeout for inactive connection with the keep-alive flag set. After this time the connection will be closed. The time-out is in milliseconds (1/1000).'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),            'pbms_http_metadata_headers' => array(                'title' => __('Metadata Headers'),                'desc'  => __('A ":" delimited list of metadata headers to be used to initialize the pbms_metadata_header table when a database is created.'),                'type'  => PMA_ENGINE_DETAILS_TYPE_PLAINTEXT            ),        );    }    //--------------------    function getInfoPages()    {        $pages = array();        $pages['Documentation'] = __('Documentation');        return $pages;    }    //--------------------    function getPage($id)    {        if (! array_key_exists($id, $this->getInfoPages())) {            return false;        }        $id = 'getPage' . $id;        return $this->$id();    }    function getPageConfigure()    {    }    function getPageDocumentation()    {        $output = '<p>'        . sprintf(__('Documentation and further information about PBMS can be found on %sThe PrimeBase Media Streaming home page%s.'), '<a href="' . PMA_linkURL('http://www.blobstreaming.org/') . '" target="_blank">', '</a>')        . '</p>' . "\n"        . '<h3>' . __('Related Links') . '</h3>' . "\n"        . '<ul>' . "\n"        . '<li><a href="' . PMA_linkURL('http://bpbdev.blogspot.com/') . '" target="_blank">' . __('The PrimeBase Media Streaming Blog by Barry Leslie') . '</a></li>' . "\n"        . '<li><a href="' . PMA_linkURL('http://www.primebase.com/xt') . '" target="_blank">' . __('PrimeBase XT Home Page') . '</a></li>' . "\n"        . '</ul>' . "\n";        return $output;    }}?>

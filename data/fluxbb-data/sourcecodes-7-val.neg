<?php/** * Copyright (C) 2008-2012 FluxBB * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher */// Tell header.php to use the admin templatedefine('PUN_ADMIN_CONSOLE', 1);// Tell common.php that we don't want output bufferingdefine('PUN_DISABLE_BUFFERING', 1);define('PUN_ROOT', dirname(__FILE__).'/');require PUN_ROOT.'include/common.php';require PUN_ROOT.'include/common_admin.php';if ($pun_user['g_id'] != PUN_ADMIN)	message($lang_common['No permission'], false, '403 Forbidden');// Load the admin_maintenance.php language filerequire PUN_ROOT.'lang/'.$admin_language.'/admin_maintenance.php';$action = isset($_REQUEST['action']) ? pun_trim($_REQUEST['action']) : '';if ($action == 'rebuild'){	$per_page = isset($_GET['i_per_page']) ? intval($_GET['i_per_page']) : 0;	$start_at = isset($_GET['i_start_at']) ? intval($_GET['i_start_at']) : 0;	// Check per page is > 0	if ($per_page < 1)		message($lang_admin_maintenance['Posts must be integer message']);	@set_time_limit(0);	// If this is the first cycle of posts we empty the search index before we proceed	if (isset($_GET['i_empty_index']))	{		// This is the only potentially "dangerous" thing we can do here, so we check the referer		confirm_referrer('admin_maintenance.php');		$db->truncate_table('search_matches') or error('Unable to empty search index match table', __FILE__, __LINE__, $db->error());		$db->truncate_table('search_words') or error('Unable to empty search index words table', __FILE__, __LINE__, $db->error());		// Reset the sequence for the search words (not needed for SQLite)		switch ($db_type)		{			case 'mysql':			case 'mysqli':			case 'mysql_innodb':			case 'mysqli_innodb':				$result = $db->query('ALTER TABLE '.$db->prefix.'search_words auto_increment=1') or error('Unable to update table auto_increment', __FILE__, __LINE__, $db->error());				break;			case 'pgsql';				$result = $db->query('SELECT setval(\''.$db->prefix.'search_words_id_seq\', 1, false)') or error('Unable to update sequence', __FILE__, __LINE__, $db->error());		}	}	$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_maintenance['Rebuilding search index']);?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title><?php echo generate_page_title($page_title) ?></title><style type="text/css">body {	font: 12px Verdana, Arial, Helvetica, sans-serif;	color: #333333;	background-color: #FFFFFF}h1 {	font-size: 16px;	font-weight: normal;}</style></head><body><h1><?php echo $lang_admin_maintenance['Rebuilding index info'] ?></h1><hr /><?php	$query_str = '';	require PUN_ROOT.'include/search_idx.php';	// Fetch posts to process this cycle	$result = $db->query('SELECT p.id, p.message, t.subject, t.first_post_id FROM '.$db->prefix.'posts AS p INNER JOIN '.$db->prefix.'topics AS t ON t.id=p.topic_id WHERE p.id >= '.$start_at.' ORDER BY p.id ASC LIMIT '.$per_page) or error('Unable to fetch posts', __FILE__, __LINE__, $db->error());	$end_at = 0;	while ($cur_item = $db->fetch_assoc($result))	{		echo '<p><span>'.sprintf($lang_admin_maintenance['Processing post'], $cur_item['id']).'</span></p>'."\n";		if ($cur_item['id'] == $cur_item['first_post_id'])			update_search_index('post', $cur_item['id'], $cur_item['message'], $cur_item['subject']);		else			update_search_index('post', $cur_item['id'], $cur_item['message']);		$end_at = $cur_item['id'];	}	// Check if there is more work to do	if ($end_at > 0)	{		$result = $db->query('SELECT id FROM '.$db->prefix.'posts WHERE id > '.$end_at.' ORDER BY id ASC LIMIT 1') or error('Unable to fetch next ID', __FILE__, __LINE__, $db->error());		if ($db->num_rows($result) > 0)			$query_str = '?action=rebuild&i_per_page='.$per_page.'&i_start_at='.$db->result($result);	}	$db->end_transaction();	$db->close();	exit('<script type="text/javascript">window.location="admin_maintenance.php'.$query_str.'"</script><hr /><p>'.sprintf($lang_admin_maintenance['Javascript redirect failed'], '<a href="admin_maintenance.php'.$query_str.'">'.$lang_admin_maintenance['Click here'].'</a>').'</p>');}if ($action == 'prune'){	$prune_from = pun_trim($_POST['prune_from']);	$prune_sticky = intval($_POST['prune_sticky']);	if (isset($_POST['prune_comply']))	{		confirm_referrer('admin_maintenance.php');		$prune_days = intval($_POST['prune_days']);		$prune_date = ($prune_days) ? time() - ($prune_days * 86400) : -1;		@set_time_limit(0);		if ($prune_from == 'all')		{			$result = $db->query('SELECT id FROM '.$db->prefix.'forums') or error('Unable to fetch forum list', __FILE__, __LINE__, $db->error());			$num_forums = $db->num_rows($result);			for ($i = 0; $i < $num_forums; ++$i)			{				$fid = $db->result($result, $i);				prune($fid, $prune_sticky, $prune_date);				update_forum($fid);			}		}		else		{			$prune_from = intval($prune_from);			prune($prune_from, $prune_sticky, $prune_date);			update_forum($prune_from);		}		// Locate any "orphaned redirect topics" and delete them		$result = $db->query('SELECT t1.id FROM '.$db->prefix.'topics AS t1 LEFT JOIN '.$db->prefix.'topics AS t2 ON t1.moved_to=t2.id WHERE t2.id IS NULL AND t1.moved_to IS NOT NULL') or error('Unable to fetch redirect topics', __FILE__, __LINE__, $db->error());		$num_orphans = $db->num_rows($result);		if ($num_orphans)		{			for ($i = 0; $i < $num_orphans; ++$i)				$orphans[] = $db->result($result, $i);			$db->query('DELETE FROM '.$db->prefix.'topics WHERE id IN('.implode(',', $orphans).')') or error('Unable to delete redirect topics', __FILE__, __LINE__, $db->error());		}		redirect('admin_maintenance.php', $lang_admin_maintenance['Posts pruned redirect']);	}	$prune_days = pun_trim($_POST['req_prune_days']);	if ($prune_days == '' || preg_match('%[^0-9]%', $prune_days))		message($lang_admin_maintenance['Days must be integer message']);	$prune_date = time() - ($prune_days * 86400);	// Concatenate together the query for counting number of topics to prune	$sql = 'SELECT COUNT(id) FROM '.$db->prefix.'topics WHERE last_post<'.$prune_date.' AND moved_to IS NULL';	if ($prune_sticky == '0')		$sql .= ' AND sticky=0';	if ($prune_from != 'all')	{		$prune_from = intval($prune_from);		$sql .= ' AND forum_id='.$prune_from;		// Fetch the forum name (just for cosmetic reasons)		$result = $db->query('SELECT forum_name FROM '.$db->prefix.'forums WHERE id='.$prune_from) or error('Unable to fetch forum name', __FILE__, __LINE__, $db->error());		$forum = '"'.pun_htmlspecialchars($db->result($result)).'"';	}	else		$forum = $lang_admin_maintenance['All forums'];	$result = $db->query($sql) or error('Unable to fetch topic prune count', __FILE__, __LINE__, $db->error());	$num_topics = $db->result($result);	if (!$num_topics)		message(sprintf($lang_admin_maintenance['No old topics message'], $prune_days));	$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Prune']);	define('PUN_ACTIVE_PAGE', 'admin');	require PUN_ROOT.'header.php';	generate_admin_menu('maintenance');?>	<div class="blockform">		<h2><span><?php echo $lang_admin_maintenance['Prune head'] ?></span></h2>		<div class="box">			<form method="post" action="admin_maintenance.php">				<div class="inform">					<input type="hidden" name="action" value="prune" />					<input type="hidden" name="prune_days" value="<?php echo $prune_days ?>" />					<input type="hidden" name="prune_sticky" value="<?php echo $prune_sticky ?>" />					<input type="hidden" name="prune_from" value="<?php echo $prune_from ?>" />					<fieldset>						<legend><?php echo $lang_admin_maintenance['Confirm prune subhead'] ?></legend>						<div class="infldset">							<p><?php printf($lang_admin_maintenance['Confirm prune info'], $prune_days, $forum, forum_number_format($num_topics)) ?></p>							<p class="warntext"><?php echo $lang_admin_maintenance['Confirm prune warn'] ?></p>						</div>					</fieldset>				</div>				<p class="buttons"><input type="submit" name="prune_comply" value="<?php echo $lang_admin_common['Prune'] ?>" /><a href="javascript:history.go(-1)"><?php echo $lang_admin_common['Go back'] ?></a></p>			</form>		</div>	</div>	<div class="clearer"></div></div><?php	require PUN_ROOT.'footer.php';	exit;}// Get the first post ID from the db$result = $db->query('SELECT id FROM '.$db->prefix.'posts ORDER BY id ASC LIMIT 1') or error('Unable to fetch topic info', __FILE__, __LINE__, $db->error());if ($db->num_rows($result))	$first_id = $db->result($result);$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Maintenance']);define('PUN_ACTIVE_PAGE', 'admin');require PUN_ROOT.'header.php';generate_admin_menu('maintenance');?>	<div class="blockform">		<h2><span><?php echo $lang_admin_maintenance['Maintenance head'] ?></span></h2>		<div class="box">			<form method="get" action="admin_maintenance.php">				<div class="inform">					<input type="hidden" name="action" value="rebuild" />					<fieldset>						<legend><?php echo $lang_admin_maintenance['Rebuild index subhead'] ?></legend>						<div class="infldset">							<p><?php printf($lang_admin_maintenance['Rebuild index info'], '<a href="admin_options.php#maintenance">'.$lang_admin_common['Maintenance mode'].'</a>') ?></p>							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php echo $lang_admin_maintenance['Posts per cycle label'] ?></th>									<td>										<input type="text" name="i_per_page" size="7" maxlength="7" value="300" tabindex="1" />										<span><?php echo $lang_admin_maintenance['Posts per cycle help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_maintenance['Starting post label'] ?></th>									<td>										<input type="text" name="i_start_at" size="7" maxlength="7" value="<?php echo (isset($first_id)) ? $first_id : 0 ?>" tabindex="2" />										<span><?php echo $lang_admin_maintenance['Starting post help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_maintenance['Empty index label'] ?></th>									<td class="inputadmin">										<label><input type="checkbox" name="i_empty_index" value="1" tabindex="3" checked="checked" />&#160;&#160;<?php echo $lang_admin_maintenance['Empty index help'] ?></label>									</td>								</tr>							</table>							<p class="topspace"><?php echo $lang_admin_maintenance['Rebuild completed info'] ?></p>							<div class="fsetsubmit"><input type="submit" name="rebuild_index" value="<?php echo $lang_admin_maintenance['Rebuild index'] ?>" tabindex="4" /></div>						</div>					</fieldset>				</div>			</form>			<form method="post" action="admin_maintenance.php" onsubmit="return process_form(this)">				<div class="inform">					<input type="hidden" name="action" value="prune" />					<fieldset>						<legend><?php echo $lang_admin_maintenance['Prune subhead'] ?></legend>						<div class="infldset">							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php echo $lang_admin_maintenance['Days old label'] ?></th>									<td>										<input type="text" name="req_prune_days" size="3" maxlength="3" tabindex="5" />										<span><?php echo $lang_admin_maintenance['Days old help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_maintenance['Prune sticky label'] ?></th>									<td>										<label class="conl"><input type="radio" name="prune_sticky" value="1" tabindex="6" checked="checked" />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="prune_sticky" value="0" />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_maintenance['Prune sticky help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_maintenance['Prune from label'] ?></th>									<td>										<select name="prune_from" tabindex="7">											<option value="all"><?php echo $lang_admin_maintenance['All forums'] ?></option><?php	$result = $db->query('SELECT c.id AS cid, c.cat_name, f.id AS fid, f.forum_name FROM '.$db->prefix.'categories AS c INNER JOIN '.$db->prefix.'forums AS f ON c.id=f.cat_id WHERE f.redirect_url IS NULL ORDER BY c.disp_position, c.id, f.disp_position') or error('Unable to fetch category/forum list', __FILE__, __LINE__, $db->error());	$cur_category = 0;	while ($forum = $db->fetch_assoc($result))	{		if ($forum['cid'] != $cur_category) // Are we still in the same category?		{			if ($cur_category)				echo "\t\t\t\t\t\t\t\t\t\t\t".'</optgroup>'."\n";			echo "\t\t\t\t\t\t\t\t\t\t\t".'<optgroup label="'.pun_htmlspecialchars($forum['cat_name']).'">'."\n";			$cur_category = $forum['cid'];		}		echo "\t\t\t\t\t\t\t\t\t\t\t\t".'<option value="'.$forum['fid'].'">'.pun_htmlspecialchars($forum['forum_name']).'</option>'."\n";	}?>											</optgroup>										</select>										<span><?php echo $lang_admin_maintenance['Prune from help'] ?></span>									</td>								</tr>							</table>							<p class="topspace"><?php printf($lang_admin_maintenance['Prune info'], '<a href="admin_options.php#maintenance">'.$lang_admin_common['Maintenance mode'].'</a>') ?></p>							<div class="fsetsubmit"><input type="submit" name="prune" value="<?php echo $lang_admin_common['Prune'] ?>" tabindex="8" /></div>						</div>					</fieldset>				</div>			</form>		</div>	</div>	<div class="clearer"></div></div><?phprequire PUN_ROOT.'footer.php';
<?php/** * Copyright (C) 2008-2012 FluxBB * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher */// Make sure no one attempts to run this script "directly"if (!defined('PUN'))	exit;// Make sure we have a usable language pack for admin.if (file_exists(PUN_ROOT.'lang/'.$pun_user['language'].'/admin_common.php'))	$admin_language = $pun_user['language'];else if (file_exists(PUN_ROOT.'lang/'.$pun_config['o_default_lang'].'/admin_common.php'))	$admin_language = $pun_config['o_default_lang'];else	$admin_language = 'English';// Attempt to load the admin_common language filerequire PUN_ROOT.'lang/'.$admin_language.'/admin_common.php';//// Display the admin navigation menu//function generate_admin_menu($page = ''){	global $pun_config, $pun_user, $lang_admin_common;	$is_admin = $pun_user['g_id'] == PUN_ADMIN ? true : false;?><div id="adminconsole" class="block2col">	<div id="adminmenu" class="blockmenu">		<h2><span><?php echo $lang_admin_common['Moderator menu'] ?></span></h2>		<div class="box">			<div class="inbox">				<ul>					<li<?php if ($page == 'index') echo ' class="isactive"'; ?>><a href="admin_index.php"><?php echo $lang_admin_common['Index'] ?></a></li>					<li<?php if ($page == 'users') echo ' class="isactive"'; ?>><a href="admin_users.php"><?php echo $lang_admin_common['Users'] ?></a></li><?php if ($is_admin || $pun_user['g_mod_ban_users'] == '1'): ?>					<li<?php if ($page == 'bans') echo ' class="isactive"'; ?>><a href="admin_bans.php"><?php echo $lang_admin_common['Bans'] ?></a></li><?php endif; if ($is_admin || $pun_config['o_report_method'] == '0' || $pun_config['o_report_method'] == '2'): ?>					<li<?php if ($page == 'reports') echo ' class="isactive"'; ?>><a href="admin_reports.php"><?php echo $lang_admin_common['Reports'] ?></a></li><?php endif; ?>				</ul>			</div>		</div><?php	if ($is_admin)	{?>		<h2 class="block2"><span><?php echo $lang_admin_common['Admin menu'] ?></span></h2>		<div class="box">			<div class="inbox">				<ul>					<li<?php if ($page == 'options') echo ' class="isactive"'; ?>><a href="admin_options.php"><?php echo $lang_admin_common['Options'] ?></a></li>					<li<?php if ($page == 'permissions') echo ' class="isactive"'; ?>><a href="admin_permissions.php"><?php echo $lang_admin_common['Permissions'] ?></a></li>					<li<?php if ($page == 'categories') echo ' class="isactive"'; ?>><a href="admin_categories.php"><?php echo $lang_admin_common['Categories'] ?></a></li>					<li<?php if ($page == 'forums') echo ' class="isactive"'; ?>><a href="admin_forums.php"><?php echo $lang_admin_common['Forums'] ?></a></li>					<li<?php if ($page == 'groups') echo ' class="isactive"'; ?>><a href="admin_groups.php"><?php echo $lang_admin_common['User groups'] ?></a></li>					<li<?php if ($page == 'censoring') echo ' class="isactive"'; ?>><a href="admin_censoring.php"><?php echo $lang_admin_common['Censoring'] ?></a></li>					<li<?php if ($page == 'maintenance') echo ' class="isactive"'; ?>><a href="admin_maintenance.php"><?php echo $lang_admin_common['Maintenance'] ?></a></li>				</ul>			</div>		</div><?php	}	// See if there are any plugins	$plugins = forum_list_plugins($is_admin);	// Did we find any plugins?	if (!empty($plugins))	{?>		<h2 class="block2"><span><?php echo $lang_admin_common['Plugins menu'] ?></span></h2>		<div class="box">			<div class="inbox">				<ul><?php		foreach ($plugins as $plugin_name => $plugin)			echo "\t\t\t\t\t".'<li'.(($page == $plugin_name) ? ' class="isactive"' : '').'><a href="admin_loader.php?plugin='.$plugin_name.'">'.str_replace('_', ' ', $plugin).'</a></li>'."\n";?>				</ul>			</div>		</div><?php	}?>	</div><?php}//// Delete topics from $forum_id that are "older than" $prune_date (if $prune_sticky is 1, sticky topics will also be deleted)//function prune($forum_id, $prune_sticky, $prune_date){	global $db;	$extra_sql = ($prune_date != -1) ? ' AND last_post<'.$prune_date : '';	if (!$prune_sticky)		$extra_sql .= ' AND sticky=\'0\'';	// Fetch topics to prune	$result = $db->query('SELECT id FROM '.$db->prefix.'topics WHERE forum_id='.$forum_id.$extra_sql, true) or error('Unable to fetch topics', __FILE__, __LINE__, $db->error());	$topic_ids = '';	while ($row = $db->fetch_row($result))		$topic_ids .= (($topic_ids != '') ? ',' : '').$row[0];	if ($topic_ids != '')	{		// Fetch posts to prune		$result = $db->query('SELECT id FROM '.$db->prefix.'posts WHERE topic_id IN('.$topic_ids.')', true) or error('Unable to fetch posts', __FILE__, __LINE__, $db->error());		$post_ids = '';		while ($row = $db->fetch_row($result))			$post_ids .= (($post_ids != '') ? ',' : '').$row[0];		if ($post_ids != '')		{			// Delete topics			$db->query('DELETE FROM '.$db->prefix.'topics WHERE id IN('.$topic_ids.')') or error('Unable to prune topics', __FILE__, __LINE__, $db->error());			// Delete subscriptions			$db->query('DELETE FROM '.$db->prefix.'topic_subscriptions WHERE topic_id IN('.$topic_ids.')') or error('Unable to prune subscriptions', __FILE__, __LINE__, $db->error());			// Delete posts			$db->query('DELETE FROM '.$db->prefix.'posts WHERE id IN('.$post_ids.')') or error('Unable to prune posts', __FILE__, __LINE__, $db->error());			// We removed a bunch of posts, so now we have to update the search index			require_once PUN_ROOT.'include/search_idx.php';			strip_search_index($post_ids);		}	}}
<?php/** * Copyright (C) 2008-2012 FluxBB * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher */// Tell header.php to use the admin templatedefine('PUN_ADMIN_CONSOLE', 1);define('PUN_ROOT', dirname(__FILE__).'/');require PUN_ROOT.'include/common.php';require PUN_ROOT.'include/common_admin.php';if (!$pun_user['is_admmod'])	message($lang_common['No permission'], false, '403 Forbidden');// Load the admin_reports.php language filerequire PUN_ROOT.'lang/'.$admin_language.'/admin_reports.php';// Zap a reportif (isset($_POST['zap_id'])){	confirm_referrer('admin_reports.php');	$zap_id = intval(key($_POST['zap_id']));	$result = $db->query('SELECT zapped FROM '.$db->prefix.'reports WHERE id='.$zap_id) or error('Unable to fetch report info', __FILE__, __LINE__, $db->error());	$zapped = $db->result($result);	if ($zapped == '')		$db->query('UPDATE '.$db->prefix.'reports SET zapped='.time().', zapped_by='.$pun_user['id'].' WHERE id='.$zap_id) or error('Unable to zap report', __FILE__, __LINE__, $db->error());	// Delete old reports (which cannot be viewed anyway)	$result = $db->query('SELECT zapped FROM '.$db->prefix.'reports WHERE zapped IS NOT NULL ORDER BY zapped DESC LIMIT 10,1') or error('Unable to fetch read reports to delete', __FILE__, __LINE__, $db->error());	if ($db->num_rows($result) > 0)	{		$zapped_threshold = $db->result($result);		$db->query('DELETE FROM '.$db->prefix.'reports WHERE zapped <= '.$zapped_threshold) or error('Unable to delete old read reports', __FILE__, __LINE__, $db->error());	}	redirect('admin_reports.php', $lang_admin_reports['Report zapped redirect']);}$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Reports']);define('PUN_ACTIVE_PAGE', 'admin');require PUN_ROOT.'header.php';generate_admin_menu('reports');?>	<div class="blockform">		<h2><span><?php echo $lang_admin_reports['New reports head'] ?></span></h2>		<div class="box">			<form method="post" action="admin_reports.php?action=zap"><?php$result = $db->query('SELECT r.id, r.topic_id, r.forum_id, r.reported_by, r.created, r.message, p.id AS pid, t.subject, f.forum_name, u.username AS reporter FROM '.$db->prefix.'reports AS r LEFT JOIN '.$db->prefix.'posts AS p ON r.post_id=p.id LEFT JOIN '.$db->prefix.'topics AS t ON r.topic_id=t.id LEFT JOIN '.$db->prefix.'forums AS f ON r.forum_id=f.id LEFT JOIN '.$db->prefix.'users AS u ON r.reported_by=u.id WHERE r.zapped IS NULL ORDER BY created DESC') or error('Unable to fetch report list', __FILE__, __LINE__, $db->error());if ($db->num_rows($result)){	while ($cur_report = $db->fetch_assoc($result))	{		$reporter = ($cur_report['reporter'] != '') ? '<a href="profile.php?id='.$cur_report['reported_by'].'">'.pun_htmlspecialchars($cur_report['reporter']).'</a>' : $lang_admin_reports['Deleted user'];		$forum = ($cur_report['forum_name'] != '') ? '<span><a href="viewforum.php?id='.$cur_report['forum_id'].'">'.pun_htmlspecialchars($cur_report['forum_name']).'</a></span>' : '<span>'.$lang_admin_reports['Deleted'].'</span>';		$topic = ($cur_report['subject'] != '') ? '<span>&#160;<a href="viewtopic.php?id='.$cur_report['topic_id'].'">'.pun_htmlspecialchars($cur_report['subject']).'</a></span>' : '<span>&#160;'.$lang_admin_reports['Deleted'].'</span>';		$post = str_replace("\n", '<br />', pun_htmlspecialchars($cur_report['message']));		$post_id = ($cur_report['pid'] != '') ? '<span>&#160;<a href="viewtopic.php?pid='.$cur_report['pid'].'#p'.$cur_report['pid'].'">'.sprintf($lang_admin_reports['Post ID'], $cur_report['pid']).'</a></span>' : '<span>&#160;'.$lang_admin_reports['Deleted'].'</span>';		$report_location = array($forum, $topic, $post_id);?>				<div class="inform">					<fieldset>						<legend><?php printf($lang_admin_reports['Report subhead'], format_time($cur_report['created'])) ?></legend>						<div class="infldset">							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php printf($lang_admin_reports['Reported by'], $reporter) ?></th>									<td class="location"><?php echo implode(' ', $report_location) ?></td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_reports['Reason'] ?><div><input type="submit" name="zap_id[<?php echo $cur_report['id'] ?>]" value="<?php echo $lang_admin_reports['Zap'] ?>" /></div></th>									<td><?php echo $post ?></td>								</tr>							</table>						</div>					</fieldset>				</div><?php	}}else{?>				<div class="inform">					<fieldset>						<legend><?php echo $lang_admin_common['None'] ?></legend>						<div class="infldset">							<p><?php echo $lang_admin_reports['No new reports'] ?></p>						</div>					</fieldset>				</div><?php}?>			</form>		</div>	</div>	<div class="blockform block2">		<h2><span><?php echo $lang_admin_reports['Last 10 head'] ?></span></h2>		<div class="box">			<div class="fakeform"><?php$result = $db->query('SELECT r.id, r.topic_id, r.forum_id, r.reported_by, r.message, r.zapped, r.zapped_by AS zapped_by_id, p.id AS pid, t.subject, f.forum_name, u.username AS reporter, u2.username AS zapped_by FROM '.$db->prefix.'reports AS r LEFT JOIN '.$db->prefix.'posts AS p ON r.post_id=p.id LEFT JOIN '.$db->prefix.'topics AS t ON r.topic_id=t.id LEFT JOIN '.$db->prefix.'forums AS f ON r.forum_id=f.id LEFT JOIN '.$db->prefix.'users AS u ON r.reported_by=u.id LEFT JOIN '.$db->prefix.'users AS u2 ON r.zapped_by=u2.id WHERE r.zapped IS NOT NULL ORDER BY zapped DESC LIMIT 10') or error('Unable to fetch report list', __FILE__, __LINE__, $db->error());if ($db->num_rows($result)){	while ($cur_report = $db->fetch_assoc($result))	{		$reporter = ($cur_report['reporter'] != '') ? '<a href="profile.php?id='.$cur_report['reported_by'].'">'.pun_htmlspecialchars($cur_report['reporter']).'</a>' : $lang_admin_reports['Deleted user'];		$forum = ($cur_report['forum_name'] != '') ? '<span><a href="viewforum.php?id='.$cur_report['forum_id'].'">'.pun_htmlspecialchars($cur_report['forum_name']).'</a></span>' : '<span>'.$lang_admin_reports['Deleted'].'</span>';		$topic = ($cur_report['subject'] != '') ? '<span>&#160;<a href="viewtopic.php?id='.$cur_report['topic_id'].'">'.pun_htmlspecialchars($cur_report['subject']).'</a></span>' : '<span>&#160;'.$lang_admin_reports['Deleted'].'</span>';		$post = str_replace("\n", '<br />', pun_htmlspecialchars($cur_report['message']));		$post_id = ($cur_report['pid'] != '') ? '<span>&#160;<a href="viewtopic.php?pid='.$cur_report['pid'].'#p'.$cur_report['pid'].'">'.sprintf($lang_admin_reports['Post ID'], $cur_report['pid']).'</a></span>' : '<span>&#160;'.$lang_admin_reports['Deleted'].'</span>';		$zapped_by = ($cur_report['zapped_by'] != '') ? '<a href="profile.php?id='.$cur_report['zapped_by_id'].'">'.pun_htmlspecialchars($cur_report['zapped_by']).'</a>' : $lang_admin_reports['NA'];		$zapped_by = ($cur_report['zapped_by'] != '') ? '<strong>'.pun_htmlspecialchars($cur_report['zapped_by']).'</strong>' : $lang_admin_reports['NA'];		$report_location = array($forum, $topic, $post_id);?>				<div class="inform">					<fieldset>						<legend><?php printf($lang_admin_reports['Zapped subhead'], format_time($cur_report['zapped']), $zapped_by) ?></legend>						<div class="infldset">							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php printf($lang_admin_reports['Reported by'], $reporter) ?></th>									<td class="location"><?php echo implode(' ', $report_location) ?></td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_reports['Reason'] ?></th>									<td><?php echo $post ?></td>								</tr>							</table>						</div>					</fieldset>				</div><?php	}}else{?>				<div class="inform">					<fieldset>						<legend><?php echo $lang_admin_common['None'] ?></legend>						<div class="infldset">							<p><?php echo $lang_admin_reports['No zapped reports'] ?></p>						</div>					</fieldset>				</div><?php}?>			</div>		</div>	</div>	<div class="clearer"></div></div><?phprequire PUN_ROOT.'footer.php';
<?php/** * Copyright (C) 2008-2012 FluxBB * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher */// Tell header.php to use the admin templatedefine('PUN_ADMIN_CONSOLE', 1);define('PUN_ROOT', dirname(__FILE__).'/');require PUN_ROOT.'include/common.php';require PUN_ROOT.'include/common_admin.php';if ($pun_user['g_id'] != PUN_ADMIN)	message($lang_common['No permission'], false, '403 Forbidden');// Load the admin_permissions.php language filerequire PUN_ROOT.'lang/'.$admin_language.'/admin_permissions.php';if (isset($_POST['form_sent'])){	confirm_referrer('admin_permissions.php');	$form = array_map('intval', $_POST['form']);	foreach ($form as $key => $input)	{		// Make sure the input is never a negative value		if($input < 0)			$input = 0;		// Only update values that have changed		if (array_key_exists('p_'.$key, $pun_config) && $pun_config['p_'.$key] != $input)			$db->query('UPDATE '.$db->prefix.'config SET conf_value='.$input.' WHERE conf_name=\'p_'.$db->escape($key).'\'') or error('Unable to update board config', __FILE__, __LINE__, $db->error());	}	// Regenerate the config cache	if (!defined('FORUM_CACHE_FUNCTIONS_LOADED'))		require PUN_ROOT.'include/cache.php';	generate_config_cache();	redirect('admin_permissions.php', $lang_admin_permissions['Perms updated redirect']);}$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_admin_common['Admin'], $lang_admin_common['Permissions']);define('PUN_ACTIVE_PAGE', 'admin');require PUN_ROOT.'header.php';generate_admin_menu('permissions');?>	<div class="blockform">		<h2><span><?php echo $lang_admin_permissions['Permissions head'] ?></span></h2>		<div class="box">			<form method="post" action="admin_permissions.php">				<p class="submittop"><input type="submit" name="save" value="<?php echo $lang_admin_common['Save changes'] ?>" /></p>				<div class="inform">					<input type="hidden" name="form_sent" value="1" />					<fieldset>						<legend><?php echo $lang_admin_permissions['Posting subhead'] ?></legend>						<div class="infldset">							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php echo $lang_admin_permissions['BBCode label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[message_bbcode]" value="1"<?php if ($pun_config['p_message_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[message_bbcode]" value="0"<?php if ($pun_config['p_message_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['BBCode help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Image tag label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[message_img_tag]" value="1"<?php if ($pun_config['p_message_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[message_img_tag]" value="0"<?php if ($pun_config['p_message_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['Image tag help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['All caps message label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[message_all_caps]" value="1"<?php if ($pun_config['p_message_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[message_all_caps]" value="0"<?php if ($pun_config['p_message_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['All caps message help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['All caps subject label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[subject_all_caps]" value="1"<?php if ($pun_config['p_subject_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[subject_all_caps]" value="0"<?php if ($pun_config['p_subject_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['All caps subject help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Require e-mail label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[force_guest_email]" value="1"<?php if ($pun_config['p_force_guest_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[force_guest_email]" value="0"<?php if ($pun_config['p_force_guest_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['Require e-mail help'] ?></span>									</td>								</tr>							</table>						</div>					</fieldset>				</div>				<div class="inform">					<fieldset>						<legend><?php echo $lang_admin_permissions['Signatures subhead'] ?></legend>						<div class="infldset">							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php echo $lang_admin_permissions['BBCode sigs label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[sig_bbcode]" value="1"<?php if ($pun_config['p_sig_bbcode'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[sig_bbcode]" value="0"<?php if ($pun_config['p_sig_bbcode'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['BBCode sigs help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Image tag sigs label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[sig_img_tag]" value="1"<?php if ($pun_config['p_sig_img_tag'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[sig_img_tag]" value="0"<?php if ($pun_config['p_sig_img_tag'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['Image tag sigs help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['All caps sigs label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[sig_all_caps]" value="1"<?php if ($pun_config['p_sig_all_caps'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[sig_all_caps]" value="0"<?php if ($pun_config['p_sig_all_caps'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['All caps sigs help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Max sig length label'] ?></th>									<td>										<input type="text" name="form[sig_length]" size="5" maxlength="5" value="<?php echo $pun_config['p_sig_length'] ?>" />										<span class="clearb"><?php echo $lang_admin_permissions['Max sig length help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Max sig lines label'] ?></th>									<td>										<input type="text" name="form[sig_lines]" size="3" maxlength="3" value="<?php echo $pun_config['p_sig_lines'] ?>" />										<span class="clearb"><?php echo $lang_admin_permissions['Max sig lines help'] ?></span>									</td>								</tr>							</table>						</div>					</fieldset>				</div>				<div class="inform">					<fieldset>						<legend><?php echo $lang_admin_permissions['Registration subhead'] ?></legend>						<div class="infldset">							<table class="aligntop" cellspacing="0">								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Banned e-mail label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[allow_banned_email]" value="1"<?php if ($pun_config['p_allow_banned_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[allow_banned_email]" value="0"<?php if ($pun_config['p_allow_banned_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['Banned e-mail help'] ?></span>									</td>								</tr>								<tr>									<th scope="row"><?php echo $lang_admin_permissions['Duplicate e-mail label'] ?></th>									<td>										<label class="conl"><input type="radio" name="form[allow_dupe_email]" value="1"<?php if ($pun_config['p_allow_dupe_email'] == '1') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['Yes'] ?></strong></label>										<label class="conl"><input type="radio" name="form[allow_dupe_email]" value="0"<?php if ($pun_config['p_allow_dupe_email'] == '0') echo ' checked="checked"' ?> />&#160;<strong><?php echo $lang_admin_common['No'] ?></strong></label>										<span class="clearb"><?php echo $lang_admin_permissions['Duplicate e-mail help'] ?></span>									</td>								</tr>							</table>						</div>					</fieldset>				</div>				<p class="submitend"><input type="submit" name="save" value="<?php echo $lang_admin_common['Save changes'] ?>" /></p>			</form>		</div>	</div>	<div class="clearer"></div></div><?phprequire PUN_ROOT.'footer.php';
<?php/** * Copyright (C) 2008-2012 FluxBB * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher */define('PUN_ROOT', dirname(__FILE__).'/');require PUN_ROOT.'include/common.php';if ($pun_user['g_read_board'] == '0')	message($lang_common['No view'], false, '403 Forbidden');$action = isset($_GET['action']) ? $_GET['action'] : null;$id = isset($_GET['id']) ? intval($_GET['id']) : 0;$pid = isset($_GET['pid']) ? intval($_GET['pid']) : 0;if ($id < 1 && $pid < 1)	message($lang_common['Bad request'], false, '404 Not Found');// Load the viewtopic.php language filerequire PUN_ROOT.'lang/'.$pun_user['language'].'/topic.php';// If a post ID is specified we determine topic ID and page number so we can redirect to the correct messageif ($pid){	$result = $db->query('SELECT topic_id, posted FROM '.$db->prefix.'posts WHERE id='.$pid) or error('Unable to fetch topic ID', __FILE__, __LINE__, $db->error());	if (!$db->num_rows($result))		message($lang_common['Bad request'], false, '404 Not Found');	list($id, $posted) = $db->fetch_row($result);	// Determine on which page the post is located (depending on $forum_user['disp_posts'])	$result = $db->query('SELECT COUNT(id) FROM '.$db->prefix.'posts WHERE topic_id='.$id.' AND posted<'.$posted) or error('Unable to count previous posts', __FILE__, __LINE__, $db->error());	$num_posts = $db->result($result) + 1;	$_GET['p'] = ceil($num_posts / $pun_user['disp_posts']);}// If action=new, we redirect to the first new post (if any)else if ($action == 'new'){	if (!$pun_user['is_guest'])	{		// We need to check if this topic has been viewed recently by the user		$tracked_topics = get_tracked_topics();		$last_viewed = isset($tracked_topics['topics'][$id]) ? $tracked_topics['topics'][$id] : $pun_user['last_visit'];		$result = $db->query('SELECT MIN(id) FROM '.$db->prefix.'posts WHERE topic_id='.$id.' AND posted>'.$last_viewed) or error('Unable to fetch first new post info', __FILE__, __LINE__, $db->error());		$first_new_post_id = $db->result($result);		if ($first_new_post_id)		{			header('Location: viewtopic.php?pid='.$first_new_post_id.'#p'.$first_new_post_id);			exit;		}	}	// If there is no new post, we go to the last post	header('Location: viewtopic.php?id='.$id.'&action=last');	exit;}// If action=last, we redirect to the last postelse if ($action == 'last'){	$result = $db->query('SELECT MAX(id) FROM '.$db->prefix.'posts WHERE topic_id='.$id) or error('Unable to fetch last post info', __FILE__, __LINE__, $db->error());	$last_post_id = $db->result($result);	if ($last_post_id)	{		header('Location: viewtopic.php?pid='.$last_post_id.'#p'.$last_post_id);		exit;	}}// Fetch some info about the topicif (!$pun_user['is_guest'])	$result = $db->query('SELECT t.subject, t.closed, t.num_replies, t.sticky, t.first_post_id, f.id AS forum_id, f.forum_name, f.moderators, fp.post_replies, s.user_id AS is_subscribed FROM '.$db->prefix.'topics AS t INNER JOIN '.$db->prefix.'forums AS f ON f.id=t.forum_id LEFT JOIN '.$db->prefix.'topic_subscriptions AS s ON (t.id=s.topic_id AND s.user_id='.$pun_user['id'].') LEFT JOIN '.$db->prefix.'forum_perms AS fp ON (fp.forum_id=f.id AND fp.group_id='.$pun_user['g_id'].') WHERE (fp.read_forum IS NULL OR fp.read_forum=1) AND t.id='.$id.' AND t.moved_to IS NULL') or error('Unable to fetch topic info', __FILE__, __LINE__, $db->error());else	$result = $db->query('SELECT t.subject, t.closed, t.num_replies, t.sticky, t.first_post_id, f.id AS forum_id, f.forum_name, f.moderators, fp.post_replies, 0 AS is_subscribed FROM '.$db->prefix.'topics AS t INNER JOIN '.$db->prefix.'forums AS f ON f.id=t.forum_id LEFT JOIN '.$db->prefix.'forum_perms AS fp ON (fp.forum_id=f.id AND fp.group_id='.$pun_user['g_id'].') WHERE (fp.read_forum IS NULL OR fp.read_forum=1) AND t.id='.$id.' AND t.moved_to IS NULL') or error('Unable to fetch topic info', __FILE__, __LINE__, $db->error());if (!$db->num_rows($result))	message($lang_common['Bad request'], false, '404 Not Found');$cur_topic = $db->fetch_assoc($result);// Sort out who the moderators are and if we are currently a moderator (or an admin)$mods_array = ($cur_topic['moderators'] != '') ? unserialize($cur_topic['moderators']) : array();$is_admmod = ($pun_user['g_id'] == PUN_ADMIN || ($pun_user['g_moderator'] == '1' && array_key_exists($pun_user['username'], $mods_array))) ? true : false;// Can we or can we not post replies?if ($cur_topic['closed'] == '0'){	if (($cur_topic['post_replies'] == '' && $pun_user['g_post_replies'] == '1') || $cur_topic['post_replies'] == '1' || $is_admmod)		$post_link = "\t\t\t".'<p class="postlink conr"><a href="post.php?tid='.$id.'">'.$lang_topic['Post reply'].'</a></p>'."\n";	else		$post_link = '';}else{	$post_link = $lang_topic['Topic closed'];	if ($is_admmod)		$post_link .= ' / <a href="post.php?tid='.$id.'">'.$lang_topic['Post reply'].'</a>';	$post_link = "\t\t\t".'<p class="postlink conr">'.$post_link.'</p>'."\n";}// Add/update this topic in our list of tracked topicsif (!$pun_user['is_guest']){	$tracked_topics = get_tracked_topics();	$tracked_topics['topics'][$id] = time();	set_tracked_topics($tracked_topics);}// Determine the post offset (based on $_GET['p'])$num_pages = ceil(($cur_topic['num_replies'] + 1) / $pun_user['disp_posts']);$p = (!isset($_GET['p']) || $_GET['p'] <= 1 || $_GET['p'] > $num_pages) ? 1 : intval($_GET['p']);$start_from = $pun_user['disp_posts'] * ($p - 1);// Generate paging links$paging_links = '<span class="pages-label">'.$lang_common['Pages'].' </span>'.paginate($num_pages, $p, 'viewtopic.php?id='.$id);if ($pun_config['o_censoring'] == '1')	$cur_topic['subject'] = censor_words($cur_topic['subject']);$quickpost = false;if ($pun_config['o_quickpost'] == '1' &&	($cur_topic['post_replies'] == '1' || ($cur_topic['post_replies'] == '' && $pun_user['g_post_replies'] == '1')) &&	($cur_topic['closed'] == '0' || $is_admmod)){	// Load the post.php language file	require PUN_ROOT.'lang/'.$pun_user['language'].'/post.php';	$required_fields = array('req_message' => $lang_common['Message']);	if ($pun_user['is_guest'])	{		$required_fields['req_username'] = $lang_post['Guest name'];		if ($pun_config['p_force_guest_email'] == '1')			$required_fields['req_email'] = $lang_common['Email'];	}	$quickpost = true;}if (!$pun_user['is_guest'] && $pun_config['o_topic_subscriptions'] == '1'){	if ($cur_topic['is_subscribed'])		// I apologize for the variable naming here. It's a mix of subscription and action I guess :-)		$subscraction = "\t\t".'<p class="subscribelink clearb"><span>'.$lang_topic['Is subscribed'].' - </span><a href="misc.php?action=unsubscribe&amp;tid='.$id.'">'.$lang_topic['Unsubscribe'].'</a></p>'."\n";	else		$subscraction = "\t\t".'<p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid='.$id.'">'.$lang_topic['Subscribe'].'</a></p>'."\n";}else	$subscraction = '';if ($pun_config['o_feed_type'] == '1')	$page_head = array('feed' => '<link rel="alternate" type="application/rss+xml" href="extern.php?action=feed&amp;tid='.$id.'&amp;type=rss" title="'.$lang_common['RSS topic feed'].'" />');else if ($pun_config['o_feed_type'] == '2')	$page_head = array('feed' => '<link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid='.$id.'&amp;type=atom" title="'.$lang_common['Atom topic feed'].'" />');$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), pun_htmlspecialchars($cur_topic['forum_name']), pun_htmlspecialchars($cur_topic['subject']));define('PUN_ALLOW_INDEX', 1);define('PUN_ACTIVE_PAGE', 'index');require PUN_ROOT.'header.php';?><div class="linkst">	<div class="inbox crumbsplus">		<ul class="crumbs">			<li><a href="index.php"><?php echo $lang_common['Index'] ?></a></li>			<li><span>&#160;</span><a href="viewforum.php?id=<?php echo $cur_topic['forum_id'] ?>"><?php echo pun_htmlspecialchars($cur_topic['forum_name']) ?></a></li>			<li><span>&#160;</span><strong><a href="viewtopic.php?id=<?php echo $id ?>"><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></a></strong></li>		</ul>		<div class="pagepost">			<p class="pagelink conl"><?php echo $paging_links ?></p><?php echo $post_link ?>		</div>		<div class="clearer"></div>	</div></div><?phprequire PUN_ROOT.'include/parser.php';$post_count = 0; // Keep track of post numbers// Retrieve a list of post IDs, LIMIT is (really) expensive so we only fetch the IDs here then later fetch the remaining data$result = $db->query('SELECT id FROM '.$db->prefix.'posts WHERE topic_id='.$id.' ORDER BY id LIMIT '.$start_from.','.$pun_user['disp_posts']) or error('Unable to fetch post IDs', __FILE__, __LINE__, $db->error());$post_ids = array();for ($i = 0;$cur_post_id = $db->result($result, $i);$i++)	$post_ids[] = $cur_post_id;if (empty($post_ids))	error('The post table and topic table seem to be out of sync!', __FILE__, __LINE__);// Retrieve the posts (and their respective poster/online status)$result = $db->query('SELECT u.email, u.title, u.url, u.location, u.signature, u.email_setting, u.num_posts, u.registered, u.admin_note, p.id, p.poster AS username, p.poster_id, p.poster_ip, p.poster_email, p.message, p.hide_smilies, p.posted, p.edited, p.edited_by, g.g_id, g.g_user_title, o.user_id AS is_online FROM '.$db->prefix.'posts AS p INNER JOIN '.$db->prefix.'users AS u ON u.id=p.poster_id INNER JOIN '.$db->prefix.'groups AS g ON g.g_id=u.group_id LEFT JOIN '.$db->prefix.'online AS o ON (o.user_id=u.id AND o.user_id!=1 AND o.idle=0) WHERE p.id IN ('.implode(',', $post_ids).') ORDER BY p.id', true) or error('Unable to fetch post info', __FILE__, __LINE__, $db->error());while ($cur_post = $db->fetch_assoc($result)){	$post_count++;	$user_avatar = '';	$user_info = array();	$user_contacts = array();	$post_actions = array();	$is_online = '';	$signature = '';	// If the poster is a registered user	if ($cur_post['poster_id'] > 1)	{		if ($pun_user['g_view_users'] == '1')			$username = '<a href="profile.php?id='.$cur_post['poster_id'].'">'.pun_htmlspecialchars($cur_post['username']).'</a>';		else			$username = pun_htmlspecialchars($cur_post['username']);		$user_title = get_title($cur_post);		if ($pun_config['o_censoring'] == '1')			$user_title = censor_words($user_title);		// Format the online indicator		$is_online = ($cur_post['is_online'] == $cur_post['poster_id']) ? '<strong>'.$lang_topic['Online'].'</strong>' : '<span>'.$lang_topic['Offline'].'</span>';		if ($pun_config['o_avatars'] == '1' && $pun_user['show_avatars'] != '0')		{			if (isset($user_avatar_cache[$cur_post['poster_id']]))				$user_avatar = $user_avatar_cache[$cur_post['poster_id']];			else				$user_avatar = $user_avatar_cache[$cur_post['poster_id']] = generate_avatar_markup($cur_post['poster_id']);		}		// We only show location, register date, post count and the contact links if "Show user info" is enabled		if ($pun_config['o_show_user_info'] == '1')		{			if ($cur_post['location'] != '')			{				if ($pun_config['o_censoring'] == '1')					$cur_post['location'] = censor_words($cur_post['location']);				$user_info[] = '<dd><span>'.$lang_topic['From'].' '.pun_htmlspecialchars($cur_post['location']).'</span></dd>';			}			$user_info[] = '<dd><span>'.$lang_topic['Registered'].' '.format_time($cur_post['registered'], true).'</span></dd>';			if ($pun_config['o_show_post_count'] == '1' || $pun_user['is_admmod'])				$user_info[] = '<dd><span>'.$lang_topic['Posts'].' '.forum_number_format($cur_post['num_posts']).'</span></dd>';			// Now let's deal with the contact links (Email and URL)			if ((($cur_post['email_setting'] == '0' && !$pun_user['is_guest']) || $pun_user['is_admmod']) && $pun_user['g_send_email'] == '1')				$user_contacts[] = '<span class="email"><a href="mailto:'.$cur_post['email'].'">'.$lang_common['Email'].'</a></span>';			else if ($cur_post['email_setting'] == '1' && !$pun_user['is_guest'] && $pun_user['g_send_email'] == '1')				$user_contacts[] = '<span class="email"><a href="misc.php?email='.$cur_post['poster_id'].'">'.$lang_common['Email'].'</a></span>';			if ($cur_post['url'] != '')			{				if ($pun_config['o_censoring'] == '1')					$cur_post['url'] = censor_words($cur_post['url']);				$user_contacts[] = '<span class="website"><a href="'.pun_htmlspecialchars($cur_post['url']).'" rel="nofollow">'.$lang_topic['Website'].'</a></span>';			}		}		if ($pun_user['is_admmod'])		{			$user_info[] = '<dd><span><a href="moderate.php?get_host='.$cur_post['id'].'" title="'.pun_htmlspecialchars($cur_post['poster_ip']).'">'.$lang_topic['IP address logged'].'</a></span></dd>';			if ($cur_post['admin_note'] != '')				$user_info[] = '<dd><span>'.$lang_topic['Note'].' <strong>'.pun_htmlspecialchars($cur_post['admin_note']).'</strong></span></dd>';		}	}	// If the poster is a guest (or a user that has been deleted)	else	{		$username = pun_htmlspecialchars($cur_post['username']);		$user_title = get_title($cur_post);		if ($pun_user['is_admmod'])			$user_info[] = '<dd><span><a href="moderate.php?get_host='.$cur_post['id'].'" title="'.pun_htmlspecialchars($cur_post['poster_ip']).'">'.$lang_topic['IP address logged'].'</a></span></dd>';		if ($pun_config['o_show_user_info'] == '1' && $cur_post['poster_email'] != '' && !$pun_user['is_guest'] && $pun_user['g_send_email'] == '1')			$user_contacts[] = '<span class="email"><a href="mailto:'.$cur_post['poster_email'].'">'.$lang_common['Email'].'</a></span>';	}	// Generation post action array (quote, edit, delete etc.)	if (!$is_admmod)	{		if (!$pun_user['is_guest'])			$post_actions[] = '<li class="postreport"><span><a href="misc.php?report='.$cur_post['id'].'">'.$lang_topic['Report'].'</a></span></li>';		if ($cur_topic['closed'] == '0')		{			if ($cur_post['poster_id'] == $pun_user['id'])			{				if ((($start_from + $post_count) == 1 && $pun_user['g_delete_topics'] == '1') || (($start_from + $post_count) > 1 && $pun_user['g_delete_posts'] == '1'))					$post_actions[] = '<li class="postdelete"><span><a href="delete.php?id='.$cur_post['id'].'">'.$lang_topic['Delete'].'</a></span></li>';				if ($pun_user['g_edit_posts'] == '1')					$post_actions[] = '<li class="postedit"><span><a href="edit.php?id='.$cur_post['id'].'">'.$lang_topic['Edit'].'</a></span></li>';			}			if (($cur_topic['post_replies'] == '' && $pun_user['g_post_replies'] == '1') || $cur_topic['post_replies'] == '1')				$post_actions[] = '<li class="postquote"><span><a href="post.php?tid='.$id.'&amp;qid='.$cur_post['id'].'">'.$lang_topic['Quote'].'</a></span></li>';		}	}	else	{		$post_actions[] = '<li class="postreport"><span><a href="misc.php?report='.$cur_post['id'].'">'.$lang_topic['Report'].'</a></span></li>';		$post_actions[] = '<li class="postdelete"><span><a href="delete.php?id='.$cur_post['id'].'">'.$lang_topic['Delete'].'</a></span></li>';		$post_actions[] = '<li class="postedit"><span><a href="edit.php?id='.$cur_post['id'].'">'.$lang_topic['Edit'].'</a></span></li>';		$post_actions[] = '<li class="postquote"><span><a href="post.php?tid='.$id.'&amp;qid='.$cur_post['id'].'">'.$lang_topic['Quote'].'</a></span></li>';	}	// Perform the main parsing of the message (BBCode, smilies, censor words etc)	$cur_post['message'] = parse_message($cur_post['message'], $cur_post['hide_smilies']);	// Do signature parsing/caching	if ($pun_config['o_signatures'] == '1' && $cur_post['signature'] != '' && $pun_user['show_sig'] != '0')	{		if (isset($signature_cache[$cur_post['poster_id']]))			$signature = $signature_cache[$cur_post['poster_id']];		else		{			$signature = parse_signature($cur_post['signature']);			$signature_cache[$cur_post['poster_id']] = $signature;		}	}?><div id="p<?php echo $cur_post['id'] ?>" class="blockpost<?php echo ($post_count % 2 == 0) ? ' roweven' : ' rowodd' ?><?php if ($cur_post['id'] == $cur_topic['first_post_id']) echo ' firstpost'; ?><?php if ($post_count == 1) echo ' blockpost1'; ?>">	<h2><span><span class="conr">#<?php echo ($start_from + $post_count) ?></span> <a href="viewtopic.php?pid=<?php echo $cur_post['id'].'#p'.$cur_post['id'] ?>"><?php echo format_time($cur_post['posted']) ?></a></span></h2>	<div class="box">		<div class="inbox">			<div class="postbody">				<div class="postleft">					<dl>						<dt><strong><?php echo $username ?></strong></dt>						<dd class="usertitle"><strong><?php echo $user_title ?></strong></dd><?php if ($user_avatar != '') echo "\t\t\t\t\t\t".'<dd class="postavatar">'.$user_avatar.'</dd>'."\n"; ?><?php if (count($user_info)) echo "\t\t\t\t\t\t".implode("\n\t\t\t\t\t\t", $user_info)."\n"; ?><?php if (count($user_contacts)) echo "\t\t\t\t\t\t".'<dd class="usercontacts">'.implode(' ', $user_contacts).'</dd>'."\n"; ?>					</dl>				</div>				<div class="postright">					<h3><?php if ($cur_post['id'] != $cur_topic['first_post_id']) echo $lang_topic['Re'].' '; ?><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></h3>					<div class="postmsg">						<?php echo $cur_post['message']."\n" ?><?php if ($cur_post['edited'] != '') echo "\t\t\t\t\t\t".'<p class="postedit"><em>'.$lang_topic['Last edit'].' '.pun_htmlspecialchars($cur_post['edited_by']).' ('.format_time($cur_post['edited']).')</em></p>'."\n"; ?>					</div><?php if ($signature != '') echo "\t\t\t\t\t".'<div class="postsignature postmsg"><hr />'.$signature.'</div>'."\n"; ?>				</div>			</div>		</div>		<div class="inbox">			<div class="postfoot clearb">				<div class="postfootleft"><?php if ($cur_post['poster_id'] > 1) echo '<p>'.$is_online.'</p>'; ?></div><?php if (count($post_actions)) echo "\t\t\t\t".'<div class="postfootright">'."\n\t\t\t\t\t".'<ul>'."\n\t\t\t\t\t\t".implode("\n\t\t\t\t\t\t", $post_actions)."\n\t\t\t\t\t".'</ul>'."\n\t\t\t\t".'</div>'."\n" ?>			</div>		</div>	</div></div><?php}?><div class="postlinksb">	<div class="inbox crumbsplus">		<div class="pagepost">			<p class="pagelink conl"><?php echo $paging_links ?></p><?php echo $post_link ?>		</div>		<ul class="crumbs">			<li><a href="index.php"><?php echo $lang_common['Index'] ?></a></li>			<li><span>&#160;</span><a href="viewforum.php?id=<?php echo $cur_topic['forum_id'] ?>"><?php echo pun_htmlspecialchars($cur_topic['forum_name']) ?></a></li>			<li><span>&#160;</span><strong><a href="viewtopic.php?id=<?php echo $id ?>"><?php echo pun_htmlspecialchars($cur_topic['subject']) ?></a></strong></li>		</ul><?php echo $subscraction ?>		<div class="clearer"></div>	</div></div><?php// Display quick post if enabledif ($quickpost){$cur_index = 1;?><div id="quickpost" class="blockform">	<h2><span><?php echo $lang_topic['Quick post'] ?></span></h2>	<div class="box">		<form id="quickpostform" method="post" action="post.php?tid=<?php echo $id ?>" onsubmit="this.submit.disabled=true;if(process_form(this)){return true;}else{this.submit.disabled=false;return false;}">			<div class="inform">				<fieldset>					<legend><?php echo $lang_common['Write message legend'] ?></legend>					<div class="infldset txtarea">						<input type="hidden" name="form_sent" value="1" /><?php if ($pun_config['o_topic_subscriptions'] == '1' && ($pun_user['auto_notify'] == '1' || $cur_topic['is_subscribed'])): ?>						<input type="hidden" name="subscribe" value="1" /><?php endif; ?><?phpif ($pun_user['is_guest']){	$email_label = ($pun_config['p_force_guest_email'] == '1') ? '<strong>'.$lang_common['Email'].' <span>'.$lang_common['Required'].'</span></strong>' : $lang_common['Email'];	$email_form_name = ($pun_config['p_force_guest_email'] == '1') ? 'req_email' : 'email';?>						<label class="conl required"><strong><?php echo $lang_post['Guest name'] ?> <span><?php echo $lang_common['Required'] ?></span></strong><br /><input type="text" name="req_username" value="<?php if (isset($_POST['req_username'])) echo pun_htmlspecialchars($username); ?>" size="25" maxlength="25" tabindex="<?php echo $cur_index++ ?>" /><br /></label>						<label class="conl<?php echo ($pun_config['p_force_guest_email'] == '1') ? ' required' : '' ?>"><?php echo $email_label ?><br /><input type="text" name="<?php echo $email_form_name ?>" value="<?php if (isset($_POST[$email_form_name])) echo pun_htmlspecialchars($email); ?>" size="50" maxlength="80" tabindex="<?php echo $cur_index++ ?>" /><br /></label>						<div class="clearer"></div><?php	echo "\t\t\t\t\t\t".'<label class="required"><strong>'.$lang_common['Message'].' <span>'.$lang_common['Required'].'</span></strong><br />';}else	echo "\t\t\t\t\t\t".'<label>';?><textarea name="req_message" rows="7" cols="75" tabindex="<?php echo $cur_index++ ?>"></textarea></label>						<ul class="bblinks">							<li><span><a href="help.php#bbcode" onclick="window.open(this.href); return false;"><?php echo $lang_common['BBCode'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>							<li><span><a href="help.php#url" onclick="window.open(this.href); return false;"><?php echo $lang_common['url tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_user['g_post_links'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>							<li><span><a href="help.php#img" onclick="window.open(this.href); return false;"><?php echo $lang_common['img tag'] ?></a> <?php echo ($pun_config['p_message_bbcode'] == '1' && $pun_config['p_message_img_tag'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>							<li><span><a href="help.php#smilies" onclick="window.open(this.href); return false;"><?php echo $lang_common['Smilies'] ?></a> <?php echo ($pun_config['o_smilies'] == '1') ? $lang_common['on'] : $lang_common['off']; ?></span></li>						</ul>					</div>				</fieldset>			</div>			<p class="buttons"><input type="submit" name="submit" tabindex="<?php echo $cur_index++ ?>" value="<?php echo $lang_common['Submit'] ?>" accesskey="s" /> <input type="submit" name="preview" value="<?php echo $lang_topic['Preview'] ?>" tabindex="<?php echo $cur_index++ ?>" accesskey="p" /></p>		</form>	</div></div><?php}// Increment "num_views" for topicif ($pun_config['o_topic_views'] == '1')	$db->query('UPDATE '.$db->prefix.'topics SET num_views=num_views+1 WHERE id='.$id) or error('Unable to update topic', __FILE__, __LINE__, $db->error());$forum_id = $cur_topic['forum_id'];$footer_style = 'viewtopic';require PUN_ROOT.'footer.php';
<?php/** * Copyright (C) 2008-2012 FluxBB * based on code by Rickard Andersson copyright (C) 2002-2008 PunBB * License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher */// Tell header.php to use the help templatedefine('PUN_HELP', 1);define('PUN_ROOT', dirname(__FILE__).'/');require PUN_ROOT.'include/common.php';if ($pun_user['g_read_board'] == '0')	message($lang_common['No view'], false, '403 Forbidden');// Load the help.php language filerequire PUN_ROOT.'lang/'.$pun_user['language'].'/help.php';$page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), $lang_help['Help']);define('PUN_ACTIVE_PAGE', 'help');require PUN_ROOT.'header.php';?><h2><span><?php echo $lang_help['BBCode'] ?></span></h2><div class="box">	<div class="inbox">		<p><a name="bbcode"></a><?php echo $lang_help['BBCode info 1'] ?></p>		<p><?php echo $lang_help['BBCode info 2'] ?></p>	</div></div><h2><span><?php echo $lang_help['Text style'] ?></span></h2><div class="box">	<div class="inbox">		<p><?php echo $lang_help['Text style info'] ?></p>		<p><code>[b]<?php echo $lang_help['Bold text'] ?>[/b]</code> <?php echo $lang_help['produces'] ?> <samp><strong><?php echo $lang_help['Bold text'] ?></strong></samp></p>		<p><code>[u]<?php echo $lang_help['Underlined text'] ?>[/u]</code> <?php echo $lang_help['produces'] ?> <samp><span class="bbu"><?php echo $lang_help['Underlined text'] ?></span></samp></p>		<p><code>[i]<?php echo $lang_help['Italic text'] ?>[/i]</code> <?php echo $lang_help['produces'] ?> <samp><em><?php echo $lang_help['Italic text'] ?></em></samp></p>		<p><code>[s]<?php echo $lang_help['Strike-through text'] ?>[/s]</code> <?php echo $lang_help['produces'] ?> <samp><span class="bbs"><?php echo $lang_help['Strike-through text'] ?></span></samp></p>		<p><code>[del]<?php echo $lang_help['Deleted text'] ?>[/del]</code> <?php echo $lang_help['produces'] ?> <samp><del><?php echo $lang_help['Deleted text'] ?></del></samp></p>		<p><code>[ins]<?php echo $lang_help['Inserted text'] ?>[/ins]</code> <?php echo $lang_help['produces'] ?> <samp><ins><?php echo $lang_help['Inserted text'] ?></ins></samp></p>		<p><code>[em]<?php echo $lang_help['Emphasised text'] ?>[/em]</code> <?php echo $lang_help['produces'] ?> <samp><em><?php echo $lang_help['Emphasised text'] ?></em></samp></p>		<p><code>[color=#FF0000]<?php echo $lang_help['Red text'] ?>[/color]</code> <?php echo $lang_help['produces'] ?> <samp><span style="color: #ff0000"><?php echo $lang_help['Red text'] ?></span></samp></p>		<p><code>[color=blue]<?php echo $lang_help['Blue text'] ?>[/color]</code> <?php echo $lang_help['produces'] ?> <samp><span style="color: blue"><?php echo $lang_help['Blue text'] ?></span></samp></p>		<p><code>[h]<?php echo $lang_help['Heading text'] ?>[/h]</code> <?php echo $lang_help['produces'] ?></p> <div class="postmsg"><h5><?php echo $lang_help['Heading text'] ?></h5></div>	</div></div><h2><span><?php echo $lang_help['Links and images'] ?></span></h2><div class="box">	<div class="inbox">		<p><?php echo $lang_help['Links info'] ?></p>		<p><a name="url"></a><code>[url=<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>]<?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars($pun_config['o_board_title']) ?></a></samp></p>		<p><code>[url]<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/') ?></a></samp></p>		<p><code>[url=/help.php]<?php echo $lang_help['This help page'] ?>[/url]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/help.php') ?>"><?php echo $lang_help['This help page'] ?></a></samp></p>		<p><code>[email]myname@example.com[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@example.com">myname@example.com</a></samp></p>		<p><code>[email=myname@example.com]<?php echo $lang_help['My email address'] ?>[/email]</code> <?php echo $lang_help['produces'] ?> <samp><a href="mailto:myname@example.com"><?php echo $lang_help['My email address'] ?></a></samp></p>		<p><code>[topic=1]<?php echo $lang_help['Test topic'] ?>[/topic]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?id=1') ?>"><?php echo $lang_help['Test topic'] ?></a></samp></p>		<p><code>[topic]1[/topic]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?id=1') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?id=1') ?></a></samp></p>		<p><code>[post=1]<?php echo $lang_help['Test post'] ?>[/post]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?pid=1#p1') ?>"><?php echo $lang_help['Test post'] ?></a></samp></p>		<p><code>[post]1[/post]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?pid=1#p1') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/viewtopic.php?pid=1#p1') ?></a></samp></p>		<p><code>[forum=1]<?php echo $lang_help['Test forum'] ?>[/forum]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewforum.php?id=1') ?>"><?php echo $lang_help['Test forum'] ?></a></samp></p>		<p><code>[forum]1[/forum]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/viewforum.php?id=1') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/viewforum.php?id=1') ?></a></samp></p>		<p><code>[user=2]<?php echo $lang_help['Test user'] ?>[/user]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/profile.php?id=2') ?>"><?php echo $lang_help['Test user'] ?></a></samp></p>		<p><code>[user]2[/user]</code> <?php echo $lang_help['produces'] ?> <samp><a href="<?php echo pun_htmlspecialchars(get_base_url(true).'/profile.php?id=2') ?>"><?php echo pun_htmlspecialchars(get_base_url(true).'/profile.php?id=2') ?></a></samp></p>	</div>	<div class="inbox">		<p><a name="img"></a><?php echo $lang_help['Images info'] ?></p>		<p><code>[img=<?php echo $lang_help['FluxBB bbcode test'] ?>]<?php echo pun_htmlspecialchars(get_base_url(true)) ?>/img/test.png[/img]</code> <?php echo $lang_help['produces'] ?> <samp><img style="height: 21px" src="<?php echo pun_htmlspecialchars(get_base_url(true)) ?>/img/test.png" alt="<?php echo $lang_help['FluxBB bbcode test'] ?>" /></samp></p>	</div></div><h2><span><?php echo $lang_help['Quotes'] ?></span></h2><div class="box">	<div class="inbox">		<p><?php echo $lang_help['Quotes info'] ?></p>		<p><code>[quote=James]<?php echo $lang_help['Quote text'] ?>[/quote]</code></p>		<p><?php echo $lang_help['produces quote box'] ?></p>		<div class="postmsg">			<div class="quotebox"><cite>James <?php echo $lang_common['wrote'] ?></cite><blockquote><div><p><?php echo $lang_help['Quote text'] ?></p></div></blockquote></div>		</div>		<p><?php echo $lang_help['Quotes info 2'] ?></p>		<p><code>[quote]<?php echo $lang_help['Quote text'] ?>[/quote]</code></p>		<p><?php echo $lang_help['produces quote box'] ?></p>		<div class="postmsg">			<div class="quotebox"><blockquote><div><p><?php echo $lang_help['Quote text'] ?></p></div></blockquote></div>		</div>		<p><?php echo $lang_help['quote note'] ?></p>	</div></div><h2><span><?php echo $lang_help['Code'] ?></span></h2><div class="box">	<div class="inbox">		<p><?php echo $lang_help['Code info'] ?></p>		<p><code>[code]<?php echo $lang_help['Code text'] ?>[/code]</code></p>		<p><?php echo $lang_help['produces code box'] ?></p>		<div class="postmsg">			<div class="codebox"><pre><code><?php echo $lang_help['Code text'] ?></code></pre></div>		</div>	</div></div><h2><span><?php echo $lang_help['Lists'] ?></span></h2><div class="box">	<div class="inbox">		<p><a name="lists"></a><?php echo $lang_help['List info'] ?></p>		<p><code>[list][*]<?php echo $lang_help['List text 1'] ?>[/*][*]<?php echo $lang_help['List text 2'] ?>[/*][*]<?php echo $lang_help['List text 3'] ?>[/*][/list]</code>		<br /><span><?php echo $lang_help['produces list'] ?></span></p>		<div class="postmsg">			<ul><li><p><?php echo $lang_help['List text 1'] ?></p></li><li><p><?php echo $lang_help['List text 2'] ?></p></li><li><p><?php echo $lang_help['List text 3'] ?></p></li></ul>		</div>		<p><code>[list=1][*]<?php echo $lang_help['List text 1'] ?>[/*][*]<?php echo $lang_help['List text 2'] ?>[/*][*]<?php echo $lang_help['List text 3'] ?>[/*][/list]</code>		<br /><span><?php echo $lang_help['produces decimal list'] ?></span></p>		<div class="postmsg">			<ol class="decimal"><li><p><?php echo $lang_help['List text 1'] ?></p></li><li><p><?php echo $lang_help['List text 2'] ?></p></li><li><p><?php echo $lang_help['List text 3'] ?></p></li></ol>		</div>		<p><code>[list=a][*]<?php echo $lang_help['List text 1'] ?>[/*][*]<?php echo $lang_help['List text 2'] ?>[/*][*]<?php echo $lang_help['List text 3'] ?>[/*][/list]</code>		<br /><span><?php echo $lang_help['produces alpha list'] ?></span></p>		<div class="postmsg">			<ol class="alpha"><li><p><?php echo $lang_help['List text 1'] ?></p></li><li><p><?php echo $lang_help['List text 2'] ?></p></li><li><p><?php echo $lang_help['List text 3'] ?></p></li></ol>		</div>	</div></div><h2><span><?php echo $lang_help['Nested tags'] ?></span></h2><div class="box">	<div class="inbox">		<p><?php echo $lang_help['Nested tags info'] ?></p>		<p><code>[b][u]<?php echo $lang_help['Bold, underlined text'] ?>[/u][/b]</code> <?php echo $lang_help['produces'] ?> <samp><strong><span class="bbu"><?php echo $lang_help['Bold, underlined text'] ?></span></strong></samp></p>	</div></div><h2><span><?php echo $lang_help['Smilies'] ?></span></h2><div class="box">	<div class="inbox">		<p><a name="smilies"></a><?php echo $lang_help['Smilies info'] ?></p><?php// Display the smiley setrequire PUN_ROOT.'include/parser.php';$smiley_groups = array();foreach ($smilies as $smiley_text => $smiley_img)	$smiley_groups[$smiley_img][] = $smiley_text;foreach ($smiley_groups as $smiley_img => $smiley_texts)	echo "\t\t".'<p><code>'.implode('</code> '.$lang_common['and'].' <code>', $smiley_texts).'</code> <span>'.$lang_help['produces'].'</span> <samp><img src="'.pun_htmlspecialchars(get_base_url(true)).'/img/smilies/'.$smiley_img.'" width="15" height="15" alt="'.$smiley_texts[0].'" /></samp></p>'."\n";?>	</div></div><?phprequire PUN_ROOT.'footer.php';
